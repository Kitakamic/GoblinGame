# 人物战斗总结功能

## 功能概述

人物战斗总结功能允许玩家在战斗胜利后生成详细的人物战斗被俘过程描述，通过AI分析战斗数据，生成生动、戏剧性的人物被俘过程描述。

## 功能特性

### 1. 人物战斗总结界面
- **位置**: 战斗胜利后，在"查看战斗记录"按钮旁边
- **按钮**: "📝 生成战斗总结"
- **样式**: 紫色渐变按钮，与历史记录按钮并列显示
- **显示条件**: 只有战斗胜利且敌方有人物单位时才显示
- **人物检测**: 使用与战前对话相同的检测逻辑，检查据点数据中的英雄人物（status为'enemy'且canCombat为true）

### 2. 总结生成
- **AI分析**: 自动分析战斗数据，包括：
  - 战斗结果（仅胜利时可用）
  - 总回合数
  - 战斗过程详情
  - 人物单位状态变化
  - 关键时刻和转折点
- **生成内容**: 500-800字的详细人物战斗被俘过程描述
- **风格**: 第三人称叙述，黑暗奇幻风格，突出人物被俘的详细过程

### 3. 界面功能
- **生成按钮**: 点击生成新的战斗总结
- **重新生成**: 可以重新生成总结
- **保存功能**: 将总结保存到角色变量中
- **关闭功能**: 关闭总结界面

### 4. 数据持久化
- **保存位置**: 角色变量中的 `battle_summary_${saveKey}`
- **自动加载**: 下次打开时自动加载已保存的总结
- **唯一标识**: 每次战斗使用时间戳作为唯一标识

## 技术实现

### 文件结构
```
src/哥布林巢穴-简版/战斗/
├── 界面/
│   ├── 战斗总结界面.vue          # 战斗总结界面组件
│   └── 高级战斗界面.vue          # 主战斗界面（已集成总结功能）
└── 服务/
    └── 战斗总结服务.ts           # 战斗总结AI服务
```

### 核心组件

#### 1. 战斗总结界面 (战斗总结界面.vue)
- 基于通用对话界面设计
- 支持生成、重新生成、保存、关闭功能
- 响应式设计，支持移动端

#### 2. 战斗总结服务 (战斗总结服务.ts)
- `generateBattleSummary()`: 生成战斗总结
- `saveBattleSummary()`: 保存总结到存档
- `loadBattleSummary()`: 加载保存的总结
- `formatBattleSummary()`: 格式化总结为HTML

#### 3. 主战斗界面集成
- 在战斗结束区域添加"生成战斗总结"按钮
- 集成战斗总结界面组件
- 传递战斗数据到总结界面

### 数据流程

1. **战斗结束** → 战斗数据保存到 `battleResult`
2. **点击总结按钮** → 打开战斗总结界面
3. **生成总结** → 调用AI服务分析战斗数据
4. **显示总结** → 格式化并显示生成的总结
5. **保存总结** → 保存到角色变量中

## 使用方法

1. 完成一场战斗
2. 在战斗结束界面点击"📝 生成战斗总结"按钮
3. 等待AI生成战斗总结
4. 可以重新生成或保存总结
5. 关闭界面返回战斗界面

## 注意事项

- 需要确保战斗数据完整才能生成总结
- AI生成可能需要几秒钟时间
- 总结会自动保存到角色变量中
- 每次战斗的总结都是独立的，不会覆盖之前的总结

## 扩展功能

未来可以考虑添加：
- 总结模板选择
- 总结长度设置
- 总结风格选择
- 总结导出功能
- 总结分享功能
