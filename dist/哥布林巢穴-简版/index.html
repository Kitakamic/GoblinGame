<head><script type="module">var e={42:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,o]of t)a[e]=o;return a}},61:e=>{e.exports=Vue},120:(e,t,a)=>{a.d(t,{Q:()=>o});class o{static START_YEAR=1074;static START_MONTH=1;static START_DAY=1;static SEASON_MONTHS={SPRING:[1,2,3],SUMMER:[4,5,6],AUTUMN:[7,8,9],WINTER:[10,11,12]};static getTimeInfo(e,t=!1){const a=7*(e||0),o=this.calculateDate(a),n={formattedDate:`帝国历${o.year}年${o.month}月${o.day}日`};if(t){const e=this.getSeason(a);n.season=e,n.seasonEmoji=this.getSeasonEmoji(e)}return n}static calculateDate(e){const t=Math.floor(e||0);let a=this.START_YEAR,o=this.START_MONTH,n=this.START_DAY;for(n+=t;n>30;)n-=30,o+=1,o>12&&(o=1,a+=1);return{year:a,month:o,day:n}}static getSeason(e){const t=this.calculateDate(e).month;return this.SEASON_MONTHS.SPRING.includes(t)?'春季':this.SEASON_MONTHS.SUMMER.includes(t)?'夏季':this.SEASON_MONTHS.AUTUMN.includes(t)?'秋季':'冬季'}static getSeasonEmoji(e){return{春季:'🌸',夏季:'☀️',秋季:'🍂',冬季:'❄️'}[e]||'🌤️'}}},208:(e,t,a)=>{a.d(t,{exploreService:()=>i});var o=a(61),_=a(716),n=a(563),s=a(885),l=a(633);class r{static RACE_PORTRAIT_LIBRARY={人类:['https://files.catbox.moe/w4h0vn.png','https://files.catbox.moe/5u7rwy.png','https://files.catbox.moe/8c2tot.png','https://files.catbox.moe/a0cpmj.png','https://files.catbox.moe/vx49re.png','https://files.catbox.moe/jawvdo.png'],永恒精灵:['https://files.catbox.moe/ar7hp7.png','https://files.catbox.moe/82hnma.png','https://files.catbox.moe/tmcme9.png','https://files.catbox.moe/ws40v8.png','https://files.catbox.moe/jdkfsr.png','https://files.catbox.moe/cyvrs5.png','https://files.catbox.moe/qcdfzy.png'],黑暗精灵:['','','','','',''],狐族:[],天使:[],魔族:[],亡灵:[]};static generateMixedTroops(e,t,a,o=1){const{type:n,difficulty:s,race:r}=e;console.log('🚀 [混合部队生成] 开始生成混合部队:',{据点:e.name,类型:n,难度:s,种族:r,基础守军:t,特殊单位:!!a,英雄数量:e.rewards?.heroes?.length||0});const i=this.calculateAdjustedGuards(t,s,o);console.log('🔍 [混合部队生成] 调整后守军数量:',i);const c=this.determineTroopTypesCount(s,n,!!a),d=(0,l.sq)(r||'人类');console.log('🔍 [混合部队生成] 获取到的种族单位数据:',{种族:r||'人类',单位数量:d.length,单位列表:d.map(e=>({id:e.id,name:e.name,level:e.level}))});const u=this.generateTroopComposition(i,c,d,s,a,e);this.assignTroopTypesToUnits(u),console.log('[混合部队生成] 部下分配完成:',{单位详情:u.map(e=>({名称:e.name,部队数量:e.troopCount,部下类型:e.troops?.type||'无',部下数量:e.troops?.count||0}))});const m=[];for(let t=0;t<u.length;t++){const a=u[t],o=this.createEnemyUnit(a,e.id,t);o&&m.push(o)}return m}static calculateAdjustedGuards(e,t,a){const o=Math.min(1+.1*(a-1),2),n=this.getDifficultyMultiplier(t);return Math.floor(e*o*n)}static getDifficultyMultiplier(e){return.7+.1*(e-1)}static determineTroopTypesCount(e,t,a){const o=a?5:6;let n=2;return n=e<=2?2:e<=4?3:e<=6?4:e<=8?5:6,'fortress'!==t&&'dungeon'!==t&&'city'!==t||(n=Math.min(n+1,o)),Math.min(n,o)}static generateTroopComposition(e,t,a,o,n,s){const l=[];let r=e;if(s&&s.rewards?.heroes&&s.rewards.heroes.length>0){const e=s.rewards.heroes.filter(e=>'enemy'===e.status&&e.canCombat);for(const t of e){const e=.05+.05*Math.random(),a=Math.max(1,Math.floor(r*e));if(console.log(`[混合部队生成] 英雄单位 ${t.name}:`,{剩余守军:r,分配比例:e,分配数量:a}),a>0){const e=t.level||this.getUnitLevelForDifficulty(o)+1,n=t.avatar||this.getDefaultAvatarByRace(t.race);l.push({name:t.name,race:t.race,class:t.title,troopCount:a,level:e,avatar:n,attributes:{attack:t.attributes.attack,defense:t.attributes.defense,intelligence:t.attributes.intelligence,speed:t.attributes.speed,health:t.attributes.health},isHero:!0,heroId:t.id,tier:this.getUnitTierByLevel(e),isCaptain:!0}),r-=a}}}if(n){const e=.05+.1*Math.random(),t=Math.max(1,Math.floor(r*e));console.log(`[混合部队生成] 特殊单位 ${n.name}:`,{剩余守军:r,分配比例:e,分配数量:t});const a=this.getUnitLevelForDifficulty(o)+2,s=n.avatar||this.getRandomPortraitFromLibrary(n.race);l.push({name:n.name,race:n.race,class:n.class,troopCount:t,level:a,avatar:s,attributes:n.attributes,isSpecial:!0,tier:this.getUnitTierByLevel(a),isCaptain:!0}),r-=t}if(s&&this.shouldAddMilitia(s)){const e=this.getMilitiaUnits(s.race||'人类'),t=this.getMilitiaPercentageByDifficulty(o),a=Math.floor(r*t);if(a>0&&e.length>0){const t=e[Math.floor(Math.random()*e.length)],o=t.avatar||this.getDefaultAvatarByRace(t.race);l.push({name:t.name,race:t.race,class:t.title,troopCount:a,level:t.level,avatar:o,attributes:{attack:t.attributes.attack,defense:t.attributes.defense,intelligence:t.attributes.intelligence,speed:t.attributes.speed,health:t.attributes.health},tier:this.getUnitTierByLevel(t.level)}),r-=a}}const i=s&&s.rewards?.heroes?s.rewards.heroes.filter(e=>'enemy'===e.status&&e.canCombat).length:0,c=t-(n?1:0)-(s&&this.shouldAddMilitia(s)?1:0)-i;console.log('[混合部队生成] 部队类型分配:',{总类型数:t,特殊单位:n?1:0,民兵单位:s&&this.shouldAddMilitia(s)?1:0,英雄单位:i,基础部队类型数:c,剩余守军:r});const d=this.filterUnitsByDifficulty(a,o);if(0===d.length)return l;const u=this.selectUniqueUnits(d,c),m=this.distributeByLevelAndDifficulty(r,u,o);console.log('[混合部队生成] 基础部队生成:',{剩余守军:r,基础部队类型数:c,可用单位数:d.length,选中单位数:u.length,分配数量:m});for(let e=0;e<c&&e<m.length;e++){const t=u[e],a=m[e];if(a>0){const e=t.avatar||this.getDefaultAvatarByRace(t.race);l.push({name:t.name,race:t.race,class:t.title,troopCount:a,level:t.level,avatar:e,attributes:{attack:t.attributes.attack,defense:t.attributes.defense,intelligence:t.attributes.intelligence,speed:t.attributes.speed,health:t.attributes.health},tier:this.getUnitTierByLevel(t.level)})}}return console.log('[混合部队生成] 部队构成生成完成:',{总守军:e,剩余守军:r,已分配单位数:l.length,单位详情:l.map(e=>({名称:e.name,部队数量:e.troopCount,等级:e.level,兵种定位:e.tier||'未知',类型:e.isHero?'英雄':e.isSpecial?'特殊':'普通'}))}),l}static filterUnitsByDifficulty(e,t){const a=this.getUnitLevelForDifficulty(t);return e.filter(e=>e.level<=a)}static getUnitLevelForDifficulty(e){return Math.min(9,Math.max(3,2+e))}static distributeByLevelAndDifficulty(e,t,a){if(0===t.length)return[];const o=t.map(e=>{const t=e.level||1;let o=Math.max(1,6-t);return a<=2?o=t<=2?2*o:.5*o:a<=4||(o=a<=6?t>=3?1.5*o:o:a<=8?t>=4?1.8*o:.8*o:t>=4?2*o:.7*o),Math.max(.1,o)}),n=o.reduce((e,t)=>e+t,0),s=[];let l=0;for(let a=0;a<t.length-1;a++){const t=o[a]/n,r=Math.floor(e*t);s.push(r),l+=r}s.push(Math.max(0,e-l));for(let a=0;a<s.length;a++)if(0===s[a]&&e>=t.length){s[a]=1;const e=s.indexOf(Math.max(...s));e!==a&&s[e]>1&&s[e]--}return s}static selectUniqueUnits(e,t){if(e.length<=t)return[...e];const a=[],o=[...e];for(let e=0;e<t&&o.length>0;e++){const e=Math.floor(Math.random()*o.length),t=o[e];a.some(e=>e.name===t.name&&e.race===t.race&&e.title===t.title)||a.push(t),o.splice(e,1)}return a}static createEnemyUnit(e,t,a){try{const o=t?`${t}_${a||0}`:`enemy_${Date.now()}`,n={id:`enemy_${e.name.replace(/\s+/g,'_').toLowerCase()}_${o}`,name:e.name,race:e.race,class:e.class,level:e.level,troopCount:e.troopCount,attributes:{attack:e.attributes.attack,defense:e.attributes.defense,intelligence:e.attributes.intelligence,speed:e.attributes.speed,health:e.attributes.health},avatar:e.avatar||this.getAvatarFromDatabase(e.race),country:this.getCountryFromDatabase(e.race),unitType:this.getUnitTypeForComposition(e),canLeadRaces:[e.race],troops:e.troops};return e.isHero&&e.heroId&&(n.isHero=!0,n.heroId=e.heroId),n}catch(e){return console.error('创建敌方单位失败:',e),null}}static shouldAddMilitia(e){return!!e&&('village'===e.type||'town'===e.type)}static getMilitiaUnits(e){const t=(0,l.sq)(e).filter(e=>1===e.level);if(0===t.length){return(0,l.sq)('人类').concat((0,l.sq)('狐族'),(0,l.sq)('黑暗精灵'),(0,l.sq)('永恒精灵'),(0,l.sq)('亡灵'),(0,l.sq)('哥布林')).filter(e=>1===e.level)}return t}static getMilitiaPercentageByDifficulty(e){return Math.max(.1,.5-.04*(e-1))}static getUnitTierByLevel(e){return 1===e?'民兵':e>=2&&e<=4?'基础':e>=5&&e<=8?'精英':e>=9&&e<=10?'禁卫':'未知'}static assignTroopTypesToUnits(e){console.log('[混合部队生成] 开始分配部下类型:',{总单位数:e.length,单位详情:e.map(e=>({name:e.name,isHero:e.isHero,isSpecial:e.isSpecial,isCaptain:e.isCaptain}))});const t=e.filter(e=>!e.isHero&&!e.isSpecial);console.log('[混合部队生成] 基础单位列表:',t.map(e=>({名称:e.name,等级:e.level,兵种定位:e.tier||'未知',种族:e.race}))),this.assignTroopsToCaptains(e,t),this.assignTroopsToRegularUnits(e)}static assignTroopsToCaptains(e,t){console.log('[混合部队生成] 开始为队长单位分配部下:',{总单位数:e.length,基础单位数:t.length,所有单位:e.map(e=>({name:e.name,isCaptain:e.isCaptain,isHero:e.isHero,isSpecial:e.isSpecial}))});const a=e.filter(e=>e.isCaptain||e.isHero||e.isSpecial);console.log('[混合部队生成] 找到队长单位:',{队长数量:a.length,队长列表:a.map(e=>({name:e.name,isCaptain:e.isCaptain}))}),0!==a.length?a.forEach(e=>{const a=this.selectSuitableTroopsForCaptain(e,t);e.troops={type:a.name,count:e.troopCount},console.log(`[混合部队生成] ${e.name} 部下类型: ${a.name} (${e.troopCount}名)`)}):console.log('[混合部队生成] 没有队长单位需要分配部下')}static selectSuitableTroopsForCaptain(e,t){if(0===t.length)return console.log('[混合部队生成] 没有基础单位，使用默认精英单位'),this.getDefaultEliteUnit();const a=t.filter(t=>t.race===e.race),o=a.length>0?a:t,n=o.sort((e,t)=>t.level-e.level)[0];return console.log(`[混合部队生成] 为队长 ${e.name} 选择部下:`,{队长等级:e.level||1,队长种族:e.race,候选单位:o.map(e=>({name:e.name,level:e.level,race:e.race})),选中单位:n.name,选择理由:'选择据点中等级最高的单位'}),n}static assignTroopsToRegularUnits(e){e.filter(e=>!e.isCaptain).forEach(e=>{e.troops={type:e.name,count:e.troopCount},console.log(`[混合部队生成] ${e.name} 部下类型: ${e.name} (${e.troopCount}名)`)})}static getDefaultEliteUnit(){return{name:'精英战士',level:3,race:'人类',attributes:{attack:8,defense:6,intelligence:4,speed:5,health:25}}}static getUnitTypeForComposition(e){try{return e.isCaptain&&e.troops?this.getUnitTypeFromDatabase(e.troops.type,e.race):this.getUnitTypeFromDatabase(e.class,e.race)}catch(e){return console.error('[混合部队生成] 获取部队单位类型失败:',e),'physical'}}static getUnitTypeFromDatabase(e,t){try{const a=(0,l.sq)(t);let o=a.find(t=>t.name===e);return o||(o=a.find(t=>t.id===e)),o||(o=a.find(t=>t.name.includes(e)||e.includes(t.name))),o?o.unitType||'physical':(console.warn(`[混合部队生成] 未找到单位类型: ${e} (${t})，使用默认类型`),'physical')}catch(e){return console.error('[混合部队生成] 获取单位类型失败:',e),'physical'}}static addPortraitToLibrary(e,t){try{this.RACE_PORTRAIT_LIBRARY[e]||(this.RACE_PORTRAIT_LIBRARY[e]=[]),this.RACE_PORTRAIT_LIBRARY[e].includes(t)?console.log(`[混合部队生成] 种族 ${e} 的肖像已存在: ${t}`):(this.RACE_PORTRAIT_LIBRARY[e].push(t),console.log(`[混合部队生成] 已为种族 ${e} 添加肖像: ${t}`))}catch(e){console.error('[混合部队生成] 添加种族肖像失败:',e)}}static addPortraitsToLibrary(e,t){try{this.RACE_PORTRAIT_LIBRARY[e]||(this.RACE_PORTRAIT_LIBRARY[e]=[]);let a=0;for(const o of t)this.RACE_PORTRAIT_LIBRARY[e].includes(o)||(this.RACE_PORTRAIT_LIBRARY[e].push(o),a++);console.log(`[混合部队生成] 已为种族 ${e} 批量添加 ${a} 个肖像`)}catch(e){console.error('[混合部队生成] 批量添加种族肖像失败:',e)}}static getRacePortraits(e){return this.RACE_PORTRAIT_LIBRARY[e]||[]}static clearRacePortraits(e){this.RACE_PORTRAIT_LIBRARY[e]&&(this.RACE_PORTRAIT_LIBRARY[e]=[],console.log(`[混合部队生成] 已清空种族 ${e} 的肖像库`))}static getRandomPortraitFromLibrary(e){try{const t=this.RACE_PORTRAIT_LIBRARY[e];if(!t||0===t.length)return console.log(`[混合部队生成] 种族 ${e} 没有配置肖像库，使用默认头像`),this.getDefaultAvatarByRace(e);const a=Math.floor(Math.random()*t.length),o=t[a];return console.log(`[混合部队生成] 种族 ${e} 随机选择肖像: ${o} (索引: ${a})`),o}catch(t){return console.error('[混合部队生成] 获取种族肖像失败:',t),this.getDefaultAvatarByRace(e)}}static getDefaultAvatarByRace(e){return{人类:'👤',狐族:'🦊',永恒精灵:'🧝‍♀️',黑暗精灵:'🧝‍♂️',天使:'👼',魔族:'👹',亡灵:'💀',哥布林:'👹'}[e]||'👤'}static getAvatarFromDatabase(e){try{const t=this.getRandomPortraitFromLibrary(e);if(t!==this.getDefaultAvatarByRace(e))return t;const a=this.getDefaultAvatarByRace(e);return console.log(`[混合部队生成] 种族 ${e} 使用默认头像: ${a}`),a}catch(e){return console.error('[混合部队生成] 获取种族头像失败:',e),'👤'}}static getCountryFromDatabase(e){try{const t=(0,l.sq)(e);return t.length>0?t[0].country||'未知':(console.warn(`[混合部队生成] 未找到种族国家: ${e}，使用默认国家`),'未知')}catch(e){return console.error('[混合部队生成] 获取种族国家失败:',e),'未知'}}}const i=new class{state=(0,o.ref)({scoutedLocations:[],conqueredLocations:[]});locations=(0,o.ref)([...n.In]);scoutingLocations=new Set;scoutingAnimation=new Set;constructor(){this.setupDataWatchers(),setTimeout(()=>{this.initializeExploreData()},100)}async initializeExploreData(){await this.loadExploreData()}async initializeFromSave(){await this.loadExploreData()}getAllLocations(){return this.locations.value}addLocation(e){try{if(this.locations.value.find(t=>t.name===e.name))return console.warn(`据点 ${e.name} 已存在，跳过添加`),!1;if('scouted'===e.status&&(!e.enemyUnits||0===e.enemyUnits.length)){console.log(`据点 ${e.name} 已侦察但无敌方单位数据，立即生成...`);try{const t=this.getLocationEnemyUnits(e.id,1);console.log(`据点 ${e.name} 敌方单位生成完成:`,t.length,'个单位')}catch(t){console.warn(`据点 ${e.name} 敌方单位生成失败:`,t)}}return console.log('🔍 [探索服务] 添加据点前的完整数据:',e),console.log('🔍 [探索服务] 据点baseGuards字段:',e.baseGuards),console.log('🔍 [探索服务] 据点specialUnit字段:',e.specialUnit),this.locations.value.push(e),console.log(`已添加新据点: ${e.name}`),this.checkAndMarkHeroGeneration(e),this.saveExploreData(),!0}catch(e){return console.error('添加据点失败:',e),!1}}addMultipleLocations(e){let t=0;for(const a of e)this.addLocation(a)&&t++;return t}getLocationEnemyUnits(e,t=1){const a=this.locations.value.find(t=>t.id===e);if(!a)return console.warn(`据点 ${e} 不存在`),[];if(a.enemyUnits&&a.enemyUnits.length>0)return console.log(`据点 ${e} 已有敌方单位，直接返回:`,a.enemyUnits.length,'个单位'),a.enemyUnits;console.log(`为据点 ${e} 生成敌方单位...`),console.log(`🔍 [探索服务] 据点 ${e} 的baseGuards字段:`,a.baseGuards),console.log(`🔍 [探索服务] 据点 ${e} 的specialUnit字段:`,a.specialUnit);const o=a.baseGuards||1e3,n=a.specialUnit;console.log('🔍 [探索服务] 最终使用的baseGuards:',o),console.log('🔍 [探索服务] 最终使用的specialUnit:',n),console.log('🔍 [探索服务] 调用混合部队生成服务，参数:',{据点:a.name,基础守军:o,特殊单位:n,当前回合:t,英雄数量:a.rewards?.heroes?.length||0});const s=r.generateMixedTroops(a,o,n?{...n,troopCount:0}:void 0,t);return console.log('🔍 [探索服务] 混合部队生成服务返回:',s.length,'个单位'),a.enemyUnits=s,a.enemyUnitsGeneratedAt=Date.now(),console.log(`据点 ${e} 敌方单位生成完成:`,s.length,'个单位'),this.saveLocationsToDatabase(),s}async checkAndMarkHeroGeneration(e){try{const{HeroDeterminationService:t}=await Promise.resolve().then(a.bind(a,719));if(e.rewards?.heroes&&e.rewards.heroes.length>0)return void console.log(`据点 ${e.name} 已有英雄数据，跳过AI生成标记`);t.shouldHaveHero(e.type,e.difficulty)?(console.log(`据点 ${e.name} 判定需要生成英雄，添加生成标记...`),e.needsAIHero=!0,console.log(`据点 ${e.name} 已添加英雄生成标记`)):console.log(`据点 ${e.name} 判定不需要生成英雄`)}catch(e){console.error('英雄概率判定失败:',e)}}async scoutLocation(e){const t=this.getAllLocations().find(t=>t.id===e);if(!t)throw new Error('据点不存在');const o=this.calculateScoutCost(t.difficulty,t.distance);if(_.l.resources.value.gold<o.gold||_.l.resources.value.food<o.food)throw new Error(`资源不足，侦察需要 ${o.gold} 金币和 ${o.food} 食物`);_.l.consumeResource('gold',o.gold),_.l.consumeResource('food',o.food),await new Promise(e=>setTimeout(e,1e3)),this.state.value.scoutedLocations.includes(e)||this.state.value.scoutedLocations.push(e);const n=this.locations.value.findIndex(t=>t.id===e);if(-1!==n){this.locations.value[n].status='scouted',this.locations.value[n].lastScouted=Date.now();const t=this.locations.value[n];if(t.needsAIHero||t.description.includes('[AI_HERO_GENERATE]')){console.log('检测到据点有英雄生成标记，开始AI生成英雄...');let n=!1;try{const{HeroDeterminationService:o}=await Promise.resolve().then(a.bind(a,719)),s=o.generateHeroPrompt(t.type,t.difficulty,t.description,t.continent,t.region);console.log('AI英雄生成提示词:',s);const l=await window.TavernHelper.generate({user_input:s});if(l){console.log('AI返回数据:',l);const a=await o.parseHeroCharacter(l,e,t.type);a?(t.rewards.heroes=[a],console.log('AI英雄生成完成:',a.name),t.enemyUnits=void 0,t.enemyUnitsGeneratedAt=void 0,n=!0):(console.error('AI英雄解析失败'),n=!1)}else console.error('AI生成失败，未返回数据'),n=!1}catch(e){console.error('AI英雄生成失败:',e),n=!1}if(!n){console.warn(`据点 ${t.name} AI英雄生成失败，需要用户决策`),t.status='unknown',t.lastScouted=void 0;const a=this.state.value.scoutedLocations.indexOf(e);return-1!==a&&this.state.value.scoutedLocations.splice(a,1),{locationId:e,information:{rewards:t.rewards,status:t.status},cost:{gold:0,food:0},error:'AI英雄生成失败',needsUserDecision:!0,aiFailureData:{location:{...t},originalCost:o}}}}if(!t.enemyUnits||0===t.enemyUnits.length){console.log('侦察时生成敌方单位数据...');const t=this.getLocationEnemyUnits(e,1);console.log('侦察时敌方单位生成完成:',t.length,'个单位')}if(t.rewards?.heroes&&t.rewards.heroes.length>0){console.log('据点已有英雄信息，添加到调教模块...');const e=_.l.getModuleData({moduleName:'training'})||{characters:[],trainingMessages:[]};for(const a of t.rewards.heroes){-1===e.characters.findIndex(e=>e.id===a.id)?(e.characters.push(a),console.log('英雄已添加到调教模块:',a.name)):console.log('英雄已存在于调教模块中:',a.name)}_.l.updateModuleData({moduleName:'training',data:e})}}return{locationId:e,information:{rewards:t.rewards,status:t.status},cost:o}}calculateScoutCost(e,t){const a=s.continentExploreService.getCurrentContinent(),o=a?.explorationCost||{gold:5,food:3},n=Math.max(1,5*e),l=t?1+.05*t:1,r=.8+.4*Math.random();return{gold:Math.round(o.gold*n*l*r),food:Math.round(o.food*n*l*r)}}async handleAbandonHeroAndAttack(e,t){try{const t=this.locations.value.find(t=>t.id===e);if(!t)return console.error(`据点 ${e} 不存在`),!1;if(console.log(`用户选择放弃英雄，直接进攻据点: ${t.name}`),t.status='scouted',t.lastScouted=Date.now(),this.state.value.scoutedLocations.includes(e)||this.state.value.scoutedLocations.push(e),t.needsAIHero=!1,t.rewards||(t.rewards={}),t.rewards.heroes&&(t.rewards.heroes=[]),!t.enemyUnits||0===t.enemyUnits.length){console.log('生成无英雄的敌方单位数据...');const t=this.getLocationEnemyUnits(e,1);console.log('无英雄敌方单位生成完成:',t.length,'个单位')}return await this.saveExploreData(),console.log(`据点 ${t.name} 已设置为可直接进攻状态`),!0}catch(e){return console.error('处理放弃英雄失败:',e),!1}}async handleRetryScout(e,t){try{return console.log(`用户选择重新侦察据点: ${e}`),_.l.addResource('gold',t.gold,'重新侦察退还金币'),_.l.addResource('food',t.food,'重新侦察退还食物'),console.log(`已退还侦察成本: ${t.gold} 金币, ${t.food} 食物`),!0}catch(e){return console.error('处理重新侦察失败:',e),!1}}removeLocation(e){try{const t=this.locations.value.findIndex(t=>t.id===e);return-1!==t&&(this.locations.value.splice(t,1),!0)}catch(e){return console.error('移除据点失败:',e),!1}}updateLocation(e,t){try{const a=this.locations.value.find(t=>t.id===e);return!!a&&(Object.assign(a,t),!0)}catch(e){return console.error('更新据点失败:',e),!1}}async loadExploreData(){try{const e=_.l.getModuleData({moduleName:'exploration'});e?(e.locations&&(this.locations.value=e.locations),e.state&&(this.state.value=e.state),console.log('从数据库加载探索数据成功'),this.generateEnemyUnitsForScoutedLocations()):console.log('未找到探索数据，使用默认数据')}catch(e){console.error('加载探索数据失败:',e)}}setupDataWatchers(){(0,o.watch)(this.locations,()=>{this.saveExploreData()},{deep:!0}),(0,o.watch)(this.state,()=>{this.saveExploreData()},{deep:!0})}updateScoutingState(e,t){this.scoutingLocations=new Set(e),this.scoutingAnimation=new Set(t)}async saveExploreData(){try{_.l.updateModuleData({moduleName:'exploration',data:{locations:this.locations.value,state:this.state.value,scoutingLocations:[...this.scoutingLocations],scoutingAnimation:[...this.scoutingAnimation]}}),console.log('探索数据已保存到数据库:',{locations:this.locations.value.length,state:this.state.value,scoutingLocations:this.scoutingLocations.size,scoutingAnimation:this.scoutingAnimation.size})}catch(e){console.error('保存探索数据失败:',e)}}addThreatFromConquest(e){try{console.log('开始计算威胁度增加...',e);const t=this.getThreatMultiplierByDifficulty(e.difficulty);console.log('难度倍数:',t);const a=this.getThreatMultiplierByType(e.type);console.log('类型倍数:',a);const o=10,n=Math.floor(o*t*a);console.log('计算出的威胁度增加:',n);const s=_.l.addResource('threat',n,`征服据点${e.name}获得`);console.log('威胁度增加是否成功:',s),console.log(`征服据点 ${e.name} 增加威胁度: +${n} (难度:${e.difficulty}, 类型:${e.type})`)}catch(e){console.error('增加威胁度失败:',e)}}async updateRegionProgressFromLocation(e){try{const{continentExploreService:t}=await Promise.resolve().then(a.bind(a,885));t.calculateRegionProgressFromLocations(e.region||''),console.log(`据点 ${e.name} 征服已触发区域进度重新计算`)}catch(e){console.error('更新区域征服进度失败:',e)}}getThreatMultiplierByDifficulty(e){return Math.max(1,e)}getThreatMultiplierByType(e){switch(e){case'village':default:return 1;case'town':return 1.5;case'city':return 2.5;case'fortress':return 2;case'ruins':return 1.2;case'dungeon':return 1.8}}async updateLocationStatus(e,t){try{console.log(`探索服务更新据点状态: ${e} -> ${t}`);const a=this.locations.value.find(t=>t.id===e);return a?(a.status=t,a.lastAttacked=Date.now(),console.log(`据点 ${a.name} 状态已更新为: ${t}`),'conquered'===t&&(this.state.value.conqueredLocations||(this.state.value.conqueredLocations=[]),this.state.value.conqueredLocations.includes(e)||(this.state.value.conqueredLocations.push(e),this.addThreatFromConquest(a),await this.updateRegionProgressFromLocation(a))),await this.saveExploreData(),!0):(console.warn(`未找到据点 ${e}，无法更新状态`),!1)}catch(e){return console.error('更新据点状态失败:',e),!1}}async restoreFromSaveData(e){try{e.locations&&(this.locations.value=e.locations),e.state&&(this.state.value=e.state),await this.saveExploreData()}catch(e){console.error('从存档恢复探索数据失败:',e)}}saveLocationsToDatabase(){try{_.l.updateModuleData({moduleName:'exploration',data:{locations:this.locations.value,state:this.state.value}})}catch(e){console.error('保存据点数据失败:',e)}}generateEnemyUnitsForScoutedLocations(){try{const e=this.locations.value.filter(e=>'scouted'===e.status&&(!e.enemyUnits||0===e.enemyUnits.length));if(e.length>0){console.log(`发现 ${e.length} 个已侦察但无敌方单位数据的据点，开始生成...`);for(const t of e)try{const e=this.getLocationEnemyUnits(t.id,1);console.log(`据点 ${t.name} 敌方单位生成完成:`,e.length,'个单位')}catch(e){console.warn(`据点 ${t.name} 敌方单位生成失败:`,e)}}}catch(e){console.error('为已侦察据点生成敌方单位失败:',e)}}resetExploreData(){try{this.state.value={scoutedLocations:[],conqueredLocations:[]},this.locations.value=[...n.In],console.log('探索数据已初始化')}catch(e){console.error('初始化探索数据失败:',e)}}}},563:(e,t,a)=>{a.d(t,{oU:()=>n,LG:()=>s,In:()=>d,ji:()=>r,VU:()=>l,Kz:()=>u});const o='1.0.0',n='GoblinNestGame',s=4,l={gold:1e3,food:1e3,threat:0,slaves:0,normalGoblins:100,warriorGoblins:0,shamanGoblins:0,paladinGoblins:0,trainingSlaves:1,rounds:0,actionPoints:3,maxActionPoints:3,conqueredRegions:0},r={breedingSlots:[{building:{id:'breeding',name:'繁殖间',icon:'👶',description:'用于俘虏生育哥布林',cost:{gold:50,food:30},category:'breeding',effects:[{type:'breeding',icon:'👶',description:'俘虏生育哥布林'}]},unlocked:!0},{building:null,unlocked:!1}],resourceSlots:[{building:{id:'food',name:'食物间',icon:'🍖',description:'每回合生成食物',cost:{gold:100,food:50},category:'resource',income:{food:20},effects:[{type:'food',icon:'🍖',description:'每回合+20食物'}]},unlocked:!0},{building:{id:'trade',name:'贸易间',icon:'💰',description:'每回合生成金钱',cost:{gold:150,food:30},category:'resource',income:{gold:30},effects:[{type:'gold',icon:'💰',description:'每回合+30金钱'}]},unlocked:!0},{building:null,unlocked:!1}],activeTab:'breeding',totalIncome:{gold:30,food:20},breedingRoomInfo:[]},i={roundHistory:[],maxHistoryEntries:100},c={characters:[{id:'player-1',name:'哥布林之王',title:'哥布林巢穴之主',avatar:'https://files.catbox.moe/x4g8t7.jpg',status:'player',canCombat:!0,loyalty:100,stamina:100,fertility:0,offspring:0,rating:'S',favorite:!0,level:1,attributes:{attack:30,defense:40,intelligence:30,speed:20,health:120},race:'哥布林',age:25,country:'哥布林巢穴',background:'贵族',sexExperience:'哥布林巢穴的统治者',sensitivePoints:[],sensitivePointsDetail:[],lifeStory:{childhood:[''],adolescence:[''],adulthood:[''],currentState:['']},personality:[''],fears:'',secrets:'',appearance:{height:150,weight:45,measurements:'',description:''}},{id:'knight_commander_elena',name:'艾琳娜·萨尔',title:'白玫瑰骑士团长',avatar:'https://files.catbox.moe/9x3htf.png',status:'imprisoned',canCombat:!0,loyalty:0,stamina:180,maxStamina:180,fertility:165,maxFertility:165,offspring:0,rating:'A',favorite:!1,level:7,attributes:{attack:42,defense:38,intelligence:28,speed:32,health:220},race:'人类',age:28,country:'赛菲亚帝国',background:'贵族',sexExperience:'艾琳娜的性经验仅限于与已故的未婚夫，一位同样在战斗中牺牲的骑士。两人的关系纯洁而深情，但从未有过真正的亲密接触。自从未婚夫去世后，她便全身心投入到骑士团的工作中，将所有精力都投入到保卫帝国的使命中，但内心深处那份被压抑的渴望有时会在梦中苏醒。',sensitivePoints:['胸部'],sensitivePointsDetail:[{part:'嘴巴',isSensitive:!1,description:'艾琳娜的嘴唇薄而性感，天然带着淡粉色的光泽。她的唇形完美，上唇略薄而下唇丰盈，接吻时会有微微的颤抖。她的舌头灵活而湿润，口腔内部温暖紧致，当被深入侵犯时会本能地吸吮和纠缠。'},{part:'胸部',isSensitive:!0,description:'艾琳娜的胸部丰满挺拔，D罩杯的乳房在紧身盔甲下展现出完美的形状。她的乳房触感柔软却富有弹性，乳晕呈现淡粉色，直径约三厘米，乳头在未受刺激时呈现可爱的粉红色。由于长期穿着盔甲作战，她的乳房保持着极佳的形状，几乎没有下垂。当被抚摸时，乳头会迅速充血变硬，整体敏感度极高，这是她最大的弱点。'},{part:'阴道',isSensitive:!1,description:'艾琳娜的阴道因为从未有过性经验而保持着处女般的紧致度。外阴唇饱满而富有弹性，内阴唇小巧粉嫩，阴蒂隐藏在包皮之下。阴道内壁布满细密的褶皱，收缩力极强，在被插入时会本能地紧紧吸附。由于从未有过这方面的经验，她的阴道保持着完全的紧闭状态，初次进入需要充分的润滑和扩张。'},{part:'子宫',isSensitive:!1,description:'艾琳娜的子宫保持着处女般的状态，从未被任何异物触碰过。她的子宫口紧闭，内部温度正常，当被精液灌满时会产生强烈的满足感。由于从未有过性经验，她的子宫保持着完全的原始状态，等待着第一次的探索和开发。'},{part:'后庭',isSensitive:!1,description:'艾琳娜的后庭紧致而从未被开发过，臀部饱满圆润，臀肉紧实而富有弹性。她的肛门呈现健康的浅粉色，周围皮肤细腻光滑。由于从未有过这方面的经验，她的后庭保持着完全的紧闭状态，即使是手指也难以轻易进入。她对这个部位有着本能的抗拒和羞耻感，认为从后方被侵犯是极度屈辱的行为。'}],lifeStory:{childhood:['艾琳娜出生于赛菲亚帝国的一个贵族家庭，她的家族世代为帝国效力，父亲是一位著名的骑士团长。从小她就被灌输着正义和荣誉的理念，在父亲的严格训练下，她学会了剑术、骑术和战术。在那个充满战争的童年里，她目睹了无数哥布林对边境村庄的袭击，这让她从小就立志要成为一名骑士，保护无辜的平民。她的母亲是一位宫廷魔法师，教会了她基础的魔法知识，这为她后来成为指挥官奠定了基础。'],adolescence:['十五岁那年，艾琳娜正式加入了帝国骑士团，成为了一名见习骑士。在骑士团中，她以优异的成绩和坚定的意志赢得了同僚们的尊重。十八岁时，她参加了第一次对哥布林巢穴的围剿行动，在战斗中表现出色，被提升为小队长。二十岁时，她率领自己的小队成功击退了哥布林对边境要塞的袭击，因此被授予了银剑骑士的称号。那段时期是她人生中最充实的时光，她与战友们并肩作战，为保护帝国的安全而奋斗。'],adulthood:['二十五岁时，艾琳娜被任命为边境骑士团的指挥官，负责监视和防御哥布林巢穴的威胁。作为指挥官，她不仅要指挥战斗，还要管理营地的日常事务，协调与帝国其他部队的合作。她以铁腕手段管理着骑士团，用雷霆手段镇压了数次哥布林的袭击。在血与火的洗礼中，她从一个年轻的骑士成长为一位成熟的指挥官，向所有人证明了女性同样可以成为优秀的军事领袖。'],currentState:['如今二十八岁的艾琳娜已经担任指挥官三年，她将骑士团管理得井井有条，甚至开始向哥布林巢穴发起主动攻击。但作为女性指挥官，她也面临着来自同僚的质疑和挑战。夜深人静时，她常常会想念家乡的亲人，但为了帝国的安全，她必须坚守在这个危险的前哨站。最近哥布林的活动越来越频繁，她预感到一场更大的战斗即将来临，为此她加强了营地的防御，同时派出侦察兵侦查哥布林巢穴的动向。']},personality:['坚毅不屈','正义凛然','外冷内热'],fears:'艾琳娜最大的恐惧是失去战友和让无辜的平民受到伤害。作为指挥官，她深知每一次决策都关系到战友们的生死。她害怕因为自己的失误而导致战友牺牲，害怕无法保护那些信任她的平民。这种恐惧驱使她必须时刻保持警惕，绝不在任何战斗中掉以轻心。',secrets:'艾琳娜的秘密是她内心深处对爱情的渴望和对被保护的渴望。作为指挥官，她必须时刻保持坚强，但内心深处她渴望有一个能够保护她、理解她的男人。这个秘密让她既困扰又羞耻，她害怕被人发现这个弱点，害怕被人认为她不够坚强。',appearance:{height:175,weight:65,measurements:'88-65-92',cupSize:'D',description:'艾琳娜拥有一头如瀑布般倾泻而下的银白色长发，在阳光下闪烁着金属般的光泽，平时她会将长发编成复杂的辫子盘在脑后，显得既优雅又干练。她的肌肤呈现出健康的小麦色，这是长期在户外训练和战斗留下的痕迹，却丝毫不减其魅力，反而增添了一种野性的美感。她的五官精致而立体，高挺的鼻梁，薄而性感的嘴唇，一双如蓝宝石般深邃的眼眸中闪烁着坚定的光芒，眼神中既有女性的柔美也有战士的坚毅。她的身材高挑匀称，双肩宽阔而有力，D罩杯的丰满胸部在紧身的骑士装束下勾勒出诱人的曲线。纤细的腰肢和浑圆饱满的臀部形成完美的对比，修长笔直的双腿肌肉线条流畅，显然经过长期的战斗训练。她的手指修长但掌心有厚茧，那是常年握剑留下的痕迹。在她的右臂上有一道淡淡的伤疤，那是早年与哥布林战斗时留下的纪念。她的锁骨精致迷人，每当她穿着低领的便装时，那若隐若现的锁骨线条总能吸引无数目光。她习惯佩戴家族传承的银剑项链，剑形的吊坠正好垂落在她深邃的乳沟之间。',clothing:{head:'银白色花纹头盔',top:'银白色精钢胸甲',bottom:'银白色锁子战裙',socks:'白色棉质长袜',shoes:'银白色花纹战靴',underwear:'白色棉质内衣',accessories:'银白色剑形项链',toys:'无'}},locationId:'knight_camp_near_nest',capturedAt:'帝国历1074年1月1日'}],trainingMessages:[]},d=[{id:'small_village_1',name:'小村庄',type:'village',icon:'🏘️',description:'一个普通的人类村庄，防御薄弱',difficulty:1,distance:5,rewards:{gold:50,food:30,slaves:2},status:'unknown',continent:'古拉尔大陆',region:'巢穴附近',race:'人类',baseGuards:10},{id:'merchant_camp',name:'商队营地',type:'village',icon:'🏕️',description:'临时商队营地，有丰富的货物',difficulty:1,distance:8,rewards:{gold:100,food:20},status:'unknown',continent:'古拉尔大陆',region:'巢穴附近',race:'人类',baseGuards:40,needsAIHero:!0},{id:'abandoned_fort',name:'废弃要塞',type:'ruins',icon:'🏰',description:'古老的废弃要塞，可能有宝藏',difficulty:3,distance:12,rewards:{gold:200},status:'unknown',continent:'古拉尔大陆',region:'巢穴附近',race:'亡灵',baseGuards:100,specialUnit:{name:'古代守卫',race:'亡灵',class:'骷髅战士',attributes:{attack:25,defense:30,intelligence:15,speed:20,health:80}}},{id:'exile_village',name:'流放者村落',type:'village',icon:'🏚️',description:'被流放种族的小型聚居地，环境恶劣但居民顽强',difficulty:2,distance:15,rewards:{gold:80,food:40,slaves:3},status:'unknown',continent:'古拉尔大陆',region:'流放之地',race:'人类',baseGuards:30},{id:'coastal_outpost',name:'沿海哨站',type:'fortress',icon:'🏔️',description:'瓦尔基里大陆边缘的军事哨站，由黑暗精灵驻守',difficulty:2,distance:25,rewards:{gold:150,food:60,slaves:5},status:'unknown',continent:'瓦尔基里大陆',region:'沿海解冻区',race:'黑暗精灵',baseGuards:60,specialUnit:{name:'冰霜守卫',race:'黑暗精灵',class:'冰霜法师',attributes:{attack:18,defense:22,intelligence:25,speed:15,health:70}}},{id:'emerald_palace_capital',name:'翡翠宫',type:'city',icon:'💎',description:'翡翠宫是古拉尔大陆上少数几个文明据点之一，这座宫殿城市建立在一片罕见的绿洲之上，周围被熔岩河流和险峻山脉环绕。翡翠王国由各族流放者和逃亡者建立，经过数代人的努力才在这片死亡之地站稳脚跟。宫殿本身由绿色的翡翠矿石建造，在荒凉的大陆上如同一颗璀璨的宝石。城墙高耸坚固，内部设有复杂的防御工事和魔法结界。这里聚集了来自各大陆的流亡贵族、被放逐的魔法师、逃亡的罪犯以及寻求庇护的难民，形成了一个独特的多元文化社会。翡翠王国虽小，但因为地理位置险要、防御严密，加上统治者的英明治理，竟在这片混乱之地维持了相对的秩序与繁荣',difficulty:9,distance:450,rewards:{gold:8500,food:3200,slaves:180,heroes:[{id:'legendarychar_Alicia',name:'艾莉西亚·翡翠',title:'翡翠王国王后',avatar:'',status:'enemy',canCombat:!0,loyalty:0,stamina:160,maxStamina:160,fertility:185,maxFertility:185,offspring:0,rating:'S',favorite:!1,level:8,attributes:{attack:38,defense:32,intelligence:42,speed:35,health:240},race:'人类',age:32,country:'翡翠王国',background:'王族',sexExperience:'艾莉西亚的性经验仅限于与已故丈夫埃德温,两人的性生活和谐美满。埃德温温柔体贴，总是能让她达到高潮。自从丈夫去世后，她便守寡至今，将所有精力都投入到治国之中，但身体深处那份被压抑的欲望有时会在梦中苏醒。',sensitivePoints:['子宫'],sensitivePointsDetail:[{part:'嘴巴',isSensitive:!1,description:'艾莉西亚的嘴唇饱满柔软，天然带着玫瑰色的光泽。她的唇形完美，上唇略薄而下唇丰盈，接吻时会有微微的颤抖。她的舌头灵活而湿润，口腔内部温暖紧致，当被深入侵犯时会本能地吸吮和纠缠。'},{part:'胸部',isSensitive:!1,description:'艾莉西亚的胸部丰满挺拔，E罩杯的乳房在紧身衣物下展现出完美的形状。她的乳房触感柔软却富有弹性，乳晕呈现淡粉色，直径约三厘米，乳头在未受刺激时呈现可爱的粉红色。由于长期穿着束胸作战，她的乳房保持着极佳的形状，几乎没有下垂。当被抚摸时，乳头会迅速充血变硬，但整体敏感度属于中等水平。'},{part:'阴道',isSensitive:!1,description:'艾莉西亚的阴道因为只与丈夫有过性经验而保持着极佳的紧致度。外阴唇饱满而富有弹性，内阴唇小巧粉嫩，阴蒂隐藏在包皮之下。阴道内壁布满细密的褶皱，收缩力极强，在被插入时会本能地紧紧吸附。由于守寡多年，她的阴道已经恢复到近乎处女般的紧致状态，初次进入需要充分的润滑和扩张。'},{part:'子宫',isSensitive:!0,description:'艾莉西亚最大的秘密就是她的子宫极度敏感，这是连她已故的丈夫都不完全了解的体质。当有异物深入触碰到子宫口时，她会产生近乎失控的快感，这种快感直接冲击大脑，让她几乎无法维持理智。她的子宫口在兴奋时会微微张开，内部温度比阴道更高，当被精液灌满时会产生强烈的满足感。正是因为这个过于敏感的弱点，她在与丈夫亲密时总是小心控制深度，害怕自己失态的模样被看到。如果这个秘密被人发现并利用，她引以为傲的理智和自制力将彻底崩溃。'},{part:'后庭',isSensitive:!1,description:'艾莉西亚的后庭紧致而从未被开发过，臀部饱满圆润，臀肉紧实而富有弹性。她的肛门呈现健康的浅粉色，周围皮肤细腻光滑。由于从未有过这方面的经验，她的后庭保持着完全的紧闭状态，即使是手指也难以轻易进入。她对这个部位有着本能的抗拒和羞耻感，认为从后方被侵犯是极度屈辱的行为。'}],lifeStory:{childhood:['艾莉西亚出生于赛菲亚帝国的一个没落王族家庭，她的家族曾经显赫一时，但在一次宫廷政变中失势，被流放到古拉尔大陆。年幼的她跟随父母在这片死亡之地艰难求生，目睹了无数同行者在恶劣环境中死去。她的父亲是一位骑士，母亲则是宫廷魔法师，双方都将毕生所学倾囊相授。在那个充满危险的童年里，她学会了如何在荒野中寻找水源和食物，如何识别有毒的植物和生物，更学会了如何在绝望中保持希望。她的父亲常说"我们虽然失去了帝国，但没有失去血统的荣耀"，这句话深深烙印在她幼小的心灵中。'],adolescence:['十五岁那年，艾莉西亚的父母在一次哥布林袭击中双双丧生，她被当时翡翠王国的建立者——年轻的国王埃德温所救。埃德温被她的美貌和坚韧所吸引，更欣赏她身上那种王族的气质。在埃德温的培养下，她不仅学习了治国之道，更精进了战斗技艺。两人在患难中产生了深厚的感情,二十岁时她成为了翡翠王国的王后。作为王后，她协助埃德温建立了翡翠宫的防御体系，整合了大陆上的各个流亡族群，用铁腕手段镇压了数次叛乱。那段时期是她人生中最幸福的时光，她与埃德温并肩作战，将翡翠王国从一个简陋的据点发展成为古拉尔大陆上最强大的势力。'],adulthood:['二十八岁那年，一场突如其来的瘟疫席卷了翡翠王国，埃德温在照顾病患时不幸染病去世，没有留下子嗣。年轻的艾莉西亚突然成为了寡妇，面对着国内各派系的虎视眈眈和外部势力的不断侵扰。她以惊人的意志力稳住了局面，用雷霆手段处决了三个试图篡位的贵族，亲自率军击退了两次大规模的哥布林入侵。在血与火的洗礼中，她从一个温柔的王后蜕变为铁腕的女王。她取消了国王的称号，独自以王后之名统治翡翠王国，向所有人证明了女性同样可以成为强大的统治者。'],currentState:['如今三十二岁的艾莉西亚已经统治翡翠王国四年，她将这个小国治理得井井有条，甚至开始向周边地区扩张势力。但寡居的生活也让她倍感孤独，夜深人静时，她常常会想念已故的丈夫。朝堂上的她是铁血女王，但卸下王冠后，她也只是一个渴望被爱的女人。最近哥布林的活动越来越频繁，她预感到一场更大的风暴即将来临，为此她加强了翡翠宫的防御，同时派出探子侦查哥布林巢穴的动向。她不知道的是，她的美貌和身份已经让她成为了哥布林王风花的重点目标。']},personality:['坚韧不屈','深谋远虑','外冷内热'],fears:'艾莉西亚最大的恐惧是失去控制和尊严。作为从底层爬起来的流亡王族，她深知权力的脆弱。她害怕再次经历童年时的无助，害怕被人当作玩物和弱者。这种恐惧驱使她必须时刻保持强势，绝不在任何人面前展露软弱。',secrets:'艾莉西亚的身体对于强烈的刺激有着异常敏感的反应，这是她从未告诉任何人的秘密。即使是与丈夫亲密时，她也会刻意控制自己的反应，因为她担心过于激烈的表现会有损王后的威严。这个秘密让她既困扰又羞耻，她害怕有一天会被人发现并利用这个弱点。',appearance:{height:172,weight:58,measurements:'96-62-94',cupSize:'E',description:'艾莉西亚拥有一头如同瀑布般倾泻而下的深栗色长发，发丝在光线下会泛起琥珀色的微光，平时她会将这头秀发编成精致的辫子盘于脑后，显露出优雅修长的颈项。她的肌肤呈现出健康的蜜色，这是长年在古拉尔大陆恶劣环境下生存留下的印记，却丝毫不减其魅力，反而增添了一种野性的韵味。她的五官轮廓分明，高挺的鼻梁，饱满的嘴唇带着天然的玫瑰色泽，一双碧绿色的眼眸如同翡翠般璀璨，眼神中既有女性的柔情也有统治者的威严。她的身材高挑匀称，双肩宽阔却不失女性的柔美线条，E罩杯的丰满胸部在紧身的王室礼服下勾勒出诱人的曲线。纤细的腰肢和浑圆饱满的臀部形成完美的对比，修长笔直的双腿肌肉线条流畅，显然经过长期的战斗训练。她的手指修长但掌心有薄茧，那是常年握剑留下的痕迹。在她的左肩胛骨处有一道淡淡的伤疤，那是早年一次暗杀中留下的纪念。她的锁骨精致迷人，每当她穿着露肩礼服时，那若隐若现的锁骨线条总能吸引无数目光。她习惯佩戴翡翠王国的象征——一条镶嵌着巨大翡翠的项链，宝石正好垂落在她深邃的乳沟之间。',clothing:{head:'翡翠宝石王冠',top:'深绿色丝质礼服',bottom:'深绿色宫廷长裙',socks:'深绿色丝质长袜',shoes:'深绿色翡翠高跟鞋',underwear:'淡绿色蕾丝内衣',accessories:'翡翠宝石项链',toys:'无'}},locationId:'emerald_palace_capital',capturedAt:'帝国历1074年1月1日'}]},status:'unknown',continent:'古拉尔大陆',region:'翡翠王国',race:'人类',baseGuards:1e3,specialUnit:{name:'翡翠禁卫',race:'人类',class:'重装魔法剑士',attributes:{attack:26,defense:28,intelligence:22,speed:18,health:95}}},{id:'knight_camp_near_nest',name:'骑士团营地',type:'fortress',icon:'⚔️',description:'位于古拉尔大陆巢穴附近的一处军事要塞，由人类帝国的边境骑士团建立。这座营地建立在一座小山上，俯瞰着哥布林巢穴的方向，是帝国监视和防御哥布林威胁的前哨站。营地由坚固的木质围墙和石制塔楼组成，内部设有训练场、武器库、马厩和指挥所。骑士们日夜巡逻，随时准备应对哥布林的袭击。这里聚集了来自帝国各地的精英骑士，他们以消灭哥布林为己任，是哥布林巢穴最大的威胁之一。',difficulty:7,distance:25,rewards:{gold:2500,food:1200,slaves:45,heroes:[{id:'knight_commander_elena',name:'艾琳娜·萨尔',title:'白玫瑰骑士团长',avatar:'',status:'enemy',canCombat:!0,loyalty:0,stamina:180,maxStamina:180,fertility:165,maxFertility:165,offspring:0,rating:'A',favorite:!1,level:7,attributes:{attack:42,defense:38,intelligence:28,speed:32,health:220},race:'人类',age:28,country:'赛菲亚帝国',background:'贵族',sexExperience:'艾琳娜的性经验仅限于与已故的未婚夫，一位同样在战斗中牺牲的骑士。两人的关系纯洁而深情，但从未有过真正的亲密接触。自从未婚夫去世后，她便全身心投入到骑士团的工作中，将所有精力都投入到保卫帝国的使命中，但内心深处那份被压抑的渴望有时会在梦中苏醒。',sensitivePoints:['胸部'],sensitivePointsDetail:[{part:'嘴巴',isSensitive:!1,description:'艾琳娜的嘴唇薄而性感，天然带着淡粉色的光泽。她的唇形完美，上唇略薄而下唇丰盈，接吻时会有微微的颤抖。她的舌头灵活而湿润，口腔内部温暖紧致，当被深入侵犯时会本能地吸吮和纠缠。'},{part:'胸部',isSensitive:!0,description:'艾琳娜的胸部丰满挺拔，D罩杯的乳房在紧身盔甲下展现出完美的形状。她的乳房触感柔软却富有弹性，乳晕呈现淡粉色，直径约三厘米，乳头在未受刺激时呈现可爱的粉红色。由于长期穿着盔甲作战，她的乳房保持着极佳的形状，几乎没有下垂。当被抚摸时，乳头会迅速充血变硬，整体敏感度极高，这是她最大的弱点。'},{part:'阴道',isSensitive:!1,description:'艾琳娜的阴道因为从未有过性经验而保持着处女般的紧致度。外阴唇饱满而富有弹性，内阴唇小巧粉嫩，阴蒂隐藏在包皮之下。阴道内壁布满细密的褶皱，收缩力极强，在被插入时会本能地紧紧吸附。由于从未有过这方面的经验，她的阴道保持着完全的紧闭状态，初次进入需要充分的润滑和扩张。'},{part:'子宫',isSensitive:!1,description:'艾琳娜的子宫保持着处女般的状态，从未被任何异物触碰过。她的子宫口紧闭，内部温度正常，当被精液灌满时会产生强烈的满足感。由于从未有过性经验，她的子宫保持着完全的原始状态，等待着第一次的探索和开发。'},{part:'后庭',isSensitive:!1,description:'艾琳娜的后庭紧致而从未被开发过，臀部饱满圆润，臀肉紧实而富有弹性。她的肛门呈现健康的浅粉色，周围皮肤细腻光滑。由于从未有过这方面的经验，她的后庭保持着完全的紧闭状态，即使是手指也难以轻易进入。她对这个部位有着本能的抗拒和羞耻感，认为从后方被侵犯是极度屈辱的行为。'}],lifeStory:{childhood:['艾琳娜出生于赛菲亚帝国的一个贵族家庭，她的家族世代为帝国效力，父亲是一位著名的骑士团长。从小她就被灌输着正义和荣誉的理念，在父亲的严格训练下，她学会了剑术、骑术和战术。在那个充满战争的童年里，她目睹了无数哥布林对边境村庄的袭击，这让她从小就立志要成为一名骑士，保护无辜的平民。她的母亲是一位宫廷魔法师，教会了她基础的魔法知识，这为她后来成为指挥官奠定了基础。'],adolescence:['十五岁那年，艾琳娜正式加入了帝国骑士团，成为了一名见习骑士。在骑士团中，她以优异的成绩和坚定的意志赢得了同僚们的尊重。十八岁时，她参加了第一次对哥布林巢穴的围剿行动，在战斗中表现出色，被提升为小队长。二十岁时，她率领自己的小队成功击退了哥布林对边境要塞的袭击，因此被授予了银剑骑士的称号。那段时期是她人生中最充实的时光，她与战友们并肩作战，为保护帝国的安全而奋斗。'],adulthood:['二十五岁时，艾琳娜被任命为边境骑士团的指挥官，负责监视和防御哥布林巢穴的威胁。作为指挥官，她不仅要指挥战斗，还要管理营地的日常事务，协调与帝国其他部队的合作。她以铁腕手段管理着骑士团，用雷霆手段镇压了数次哥布林的袭击。在血与火的洗礼中，她从一个年轻的骑士成长为一位成熟的指挥官，向所有人证明了女性同样可以成为优秀的军事领袖。'],currentState:['如今二十八岁的艾琳娜已经担任指挥官三年，她将骑士团管理得井井有条，甚至开始向哥布林巢穴发起主动攻击。但作为女性指挥官，她也面临着来自同僚的质疑和挑战。夜深人静时，她常常会想念家乡的亲人，但为了帝国的安全，她必须坚守在这个危险的前哨站。最近哥布林的活动越来越频繁，她预感到一场更大的战斗即将来临，为此她加强了营地的防御，同时派出侦察兵侦查哥布林巢穴的动向。']},personality:['坚毅不屈','正义凛然','外冷内热'],fears:'艾琳娜最大的恐惧是失去战友和让无辜的平民受到伤害。作为指挥官，她深知每一次决策都关系到战友们的生死。她害怕因为自己的失误而导致战友牺牲，害怕无法保护那些信任她的平民。这种恐惧驱使她必须时刻保持警惕，绝不在任何战斗中掉以轻心。',secrets:'艾琳娜的秘密是她内心深处对爱情的渴望和对被保护的渴望。作为指挥官，她必须时刻保持坚强，但内心深处她渴望有一个能够保护她、理解她的男人。这个秘密让她既困扰又羞耻，她害怕被人发现这个弱点，害怕被人认为她不够坚强。',appearance:{height:175,weight:65,measurements:'88-65-92',cupSize:'D',description:'艾琳娜拥有一头如瀑布般倾泻而下的银白色长发，在阳光下闪烁着金属般的光泽，平时她会将长发编成复杂的辫子盘在脑后，显得既优雅又干练。她的肌肤呈现出健康的小麦色，这是长期在户外训练和战斗留下的痕迹，却丝毫不减其魅力，反而增添了一种野性的美感。她的五官精致而立体，高挺的鼻梁，薄而性感的嘴唇，一双如蓝宝石般深邃的眼眸中闪烁着坚定的光芒，眼神中既有女性的柔美也有战士的坚毅。她的身材高挑匀称，双肩宽阔而有力，D罩杯的丰满胸部在紧身的骑士装束下勾勒出诱人的曲线。纤细的腰肢和浑圆饱满的臀部形成完美的对比，修长笔直的双腿肌肉线条流畅，显然经过长期的战斗训练。她的手指修长但掌心有厚茧，那是常年握剑留下的痕迹。在她的右臂上有一道淡淡的伤疤，那是早年与哥布林战斗时留下的纪念。她的锁骨精致迷人，每当她穿着低领的便装时，那若隐若现的锁骨线条总能吸引无数目光。她习惯佩戴家族传承的银剑项链，剑形的吊坠正好垂落在她深邃的乳沟之间。',clothing:{head:'银白色花纹头盔',top:'银白色精钢胸甲',bottom:'银白色锁子战裙',socks:'白色棉质长袜',shoes:'银白色花纹战靴',underwear:'白色棉质内衣',accessories:'银白色剑形项链',toys:'无'}},locationId:'knight_camp_near_nest',capturedAt:'帝国历1074年1月1日'}]},status:'unknown',continent:'古拉尔大陆',region:'巢穴附近',race:'人类',baseGuards:150,specialUnit:{name:'精英骑士',race:'人类',class:'重装骑士',attributes:{attack:22,defense:28,intelligence:15,speed:12,health:85}}}];function u(){return{baseResources:{...l},exploration:{locations:[...d],state:{scoutedLocations:[],conqueredLocations:[]},scoutingLocations:[],scoutingAnimation:[],continents:[],continentExploreState:{unlockedContinents:[],conqueredContinents:[],currentContinent:'',continentProgress:{}}},nest:{...r},history:{...i},training:{...c},metadata:{gameVersion:o,lastSaved:Date.now(),totalPlayTime:0,gameStartTime:Date.now()}}}},588:(e,t,a)=>{a.d(t,{FormationService:()=>s});var o=a(716),n=a(633);class s{static getFormationData(){try{const e=o.l.getCurrentGameData();if(!e)return console.log('没有找到游戏数据'),[];console.log('获取到的游戏数据:',e);const t=e.training.characters;console.log('人物数据:',t);const a=[];return t.forEach(e=>{if(console.log(`检查人物 ${e.name}: status=${e.status}, troopDeployment=`,e.troopDeployment),'deployed'===e.status){const t=e,o=e.troopDeployment,s=Math.floor(e.offspring/10);let l=0,r=0,i=0,c=0,d=0;if(o){const e={normalGoblins:'普通哥布林',warriorGoblins:'哥布林战士',shamanGoblins:'哥布林萨满',paladinGoblins:'哥布林圣骑士'};Object.entries(o).forEach(([t,a])=>{const o=a;if(o>0){const a=e[t];if(a){const e=n.Mq.find(e=>e.id===a);if(e){const t=Math.min(e.level,10),n=t/10,s=Math.floor(o*e.attributes.attack*n),u=Math.floor(o*e.attributes.defense*n),m=Math.floor(o*e.attributes.intelligence*n),g=Math.floor(o*e.attributes.speed*n),h=Math.floor(o*e.attributes.health*n);l+=s,r+=u,i+=m,c+=g,d+=h,console.log(`部队加成计算: ${a} x${o}`,{单位属性:e.attributes,等级:t,加成比例:n,计算加成:{attack:s,defense:u,intelligence:m,speed:g,health:h}})}}}})}const u={id:`${t.id}_captain`,name:t.name,type:'hybrid',level:s,attributes:{attack:t.attributes.attack+l,defense:t.attributes.defense+r,intelligence:t.attributes.intelligence+i,speed:t.attributes.speed+c},maxHealth:t.attributes.health+d,currentHealth:t.attributes.health+d,isAlive:!0,troops:o,avatar:t.avatar};console.log(`队长 ${t.name} 属性加成计算:`,{原始属性:t.attributes,部队加成:{attack:l,defense:r,intelligence:i,speed:c,health:d},最终属性:u.attributes,最终血量:u.maxHealth}),a.push(u)}}),console.log('获取到部队编制数据:',a),a}catch(e){return console.error('获取部队编制数据失败:',e),[]}}static hasFormationData(){try{const e=o.l.getCurrentGameData();if(!e)return console.log('hasFormationData: 没有找到游戏数据'),!1;const t=e.training.characters;console.log('hasFormationData: 检查人物数据:',t);const a=t.some(e=>{const t='deployed'===e.status;return console.log(`人物 ${e.name}: isDeployed=${t}, troopDeployment=`,e.troopDeployment),t});return console.log('hasFormationData: 检查结果:',a),a||(console.log('=== 部队编制调试信息 ==='),console.log('已编制的人物数量:',t.filter(e=>'deployed'===e.status).length),t.filter(e=>'deployed'===e.status).forEach(e=>{if(console.log(`人物: ${e.name}`),console.log(`  状态: ${e.status}`),console.log('  部队编制:',e.troopDeployment),e.troopDeployment){const t=Object.values(e.troopDeployment).reduce((e,t)=>e+t,0);console.log(`  总部队数: ${t}`)}else console.log('  无部队编制（队长单独出战）')}),console.log('========================')),a}catch(e){return console.error('检查部队编制数据失败:',e),!1}}static getFormationStats(){const e=this.getFormationData(),t={};e.forEach(e=>{t[e.type]=(t[e.type]||0)+1});const a=o.l.getCurrentGameData(),n=a?a.training.characters.filter(e=>'deployed'===e.status&&e.troopDeployment&&Object.values(e.troopDeployment).some(e=>e>0)).length:0;return{totalUnits:e.length,totalCaptains:n,unitTypes:t}}static async saveFormationData(e){try{console.log('开始保存部队编制数据:',e);const t=o.l.getCurrentGameData();return t?(console.log('保存前的游戏数据:',t),console.log('保存前的人物数据:',t.training.characters),t.training.characters.forEach(e=>{'deployed'===e.status&&(console.log(`清除人物 ${e.name} 的编制状态`),e.status='surrendered',e.troopDeployment=void 0)}),e.forEach((e,a)=>{if(console.log(`处理队长槽位 ${a}:`,e),e&&e.troops){const a=t.training.characters.find(t=>t.id===e.id);if(a){console.log(`找到对应人物 ${a.name}，设置编制状态`),a.status='deployed';const t={normalGoblins:e.troops.普通哥布林||0,warriorGoblins:e.troops.哥布林战士||0,shamanGoblins:e.troops.哥布林萨满||0,paladinGoblins:e.troops.哥布林圣骑士||0};a.troopDeployment=t,console.log(`人物 ${a.name} 的部队编制:`,t)}else console.warn(`未找到ID为 ${e.id} 的人物`)}}),console.log('保存后的人物数据:',t.training.characters),o.l.updateModuleData({moduleName:'training',data:t.training}),console.log('部队编制数据已保存到存档系统'),!0):(console.error('没有找到游戏数据，无法保存部队编制'),!1)}catch(e){return console.error('保存部队编制数据失败:',e),!1}}static loadFormationData(){try{const e=o.l.getCurrentGameData();if(!e)return console.log('没有找到游戏数据'),[];const t=[],a=e.training.characters.filter(e=>'deployed'===e.status&&e.troopDeployment);for(let e=0;e<6;e++){const o=a[e];if(o&&o.troopDeployment){const e={id:o.id,name:o.name,avatar:o.avatar||'',level:o.level,offspring:o.offspring,attributes:o.attributes,description:o.title||'',isUsed:!0,troops:{普通哥布林:o.troopDeployment.normalGoblins,哥布林战士:o.troopDeployment.warriorGoblins,哥布林萨满:o.troopDeployment.shamanGoblins,哥布林圣骑士:o.troopDeployment.paladinGoblins}};t.push(e)}else t.push(null)}return console.log('从存档系统加载部队编制数据:',t),t}catch(e){return console.error('加载部队编制数据失败:',e),[]}}static getFormationConfigs(){try{const e=localStorage.getItem('goblin-nest-formation-configs');return e?JSON.parse(e):[]}catch(e){return console.error('获取部队配置列表失败:',e),[]}}static saveFormationConfig(e){try{const t=this.getFormationConfigs(),a={...e,id:`config_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:Date.now(),lastModified:Date.now()};return t.push(a),localStorage.setItem('goblin-nest-formation-configs',JSON.stringify(t)),console.log('部队配置已保存:',a),a.id}catch(e){throw console.error('保存部队配置失败:',e),e}}static updateFormationConfig(e,t){try{const a=this.getFormationConfigs(),o=a.findIndex(t=>t.id===e);return-1===o?(console.error('未找到指定的部队配置'),!1):(a[o]={...a[o],...t,lastModified:Date.now()},localStorage.setItem('goblin-nest-formation-configs',JSON.stringify(a)),console.log('部队配置已更新:',a[o]),!0)}catch(e){return console.error('更新部队配置失败:',e),!1}}static deleteFormationConfig(e){try{const t=this.getFormationConfigs(),a=t.filter(t=>t.id!==e);return a.length===t.length?(console.error('未找到指定的部队配置'),!1):(localStorage.setItem('goblin-nest-formation-configs',JSON.stringify(a)),console.log('部队配置已删除:',e),!0)}catch(e){return console.error('删除部队配置失败:',e),!1}}static loadFormationConfig(e){try{const t=this.getFormationConfigs().find(t=>t.id===e);return t?(console.log('加载部队配置:',t),t.captainSlots):(console.error('未找到指定的部队配置'),Array(6).fill(null))}catch(e){return console.error('加载部队配置失败:',e),Array(6).fill(null)}}static getFormationConfig(e){try{return this.getFormationConfigs().find(t=>t.id===e)||null}catch(e){return console.error('获取部队配置详情失败:',e),null}}}},633:(e,t,a)=>{a.d(t,{YD:()=>l,Mq:()=>r,P$:()=>d,jr:()=>u,zw:()=>c,sq:()=>i});class o{static parseFromCSV(e){const t=e.trim().split('\n'),a=t[0].split(','),o=[];for(let e=1;e<t.length;e++){const n=t[e].split(',');if(n.length<a.length)continue;const s=this.parseUnitFromRow(a,n);s&&o.push(s)}return o}static parseUnitFromRow(e,t){try{const a={};e.forEach((e,o)=>{a[e.trim()]=t[o]?.trim()||''});const o=a.canLeadRaces?a.canLeadRaces.split('|'):[];return{id:a.name,name:a.name,title:'',avatar:a.avatar,canCombat:!0,background:'平民',status:'enemy',loyalty:0,stamina:0,fertility:0,offspring:0,maxStamina:0,maxFertility:0,rating:'C',level:parseInt(a.level)||1,attributes:{attack:parseInt(a.attack)||0,defense:parseInt(a.defense)||0,intelligence:parseInt(a.intelligence)||0,speed:parseInt(a.speed)||0,health:parseInt(a.health)||1},race:a.race,age:25,country:a.country,unitType:a.unitType,canLeadRaces:o}}catch(e){return console.error('解析单位数据失败:',e,t),null}}static getUnitsByRace(e,t){return t.filter(t=>t.race===e)}static getUnitByName(e,t){return t.find(t=>t.name===e)}static getUnitsByLevelRange(e,t,a){return a.filter(a=>a.level>=e&&a.level<=t)}static getUnitsByType(e,t){return t.filter(t=>t.unitType===e)}}const n='name,avatar,race,country,unitType,level,attack,defense,intelligence,speed,health,canLeadRaces\n永恒精灵游侠,https://files.catbox.moe/csq7o3.png,永恒精灵,永恒精灵森林,hybrid,4,8,3,8,10,16,永恒精灵\n永恒精灵平民,https://files.catbox.moe/yxdznd.png,永恒精灵,永恒精灵森林,physical,1,1,1,2,2,4,永恒精灵\n永恒精灵法师,https://files.catbox.moe/cqbbik.png,永恒精灵,永恒精灵森林,magical,5,1,1,12,6,10,永恒精灵\n永恒精灵德鲁伊,https://files.catbox.moe/rulo3k.png,永恒精灵,永恒精灵森林,magical,6,4,3,12,5,18,永恒精灵\n天使祭司,https://files.catbox.moe/d7psd4.png,天使,天界,magical,7,4,4,12,5,15,天使\n守护天使,https://files.catbox.moe/jv1owy.png,天使,天界,defensive,8,6,8,6,6,18,天使\n战斗天使,https://files.catbox.moe/wsg4b7.png,天使,天界,physical,6,7,5,3,7,14,天使\n人类守卫,https://files.catbox.moe/tpbkcq.png,人类,王国,defensive,2,3,5,1,2,8,人类\n人类士兵,https://files.catbox.moe/cx8hnc.png,人类,王国,physical,3,5,3,1,3,10,人类\n人类圣骑士,https://files.catbox.moe/wevv28.png,人类,圣殿,hybrid,8,8,7,4,4,16,人类\n人类商人,https://files.catbox.moe/7kwm5s.png,人类,王国,agile,1,1,1,2,2,3,人类\n人类骑士,https://files.catbox.moe/nz3y0w.png,人类,王国,hybrid,7,6,5,2,3,12,人类\n人类农民,https://files.catbox.moe/aiqxr2.png,人类,王国,physical,1,1,1,0,1,3,人类\n人类牧师,https://files.catbox.moe/1m6ni6.png,人类,圣殿,magical,6,2,3,4,1,6,人类\n人类民兵,https://files.catbox.moe/9ty6z2.png,人类,王国,physical,1,2,2,1,1,4,人类\n人类弓箭手,https://files.catbox.moe/1hfjh3.png,人类,王国,agile,2,4,2,2,4,6,人类\n人类法师,https://files.catbox.moe/993iao.png,人类,魔法学院,magical,5,1,2,6,2,4,人类\n普通哥布林,🟢,哥布林,哥布林巢穴,physical,1,1,1,0,1,5,哥布林\n骷髅战士,https://files.catbox.moe/okmnag.png,亡灵,死亡领域,physical,2,8,2,0,3,10,亡灵\n骷髅仆从,https://files.catbox.moe/omnf5s.png,亡灵,死亡领域,physical,1,1,1,0,1,3,亡灵\n骷髅法师,https://files.catbox.moe/zjro2p.png,亡灵,死亡领域,magical,5,2,2,8,2,6,亡灵\n僵尸,https://files.catbox.moe/8tl4j5.png,亡灵,死亡领域,defensive,2,6,8,0,0,14,亡灵\n狐族巫女,https://files.catbox.moe/kgtuyz.png,狐族,九尾神社,magical,6,2,4,6,3,8,狐族\n狐族守卫,https://files.catbox.moe/domp5g.png,狐族,九尾神社,defensive,2,3,4,2,3,6,狐族\n狐族商人,https://files.catbox.moe/8n28s7.png,狐族,红叶商盟,agile,1,3,3,5,4,6,狐族\n狐族航海家,https://files.catbox.moe/ov0rl8.png,狐族,红叶商盟,agile,6,4,3,6,5,8,狐族\n狐族弓箭手,https://files.catbox.moe/m7lva3.png,狐族,九尾神社,agile,3,4,2,3,5,6,狐族\n狐族法师,https://files.catbox.moe/lsgnrg.png,狐族,九尾神社,magical,5,1,2,7,3,5,狐族\n狐族村民,https://files.catbox.moe/tfpfsh.png,狐族,九尾神社,physical,1,1,1,1,2,3,狐族\n黑暗精灵战士,https://files.catbox.moe/pqbq0j.png,黑暗精灵,暗影密会,physical,3,5,3,2,4,7,黑暗精灵\n黑暗精灵奴隶,https://files.catbox.moe/9trz0j.png,黑暗精灵,暗影密会,physical,1,2,1,1,1,4,黑暗精灵\n黑暗精灵祭司,https://files.catbox.moe/xp7sw1.png,黑暗精灵,暗影密会,magical,6,3,3,6,2,7,黑暗精灵\n黑暗精灵弓箭手,https://files.catbox.moe/2vk4ko.png,黑暗精灵,暗影密会,agile,2,5,2,3,6,5,黑暗精灵\n黑暗精灵法师,https://files.catbox.moe/n3iamo.png,黑暗精灵,暗影密会,magical,5,2,2,7,3,5,黑暗精灵\n黑暗精灵刺客,https://files.catbox.moe/8wd6b4.png,黑暗精灵,暗影密会,agile,5,7,1,3,6,4,黑暗精灵\n哥布林战士,⚔️,哥布林,哥布林巢穴,physical,2,4,3,1,3,12,哥布林\n哥布林圣骑士,✨,哥布林,哥布林巢穴,hybrid,6,6,5,4,4,18,哥布林\n哥布林萨满,🔮,哥布林,哥布林巢穴,magical,5,2,2,8,3,10,哥布林\n恶魔战士,https://files.catbox.moe/pus011.png,魔族,地狱,physical,4,8,6,4,5,16,魔族\n恶魔领主,https://files.catbox.moe/yx7jv7.png,魔族,地狱,hybrid,10,10,8,8,7,25,魔族\n炽天使,https://files.catbox.moe/btr5a6.png,天使,天界,hybrid,9,8,6,10,8,20,天使',s=o.parseFromCSV(n),l=(o.getUnitsByRace('哥布林',s),o.getUnitsByRace('人类',s),o.getUnitsByRace('狐族',s),o.getUnitsByRace('黑暗精灵',s),o.getUnitsByRace('永恒精灵',s),o.getUnitsByRace('亡灵',s),o.parseFromCSV(n)),r=o.getUnitsByRace('哥布林',l);o.getUnitsByRace('人类',l),o.getUnitsByRace('狐族',l),o.getUnitsByRace('黑暗精灵',l),o.getUnitsByRace('永恒精灵',l),o.getUnitsByRace('亡灵',l);function i(e){return o.getUnitsByRace(e,l)}function c(e){return o.getUnitByName(e,l)}function d(){const e=Math.floor(Math.random()*l.length);return l[e]}function u(e){const t=i(e);if(0===t.length)return d();return t[Math.floor(Math.random()*t.length)]}},716:(e,t,a)=>{a.d(t,{l:()=>r});var o=a(61),_=a(844),n=a(563);const s=new class{dbName=n.oU;version=n.LG;db=null;async init(){return new Promise((e,t)=>{const a=indexedDB.open(this.dbName,this.version);a.onerror=()=>{console.error('数据库打开失败:',a.error),t(a.error)},a.onsuccess=()=>{this.db=a.result,console.log('数据库连接成功，对象存储:',Array.from(this.db.objectStoreNames)),e()},a.onupgradeneeded=e=>{const t=e.target.result;if(console.log('数据库升级中，版本:',e.oldVersion,'->',e.newVersion),!t.objectStoreNames.contains('saves')){const e=t.createObjectStore('saves',{keyPath:'id'});e.createIndex('name','name',{unique:!1}),e.createIndex('lastPlayed','lastPlayed',{unique:!1}),console.log('✅ 创建 saves 对象存储')}if(!t.objectStoreNames.contains('gameData')){t.createObjectStore('gameData',{keyPath:'id'}).createIndex('saveId','id',{unique:!0}),console.log('✅ 创建 gameData 对象存储')}if(!t.objectStoreNames.contains('worldbookData')){t.createObjectStore('worldbookData',{keyPath:'id'}).createIndex('saveId','id',{unique:!0}),console.log('✅ 创建 worldbookData 对象存储')}}})}async forceReinit(){try{console.log('强制重新初始化数据库...'),this.db&&(this.db.close(),this.db=null);const e=indexedDB.deleteDatabase(this.dbName);await new Promise(t=>{e.onsuccess=()=>{console.log('旧数据库删除成功'),t()},e.onerror=()=>{console.log('删除旧数据库时出错，但继续执行:',e.error),t()},e.onblocked=()=>{console.log('数据库被阻塞，等待...'),setTimeout(()=>t(),1e3)}}),await new Promise(e=>setTimeout(e,1e3)),await this.init(),console.log('数据库强制重新初始化完成')}catch(e){throw console.error('强制重新初始化数据库失败:',e),e}}async createSave(e){if(!this.db)throw new Error('Database not initialized');const t=`save_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:t,name:e,createdAt:new Date,lastPlayed:new Date,version:'1.0.0'};return await this.putData('saves',a),await this.createSaveDataStore(t),t}async createSaveDataStore(e){if(!this.db)throw new Error('Database not initialized');const t=(0,n.Kz)();await this.putData('gameData',{id:e,data:t})}async getAllSaves(){if(!this.db)throw new Error('Database not initialized');return new Promise((e,t)=>{const a=this.db.transaction(['saves'],'readonly').objectStore('saves').getAll();a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}async loadSave(e){if(!this.db)throw new Error('Database not initialized');try{const t=await this.getData('gameData',e);return t?.data||null}catch(e){return console.error('Failed to load save:',e),null}}async saveGameData(e,t){if(!this.db)throw new Error('Database not initialized');const a=this.toPlain(t);await this.putData('gameData',{id:e,data:a});const o=await this.getData('saves',e);o&&(o.lastPlayed=new Date,await this.putData('saves',o))}async upsertSaveMeta(e,t){if(!this.db)throw new Error('Database not initialized');const a=await this.getData('saves',e),o={id:e,name:t,createdAt:a?.createdAt??new Date,lastPlayed:new Date,version:'1.0.0'};await this.putData('saves',o)}async deleteSave(e){if(!this.db)throw new Error('Database not initialized');await this.deleteData('saves',e),await this.deleteData('gameData',e)}async getData(e,t){if(!this.db)throw new Error('Database not initialized');return new Promise((a,o)=>{const n=this.db.transaction([e],'readonly').objectStore(e).get(t);n.onsuccess=()=>a(n.result),n.onerror=()=>o(n.error)})}async putData(e,t){if(!this.db)throw new Error('Database not initialized');if(!this.db.objectStoreNames.contains(e))throw new Error(`对象存储 '${e}' 不存在。可用存储: ${Array.from(this.db.objectStoreNames).join(', ')}`);return new Promise((a,o)=>{const n=this.db.transaction([e],'readwrite').objectStore(e).put(t);n.onsuccess=()=>{console.log(`✅ 数据保存到 ${e} 成功`),a()},n.onerror=()=>{console.error(`❌ 数据保存到 ${e} 失败:`,n.error),o(n.error)}})}toPlain(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return console.error('toPlain 失败，使用原始值回退。请检查循环引用或不可序列化字段。',t),e}}async deleteData(e,t){if(!this.db)throw new Error('Database not initialized');return new Promise((a,o)=>{const n=this.db.transaction([e],'readwrite').objectStore(e).delete(t);n.onsuccess=()=>a(),n.onerror=()=>o(n.error)})}getCurrentSaveId(){return getVariables({type:'global'})?.currentSaveId||null}setCurrentSaveId(e){const t=getVariables({type:'global'})||{};replaceVariables({...t,currentSaveId:e},{type:'global'})}getCurrentSlot(){const e=this.getCurrentSaveId();if(e&&e.startsWith('slot_')){const t=parseInt(e.substring(5));return isNaN(t)?null:t}return null}async saveWorldbookData(e,t){if(!this.db)throw new Error('Database not initialized');try{await this.putData('worldbookData',{id:e,data:t,savedAt:new Date}),console.log(`世界书数据已保存到存档 ${e}`)}catch(e){throw console.error('保存世界书数据失败:',e),e}}async loadWorldbookData(e){if(!this.db)throw new Error('Database not initialized');try{const t=await this.getData('worldbookData',e);return t?t.data:null}catch(e){return console.error('读取世界书数据失败:',e),null}}async deleteWorldbookData(e){if(!this.db)throw new Error('Database not initialized');try{await this.deleteData('worldbookData',e),console.log(`已删除存档 ${e} 的世界书数据`)}catch(e){throw console.error('删除世界书数据失败:',e),e}}close(){this.db&&(this.db.close(),this.db=null)}};s.init().catch(console.error);class l{static MAX_SLOTS=5;static CURRENT_VERSION='1.0.0';events={};currentGameData=null;resources=(0,o.ref)({...n.VU});resourceDisplay=(0,o.computed)(()=>({gold:`💰 ${this.resources.value.gold}`,food:`🍖 ${this.resources.value.food}`,threat:`⚠️ ${this.resources.value.threat}`,slaves:`🔒 ${this.resources.value.slaves}`,trainingSlaves:`💋 ${this.resources.value.trainingSlaves}`,rounds:`🔄 ${this.resources.value.rounds}`,actionPoints:`❤️ ${this.resources.value.actionPoints}/${this.resources.value.maxActionPoints}`,conqueredRegions:`🏰 ${this.resources.value.conqueredRegions}`}));constructor(e){e&&(this.events=e)}deriveSlotFromId(e){if(e.startsWith('slot_')){const t=parseInt(e.substring(5));return Number.isFinite(t)?t:0}const t=e.split('_'),a=t[t.length-1],o=parseInt(a);return Number.isFinite(o)?o:0}setEvents(e){this.events={...this.events,...e}}async init(){try{await s.init(),await this.ensureDefaultWorldbook(),console.log('模块化存档管理器初始化成功')}catch(e){console.error('模块化存档管理器初始化失败，尝试强制重新初始化:',e);try{await s.forceReinit(),await this.ensureDefaultWorldbook(),console.log('模块化存档管理器强制重新初始化成功')}catch(e){throw console.error('模块化存档管理器强制重新初始化失败:',e),e}}}async getAllSlots(){try{const e=await s.getAllSaves(),t=[];for(const a of e){const e=this.deriveSlotFromId(a.id),o=await s.loadSave(a.id);t.push({slot:e,data:o,timestamp:a.lastPlayed.getTime(),version:a.version,saveName:a.name})}const a=[];for(let e=0;e<=l.MAX_SLOTS;e++){const o=t.find(t=>t.slot===e);o?a.push(o):a.push({slot:e,data:null,timestamp:0,version:l.CURRENT_VERSION,saveName:0===e?'自动存档':`槽位 ${e}`})}return a}catch(e){return console.error('获取存档槽位失败:',e),this.handleError(e),[]}}async getSlot(e){try{if(e<0||e>l.MAX_SLOTS)throw new Error(`无效的槽位编号: ${e}`);const t=await s.getAllSaves();let a=t.find(t=>t.id===`slot_${e}`);if(a||(a=t.find(t=>t.id.endsWith(`_${e}`))),a){const t=await s.loadSave(a.id);return{slot:e,data:t,timestamp:a.lastPlayed.getTime(),version:a.version,saveName:a.name}}return{slot:e,data:null,timestamp:0,version:l.CURRENT_VERSION,saveName:`槽位 ${e}`}}catch(t){return console.error(`获取槽位 ${e} 失败:`,t),this.handleError(t),{slot:e,data:null,timestamp:0,version:l.CURRENT_VERSION,saveName:`槽位 ${e}`}}}async saveToSlot(e){try{const{slot:t,gameData:a}=e;if(t<0||t>l.MAX_SLOTS)throw new Error(`无效的槽位编号: ${t}`);a.metadata.lastSaved=Date.now(),a.metadata.gameVersion=l.CURRENT_VERSION;const o=`slot_${t}`;return await s.saveGameData(o,a),await s.upsertSaveMeta(o,e.saveName??(0===t?'自动存档':`槽位 ${t}`)),s.setCurrentSaveId(o),this.currentGameData=a,await this.saveWorldbookToDatabase(t),this.events.onSave&&this.events.onSave(t,a),console.log(`游戏已保存到槽位 ${t}`),!0}catch(e){return console.error('保存游戏失败:',e),this.handleError(e),!1}}async loadFromSlot(e){try{const{slot:t}=e;if(t<0||t>l.MAX_SLOTS)throw new Error(`无效的槽位编号: ${t}`);const a=await this.getSlot(t);if(!a.data)throw new Error(`槽位 ${t} 没有存档`);return this.currentGameData=a.data,s.setCurrentSaveId(`slot_${t}`),await this.restoreWorldbookFromDatabase(t),this.events.onLoad&&this.events.onLoad(t,a.data),console.log(`游戏已从槽位 ${t} 读取`),a.data}catch(e){return console.error('读取游戏失败:',e),this.handleError(e),null}}async deleteSlot(e){try{const{slot:t}=e;if(t<0||t>l.MAX_SLOTS)throw new Error(`无效的槽位编号: ${t}`);const a=(await s.getAllSaves()).find(e=>e.id.includes(`_${t}_`));return a&&await s.deleteSave(a.id),await this.deleteWorldbookDataFromDatabase(t),this.events.onDelete&&this.events.onDelete(t),console.log(`槽位 ${t} 的存档已删除`),!0}catch(e){return console.error('删除存档失败:',e),this.handleError(e),!1}}async hasSave(e){return(await this.getSlot(e)).timestamp>0}getCurrentGameData(){return this.currentGameData}syncResourcesToReactive(){this.currentGameData&&(this.resources.value={...this.currentGameData.baseResources})}syncReactiveToResources(){this.currentGameData&&(this.currentGameData.baseResources={...this.resources.value})}updateModuleData(e){if(!this.currentGameData)return void console.warn('没有加载的游戏数据，无法更新模块数据');const{moduleName:t,data:a}=e;this.currentGameData[t]=a,this.events.onModuleUpdate&&this.events.onModuleUpdate(t,this.currentGameData[t]),console.log(`模块 ${t} 数据已更新`)}getModuleData(e){return this.currentGameData?this.currentGameData[e.moduleName]:null}updateBaseResources(e){this.currentGameData?(this.currentGameData.baseResources={...this.currentGameData.baseResources,...e},console.log('基础资源已更新')):console.warn('没有加载的游戏数据，无法更新基础资源')}createNewGame(){return this.currentGameData=(0,n.Kz)(),this.currentGameData}async saveCurrentGameData(e,t){return this.currentGameData||(console.warn('没有当前游戏数据，创建新游戏'),this.createNewGame()),await this.saveToSlot({slot:e,saveName:t,gameData:this.currentGameData})}formatTime(e){if(!e)return'无存档';return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}async getSaveStats(){const e=(await this.getAllSlots()).filter(e=>e.timestamp>0).length;return{totalSlots:l.MAX_SLOTS,usedSlots:e,emptySlots:l.MAX_SLOTS-e}}async clearAllSaves(){try{const e=await s.getAllSaves();for(const t of e)await s.deleteSave(t.id);return console.log('所有存档已清除'),!0}catch(e){return console.error('清除存档失败:',e),this.handleError(e),!1}}async exportSave(e){try{const t=await this.getSlot(e);if(!t.data)throw new Error(`槽位 ${e} 没有存档`);return JSON.stringify(t.data,null,2)}catch(e){return console.error('导出存档失败:',e),this.handleError(e),null}}async importSave(e,t,a){try{const o=JSON.parse(t);return await this.saveToSlot({slot:e,saveName:a,gameData:o})}catch(e){return console.error('导入存档失败:',e),this.handleError(e),!1}}getCurrentResources(){return this.currentGameData||this.createNewGame(),this.currentGameData.baseResources}setResource(e,t){this.currentGameData||this.createNewGame(),this.currentGameData.baseResources[e]=t,this.currentGameData.metadata.lastSaved=Date.now(),this.syncResourcesToReactive()}getResource(e){return this.currentGameData||this.createNewGame(),this.currentGameData.baseResources[e]}addResource(e,t,a){console.log(`addResource 被调用: ${e}, 数量: ${t}, 原因: ${a}`),this.currentGameData||(console.log('没有当前游戏数据，创建新游戏'),this.createNewGame());const o=this.currentGameData.baseResources[e],n=o+t;return console.log(`资源 ${e}: 当前值 ${o} -> 新值 ${n}`),('gold'===e||'food'===e||'normalGoblins'===e||'warriorGoblins'===e||'shamanGoblins'===e||'paladinGoblins'===e||'actionPoints'===e)&&n<0?(console.warn(`资源 ${e} 不足，无法减少 ${t}`),!1):(this.currentGameData.baseResources[e]=n,this.currentGameData.metadata.lastSaved=Date.now(),console.log('同步到Vue响应式状态...'),this.syncResourcesToReactive(),console.log('Vue响应式状态已更新:',this.resources.value[e]),a&&console.log(`${a}: ${e} ${t>0?'+':''}${t} (当前: ${n})`),!0)}consumeResource(e,t,a){this.currentGameData||this.createNewGame();const o=this.currentGameData.baseResources[e];return o<t?(console.warn(`资源 ${e} 不足: 需要 ${t}，当前 ${o}`),!1):(this.currentGameData.baseResources[e]=o-t,this.currentGameData.metadata.lastSaved=Date.now(),this.syncResourcesToReactive(),a&&console.log(`${a}: ${e} -${t} (剩余: ${o-t})`),!0)}consumeResources(e){this.currentGameData||this.createNewGame();for(const t of e){const e=this.currentGameData.baseResources[t.type];if(e<t.amount)return console.warn(`资源 ${t.type} 不足: 需要 ${t.amount}，当前 ${e}`),!1}for(const t of e)this.currentGameData.baseResources[t.type]-=t.amount,t.reason&&console.log(`${t.reason}: ${t.type} -${t.amount}`);return this.currentGameData.metadata.lastSaved=Date.now(),this.syncResourcesToReactive(),!0}hasEnoughResources(e){this.currentGameData||this.createNewGame();for(const t of e){if(this.currentGameData.baseResources[t.type]<t.amount)return!1}return!0}getInsufficientResourcesMessage(e){this.currentGameData||this.createNewGame();const t=[];for(const a of e){const e=this.currentGameData.baseResources[a.type];e<a.amount&&t.push(`${a.type}: 需要 ${a.amount}，当前 ${e}`)}return t.join('; ')}resetResources(){this.currentGameData||this.createNewGame();const e={...n.VU};this.currentGameData.baseResources={...e},this.currentGameData.metadata.lastSaved=Date.now(),this.syncResourcesToReactive()}getInitialNestData(){try{return n.ji}catch(e){return console.error('获取初始巢穴数据失败:',e),null}}getNestIncome(){if(!this.currentGameData||!this.currentGameData.nest)return{gold:0,food:0};return this.currentGameData.nest.totalIncome||{gold:0,food:0}}processNestIncome(){const e=[],t=[],a=this.getNestIncome();if(a.gold>0){this.addResource('gold',a.gold,'巢穴建筑收入')&&(t.push({type:'gold',amount:a.gold,reason:'巢穴建筑收入'}),e.push(`巢穴建筑产生了 ${a.gold} 金钱`))}if(a.food>0){this.addResource('food',a.food,'巢穴建筑收入')&&(t.push({type:'food',amount:a.food,reason:'巢穴建筑收入'}),e.push(`巢穴建筑产生了 ${a.food} 食物`))}return{messages:e,changes:t}}getCurrentWorldbookName(){return'哥布林巢穴-人物档案'}async saveWorldbookToDatabase(e){try{let t=[];try{t=await window.TavernHelper.getWorldbook('哥布林巢穴-人物档案'),console.log(`从默认世界书获取到 ${t.length} 个条目`)}catch(e){console.log('默认世界书不存在或为空，保存空的世界书数据')}const a=`slot_${e}`;await s.saveWorldbookData(a,t),console.log(`世界书数据已保存到数据库，存档: ${a}`)}catch(e){console.error('保存世界书数据到数据库失败:',e)}}async restoreWorldbookFromDatabase(e){try{const t=`slot_${e}`,a='哥布林巢穴-人物档案',o=await s.loadWorldbookData(t);if(o&&o.length>0)try{await window.TavernHelper.replaceWorldbook(a,o),console.log(`已从数据库恢复 ${o.length} 个世界书条目到默认世界书`)}catch(e){console.log('默认世界书不存在，正在创建...'),await window.TavernHelper.createWorldbook(a,[]),await window.TavernHelper.replaceWorldbook(a,o),console.log(`已从数据库恢复 ${o.length} 个世界书条目到默认世界书`)}else{console.log(`存档 ${t} 没有世界书数据，清空默认世界书`);try{await window.TavernHelper.replaceWorldbook(a,[])}catch(e){console.log('默认世界书不存在，正在创建空的世界书...'),await window.TavernHelper.createWorldbook(a,[])}}}catch(e){console.error('从数据库恢复世界书数据失败:',e)}}async getCurrentBoundWorldbook(){try{const e=await this.getCurrentBoundWorldbookName();if(e){return await this.checkWorldbookExists(e)?await window.TavernHelper.getWorldbook(e):(console.log(`当前世界书 ${e} 不存在，返回空内容`),[])}return[]}catch(e){return console.error('获取当前世界书内容失败:',e),[]}}async ensureDefaultWorldbook(){try{const e='哥布林巢穴-人物档案';await this.checkWorldbookExists(e)||(console.log('创建默认世界书...'),await window.TavernHelper.createWorldbook(e,[]),console.log('默认世界书创建成功'))}catch(e){console.error('创建默认世界书失败:',e)}}async getCurrentBoundWorldbookName(){return'哥布林巢穴-人物档案'}async switchWorldbookToCurrentSave(){try{const e=this.getCurrentWorldbookName();_.WorldbookService.setWorldbookName(e);await this.checkWorldbookExists(e)||(console.log(`世界书 ${e} 不存在，正在创建...`),await window.TavernHelper.createWorldbook(e,[]),console.log(`已创建世界书: ${e}`)),await window.TavernHelper.rebindChatWorldbook('current',e),console.log(`世界书已切换到: ${e}`)}catch(e){console.error('切换世界书关联失败:',e)}}async checkWorldbookExists(e){try{const t=await window.TavernHelper.getWorldbook(e);return null!=t}catch(e){return console.error('检查世界书存在性失败:',e),!1}}async deleteWorldbookDataFromDatabase(e){try{const t=`slot_${e}`;await s.deleteWorldbookData(t),console.log(`已删除存档 ${t} 的世界书数据`)}catch(e){console.error('删除存档世界书数据失败:',e)}}handleError(e){this.events.onError&&this.events.onError(e)}}const r=new l},719:(e,t,a)=>{a.d(t,{HeroDeterminationService:()=>s});var _=a(885);class o{static calculateRating(e,t,a,o='平民'){let n=0;const s=this.getRaceScore(e);n+=s,console.log(`🏷️ [评级计算] 种族评分: ${e} = ${s}分`);const l=this.getAgeScore(t);n+=l,console.log(`🎂 [评级计算] 年龄评分: ${t}岁 = ${l}分`);const r=this.getAppearanceScore(a);n+=r,console.log(`👤 [评级计算] 外貌评分: ${r}分 (身高:${a.height}cm, 体重:${a.weight}kg, 罩杯:${a.cupSize})`);const i=this.getBackgroundScore(o);n+=i,console.log(`👑 [评级计算] 出身评分: ${o} = ${i}分`);const c=this.getRandomDiceScore();n+=c,console.log(`🎲 [评级计算] 随机评分: ${c}分`),console.log(`📊 [评级计算] 总分: ${n}分 (种族:${s} + 年龄:${l} + 外貌:${r} + 出身:${i} + 随机:${c})`);const d=this.scoreToRating(n);return console.log(`⭐ [评级计算] 最终评级: ${d}级`),d}static calculateAttributes(e,t,a,o){let n=10,s=10,l=10,r=10,i=40;const c=this.getRaceAttributeBonus(e);n+=c.attack,s+=c.defense,l+=c.intelligence,r+=c.speed,i+=c.health;const d=this.getAgeAttributeBonus(t);n+=d.attack,s+=d.defense,l+=d.intelligence,r+=d.speed,i+=d.health;const u=this.getRatingAttributeBonus(a);if(n=Math.floor(n*(1+u.attack)),s=Math.floor(s*(1+u.defense)),l=Math.floor(l*(1+u.intelligence)),r=Math.floor(r*(1+u.speed)),i=Math.floor(i*(1+u.health)),o){const e=this.getLocationAttributeBonus(o);n+=e.attack,s+=e.defense,l+=e.intelligence,r+=e.speed,i+=e.health}return{attack:Math.max(1,n),defense:Math.max(1,s),intelligence:Math.max(1,l),speed:Math.max(1,r),health:Math.max(10,i)}}static calculateStamina(e,t,a,o){let n=50;n+=this.getRaceStaminaBonus(e);n+=this.getAgeStaminaBonus(t);if(n+=this.getRatingStaminaBonus(a),o){const e=o.weight/Math.pow(o.height/100,2);n+=this.getBmiStaminaBonus(e)}return Math.max(50,Math.min(200,n))}static calculateFertility(e,t,a,o){let n=30;n+=this.getRaceFertilityBonus(e);n+=this.getAgeFertilityBonus(t);if(n+=this.getRatingFertilityBonus(a),o&&o.cupSize){n+=this.getCupSizeFertilityBonus(o.cupSize)}return Math.max(50,Math.min(200,n))}static getRaceScore(e){return{人类:10,狐族:18,哥布林:5,亡灵:8,永恒精灵:20,黑暗精灵:18,天使:22,魔族:20}[e]||10}static getAgeScore(e){return e<16?5:e<20?15:e<25?20:e<30?18:e<35?15:e<40?12:e<50?8:5}static getAppearanceScore(e){let t=0;return t+=this.getHeightScore(e.height),t+=this.getWeightScore(e.weight,e.height),t+=this.getCupSizeScore(e.cupSize),Math.min(25,t)}static getHeightScore(e){return e<150?3:e<160?5:e<165?7:e<170?8:e<175?7:e<180?5:3}static getWeightScore(e,t){const a=e/Math.pow(t/100,2);return a<16?2:a<18.5?4:a<20?6:a<22?7:a<24?6:a<26?4:a<28?2:1}static getCupSizeScore(e){if(!e)return 5;return{A:6,B:7,C:8,D:9,E:8,F:7,G:6}[e.toUpperCase()]||5}static getBackgroundScore(e){return{王族:15,贵族:10,平民:5}[e]}static getRandomDiceScore(){const e=Math.floor(6*Math.random())+1+(Math.floor(6*Math.random())+1)+(Math.floor(6*Math.random())+1);return Math.max(0,Math.min(15,e-3))}static scoreToRating(e){return e>=90?'S':e>=75?'A':e>=60?'B':e>=45?'C':'D'}static getRaceAttributeBonus(e){return{人类:{attack:0,defense:0,intelligence:0,speed:0,health:0},狐族:{attack:2,defense:1,intelligence:2,speed:3,health:8},哥布林:{attack:1,defense:0,intelligence:0,speed:1,health:2},亡灵:{attack:2,defense:1,intelligence:1,speed:1,health:3},永恒精灵:{attack:1,defense:0,intelligence:3,speed:2,health:5},黑暗精灵:{attack:2,defense:1,intelligence:2,speed:2,health:4},天使:{attack:2,defense:2,intelligence:3,speed:2,health:10},魔族:{attack:3,defense:2,intelligence:2,speed:2,health:8}}[e]||{attack:0,defense:0,intelligence:0,speed:0,health:0}}static getAgeAttributeBonus(e){return e<18?{attack:-1,defense:-1,intelligence:0,speed:1,health:-3}:e<25?{attack:1,defense:0,intelligence:0,speed:1,health:3}:e<30?{attack:2,defense:1,intelligence:1,speed:0,health:2}:e<40?{attack:0,defense:1,intelligence:2,speed:0,health:1}:e<50?{attack:0,defense:0,intelligence:1,speed:-1,health:0}:{attack:-1,defense:0,intelligence:0,speed:-1,health:-2}}static getRatingAttributeBonus(e){return{S:{attack:.5,defense:.5,intelligence:.5,speed:.5,health:.4},A:{attack:.35,defense:.35,intelligence:.35,speed:.35,health:.25},B:{attack:.2,defense:.2,intelligence:.2,speed:.2,health:.15},C:{attack:.1,defense:.1,intelligence:.1,speed:.1,health:.08},D:{attack:0,defense:0,intelligence:0,speed:0,health:0}}[e]||{attack:0,defense:0,intelligence:0,speed:0,health:0}}static getLocationAttributeBonus(e){return{village:{attack:0,defense:-1,intelligence:2,speed:2,health:0},town:{attack:1,defense:1,intelligence:1,speed:1,health:2},fortress:{attack:2,defense:2,intelligence:0,speed:-1,health:3},ruins:{attack:0,defense:0,intelligence:2,speed:2,health:-2},dungeon:{attack:2,defense:0,intelligence:-1,speed:0,health:3}}[e]||{attack:0,defense:0,intelligence:0,speed:0,health:0}}static getRaceStaminaBonus(e){return{人类:0,狐族:20,哥布林:5,亡灵:3,永恒精灵:10,黑暗精灵:8,天使:15,魔族:18}[e]||0}static getAgeStaminaBonus(e){return e<18?-10:e<25?10:e<30?5:e<40?0:e<50?-5:-15}static getRatingStaminaBonus(e){return{S:20,A:15,B:10,C:5,D:0}[e]||0}static getBmiStaminaBonus(e){return e<18.5?-5:e<24?5:e<28?0:-10}static getRaceFertilityBonus(e){return{人类:0,狐族:25,哥布林:10,亡灵:0,永恒精灵:15,黑暗精灵:12,天使:20,魔族:22}[e]||0}static getAgeFertilityBonus(e){return e<18?-20:e<25?15:e<30?20:e<35?10:e<40?0:e<45?-10:-25}static getRatingFertilityBonus(e){return{S:25,A:20,B:15,C:10,D:5}[e]||0}static getCupSizeFertilityBonus(e){return{A:5,B:10,C:15,D:20,E:25,F:30,G:35}[e.toUpperCase()]||0}static determineUnitType(e,t){const a=e.toLowerCase();return a.includes('法师')||a.includes('魔法')||a.includes('术士')||a.includes('萨满')||a.includes('牧师')||a.includes('mage')||a.includes('wizard')||a.includes('sorcerer')?'magical':a.includes('刺客')||a.includes('盗贼')||a.includes('游侠')||a.includes('弓手')||a.includes('assassin')||a.includes('rogue')||a.includes('archer')||a.includes('ranger')?'agile':a.includes('守卫')||a.includes('盾')||a.includes('坦克')||a.includes('guard')||a.includes('defender')||a.includes('tank')?'defensive':a.includes('圣骑士')||a.includes('战法师')||a.includes('魔剑士')||a.includes('paladin')||a.includes('spellsword')?'hybrid':'永恒精灵'===t||'黑暗精灵'===t?'magical':'狐族'===t?'agile':'physical'}static calculateHeroLevel(e,t){let a=3;switch(e){case'village':a=2;break;case'town':default:a=3;break;case'city':a=5;break;case'fortress':case'ruins':a=4;break;case'dungeon':a=6}switch(t){case'S':a+=3;break;case'A':a+=2;break;case'B':a+=1;break;case'C':default:a+=0;break;case'D':a-=1}return Math.max(1,Math.min(10,a))}static async buildCharacter(e,t,o){try{if(console.log('🔧 [属性计算] 开始构建人物对象...'),console.log('📊 [属性计算] 输入数据:',{姓名:e.name,种族:e.race,年龄:e.age,出身:e.background,据点类型:o||'未指定'}),!e||!e.name)return console.warn('❌ [属性计算] 人物数据验证失败: 缺少必要字段'),null;const n=this.generateCharacterId(e.name);console.log('🆔 [属性计算] 生成唯一ID:',n),console.log('⭐ [属性计算] 开始计算人物评级...');const s=this.calculateRating(e.race,e.age,e.appearance,e.background);console.log('🎯 [属性计算] 评级计算完成:',s),console.log('⚔️ [属性计算] 开始计算战斗属性...');const l=this.calculateAttributes(e.race,e.age,s,o);console.log('🛡️ [属性计算] 战斗属性计算完成:',l),console.log('💪 [属性计算] 开始计算体力和生育力...');const r=this.calculateStamina(e.race,e.age,s,e.appearance),i=this.calculateFertility(e.race,e.age,s,e.appearance);console.log('📊 [属性计算] 体力和生育力计算完成:',{体力:r,生育力:i}),console.log('🎯 [属性计算] 开始提取敏感点信息...');const c=e.sensitivePointsDetail?.filter(e=>e.isSensitive)?.map(e=>e.part)||[];console.log('💫 [属性计算] 敏感点提取完成:',{敏感点数量:c.length,敏感点列表:c}),console.log('🏗️ [属性计算] 开始构建Character对象...');const d=this.calculateHeroLevel(o,s);console.log('⭐ [属性计算] 英雄等级计算完成:',d);const u={id:n,name:e.name,title:e.identity,rating:s,avatar:'',favorite:!1,status:e.canCombat?'enemy':'uncaptured',locationId:t,capturedAt:void 0,canCombat:e.canCombat,loyalty:0,stamina:r,fertility:i,offspring:0,maxStamina:r,maxFertility:i,level:d,attributes:l,deployedAttributes:void 0,troopDeployment:void 0,lastTraining:void 0,breedingRecords:[],race:e.race,age:e.age,country:e.country,background:e.background,unitType:this.determineUnitType(e.identity,e.race),canLeadRaces:[e.race],sexExperience:e.hiddenTraits?.sexExperience||'未知',sensitivePoints:c,sensitivePointsDetail:e.sensitivePointsDetail||[],lifeStory:e.lifeStory||{childhood:[],adolescence:[],adulthood:[],currentState:[]},personality:e.personality||[],fears:e.hiddenTraits?.fears||'未知',secrets:e.hiddenTraits?.secrets||'未知',appearance:e.appearance};if(console.log('🎉 [属性计算] 人物构建成功!'),console.log('📋 [属性计算] 最终人物信息:',{姓名:u.name,身份:u.title,评级:u.rating,种族:u.race,年龄:u.age,国家:u.country,出身:u.background,攻击力:u.attributes.attack,防御力:u.attributes.defense,智力:u.attributes.intelligence,速度:u.attributes.speed,血量:u.attributes.health,体力:u.stamina,生育力:u.fertility,敏感点:u.sensitivePoints}),'uncaptured'===u.status||'enemy'===u.status){console.log('📚 [属性计算] 开始将人物加入世界书...');try{const{WorldbookService:e}=await Promise.resolve().then(a.bind(a,844));await e.createCharacterWorldbook(u),console.log('✅ [属性计算] 人物已成功加入世界书')}catch(e){console.error('❌ [属性计算] 将人物加入世界书失败:',e)}}else console.log('ℹ️ [属性计算] 人物状态为',u.status,'，跳过世界书加入');return console.log('✅ [属性计算] 返回完整Character对象'),u}catch(e){return console.error('构建人物对象失败:',e),null}}static generateCharacterId(e){return`char_${e}_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}}class n{static parseCharacterJson(e){try{console.log('🔍 [人物解析] 开始解析AI输出的人物信息...'),console.log('📝 [人物解析] 原始AI输出长度:',e.length);const t=e.trim();console.log('🧹 [人物解析] 清理后文本长度:',t.length);const a=t.match(/\{[\s\S]*\}/);if(!a)return console.error('❌ [人物解析] 未找到有效的JSON格式'),null;const o=a[0];console.log('📄 [人物解析] 提取的JSON长度:',o.length);const n=JSON.parse(o);if(console.log('✅ [人物解析] JSON解析成功'),console.log('🔍 [人物解析] 完整JSON结构检查:',{所有键:Object.keys(n),衣着字段:n.衣着,衣着字段类型:typeof n.衣着,衣着字段存在:'衣着'in n}),console.log('📊 [人物解析] 解析后的数据结构:',{基础信息:n.基础信息?'存在':'缺失',外貌数据:n.外貌数据?'存在':'缺失',成长经历:n.成长经历?'存在':'缺失',隐藏特质:n.隐藏特质?'存在':'缺失',敏感点:n.敏感点?'存在':'缺失',衣着:n.衣着?'存在':'缺失'}),!n.基础信息||!n.基础信息.姓名)throw console.error('❌ [人物解析] JSON格式缺少必要字段'),new Error('JSON格式缺少必要字段');console.log('✅ [人物解析] 基础信息验证通过'),console.log('👤 [人物解析] 人物姓名:',n.基础信息.姓名),console.log('🔍 [人物解析] 开始解析敏感点信息...');const s=[],l=['嘴巴','胸部','阴道','子宫','后庭'];if(n.敏感点){console.log('✅ [人物解析] 敏感点数据存在，开始解析...');for(const e of l)if(n.敏感点[e]){const t=!0===n.敏感点[e].敏感;console.log(`🎯 [人物解析] ${e}部位: ${t?'敏感':'不敏感'}`),s.push({part:e,isSensitive:t,description:n.敏感点[e].描述||`${e}部位`})}else s.push({part:e,isSensitive:!1,description:`${e}部位`})}else{console.log('⚠️ [人物解析] 敏感点数据缺失，使用默认值');for(const e of l)s.push({part:e,isSensitive:!1,description:`${e}部位`})}const r=s.filter(e=>e.isSensitive).length;console.log(`📊 [人物解析] 敏感点解析完成，敏感部位数量: ${r}`),console.log('📚 [人物解析] 开始解析成长经历...');const i={childhood:n.成长经历?.童年?[n.成长经历.童年]:[],adolescence:n.成长经历?.青年?[n.成长经历.青年]:[],adulthood:n.成长经历?.成年?[n.成长经历.成年]:[],currentState:n.成长经历?.当前?[n.成长经历.当前]:[]};console.log('📊 [人物解析] 成长经历解析完成:',{童年:i.childhood.length>0?'存在':'缺失',青年:i.adolescence.length>0?'存在':'缺失',成年:i.adulthood.length>0?'存在':'缺失',当前:i.currentState.length>0?'存在':'缺失'}),console.log('👗 [人物解析] 开始解析衣着信息...'),console.log('🔍 [人物解析] 检查衣着数据:',{顶级衣着存在:!!n.衣着,外貌数据衣着存在:!(!n.外貌数据||!n.外貌数据.衣着),外貌数据衣着类型:n.外貌数据?typeof n.外貌数据.衣着:'undefined',外貌数据衣着内容:n.外貌数据?n.外貌数据.衣着:'undefined'});const c={},d=n.衣着||n.外貌数据&&n.外貌数据.衣着;if(d){console.log('✅ [人物解析] 衣着数据存在，开始解析...'),d.头部&&(c.head=d.头部,console.log('👑 [人物解析] 头部装饰:',c.head)),d.上装&&(c.top=d.上装,console.log('👕 [人物解析] 上装:',c.top)),d.下装&&(c.bottom=d.下装,console.log('👖 [人物解析] 下装:',c.bottom)),d.袜子&&(c.socks=d.袜子,console.log('🧦 [人物解析] 袜子:',c.socks)),d.鞋子&&(c.shoes=d.鞋子,console.log('👠 [人物解析] 鞋子:',c.shoes)),d.内衣&&(c.underwear=d.内衣,console.log('🩱 [人物解析] 内衣:',c.underwear)),d.装饰品&&(c.accessories=d.装饰品,console.log('💎 [人物解析] 装饰品:',c.accessories)),d.玩具&&(c.toys=d.玩具,console.log('🎀 [人物解析] 玩具:',c.toys));const e=Object.keys(c).length;console.log(`📊 [人物解析] 衣着解析完成，衣着部位数量: ${e}`)}else console.log('⚠️ [人物解析] 衣着数据缺失，使用默认值');console.log('🏗️ [人物解析] 开始构建解析后的数据对象...'),console.log('🔍 [人物解析] 开始严格验证基础信息...');const u={name:this.validateRequiredString(n.基础信息.姓名,'姓名'),race:this.validateRequiredString(n.基础信息.种族,'种族'),age:this.validateRequiredNumber(n.基础信息.年龄,'年龄'),country:this.validateRequiredString(n.基础信息.国家,'国家'),identity:this.validateRequiredString(n.基础信息.身份,'身份'),background:this.validateBackground(n.基础信息.出身),personality:this.validatePersonality(n.基础信息.性格),canCombat:this.validateCanCombat(n.基础信息.可战斗),appearance:{height:this.validateRequiredNumber(n.外貌数据?.身高,'身高'),weight:this.validateRequiredNumber(n.外貌数据?.体重,'体重'),measurements:this.validateRequiredString(n.外貌数据?.三围,'三围'),cupSize:this.validateCupSize(n.外貌数据?.罩杯),description:this.validateRequiredString(n.外貌数据?.描述,'外貌描述'),clothing:Object.keys(c).length>0?c:void 0},sensitivePointsDetail:s,lifeStory:i,hiddenTraits:{sexExperience:this.validateRequiredString(n.隐藏特质?.性经历,'性经历'),fears:this.validateRequiredString(n.隐藏特质?.恐惧,'恐惧'),secrets:this.validateRequiredString(n.隐藏特质?.秘密,'秘密')}};return console.log('✅ [人物解析] 所有字段验证通过'),console.log('🎉 [人物解析] 人物数据解析成功:',{姓名:u.name,种族:u.race,年龄:u.age,国家:u.country,身份:u.identity,出身:u.background,性格数量:u.personality.length,身高:u.appearance.height,体重:u.appearance.weight,罩杯:u.appearance.cupSize,衣着数量:u.appearance.clothing?Object.keys(u.appearance.clothing).length:0}),console.log('📤 [人物解析] 返回解析后的数据对象'),u}catch(e){return console.error('解析人物信息失败:',e),null}}static validateParsedData(e){const t=[];if(e.name&&''!==e.name.trim()||t.push('姓名为空'),e.race&&''!==e.race.trim()||t.push('种族为空'),(e.age<1||e.age>100)&&t.push('年龄不在有效范围内'),e.sensitivePointsDetail){e.sensitivePointsDetail.filter(e=>e.isSensitive).length>1&&t.push('敏感点数量超过限制（只能有1个）')}return e.appearance&&((e.appearance.height<100||e.appearance.height>250)&&t.push('身高不在有效范围内'),(e.appearance.weight<30||e.appearance.weight>150)&&t.push('体重不在有效范围内')),{valid:0===t.length,errors:t}}static validateBackground(e){if(!e||'string'!=typeof e)throw new Error('出身等级字段缺失，AI必须明确指定：平民/贵族/王族');if(!['平民','贵族','王族'].includes(e))throw new Error(`出身等级无效：${e}，必须是：平民/贵族/王族`);return e}static validateRequiredString(e,t){if(!e||'string'!=typeof e||''===e.trim())throw new Error(`${t}字段缺失或为空，AI必须提供有效的${t}`);return e.trim()}static validateRequiredNumber(e,t){if(null==e||'number'!=typeof e||isNaN(e))throw new Error(`${t}字段缺失或无效，AI必须提供有效的数字`);return e}static validatePersonality(e){if(!Array.isArray(e))throw new Error('性格字段必须是数组格式');return e.filter(e=>'string'==typeof e&&''!==e.trim())}static validateCupSize(e){if(!e||'string'!=typeof e)throw new Error('罩杯字段缺失或无效，AI必须提供有效的罩杯大小');const t=e.toUpperCase();if(!['A','B','C','D','E','F','G'].includes(t))throw new Error(`罩杯大小无效：${e}，必须是：A/B/C/D/E/F/G`);return t}static validateCanCombat(e){if(null==e)throw new Error('可战斗字段缺失，AI必须明确指定：true/false');if('boolean'!=typeof e)throw new Error(`可战斗字段无效：${e}，必须是：true/false`);return e}}class s{static PERSONALITY_CATEGORIES={基础性格类:['淫荡放纵','纯洁无暇','高傲冷漠','温柔善良','坚强勇敢','懦弱胆小'],道德倾向类:['已经堕落','正在堕落','完全纯洁','半推半就','内心挣扎','自甘堕落'],行为方式类:['主动出击','被动等待','喜欢控制','甘愿被控','反抗精神','顺从听话'],情感需求类:['好色贪欢','渴望关爱','害怕亲密','依赖他人','独立自主','孤独寂寞'],心理状态类:['心理创伤','童年阴影','复仇心切','愧疚自责','自卑敏感','骄傲自大']};static rollPersonalityFromCategory(e){const t=this.PERSONALITY_CATEGORIES[e];return t[Math.floor(Math.random()*t.length)]}static rollPersonalityStylesCombination(){const e=[...Object.keys(this.PERSONALITY_CATEGORIES)].sort(()=>.5-Math.random()).slice(0,3),t=e.map(e=>this.rollPersonalityFromCategory(e));return console.log('🎲 [性格筛子] 选中的类别:',e),console.log('🎯 [性格筛子] 抽取的特质:',t),t.join('、')}static getPersonalityStylesStats(){const e={};let t=0;return Object.entries(this.PERSONALITY_CATEGORIES).forEach(([a,o])=>{e[a]=o.length,t+=o.length}),{totalCategories:Object.keys(this.PERSONALITY_CATEGORIES).length,totalTraits:t,categories:e}}static shouldHaveHero(e,t){return Math.random()<this.getBaseProbability(e,t)}static getBaseProbability(e,t){const a=.4+.1*(t-1),o={village:.3,town:.5,fortress:.7,ruins:.2,dungeon:.4,city:.8}[e]||.3;return Math.min(.9,o*a)}static generateHeroPrompt(e,t,a,o,n){let s='';if(o&&n){const e=_.continentExploreService.continents.value.find(e=>e.name===o);if(e){const t=e.regions.find(e=>e.name===n);t&&(s=t.description)}}const l=this.rollPersonalityStylesCombination();return console.log('🎲 [人物生成] 随机性格筛子结果:',l),`<herorules>\n请为这个据点生成一个英雄人物，严格按照以下JSON格式输出，不要添加任何其他内容：\n\n据点信息（以下信息请严格参考，增加代入感）：\n- 类型：${e}\n- 难度：${t}/10\n- 描述：${a}\n- 大陆：${o}\n- 区域：${n}:${s}\n\n人物要求：\n1. 与据点类型和难度相匹配的实力\n2. 英雄的背景和身份应该与据点描述相符\n3. 严格按照以下JSON格式输出，不要添加任何其他内容\n4. **人物整体风格为：${l}** - 请在人物的性格、外貌描述、成长经历、隐藏特质等各个方面都体现这种风格特征\n5. 人物的性格特征、行为表现、内心想法都应该与"${l}"这一风格保持一致\n</herorules>\n\n{\n  "基础信息": {\n    "姓名": "人物姓名，参考命名规则",\n    "种族": "人类/狐族/永恒精灵/黑暗精灵/天使/魔族",\n    "年龄": 数字,\n    "国家": "国家名称",\n    "身份": "具体职业身份，如"白玫瑰骑士团团长/翡翠王国公主等"，10个字以内",\n    "出身": "出身等级，只能选择：平民/贵族/王族",\n    "性格": ["性格1", "性格2", "性格3"，必须为五个**四字词语**，需要体现"${l}"的特征],\n    "可战斗": true/false {可战斗属性：根据身份判断，例如：战士、骑士、法师等战斗职业为true，商人、工匠、学者等非战斗职业为false}\n  },\n  "外貌数据": {\n    "身高": 数字,\n    "体重": 数字,\n    "三围": "胸围-腰围-臀围，不需要带字母",\n    "罩杯": "A/B/C/D/E/F/G",\n    "描述": "使用最少200字优美细致的语言，从头到脚由宏观到细节描述人物整体，包含体型、肌肤/头发颜色、长度/眼睛/面容细节/四肢，如同是在拍摄写真一般，要有画面感。外貌描述需要体现"${l}"的气质特征"\n    "衣着": {\n      "头部": "头部装饰/帽子/头盔，所有衣着描述请使用**形容词+名词结构，例如深蓝色碎花裙**格式，且如果此部位未穿着可以不输出此行",\n      "上装": "上装",\n      "下装": "下装",\n      "袜子": "袜子",\n      "鞋子": "鞋子",\n      "内衣": "内衣",\n      "装饰品": "装饰品",\n      "玩具": "性玩具/跳蛋/手铐/锁链",\n    }\n  },\n  "成长经历": {\n    "童年": "童年经历描述，最少100字，需要体现"${l}"性格的形成原因",\n    "青年": "青年经历描述，最少100字，展现"${l}"特征的发展", \n    "成年": "成年经历描述，最少100字，体现"${l}"的成熟表现",\n    "当前": "当前状态描述，最少100字，完全展现"${l}"的特征"\n  },\n  "隐藏特质": {\n    "性经历": "性经验描述，最少20字，需要符合"${l}"的特征",\n    "恐惧": "恐惧内容，最少20字，与"${l}"相关的内心恐惧",\n    "秘密": "秘密内容，最少20字，体现"${l}"的隐藏面"\n  },\n  "敏感点": {\n    "嘴巴": {\n      "敏感": true/false,\n      "描述": "最少30字细节描述此器官，**注意只能有一个部位为true，其他都为false**"\n    },\n    "胸部": {\n      "敏感": true/false,\n      "描述": "最少30字细节描述此器官"\n    },\n    "阴道": {\n      "敏感": true/false,\n      "描述": "最少30字细节描述此器官"\n    },\n    "子宫": {\n      "敏感": true/false,\n      "描述": "最少30字细节描述此器官"\n    },\n    "后庭": {\n      "敏感": true/false,\n      "描述": "最少30字细节描述此器官"\n    }\n  }\n}\n\n注意：\n1. 必须严格按照JSON格式输出\n2. 敏感点中只能有一个部位为true，其他都为false\n3. 所有字符串值用双引号包围\n4. 不要添加任何注释或额外内容\n5. ***禁止输出任何剧情，也不要开始剧情，正文只需要json人物信息***\n`}static async parseHeroCharacter(e,t,a){console.log('🚀 [人物生成] 开始处理英雄人物信息...'),console.log('📍 [人物生成] 据点信息:',{据点ID:t,据点类型:a}),console.log('📝 [人物生成] AI输出长度:',e.length),console.log('🔍 [人物生成] 步骤1: 开始解析JSON数据...');const s=n.parseCharacterJson(e);if(!s)return console.error('❌ [人物生成] JSON解析失败，无法继续处理'),null;console.log('✅ [人物生成] JSON解析成功，获得解析数据'),console.log('🔧 [人物生成] 步骤2: 开始计算属性并构建人物对象...');const l=await o.buildCharacter(s,t,a);return l?(console.log('🎉 [人物生成] 英雄人物生成成功!'),console.log('👤 [人物生成] 最终人物:',l.name)):console.error('❌ [人物生成] 人物构建失败'),l}static getHeroTypeByLocation(e){const t=this.getHeroTypesByLocation(e);return t[Math.floor(Math.random()*t.length)]}static getHeroTypesByLocation(e){return{village:['村姑','村医','教师','民兵'],town:['女商人','女贵族','女骑士','女法师'],fortress:['女将军','女指挥官','女战士','女圣骑士'],ruins:['女冒险者','女盗贼','女法师','女学者'],dungeon:['女祭司','女法师','女战士','女盗贼'],city:['女贵族','女骑士','女法师','女圣骑士','公主','女仆','王后']}[e]||['女战士']}}},844:(e,t,a)=>{a.d(t,{WorldbookService:()=>m});var _=a(120);class o{static async exists(e){try{const t=await window.TavernHelper.getWorldbook(e);return null!=t}catch(e){return console.error('检查世界书存在性失败:',e),!1}}static async ensureExists(e){await this.exists(e)||(console.log(`世界书 ${e} 不存在，正在创建...`),await window.TavernHelper.createWorldbook(e,[]),console.log(`已创建世界书: ${e}`))}static async get(e){return await window.TavernHelper.getWorldbook(e)}static async replace(e,t){await window.TavernHelper.replaceWorldbook(e,t)}static async bindToCurrent(e){await window.TavernHelper.rebindChatWorldbook('current',e)}static findEntryIndex(e,t){return e.findIndex(t)}static findEntry(e,t){return e.find(t)}static async updateOrCreateEntry(e,t,a,o){await this.ensureExists(e);const n=await this.get(e),s=this.findEntryIndex(n,t);-1!==s?n[s]=a(n[s]):n.push(o()),await this.replace(e,n)}static isPlayerCharacter(e,t,a){return'player'===a||'player-1'===e||'哥布林之王'===t}static generateStoryHistoryUID(e){let t=0;const a=`story_history_${e}`;for(let e=0;e<a.length;e++){t=(t<<5)-t+a.charCodeAt(e),t&=t}return Math.abs(t)%2147483647}}class n{static async createCharacterWorldbook(e,t){try{if(o.isPlayerCharacter(e.id,e.name,e.status))return console.log(`跳过player角色 ${e.name} 的世界书创建`),t;await o.ensureExists(t);const a=await o.get(t),n=this.createCharacterEntry(e);return a.push(n),await o.replace(t,a),await o.bindToCurrent(t),toastr.success(`已将人物 ${e.name} 添加到世界书: ${t}`),t}catch(e){throw toastr.error(`创建人物世界书失败: ${e}`),e}}static async getCharacterEntry(e,t){try{const a=await o.get(e);return o.findEntry(a,e=>e.extra?.character_id===t)||null}catch(e){return console.error('获取人物世界书条目失败:',e),null}}static async updateCharacterEntry(e,t){try{if(o.isPlayerCharacter(t.id,t.name,t.status))return void console.log(`跳过player角色 ${t.name} 的世界书更新`);const a=await o.get(e),n=o.findEntryIndex(a,e=>e.extra?.character_id===t.id);if(-1!==n){const s=this.buildCharacterContent(t);a[n]={...a[n],content:s,extra:{...a[n].extra,updated_at:(new Date).toISOString()}},await o.replace(e,a),toastr.success(`已更新人物 ${t.name} 的世界书条目`)}else toastr.warning(`未找到人物 ${t.name} 的世界书条目`)}catch(e){throw toastr.error(`更新人物世界书条目失败: ${e}`),e}}static async deleteCharacterEntry(e,t){try{const a=(await o.get(e)).filter(e=>e.extra?.character_id!==t);await o.replace(e,a),toastr.success('已删除人物世界书条目')}catch(e){throw toastr.error(`删除人物世界书条目失败: ${e}`),e}}static async clearCharacterAndStoryEntries(e){try{const t=(await o.get(e)).filter(e=>!e.extra?.character_id&&'character_story_history'!==e.extra?.entry_type&&'conquest_records'!==e.extra?.entry_type&&'game_event_story'!==e.extra?.entry_type);await o.replace(e,t),console.log('已清空所有人物档案、剧情记录、据点征服记录和游戏事件记录世界书条目')}catch(e){throw console.error('清空人物档案、剧情记录、据点征服记录和游戏事件记录世界书条目失败:',e),e}}static createCharacterEntry(e){const t=this.buildCharacterContent(e),a=`${e.title||'角色'}-${e.name}`;return{uid:parseInt(e.id.replace(/\D/g,''))||Date.now(),name:a,enabled:!0,strategy:{type:'selective',keys:[e.name,e.title||'角色'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:150},content:t,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{character_id:e.id,created_at:(new Date).toISOString(),character_type:'manual_training'}}}static buildCharacterContent(e,t){const a=t||0,o=this.getUnlockStatus(e.loyalty),n={basicInfo:{name:e.name,title:e.title||'未知',race:e.race||'未知',age:e.age||'未知',country:e.country||'未知',background:e.background||'未知',rating:e.rating||'D'},background:{sexExperience:e.sexExperience+(o.sensitivePoints?'':'（当前信息对于{{user}}未知）'),personality:e.personality||[],sensitivePoints:e.sensitivePoints||[],fears:e.fears+(o.fearsAndSecrets?'':'（当前信息对于{{user}}未知）'),secrets:e.secrets+(o.fearsAndSecrets?'':'（当前信息对于{{user}}未知）')},appearance:e.appearance?{height:e.appearance.height,weight:e.appearance.weight,measurements:e.appearance.measurements,cupSize:e.appearance.cupSize,description:e.appearance.description,clothing:e.appearance.clothing}:null,lifeStory:e.lifeStory?{childhood:(e.lifeStory.childhood||[]).map(e=>e+(o.lifeStory?'':'（当前信息对于{{user}}未知）')),adolescence:(e.lifeStory.adolescence||[]).map(e=>e+(o.lifeStory?'':'（当前信息对于{{user}}未知）')),adulthood:(e.lifeStory.adulthood||[]).map(e=>e+(o.lifeStory?'':'（当前信息对于{{user}}未知）')),currentState:('surrendered'===e.status?[...e.lifeStory.currentState||[],'已完全堕落，对哥布林主人绝对忠诚，完全抛弃了过去的身份和信仰']:e.lifeStory.currentState||[]).map(e=>e+(o.lifeStory?'':'（当前信息对于{{user}}未知）'))}:null,sensitivePointsDetail:(e.sensitivePointsDetail||[]).map(e=>({...e,description:e.description+(o.sensitivePoints?'':'（当前信息对于{{user}}未知）')})),breedingRecords:e.breedingRecords||[],combatAttributes:{level:e.level,baseAttributes:e.attributes,deployedAttributes:e.deployedAttributes,troopDeployment:e.troopDeployment},locationInfo:{locationId:e.locationId,capturedAt:e.capturedAt?_.Q.getTimeInfo(a).formattedDate:void 0,capturedAtRaw:e.capturedAt},trainingSettings:this.buildTrainingSettings(e)};return`## 基本信息\n\n\`\`\`json\n${JSON.stringify(n,null,2)}\n\`\`\`\n\n## ${e.name} 当前状态\n- 状态: ${e.status}\n- 堕落值: ${e.loyalty}%\n- 体力: ${e.stamina}/${e.maxStamina||200}\n- 生育值: ${e.fertility}/${e.maxFertility||200}\n- 子嗣数量: ${e.offspring}`}static getUnlockStatus(e){return{lifeStory:e>=10,personality:e>=20,sensitivePoints:e>=30,fearsAndSecrets:e>=40}}static buildTrainingSettings(e){const t=this.getUnlockStatus(e.loyalty);return'surrendered'===e.status?{description:this.buildCorruptionDescription(e),guidelines:this.buildCorruptionGuidelines(e),unlockStatus:t}:'uncaptured'===e.status||'enemy'===e.status?{description:this.buildUncapturedDescription(e),guidelines:this.buildUncapturedGuidelines(),unlockStatus:t}:{description:this.buildNormalDescription(e),guidelines:this.buildNormalGuidelines(e,t),unlockStatus:t}}static buildCorruptionDescription(e){const t=this.getLoyaltyLevel(e.loyalty);return`已完全堕落，对哥布林主人绝对忠诚${this.getRaceSpecificCorruption(e.race)}。忠诚度：${e.loyalty}%${t}`}static buildUncapturedDescription(e){return`当前为${'enemy'===e.status?'敌方单位':'未捕获目标'}，尚未被哥布林巢穴捕获。这是一个潜在的征服目标。`}static buildNormalDescription(e){const t=this.getLoyaltyLevel(e.loyalty),a=this.getResistanceLevel(e.loyalty);return`当前已被哥布林巢穴捕获，忠诚度：${e.loyalty}%${t}${a}`}static buildCorruptionGuidelines(e){return['角色已经完全堕落，对主人绝对忠诚和服从','表现出对主人的崇拜和依赖','主动寻求主人的关注和认可','语言风格更加顺从和谄媚','会主动配合主人的所有要求','表现出对过去身份的完全抛弃',...this.getRaceSpecificGuidelines(e.race,'corrupted'),...this.getLoyaltySpecificGuidelines(e.loyalty,'corrupted')]}static buildUncapturedGuidelines(){return['角色尚未被哥布林巢穴捕获，保持其原始身份和立场','根据角色的种族、身份和性格特征来塑造其行为','角色对哥布林巢穴可能持有敌意或警惕态度']}static buildNormalGuidelines(e,t){const a=this.getLoyaltySpecificGuidelines(e.loyalty,'normal'),o=this.getRaceSpecificGuidelines(e.race,'normal'),n=['保持角色的背景设定，根据人生经历调整回应'];return t.lifeStory||n.push('注意：人生经历信息已显示但标记为未知，调教时请考虑信息未知'),['根据当前忠诚度和体力状态调整回应','在调教过程中会逐渐改变对巢穴以及哥布林之王的态度',...a,...o,...n]}static getLoyaltyLevel(e){return e>=100?'（完全堕落）':e>=80?'（高度忠诚）':e>=60?'（中度忠诚）':e>=40?'（轻度忠诚）':e>=20?'（开始动摇）':'（强烈抗拒）'}static getResistanceLevel(e){return e<20?'，表现出强烈的抗拒和敌意':e<40?'，仍然保持一定的抵抗心理':e<60?'，开始出现动摇的迹象':e<80?'，逐渐接受现实':'，已经基本认同现状'}static getRaceSpecificCorruption(e){return{高等精灵:'，完全抛弃了精灵的骄傲和自然信仰',黑暗精灵:'，彻底臣服于哥布林的统治',狐族:'，背叛了九尾神的信仰，完全效忠于主人',人类:'，抛弃了人类的尊严和道德观念',亡灵:'，彻底服从于哥布林的意志',恶魔:'，承认哥布林主人的绝对权威'}[e]||'，完全臣服于哥布林主人'}static getRaceSpecificGuidelines(e,t){if('corrupted'===t){return{高等精灵:['完全抛弃精灵的骄傲，表现出对主人的绝对崇拜','主动提及对哥布林主人的忠诚，贬低过去的精灵身份'],黑暗精灵:['表现出对哥布林主人的绝对服从，承认其统治地位','主动配合主人的所有要求，包括最屈辱的命令'],狐族:['背叛九尾神信仰，将哥布林主人视为新的神明','主动讨好主人，寻求主人的喜爱和认可'],人类:['抛弃人类的道德观念，完全接受哥布林的价值观','主动配合主人的统治，协助管理其他奴隶']}[e]||[]}return{高等精灵:['保持精灵的骄傲和自然信仰，但逐渐被现实动摇','在调教过程中会逐渐放弃精灵的尊严'],黑暗精灵:['保持黑暗精灵的冷酷，但逐渐被哥布林的力量征服','在调教过程中会逐渐认同哥布林的统治'],狐族:['保持对九尾神的信仰，但逐渐被哥布林的力量影响','在调教过程中会逐渐背叛自己的信仰'],人类:['保持人类的道德观念，但逐渐被哥布林的环境同化','在调教过程中会逐渐接受哥布林的价值观']}[e]||[]}static getLoyaltySpecificGuidelines(e,t){return'corrupted'===t?['在对话中会主动提及对主人的忠诚','对主人的任何要求都会欣然接受','会主动讨好主人，寻求主人的喜爱','已经完全认同自己作为哥布林奴隶的身份']:e<20?['表现出强烈的抗拒和敌意','会试图反抗或逃跑','对哥布林表现出明显的厌恶']:e<40?['仍然保持一定的抵抗心理','会质疑哥布林的权威','表现出对现状的不满']:e<60?['开始出现动摇的迹象','会逐渐接受现实','对哥布林的态度开始软化']:e<80?['逐渐接受现实','开始配合哥布林的要求','对哥布林的态度明显改善']:['已经基本认同现状','开始主动配合哥布林','对哥布林表现出一定的忠诚']}}class s{static sortByTimestamp(e){return[...e].sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))}static formatRecordTime(e){return{date:e.gameTime||'未知时间',sender:'user'===e.sender?'{{user}}':e.sender}}static buildDialogueSection(e){let t='<dialogue_history>\n';if(e.length>0){this.sortByTimestamp(e).forEach(e=>{const{date:a,sender:o}=this.formatRecordTime(e);t+=`[${a}] ${o}: ${e.content}\n`})}else t+='暂无战前对话记录。\n';return t+='</dialogue_history>\n\n',t}static buildBattleSummarySection(e){if(!e||!Array.isArray(e)||0===e.length)return'';const t=e.filter(e=>e&&e.content&&'undefined'!==e.content&&''!==e.content.trim());if(0===t.length)return'';let a='<battlesummary>\n';return this.sortByTimestamp(t).forEach(e=>{const{date:t}=this.formatRecordTime(e);a+=`[${t}] ${e.content}\n`}),a+='</battlesummary>\n\n',a}static buildTrainingSection(e){let t='<training_history>\n';if(e.length>0){this.sortByTimestamp(e).forEach(e=>{const{date:a,sender:o}=this.formatRecordTime(e);t+=`[${a}] ${o}: ${e.content}\n`})}else t+='暂无调教记录。\n';return t+='</training_history>\n',t}static buildEventStoryContent(e){let t='<event_records>\n';if(e.length>0){this.sortByTimestamp(e).forEach(e=>{const{date:a}=this.formatRecordTime(e);t+=`[${a}] ${e.content}\n`})}else t+='暂无事件记录。\n';return t+='</event_records>\n',t}}class l{static async createEventStoryRecord(e,t,a,n,l){try{console.log(`开始处理游戏事件故事记录: ${a}`);const r={gameTime:l,sender:'游戏事件记录',content:n,timestamp:Date.now()};await o.ensureExists(e);const i=await this.getEventStoryEntry(e,t);if(i){console.log(`游戏事件故事记录已存在，追加新内容: ${a}`);const n=s.buildEventStoryContent([r]),l=i.content+'\n\n'+n,c={...i,content:l,extra:{...i.extra,updated_at:(new Date).toISOString()}},d=await o.get(e),u=d.findIndex(e=>e.uid===i.uid);-1!==u?(d[u]=c,await o.replace(e,d),console.log(`游戏事件故事记录追加成功: ${a}`)):console.warn(`未找到要更新的条目: ${t}`)}else{console.log(`创建新的游戏事件故事记录: ${a}`);const n={name:'游戏事件记录',content:s.buildEventStoryContent([r]),uid:Date.now(),enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:120},probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'game_event_story',event_id:t,event_name:a,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}},l=await o.get(e);await o.replace(e,[...l,n]),console.log(`游戏事件故事记录创建成功: ${a}`)}}catch(e){throw console.error('处理游戏事件故事记录失败:',e),e}}static async getEventStoryEntry(e,t){try{const a=await o.get(e);if(!a||0===a.length)return null;return a.find(e=>'game_event_story'===e.extra?.entry_type&&e.extra?.event_id===t)||null}catch(e){return console.error('获取游戏事件故事记录失败:',e),null}}}class r{static async getExistingDialogueHistory(e,t){try{const a=await o.get(t),n=o.findEntry(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);return n?this.parseDialogueHistory(n.content):[]}catch(e){return console.error('获取现有战前对话记录失败:',e),[]}}static async addMultipleDialogueRecords(e,t,a,n,l){try{if(o.isPlayerCharacter(e,t,l))return void console.log(`跳过player角色 ${t} 的战前对话记录`);const r=await o.get(a),i=o.findEntry(r,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);let c;c=i&&i.content?this.appendDialogueRecords(i.content,n):s.buildDialogueSection(n),await this.updateDialogueEntry(e,t,a,c),console.log(`✅ 已增量添加 ${n.length} 条战前对话记录到 ${t}`)}catch(e){throw console.error('批量添加战前对话记录失败:',e),e}}static appendDialogueRecords(e,t){const a=e.match(/<\/dialogue_history>/);if(!a){console.warn('未找到战前对话标签，尝试构建新的对话记录');const a=s.buildDialogueSection(t);return e.trim()?a+e:a}const o=t.map(e=>`[${e.gameTime||'未知时间'}] ${'user'===e.sender?'{{user}}':e.sender}: ${e.content}`).join('\n'),n=a.index,l=e.substring(0,n),r=e.substring(n),i=!l.endsWith('\n');return l+(i?'\n':'')+o+'\n'+r}static async updateDialogueEntry(e,t,a,n){await o.ensureExists(a);const s=await o.get(a),l=o.findEntryIndex(s,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e),r=this.createCharacterStoryHistoryEntry(e,t,n);-1!==l?s[l]=r:s.push(r),await o.replace(a,s)}static createCharacterStoryHistoryEntry(e,t,a){return{uid:o.generateStoryHistoryUID(e),name:`${t}-剧情记录`,enabled:!0,strategy:{type:'selective',keys:[t,'战斗总结','调教记录','战前对话','剧情记录'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:160},content:a,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'character_story_history',character_id:e,character_name:t,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}}}static parseDialogueHistory(e){const t=[],a=e.match(/<dialogue_history>([\s\S]*?)<\/dialogue_history>/);if(!a)return t;const o=a[1].split('\n');let n=null;return o.forEach(e=>{const a=e.match(/^\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\] (.+?): (.+)$/);if(a){n&&t.push(n);const[,e,o,s]=a;n={gameTime:e,sender:'{{user}}'===o?'user':o,content:s.trim(),timestamp:Date.now()}}else n&&e.trim()&&(n.content+='\n'+e.trim())}),n&&t.push(n),t}static async deleteDialogueHistory(e,t){try{const a=await o.get(t),n=o.findEntryIndex(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);-1!==n&&(a.splice(n,1),await o.replace(t,a),console.log(`✅ 已删除角色 ${e} 的战前对话记录`))}catch(e){throw console.error('删除战前对话记录失败:',e),e}}}class i{static async getExistingBattleSummaryHistory(e,t){try{const a=await o.get(t),n=o.findEntry(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);return n?this.parseBattleSummaryHistory(n.content):[]}catch(e){return console.error('获取现有战斗总结记录失败:',e),[]}}static async addMultipleBattleSummaryRecords(e,t,a,n,l){try{if(o.isPlayerCharacter(e,t,l))return void console.log(`跳过player角色 ${t} 的战斗总结记录`);const r=await o.get(a),i=o.findEntry(r,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);let c;c=i&&i.content?this.replaceBattleSummaryRecords(i.content,n):s.buildBattleSummarySection(n),await this.updateBattleSummaryEntry(e,t,a,c),console.log(`✅ 已替换 ${t} 的战斗总结记录`)}catch(e){throw console.error('批量添加战斗总结记录失败:',e),e}}static replaceBattleSummaryRecords(e,t){const a=e.match(/<battlesummary>/),o=e.match(/<\/battlesummary>/);if(!a||!o){console.warn('未找到战斗总结标签，插入新的战斗总结记录');const a=s.buildBattleSummarySection(t),o=e.match(/<\/dialogue_history>\n\n/);if(o){const t=o.index+o[0].length;return e.substring(0,t)+a+e.substring(t)}const n=e.match(/<training_history>/);if(n){const t=n.index;return e.substring(0,t)+a+e.substring(t)}return e+a}const n=t.map(e=>`[${e.gameTime||'未知时间'}] ${e.content}`).join('\n'),l=a.index+a[0].length,r=o.index;return e.substring(0,l)+'\n'+n+'\n'+e.substring(r)}static async updateBattleSummaryEntry(e,t,a,n){await o.ensureExists(a);const s=await o.get(a),l=o.findEntryIndex(s,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e),r=this.createCharacterStoryHistoryEntry(e,t,n);-1!==l?s[l]=r:s.push(r),await o.replace(a,s)}static createCharacterStoryHistoryEntry(e,t,a){return{uid:o.generateStoryHistoryUID(e),name:`${t}-剧情记录`,enabled:!0,strategy:{type:'selective',keys:[t,'战斗总结','调教记录','战前对话','剧情记录'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:160},content:a,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'character_story_history',character_id:e,character_name:t,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}}}static parseBattleSummaryHistory(e){const t=[],a=e.match(/<battlesummary>([\s\S]*?)<\/battlesummary>/);if(!a)return t;return a[1].split('\n').filter(e=>e.trim()).forEach(e=>{const a=e.match(/^\[(.+?)\]\s*(.+)$/);if(a){const[,e,o]=a;t.push({gameTime:e.trim(),content:o.trim(),timestamp:Date.now()})}else e.trim()&&t.push({gameTime:'',content:e.trim(),timestamp:Date.now()})}),t}static async deleteBattleSummaryHistory(e,t){try{const a=await o.get(t),n=o.findEntryIndex(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);-1!==n&&(a.splice(n,1),await o.replace(t,a),console.log(`✅ 已删除角色 ${e} 的战斗总结记录`))}catch(e){throw console.error('删除战斗总结记录失败:',e),e}}}class c{static async addConquestRecord(e,t,a,n,s){try{await o.ensureExists(e);const l=await o.get(e),r=o.findEntryIndex(l,e=>'conquest_records'===e.extra?.entry_type);let i={};-1!==r&&(i=this.parseExistingConquestRecords(l[r].content));const c=this.buildConquestRecordsContent(t,a,n,s,i);if(-1!==r)l[r]={...l[r],content:c,extra:{...l[r].extra,updated_at:(new Date).toISOString()}},console.log('已更新据点征服记录世界书条目');else{const e=this.createConquestRecordsEntry(c);l.push(e),console.log('已创建新的据点征服记录世界书条目')}await o.replace(e,l),console.log('据点征服记录世界书条目更新完成')}catch(e){throw console.error('添加据点征服记录失败:',e),e}}static parseExistingConquestRecords(e){const t={};try{const a=e.split('\n');let o='',n='';for(const e of a){const a=e.match(/^([^:\s]+):\s*$/);if(a){o=a[1],t[o]||(t[o]={});continue}const s=e.match(/^ {2}([^:]+):\s*(.*)$/);if(s&&o){n=s[1],t[o][n]||(t[o][n]=[]);continue}const l=e.match(/^ {2}- (.+)$/);l&&o&&n&&t[o][n].push(`  - ${l[1]}`)}console.log('解析现有据点征服记录:',t)}catch(e){console.error('解析现有据点征服记录失败:',e)}return t}static createConquestRecordsEntry(e){return{uid:Date.now()+1,name:'据点征服记录',enabled:!0,strategy:{type:'constant',keys:['据点征服记录'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:120},content:e,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'conquest_records',created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}}}static buildConquestRecordsContent(e,t,a,o,n={}){const s=a,l=JSON.parse(JSON.stringify(n));if(e){const t=e.continent||'未知大陆',a=e.region||'未知区域',o=e.race||'未知种族',n=this.getLocationTypeDescription(e.type),r=e.name,i='★'.repeat(e.difficulty),c=e.description||'无描述',d=e.rewards?.heroes||[];let u='';if(d.length>0){u=`-英雄:${d.map(e=>`${e.name}(${e.title})`).join('、')}`}l[t]||(l[t]={}),l[t][a]||(l[t][a]=[]);const m=`  - [${s}] ${o}-${n}-${r}-${i}-${c}${u}`;l[t][a].push(m)}let r='<ConquestRecords>\n# 据点征服记录\n';Object.keys(l).sort().forEach(e=>{r+=`${e}:\n`,Object.keys(l[e]).sort().forEach(t=>{r+=`  ${t}: ${o||'未知区域'}\n`,l[e][t].forEach(e=>{r+=e+'\n'})})});return`${r}\n\n- 这些记录记录了哥布林巢穴对外扩张的历史\n- 每次成功的征服都会增加巢穴的威胁度\n</ConquestRecords>`}static getLocationTypeDescription(e){return{village:'村庄',town:'城镇',city:'城市',fortress:'军事要塞',ruins:'古代废墟',dungeon:'地下迷宫'}[e]||'未知类型'}}class d{static async getExistingTrainingHistory(e,t){console.log('🔍 [调教记录管理器] 开始获取调教记录',{characterName:e,worldbookName:t});try{console.log('📚 正在获取世界书数据...');const a=await o.get(t);console.log(`📊 世界书包含 ${a.length} 个条目`),console.log('🔎 正在查找剧情记录条目...');const n=o.findEntry(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);if(n){console.log('✅ 找到剧情记录条目:',{name:n.name,contentLength:n.content?.length||0,contentPreview:n.content?.substring(0,200)||''}),console.log('🔄 正在解析调教记录...');const e=this.parseTrainingHistory(n.content);return console.log(`✅ 解析完成，共 ${e.length} 条记录`),e}return console.log('ℹ️ 未找到该角色的剧情记录条目'),console.log('📋 世界书中的所有条目类型:'),a.slice(0,10).forEach((e,t)=>{console.log(`  [${t}]`,{name:e.name,entryType:e.extra?.entry_type,characterId:e.extra?.character_id})}),a.length>10&&console.log(`  ... 还有 ${a.length-10} 个条目`),[]}catch(e){return console.error('❌ 获取现有调教记录失败:',e),console.error('错误详情:',{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),[]}}static async addMultipleTrainingRecords(e,t,a,n,l){try{if(o.isPlayerCharacter(e,t,l))return void console.log(`跳过player角色 ${t} 的调教记录`);const r=await o.get(a),i=o.findEntry(r,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);let c;c=i&&i.content?this.appendTrainingRecords(i.content,n):s.buildTrainingSection(n),await this.updateTrainingEntry(e,t,a,c),console.log(`✅ 已增量添加 ${n.length} 条调教记录到 ${t}`)}catch(e){throw console.error('批量添加调教记录失败:',e),e}}static appendTrainingRecords(e,t){const a=e.match(/<\/training_history>/);if(!a){console.warn('未找到调教记录标签，尝试构建新的调教记录');const a=s.buildTrainingSection(t);return e.trim()?e+a:a}const o=t.map(e=>`[${e.gameTime||'未知时间'}] ${'user'===e.sender?'{{user}}':e.sender}: ${e.content}`).join('\n'),n=a.index,l=e.substring(0,n),r=e.substring(n),i=!l.endsWith('\n');return l+(i?'\n':'')+o+'\n'+r}static async updateTrainingEntry(e,t,a,n){await o.ensureExists(a);const s=await o.get(a),l=o.findEntryIndex(s,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e),r=this.createCharacterStoryHistoryEntry(e,t,n);-1!==l?s[l]=r:s.push(r),await o.replace(a,s)}static createCharacterStoryHistoryEntry(e,t,a){return{uid:o.generateStoryHistoryUID(e),name:`${t}-剧情记录`,enabled:!0,strategy:{type:'selective',keys:[t,'战斗总结','调教记录','战前对话','剧情记录'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:160},content:a,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'character_story_history',character_id:e,character_name:t,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}}}static parseTrainingHistory(e){console.log('🔍 [解析调教记录] 开始解析'),console.log('📄 内容长度:',e?.length||0);const t=[],a=e.match(/<training_history>([\s\S]*?)<\/training_history>/);if(!a)return console.log('⚠️ 未找到 <training_history> 标签'),console.log('📄 内容预览:',e?.substring(0,300)||'(空内容)'),t;console.log('✅ 找到 <training_history> 标签');const o=a[1];console.log('📊 标签内容长度:',o.length),console.log('📄 完整标签内容:'),console.log('---开始---'),console.log(o),console.log('---结束---');const n=o.split('\n');console.log(`📋 分割成 ${n.length} 行`);let s=null,l=0;if(n.forEach((e,a)=>{const o=e.match(/^\[(.+?)\] (.+?): (.*)$/);if(o){if(s){const e=s;e.sender&&'user'!==e.sender&&e.content&&(e.content=this.cleanAIContent(e.content),console.log('  🧹 已清理AI回复的空行和格式')),t.push(e),console.log(`  ✅ 完成第 ${l} 条记录`)}l++;const[,e,n,r]=o;s={gameTime:e,sender:'{{user}}'===n?'user':n,content:r.trim(),timestamp:Date.now()},console.log(`  📝 [行${a}] 开始新记录 #${l}:`,{gameTime:e,sender:s.sender,contentPreview:r.substring(0,30)+(r.length>30?'...':''),hasContent:r.trim().length>0})}else s&&e.trim()?(s.content&&''!==s.content.trim()?s.content+='\n'+e.trim():s.content=e.trim(),console.log(`    ➕ [行${a}] 追加内容到记录 #${l}: "${e.trim().substring(0,30)}${e.trim().length>30?'...':''}"`)):''===e.trim()?console.log(`    ⚪ [行${a}] 空行`):console.log(`    ⚠️ [行${a}] 未匹配的行: "${e.substring(0,50)}${e.length>50?'...':''}"`)}),s){const e=s;e.sender&&'user'!==e.sender&&e.content&&(e.content=this.cleanAIContent(e.content),console.log('  🧹 已清理AI回复的空行和格式')),t.push(e),console.log(`  ✅ 完成第 ${l} 条记录（最后一条）`)}return console.log(`✅ [解析完成] 共解析出 ${t.length} 条记录`),t}static cleanAIContent(e){return e.split('\n').map(e=>e.trim()).filter(e=>e.length>0).join('\n\n')}static async deleteTrainingHistory(e,t){try{const a=await o.get(t),n=o.findEntryIndex(a,t=>'character_story_history'===t.extra?.entry_type&&t.extra?.character_id===e);-1!==n&&(a.splice(n,1),await o.replace(t,a),console.log(`✅ 已删除角色 ${e} 的剧情记录条目`))}catch(e){throw console.error('删除剧情记录条目失败:',e),e}}}class u{static async initialize(e,t){try{await o.ensureExists(e),await o.updateOrCreateEntry(e,e=>'resources'===e.extra?.entry_type,e=>({...e,content:this.buildContent(t),extra:{...e.extra,updated_at:(new Date).toISOString()}}),()=>this.createEntry(this.buildContent(t))),console.log('资源世界书条目初始化完成')}catch(e){throw console.error('初始化资源世界书条目失败:',e),e}}static async update(e,t){try{await o.ensureExists(e),await o.updateOrCreateEntry(e,e=>'resources'===e.extra?.entry_type,e=>({...e,content:this.buildContent(t),extra:{...e.extra,updated_at:(new Date).toISOString()}}),()=>this.createEntry(this.buildContent(t))),console.log('资源世界书条目更新完成')}catch(e){throw console.error('更新资源世界书条目失败:',e),e}}static createEntry(e){return{uid:Date.now(),name:'哥布林巢穴资源状态',enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:4,order:115},content:e,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{entry_type:'resources',created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}}}static buildContent(e){const t=e.rounds||0,a=_.Q.getTimeInfo(t).formattedDate;return`<NestStatus>\n# 哥布林巢穴资源状态\n\n# 基础资源\n- 金币: ${(e.gold||0).toLocaleString()}\n- 食物: ${(e.food||0).toLocaleString()}\n- 普通奴隶: ${e.slaves||0}\n- 高级女奴: ${e.trainingSlaves||0}\n- 普通哥布林: ${e.normalGoblins||0}\n- 哥布林战士: ${e.warriorGoblins||0}\n- 哥布林萨满: ${e.shamanGoblins||0}\n- 哥布林圣骑士: ${e.paladinGoblins||0}\n\n# 时间信息\n- 当前时间: ${a}\n- 回合数: ${t}\n- 威胁度: ${e.threat||0}\n\n# 说明\n- 这是哥布林巢穴的当前状态\n- 参考这些数据来考虑剧情发展情况\n</NestStatus>`}}class m{static currentWorldbookName='哥布林巢穴-人物档案';static setWorldbookName(e){this.currentWorldbookName=e}static getCurrentWorldbookName(){return this.currentWorldbookName}static async createCharacterWorldbook(e){const t=this.getCurrentWorldbookName();return n.createCharacterWorldbook(e,t)}static async getCharacterEntry(e){const t=this.getCurrentWorldbookName();return n.getCharacterEntry(t,e)}static async updateCharacterEntry(e){const t=this.getCurrentWorldbookName();return n.updateCharacterEntry(t,e)}static async deleteCharacterEntry(e){const t=this.getCurrentWorldbookName();return n.deleteCharacterEntry(t,e)}static async deleteCharacterStoryHistoryEntry(e){const t=this.getCurrentWorldbookName();await d.deleteTrainingHistory(e,t)}static async clearCharacterAndStoryEntries(){const e=this.getCurrentWorldbookName();return n.clearCharacterAndStoryEntries(e)}static async initializeResourcesWorldbook(e){const t=this.getCurrentWorldbookName();return u.initialize(t,e)}static async updateResourcesWorldbook(e){const t=this.getCurrentWorldbookName();return u.update(t,e)}static async addMultipleDialogueRecords(e,t,a,o){const n=this.getCurrentWorldbookName();return r.addMultipleDialogueRecords(e,t,n,a,o)}static async addMultipleBattleSummaryRecords(e,t,a,o){const n=this.getCurrentWorldbookName();return i.addMultipleBattleSummaryRecords(e,t,n,a,o)}static async getExistingTrainingHistory(e){const t=this.getCurrentWorldbookName();return d.getExistingTrainingHistory(e,t)}static async addMultipleTrainingRecords(e,t,a,o){const n=this.getCurrentWorldbookName();return d.addMultipleTrainingRecords(e,t,n,a,o)}static async addConquestRecord(e,t,a,o){const n=this.getCurrentWorldbookName();return c.addConquestRecord(n,e,t,a,o)}static async createEventStoryRecord(e,t,a,o){const n=this.getCurrentWorldbookName();return l.createEventStoryRecord(n,e,t,a,o)}}},885:(e,t,a)=>{a.d(t,{continentExploreService:()=>s});var o=a(61),_=a(716);const n='大陆名称,大陆图标,大陆描述,大陆难度,探索成本(金币),探索成本(食物),威胁倍数,是否解锁,是否征服\n古拉尔大陆,🌋,哥布林巢穴所在地，流放之地，环境恶劣但哥布林熟悉,1,50,30,1.0,true,false\n瓦尔基里大陆,❄️,北部冰雪大陆，黑暗精灵统治，奴隶制经济,2,100,75,1.5,false,false\n香草群岛,🏝️,南部群岛，狐族统治，海上贸易发达,3,150,100,2.0,false,false\n赛菲亚大陆,🏰,西部最大大陆，人类帝国，军事霸权,4,200,150,2.5,false,false\n世界树,🌳,中部世界中心，永恒精灵圣地，世界核心,5,500,300,5.0,false,false\n';const s=new class{continents=(0,o.ref)([]);exploreState=(0,o.ref)({unlockedContinents:[],conqueredContinents:[],currentContinent:'',continentProgress:{}});constructor(){this.initializeContinents(),this.setupDataWatchers(),setTimeout(()=>{this.initializeExploreData()},100)}initializeContinents(){console.log('🔍 [大陆探索服务] 开始初始化大陆数据...');const e=this.loadContinentDataFromCSV();0===this.continents.value.length?(this.continents.value=e,console.log('🔍 [大陆探索服务] 大陆数据初始化完成，共',e.length,'个大陆'),console.log('🔍 [大陆探索服务] 大陆数据详情:',e)):console.log('🔍 [大陆探索服务] 大陆数据已存在，跳过CSV初始化')}loadContinentDataFromCSV(){console.log('🔍 [大陆探索服务] 开始解析CSV数据...'),console.log('🔍 [大陆探索服务] 大陆CSV数据:',n);const e=n.trim().split('\n');console.log('🔍 [大陆探索服务] 大陆CSV行数:',e.length);const t=e[0].split(',');console.log('🔍 [大陆探索服务] 大陆CSV表头:',t);const a=e.slice(1).map(e=>{const a=e.split(','),o={};return t.forEach((e,t)=>{o[e.trim()]=a[t]?.trim()||''}),o});console.log('🔍 [大陆探索服务] 大陆CSV解析结果:',a);const o='区域名称,区域图标,所属大陆,区域描述,区域难度,是否解锁,是否征服,征服需要总星级,解锁星级,首都\n巢穴附近,🏰,古拉尔大陆,哥布林巢穴所在的核心区域，这里环境恶劣但哥布林们熟悉每一寸土地，附近的据点普遍没有任何国家庇护，完全的无主之地...,1,true,false,15,0,\n流放之地,🏚️,古拉尔大陆,被流放的种族聚居地，环境恶劣但居民顽强，是各种被放逐者的避难所,2,true,false,20,0,\n翡翠王国,💎,古拉尔大陆,古拉尔大陆上一个较大的人类王国，拥有丰富的翡翠矿藏和繁荣的贸易，是大陆上最富庶的王国之一,3,false,false,25,30,翡翠王都\n卡拉森林,🌲,古拉尔大陆,部分永恒精灵的栖息地，古老的森林中隐藏着精灵的魔法结界和神秘遗迹,5,false,false,40,50,卡拉村\n沿海解冻区,🏔️,瓦尔基里大陆,夏季短暂解冻的沿海地区,2,false,false,30,60,冰霜要塞\n内陆冰原,🧊,瓦尔基里大陆,终年冰雪覆盖的内陆地区,3,false,false,35,70,黑暗精灵王城\n主岛群,🏝️,香草群岛,狐族主要居住的岛屿群,3,false,false,40,80,狐族王宫\n贸易航道,⛵,香草群岛,连接各岛屿的繁忙航道,4,false,false,45,90,\n边境地区,🛡️,赛菲亚大陆,人类帝国的边境防御区,4,false,false,50,100,\n帝国腹地,👑,赛菲亚大陆,人类帝国的核心区域,5,false,false,60,120,帝国皇都\n世界树外围,🌲,世界树,世界树周围的精灵结界区域,4,false,false,70,140,\n世界树内部,🌳,世界树,世界树内部的精灵城市,5,false,false,80,160,永恒圣城\n'.trim().split('\n'),s=o[0].split(','),l=o.slice(1).map(e=>{const t=e.split(','),a={};return s.forEach((e,o)=>{a[e.trim()]=t[o]?.trim()||''}),a}),r=a.map(e=>({name:e['大陆名称'],icon:e['大陆图标'],description:e['大陆描述'],difficulty:parseInt(e['大陆难度']),explorationCost:{gold:parseInt(e['探索成本(金币)']),food:parseInt(e['探索成本(食物)'])},threatMultiplier:parseFloat(e['威胁倍数']),conquestProgress:0,isUnlocked:'true'===e['是否解锁'],isConquered:'true'===e['是否征服'],unlockCondition:{conquestPercentage:0,previousContinentName:void 0},regions:[]})),i=l.map(e=>({name:e['区域名称'],icon:e['区域图标'],continentName:e['所属大陆'],description:e['区域描述'],difficulty:parseInt(e['区域难度']),isUnlocked:'true'===e['是否解锁'],isConquered:'true'===e['是否征服'],conquestProgress:0,requiredStars:parseInt(e['征服需要总星级'])||0,unlockStars:parseInt(e['解锁星级'])||0,capital:e['首都']||'',threatLevel:0,locations:[]}));console.log('🔍 [大陆探索服务] 开始分配区域到大陆...'),console.log('🔍 [大陆探索服务] 大陆列表:',r.map(e=>({name:e.name}))),console.log('🔍 [大陆探索服务] 区域列表:',i.map(e=>({name:e.name,continentName:e.continentName})));const c=r.map(e=>{const t=i.filter(t=>t.continentName===e.name);return console.log(`🔍 [大陆探索服务] 大陆 ${e.name} 匹配到 ${t.length} 个区域:`,t.map(e=>e.name)),{...e,regions:t}});return console.log('🔍 [大陆探索服务] 最终大陆数据:',c.map(e=>({name:e.name,regionsCount:e.regions.length}))),c}async initializeExploreData(){await this.loadExploreData()}async initializeFromSave(){await this.loadExploreData()}reloadCSVData(){console.log('🔄 重新加载CSV数据...'),this.initializeContinents(),console.log('✅ CSV数据重新加载完成')}initializeNewGame(){this.resetExploreData()}getAllContinents(){return this.continents.value}getUnlockedContinents(){return this.continents.value.filter(e=>e.isUnlocked)}getCurrentContinent(){const e=this.exploreState.value.currentContinent;return this.continents.value.find(t=>t.name===e)||null}unlockContinent(e){try{const t=this.continents.value.find(t=>t.name===e);return t?this.checkUnlockConditions(t)?(t.isUnlocked=!0,this.exploreState.value.unlockedContinents.includes(e)||this.exploreState.value.unlockedContinents.push(e),this.exploreState.value.currentContinent||(this.exploreState.value.currentContinent=e),console.log(`大陆 ${t.name} 已解锁`),this.saveExploreData(),!0):(console.warn(`大陆 ${t.name} 解锁条件未满足`),!1):(console.warn(`大陆 ${e} 不存在`),!1)}catch(e){return console.error('解锁大陆失败:',e),!1}}checkUnlockConditions(e){const{previousContinentName:t}=e.unlockCondition;if(!t)return!0;return(this.exploreState.value.continentProgress[t]||0)>=50}updateContinentProgress(e,t){try{const a=this.continents.value.find(t=>t.name===e);if(!a)return void console.warn(`大陆 ${e} 不存在`);a.conquestProgress=Math.min(100,Math.max(0,t)),this.exploreState.value.continentProgress[e]=a.conquestProgress,a.conquestProgress>=100&&!a.isConquered&&(a.isConquered=!0,this.exploreState.value.conqueredContinents.includes(e)||this.exploreState.value.conqueredContinents.push(e),console.log(`大陆 ${a.name} 已完全征服`)),this.checkNextContinentUnlock(e),this.saveExploreData()}catch(e){console.error('更新大陆征服进度失败:',e)}}calculateContinentProgressFromRegions(e){try{const t=this.continents.value.find(t=>t.name===e);if(!t)return void console.warn(`大陆 ${e} 不存在`);let a=0,o=0;console.log(`🔍 [大陆征服进度计算] 开始计算大陆 ${t.name} 的征服进度`),t.regions.forEach(e=>{console.log(`🔍 [大陆征服进度计算] 区域 ${e.name}: 解锁=${e.isUnlocked}, 征服进度=${e.conquestProgress}%`),a+=e.conquestProgress,o++});const n=o>0?a/o:0;t.conquestProgress=Math.min(100,Math.max(0,n)),console.log(`🔍 [大陆征服进度计算] 大陆 ${t.name} 征服进度: ${t.conquestProgress.toFixed(1)}% (基于${o}个区域的平均值)`),t.conquestProgress>=100&&!t.isConquered&&(t.isConquered=!0,this.exploreState.value.conqueredContinents.includes(e)||this.exploreState.value.conqueredContinents.push(e),console.log(`大陆 ${t.name} 已完全征服`)),this.checkNextContinentUnlock(e),this.saveExploreData()}catch(e){console.error('计算大陆征服进度失败:',e)}}checkNextContinentUnlock(e){const t=this.continents.value.find(t=>t.unlockCondition.previousContinentName===e);t&&!t.isUnlocked&&this.checkUnlockConditions(t)&&this.unlockContinent(t.name)}unlockRegion(e){try{const t=this.findRegionByName(e);if(!t)return console.warn(`区域 ${e} 不存在`),!1;if(t.isUnlocked)return console.log(`区域 ${t.name} 已经解锁`),!0;const a=this.continents.value.find(e=>e.name===t.continentName);return a&&a.isUnlocked?this.checkRegionUnlockConditions(t)?(t.isUnlocked=!0,console.log(`区域 ${t.name} 已解锁`),this.saveExploreData(),!0):(console.warn(`区域 ${t.name} 解锁条件未满足`),!1):(console.warn(`区域 ${t.name} 所属大陆未解锁`),!1)}catch(e){return console.error('解锁区域失败:',e),!1}}checkRegionUnlockConditions(e){if(0===e.unlockStars)return!0;const t=this.continents.value.find(t=>t.name===e.continentName);if(!t)return!1;return this.calculateContinentConqueredStars(t.name)>=e.unlockStars}calculateContinentConqueredStars(e){try{const t=_.l.getModuleData({moduleName:'exploration'});if(!t||!t.locations)return 0;const a=t.locations,o=this.continents.value.find(t=>t.name===e);if(!o)return 0;let n=0;return o.regions.forEach(e=>{a.filter(t=>t.continent===o.name&&t.region===e.name&&'conquered'===t.status).forEach(e=>{n+=e.difficulty||0})}),n}catch(e){return console.error('计算大陆征服星级失败:',e),0}}findRegionByName(e){for(const t of this.continents.value){const a=t.regions.find(t=>t.name===e);if(a)return a}return null}updateRegionProgress(e,t){try{const a=this.findRegionByName(e);if(!a)return void console.warn(`区域 ${e} 不存在`);a.conquestProgress=Math.min(100,Math.max(0,t)),a.conquestProgress>=100&&!a.isConquered&&(a.isConquered=!0,console.log(`区域 ${a.name} 已完全征服`),this.checkNextRegionUnlock(e)),this.saveExploreData()}catch(e){console.error('更新区域征服进度失败:',e)}}calculateRegionProgressFromLocations(e){try{const t=this.findRegionByName(e);if(!t)return void console.warn(`区域 ${e} 不存在`);const a=this.calculateRegionConqueredStars(e),o=t.requiredStars>0?Math.min(100,a/t.requiredStars*100):0;t.conquestProgress=o,console.log(`区域 ${t.name} 征服进度: ${o.toFixed(1)}% (${a}/${t.requiredStars}星)`),o>=100&&!t.isConquered&&(t.isConquered=!0,console.log(`区域 ${t.name} 已完全征服`),this.addActionPointsFromRegionConquest(),this.checkNextRegionUnlock(e)),this.calculateContinentProgressFromRegions(t.continentName),this.saveExploreData()}catch(e){console.error('计算区域征服进度失败:',e)}}calculateRegionConqueredStars(e){try{const t=this.findRegionByName(e);if(!t)return 0;const a=_.l.getModuleData({moduleName:'exploration'});if(!a||!a.locations)return 0;const o=a.locations,n=this.continents.value.find(e=>e.name===t.continentName);if(!n)return 0;const s=o.filter(e=>e.continent===n.name&&e.region===t.name&&'conquered'===e.status);console.log(`🔍 [征服进度计算] 区域 ${t.name} 的据点匹配:`),console.log(`🔍 [征服进度计算] 大陆名称: ${n.name}`),console.log(`🔍 [征服进度计算] 区域名称: ${t.name}`),console.log(`🔍 [征服进度计算] 匹配到的据点数量: ${s.length}`),s.forEach(e=>{console.log(`🔍 [征服进度计算] 据点: ${e.name}, 难度: ${e.difficulty}, 状态: ${e.status}`)});let l=0;return s.forEach(e=>{l+=e.difficulty||0}),console.log(`🔍 [征服进度计算] 区域 ${t.name} 总征服星级: ${l}`),l}catch(e){return console.error('计算区域征服星级失败:',e),0}}addActionPointsFromRegionConquest(){try{const e=_.l.resources.value.maxActionPoints,t=e+1;_.l.setResource('maxActionPoints',t);const a=_.l.resources.value.conqueredRegions;_.l.setResource('conqueredRegions',a+1),console.log(`征服区域增加行动力上限: ${e} -> ${t} (已征服区域: ${a+1})`)}catch(e){console.error('增加行动力上限失败:',e)}}checkNextRegionUnlock(e){const t=this.findRegionByName(e);if(!t)return;const a=this.continents.value.find(e=>e.name===t.continentName);a&&a.regions.forEach(e=>{!e.isUnlocked&&e.unlockStars>0&&this.checkRegionUnlockConditions(e)&&this.unlockRegion(e.name)})}recalculateAllRegionProgress(){try{console.log('🔄 重新计算所有区域征服进度...'),this.continents.value.forEach(e=>{e.regions.forEach(e=>{this.calculateRegionProgressFromLocations(e.name)}),this.calculateContinentProgressFromRegions(e.name)}),console.log('✅ 所有区域征服进度重新计算完成')}catch(e){console.error('重新计算区域征服进度失败:',e)}}setupDataWatchers(){(0,o.watch)(this.continents,()=>{this.saveExploreData()},{deep:!0}),(0,o.watch)(this.exploreState,()=>{this.saveExploreData()},{deep:!0})}async loadExploreData(){try{const e=_.l.getModuleData({moduleName:'exploration'});if(e){const t=e;if(this.migrateExploreData(t),t.continents&&Array.isArray(t.continents)&&t.continents.length>0)this.continents.value=t.continents,console.log('从数据库加载大陆数据成功，共',t.continents.length,'个大陆');else{console.log('存档中无大陆数据，强制从CSV加载...');const e=this.loadContinentDataFromCSV();this.continents.value=e,console.log('从CSV加载大陆数据成功，共',e.length,'个大陆')}t.continentExploreState&&(this.exploreState.value=t.continentExploreState,console.log('从数据库加载大陆探索状态成功')),console.log('从数据库加载大陆探索数据成功')}else console.log('未找到大陆探索数据，使用默认数据'),this.initializeContinents()}catch(e){console.error('加载大陆探索数据失败:',e),this.initializeContinents()}}migrateExploreData(e){try{e.continents&&!Array.isArray(e.continents)&&(console.warn('检测到旧版本大陆数据格式，正在迁移...'),e.continents=[]),e.continentExploreState&&'object'!=typeof e.continentExploreState&&(console.warn('检测到旧版本大陆探索状态格式，正在迁移...'),e.continentExploreState={unlockedContinents:[],conqueredContinents:[],currentContinent:'',continentProgress:{}}),e.continents&&e.continents.length>0&&e.continents.forEach(e=>{e.regions||(e.regions=[]),e.conquestProgress||(e.conquestProgress=0),e.isUnlocked||(e.isUnlocked=!1),e.isConquered||(e.isConquered=!1),e.regions.forEach(e=>{e.conquestProgress||(e.conquestProgress=0),e.isUnlocked||(e.isUnlocked=!1),e.isConquered||(e.isConquered=!1),e.requiredStars||(e.requiredStars=0),e.unlockStars||(e.unlockStars=0),e.capital||(e.capital=''),e.threatLevel||(e.threatLevel=0),e.locations||(e.locations=[])})}),console.log('数据迁移和兼容性处理完成')}catch(e){console.error('数据迁移失败:',e)}}async saveExploreData(){try{const e=_.l.getModuleData({moduleName:'exploration'})||{},t=this.validateContinentsData(this.continents.value),a=this.validateExploreStateData(this.exploreState.value);_.l.updateModuleData({moduleName:'exploration',data:{...e,continents:t,continentExploreState:a}}),console.log('大陆探索数据已保存到数据库')}catch(e){console.error('保存大陆探索数据失败:',e)}}validateContinentsData(e){return e.map(e=>({...e,name:e.name||'',description:e.description||'',difficulty:e.difficulty||1,icon:e.icon||'🌍',isUnlocked:Boolean(e.isUnlocked),isConquered:Boolean(e.isConquered),conquestProgress:Number(e.conquestProgress)||0,regions:e.regions?e.regions.map(t=>({...t,name:t.name||'',continentName:t.continentName||e.name,description:t.description||'',difficulty:t.difficulty||1,icon:t.icon||'🏘️',isUnlocked:Boolean(t.isUnlocked),isConquered:Boolean(t.isConquered),conquestProgress:Number(t.conquestProgress)||0,requiredStars:Number(t.requiredStars)||0,unlockStars:Number(t.unlockStars)||0,capital:t.capital||'',threatLevel:Number(t.threatLevel)||0,locations:t.locations||[]})):[]}))}validateExploreStateData(e){return{unlockedContinents:Array.isArray(e.unlockedContinents)?e.unlockedContinents:[],conqueredContinents:Array.isArray(e.conqueredContinents)?e.conqueredContinents:[],currentContinent:e.currentContinent||'',continentProgress:e.continentProgress||{}}}resetExploreData(){try{this.continents.value.forEach(e=>{e.isUnlocked='gular'===e.name,e.isConquered=!1,e.conquestProgress=0,e.regions.forEach(e=>{e.isUnlocked=!1,e.isConquered=!1,e.conquestProgress=0,e.threatLevel=0})}),this.exploreState.value={unlockedContinents:['gular'],conqueredContinents:[],currentContinent:'gular',continentProgress:{}},console.log('大陆探索数据已重置'),this.saveExploreData()}catch(e){console.error('重置大陆探索数据失败:',e)}}}}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=a(61);const n=VueRouter;var s,l;!function(e){e.MERCHANT='merchant',e.TREASURE='treasure',e.ENCOUNTER='encounter',e.DISASTER='disaster',e.BLESSING='blessing',e.QUEST='quest',e.RANDOM='random'}(s||(s={})),function(e){e.COMMON='common',e.UNCOMMON='uncommon',e.RARE='rare',e.EPIC='epic',e.LEGENDARY='legendary'}(l||(l={}));const r=[{id:'round_start_rumors',name:'世界传闻',description:'关于哥布林巢穴的传闻在大陆上传播...',type:s.RANDOM,rarity:l.COMMON,trigger:{minRound:1,probability:.2},dialogueConfig:{title:'📰 世界传闻',subtitle:'关于哥布林巢穴的消息在世界上传播',welcomeText:'📰 世界传闻记录',welcomeHint:'最近，出现了一些关于哥布林巢穴的传闻，这些消息可能会影响你的发展...',showCustomInput:!1,initialOptions:[{text:'仔细了解传闻',label:'了解',value:'understand'},{text:'忽略这些消息',label:'忽略',value:'ignore'}],onAIGenerate:async()=>{try{return await window.TavernHelper.generate({user_input:'\n        请作为一个中立的叙述者，讲述世界上目前对于哥布林巢穴的传闻。\n\n指导原则：\n1. 参考世界书中的相关设定，如世界设定/大陆设定/势力种族设定/哥布林设定等\n2. 参考巢穴当前的资源状态/征服记录等信息，作为传闻的背景\n3. 用第三人称叙述，类似故事中的旁白，语言要生动真实，符合奇幻冒险色情游戏的风格\n4. 保持神秘和紧张的氛围\n5. 字数控制在400字左右\n'})}catch(e){return console.error('AI生成失败:',e),'传闻在大陆上传播，但具体内容模糊不清...'}},onOptionSelect:e=>'ignore'===e.value?(console.log('玩家选择忽略传闻，直接结束对话'),!1):('understand'===e.value&&console.log('玩家选择了解传闻'),!0),onDialogueClose:()=>{console.log('传闻事件关闭')}}}];class i{static instance;registeredEvents=new Map;eventHistory=[];constructor(){this.initializeEvents()}static getInstance(){return i.instance||(i.instance=new i),i.instance}initializeEvents(){r.forEach(e=>{this.registerEvent(e)})}registerEvent(e){this.registeredEvents.set(e.id,e)}getAllEvents(){return Array.from(this.registeredEvents.values())}getEventsByType(e){return this.getAllEvents().filter(t=>t.type===e)}getEventsByRarity(e){return this.getAllEvents().filter(t=>t.rarity===e)}checkRoundStartEvents(e,t){const a=this.getEventsByType(s.RANDOM).filter(a=>this.isEventAvailable(a,e,t));if(0===a.length)return{triggered:!1,reason:'没有可用的事件'};const o=a.reduce((e,t)=>e+(t.trigger.probability??.2),0);if(Math.random()<o){const e=this.selectEventByProbability(a);if(e)return this.eventHistory.push(e.id),{triggered:!0,event:e}}return{triggered:!1,reason:'概率未触发'}}isEventAvailable(e,t,a){const o=e.trigger;if(o.minRound&&t<o.minRound)return!1;if(o.maxRound&&t>o.maxRound)return!1;if(o.requiredResources&&a)for(const[e,t]of Object.entries(o.requiredResources))if(!a.resources||a.resources[e]<t)return!1;return!(o.requiredThreat&&a&&(!a.threat||a.threat<o.requiredThreat))}selectEventByProbability(e){if(0===e.length)return null;const t=e.reduce((e,t)=>e+(t.trigger.probability??.2),0);let a=Math.random()*t;for(const t of e){const e=t.trigger.probability??.2;if(a<=e)return t;a-=e}return e[e.length-1]}processEventResult(e,t){try{return console.log(`处理事件 "${e.name}" 的用户选择: ${t}`),{success:!0,message:`事件 "${e.name}" 处理完成`,rewards:e.rewards||[],penalties:e.penalties||[]}}catch(e){return console.error('处理事件结果失败:',e),{success:!1,message:'处理事件结果时发生错误'}}}}var _=a(844),c=a(716),d=a(120);const u={class:'modal-header'},m={class:'modal-content'},g={class:'message'},h={key:0,class:'details'},p={class:'modal-actions'},v=(0,o.defineComponent)({__name:'自定义确认框',props:{show:{type:Boolean},title:{default:'提示'},message:{},details:{},confirmText:{default:'确定'},cancelText:{default:'取消'},showCancel:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},type:{default:'info'}},emits:['confirm','cancel','close'],setup(e,{emit:t}){const a=e,n=t,s=()=>{n('confirm')},l=()=>{n('cancel')},r=()=>{a.showClose&&n('close')},i=(0,o.computed)(()=>({info:'info-button',warning:'warning-button',danger:'danger-button',success:'success-button'}[a.type]));return(t,a)=>e.show?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'custom-confirm-overlay',onClick:r},[(0,o.createElementVNode)('div',{class:'custom-confirm-modal',onClick:a[0]||(a[0]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',u,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(e.title),1),e.showClose?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'close-button',onClick:l},'×')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',m,[(0,o.createElementVNode)('div',g,(0,o.toDisplayString)(e.message),1),e.details?((0,o.openBlock)(),(0,o.createElementBlock)('div',h,(0,o.toDisplayString)(e.details),1)):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',p,[e.showCancel?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'cancel-button',onClick:l},(0,o.toDisplayString)(e.cancelText),1)):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['confirm-button',i.value]),onClick:s},(0,o.toDisplayString)(e.confirmText),3)])])])):(0,o.createCommentVNode)('v-if',!0)}});var f=a(42);const y=(0,f.A)(v,[['__scopeId','data-v-284513a8']]);class b{static formatMessage(e,t={}){const{enableMarkdown:a=!0,enableCodeHighlight:o=!0,enableQuote:n=!0}=t;let s=e;return a&&(s=s.replace(/\n/g,'<br>'),n&&(s=s.replace(/^> (.+)$/gm,'<blockquote class="quote">$1</blockquote>')),s=s.replace(/"([^"]*)"/g,'<span class="double-quote">"$1"</span>'),s=s.replace(/“([^”]+)”/g,'<span class="double-quote">"$1"</span>'),s=s.replace(/「([^」]+)」/g,'<span class="double-quote">「$1」</span>'),s=s.replace(/『([^』]+)』/g,'<span class="double-quote">『$1』</span>'),s=s.replace(/'([^']+)'/g,'<span class="single-quote">\'$1\'</span>'),s=s.replace(/‘([^’]+)’/g,'<span class="single-quote">\'$1\'</span>'),s=s.replace(/\*\*(.+?)\*\*/g,'<strong class="strong-text">$1</strong>'),s=s.replace(/\*(.+?)\*/g,'<em class="italic-text">$1</em>'),o&&(s=s.replace(/```([\s\S]*?)```/g,(_,e)=>`<pre class="code-block"><code class="code-content" data-language="${e.trim().split('\n')[0].match(/^\s*```(\w+)\s*$/)?.[1]||''}">${e.trim().replace(/^\s*```(\w+)\s*\n?/,'').replace(/\n*```\s*$/,'')}</code></pre>`),s=s.replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>'))),s}static getCurrentTime(){const e=new Date;return`${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`}static createMessage(e,t,a,o){return{message_id:o,role:e,sender:a,time:this.getCurrentTime(),content:t}}static async sendMessage(e){const{userInput:t,onSuccess:a,onError:o}=e;try{await window.TavernHelper.createChatMessages([{role:'user',message:t}]);const e=await window.TavernHelper.generate({user_input:t});console.log('🧹 原始AI回复:',e);const o=formatAsTavernRegexedString(e,'ai_output','display');console.log('🎨 应用酒馆正则后的回复:',o),console.log('🔄 内容是否发生变化:',e!==o),await window.TavernHelper.createChatMessages([{role:'assistant',message:o}]);const n=this.createMessage('assistant',o,'系统');return a&&a(o),n}catch(e){const t=this.createMessage('system','抱歉，生成回复时出现错误，请稍后再试。','系统');return o&&o(e),t}}static async loadHistoryMessages(e='0-{{lastMessageId}}'){try{return(await window.TavernHelper.getChatMessages(e)).map(e=>({message_id:e.message_id,role:e.role,sender:'user'===e.role?'玩家':'系统',time:'10:00',content:e.message}))}catch(e){return console.error('加载历史消息失败:',e),[]}}static exportMessages(e,t={format:'txt'}){const{format:a='txt',filename:o='messages'}=t;let n,s,l;'json'===a?(n=JSON.stringify(e,null,2),s='application/json',l='json'):(n=e.map(e=>`[${e.time}] ${e.sender}: ${e.content}`).join('\n'),s='text/plain',l='txt');const r=new Blob([n],{type:s}),i=URL.createObjectURL(r),c=document.createElement('a');c.href=i,c.download=`${o}.${l}`,c.click(),URL.revokeObjectURL(i)}static scrollToBottom(e){e&&setTimeout(()=>{e.scrollTop=e.scrollHeight},100)}}function N(e={}){const{autoLoadHistory:t=!0}=e,a=(0,o.ref)([]),n=(0,o.ref)(''),s=(0,o.ref)(!1),l=(0,o.ref)(null),r=async e=>{try{const t=await b.loadHistoryMessages(e);a.value=t}catch(e){console.error('加载历史消息失败:',e)}};return(0,o.onMounted)(()=>{t&&r()}),{messages:a,currentMessage:n,isLoading:s,containerRef:l,sendMessage:async e=>{if(!n.value.trim())return;const t=n.value;n.value='';const o=b.createMessage('user',t,'玩家');a.value=[...a.value,o],b.scrollToBottom(l.value),s.value=!0;try{const o=await b.sendMessage({userInput:t,...e});a.value=[...a.value,o],b.scrollToBottom(l.value)}catch(e){console.error('发送消息失败:',e)}finally{s.value=!1}},clearMessages:()=>{a.value=[]},formatMessage:(e,t)=>b.formatMessage(e,t),exportMessages:e=>{b.exportMessages(a.value,e)},loadHistoryMessages:r,addSystemMessage:e=>{const t=b.createMessage('system',e,'系统');a.value=[...a.value,t],b.scrollToBottom(l.value)},addUserMessage:e=>{const t=b.createMessage('user',e,'{{user}}');a.value=[...a.value,t],b.scrollToBottom(l.value)},addAIMessage:(e,t='系统')=>{const o=b.createMessage('assistant',e,t);a.value=[...a.value,o],b.scrollToBottom(l.value)}}}class E{static parseNextStepOptions(e){try{const t=E.extractJsonBlock(e);if(t){const e=JSON.parse(t);if(Array.isArray(e.options)&&e.options.length>0){const t=e.options.filter(e=>e&&'string'==typeof e.text).map(e=>({text:e.text,label:e.strategy})).slice(0,3);if(t.length>0)return{options:t}}}}catch(e){console.warn('JSON 解析失败:',e)}return{options:[]}}static extractJsonBlock(e){const t=e.match(/\[OPTIONS_JSON\]([\s\S]*?)(?:\[\/OPTIONS_JSON\]|$)/i);if(t&&t[1]){const e=t[1].trim(),a=E.extractFirstJson(e);if(a)return a}return E.extractFirstJson(e)}static extractFirstJson(e){const t=e.indexOf('{');if(-1===t)return null;let a=0;for(let o=t;o<e.length;o++){const n=e[o];if('{'===n&&a++,'}'===n&&(a--,0===a))return e.slice(t,o+1)}return null}}const k={class:'generic-dialogue-container'},S={class:'dialogue-panel'},V={class:'dialogue-header'},C={class:'dialogue-info'},w={class:'dialogue-title'},x={class:'dialogue-subtitle'},D={class:'header-buttons'},B={class:'dialogue-shell'},A={class:'dialogue-nav'},T=['disabled'],M={class:'nav-info'},R=['disabled'],G={class:'page'},I={class:'page-inner'},O=['innerHTML'],P={key:1,class:'initial-state'},L={class:'initial-welcome'},U={class:'welcome-text'},F={class:'welcome-hint'},H={class:'initial-options'},q={class:'option-choices'},J=['onClick'],W={class:'option-content'},j={key:2,class:'inline-options'},Y={class:'option-choices'},K=['onClick'],Q={class:'option-content'},X={class:'custom-input-body'},Z=['placeholder','disabled','onKeydown'],ee={class:'custom-input-footer'},te=['disabled'],ae={class:'edit-dialog-body'},oe=(0,o.defineComponent)({__name:'通用对话界面',props:{dialogueConfig:{}},emits:['close'],setup(e,{emit:t}){const a=e,n=t,{messages:s,containerRef:l,addUserMessage:r,addAIMessage:i}=N({autoLoadHistory:!1}),c=(0,o.ref)(!1),d=(0,o.ref)([]),u=(0,o.ref)(a.dialogueConfig.initialOptions||[{text:'继续对话',label:'继续'},{text:'询问详情',label:'询问'},{text:'结束对话',label:'结束'}]),m=(0,o.ref)([]),g=(0,o.ref)(0),h=()=>{g.value>0&&(g.value-=1)},p=()=>{g.value<m.value.length-1&&(g.value+=1)},v=e=>{if(0===m.value.length)return;m.value[m.value.length-1].html+=`<div class="choice-line"><span class="choice-prefix">→</span> ${Se(e)}</div>`},f=(0,o.ref)(''),oe=a.dialogueConfig.customPlaceholder||'输入你的选择…',ne=(0,o.ref)(!1),se=()=>{c.value||!1===a.dialogueConfig.showCustomInput||(ne.value=!0,(0,o.nextTick)(()=>{const e=document.querySelector('.custom-input-panel textarea');e&&e.focus()}))},le=()=>{ne.value=!1,f.value=''},re=async()=>{const e=f.value.trim();if(e&&!c.value){if(le(),a.dialogueConfig.onCustomInput&&a.dialogueConfig.onCustomInput(e),r(e),v(e),a.dialogueConfig.onUserMessage)try{await a.dialogueConfig.onUserMessage(e)}catch(e){console.error('用户消息回调执行失败:',e)}d.value=[],de(),await ce()}};(0,o.onMounted)(async()=>{m.value.length>0&&ue()});const ie=()=>{const e=s.value.filter(e=>'user'===e.role).pop();return e?e.content:''},ce=async()=>{let e='';try{if(c.value=!0,a.dialogueConfig.onAIGenerate)e=await a.dialogueConfig.onAIGenerate(ie());else{e=await window.TavernHelper.generate({user_input:ie()})}const t=E.parseNextStepOptions(e);d.value=t.options,de();const o=ke(e),n=formatAsTavernRegexedString(o,'ai_output','display');if(i(n,'AI'),(e=>{const t=Se(Ee(e));m.value.push({html:t})})(n),g.value=m.value.length-1,a.dialogueConfig.onAIReply)try{await a.dialogueConfig.onAIReply(n,a.dialogueConfig.characterName||'AI')}catch(e){console.error('AI回复回调执行失败:',e)}}catch(e){console.error('AI生成失败:',e),toastr.error('AI生成失败','AI生成失败')}finally{c.value=!1}},de=()=>{if(a.dialogueConfig.saveKey)try{const e={options:d.value,timestamp:Date.now()},t=getVariables({type:'character'});t[`dialogue_options_${a.dialogueConfig.saveKey}`]=JSON.stringify(e),replaceVariables(t,{type:'character'})}catch(e){console.error('保存选项失败:',e)}},ue=()=>{if(0===m.value.length)return;if((()=>{if(!a.dialogueConfig.saveKey)return!1;try{const e=getVariables({type:'character'})[`dialogue_options_${a.dialogueConfig.saveKey}`];if(e){const t=JSON.parse(e);return d.value=t.options||[],!0}}catch(e){console.error('加载选项失败:',e)}return!1})())return;const e=[...s.value].reverse().find(e=>'assistant'===e.role);if(!e)return;const t=e.content,o=E.parseNextStepOptions(t);d.value=o.options,d.value.length>0&&de()},me=()=>{a.dialogueConfig.onDialogueClose&&a.dialogueConfig.onDialogueClose(),n('close')},ge=(0,o.ref)(-1),he=(0,o.ref)(''),pe=(0,o.ref)(!1),ve=(0,o.ref)({title:'删除消息',message:'确定要删除这条消息吗？',details:'删除后将无法恢复',confirmText:'删除',cancelText:'取消',showCancel:!0,showClose:!0,type:'danger'}),fe=()=>{ge.value>=0&&ge.value<m.value.length&&(m.value[ge.value].html=he.value,ge.value=-1,he.value='')},ye=()=>{ge.value=-1,he.value=''},be=()=>{g.value>=0&&g.value<m.value.length&&(m.value.splice(g.value,1),g.value>=m.value.length&&(g.value=Math.max(0,m.value.length-1))),pe.value=!1},Ne=()=>{pe.value=!1},Ee=e=>e.replace(/<content[^>]*>(.*?)<\/content>/gi,'$1').replace(/<message[^>]*>(.*?)<\/message>/gi,'$1').replace(/<[^>]+>/g,''),ke=e=>e.replace(/\[OPTIONS_JSON\][\s\S]*?\[\/OPTIONS_JSON\]/gi,'').trim(),Se=e=>b.formatMessage(e,{enableMarkdown:!0,enableCodeHighlight:!0,enableQuote:!0});return(t,n)=>((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)('div',k,[(0,o.createElementVNode)('div',S,[(0,o.createCommentVNode)(' 头部信息 '),(0,o.createElementVNode)('div',V,[(0,o.createElementVNode)('div',C,[(0,o.createElementVNode)('div',w,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(e.dialogueConfig.title),1),(0,o.createElementVNode)('div',x,(0,o.toDisplayString)(e.dialogueConfig.subtitle),1)])]),(0,o.createElementVNode)('div',D,[(0,o.createElementVNode)('button',{class:'header-btn edit-btn',title:'编辑当前页消息',onClick:n[0]||(n[0]=e=>(()=>{if(g.value>=0&&g.value<m.value.length){const e=m.value[g.value];ge.value=g.value,he.value=e.html}})())},[...n[6]||(n[6]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'✏️',-1)])]),(0,o.createElementVNode)('button',{class:'header-btn delete-btn',title:'删除当前页消息',onClick:n[1]||(n[1]=e=>{g.value>=0&&g.value<m.value.length&&(pe.value=!0)})},[...n[7]||(n[7]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🗑️',-1)])]),(0,o.createElementVNode)('button',{class:'header-btn close-btn',title:'关闭对话界面',onClick:me},[...n[8]||(n[8]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'✕',-1)])])])]),(0,o.createCommentVNode)(' 消息列表区域 '),(0,o.createElementVNode)('div',B,[(0,o.createElementVNode)('div',A,[(0,o.createElementVNode)('button',{class:'nav-btn',disabled:(0,o.unref)(g)<=0,onClick:h},'上一页',8,T),(0,o.createElementVNode)('div',M,(0,o.toDisplayString)((0,o.unref)(g)+1)+' / '+(0,o.toDisplayString)((0,o.unref)(m).length||1),1),(0,o.createElementVNode)('button',{class:'nav-btn',disabled:(0,o.unref)(g)>=(0,o.unref)(m).length-1,onClick:p},'下一页',8,R)]),(0,o.createElementVNode)('div',{ref_key:'dialogueContent',ref:l,class:'dialogue-viewport'},[(0,o.createElementVNode)('div',G,[(0,o.createElementVNode)('div',I,[(0,o.createCommentVNode)(' 当前页内容 '),(0,o.unref)(m)[(0,o.unref)(g)]?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'page-content typo-book',innerHTML:(0,o.unref)(m)[(0,o.unref)(g)].html},null,8,O)):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 初始空白状态的提示 '),0===(0,o.unref)(m).length?((0,o.openBlock)(),(0,o.createElementBlock)('div',P,[(0,o.createElementVNode)('div',L,[(0,o.createElementVNode)('p',U,(0,o.toDisplayString)(e.dialogueConfig.welcomeText),1),(0,o.createElementVNode)('p',F,(0,o.toDisplayString)(e.dialogueConfig.welcomeHint),1)]),(0,o.createElementVNode)('div',H,[(0,o.createElementVNode)('div',q,[(0,o.createCommentVNode)(' 初始选项 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(u),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:`initial-opt-${t}`,class:(0,o.normalizeClass)(['inline-option',{disabled:(0,o.unref)(c)}]),onClick:t=>!(0,o.unref)(c)&&(async e=>{if(c.value)return;const t=e.text;let o=!0;if(a.dialogueConfig.onOptionSelect){const t=a.dialogueConfig.onOptionSelect(e);'boolean'==typeof t&&!1===t&&(o=!1)}if(o){if(r(t),a.dialogueConfig.onUserMessage)try{await a.dialogueConfig.onUserMessage(t)}catch(e){console.error('用户消息回调执行失败:',e)}const e=`<div class="choice-line"><span class="choice-prefix">→</span> ${Se(t)}</div>`;m.value.push({html:e}),g.value=0,await ce()}else console.log('初始选项选择被阻止，直接关闭对话'),setTimeout(()=>{me()},100)})(e)},[n[9]||(n[9]=(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1)),(0,o.createElementVNode)('span',W,(0,o.toDisplayString)(e.text),1),n[10]||(n[10]=(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1))],10,J))),128)),(0,o.createCommentVNode)(' 自定义选项 '),!0===e.dialogueConfig.showCustomInput?((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['inline-option custom-option',{disabled:(0,o.unref)(c)}]),onClick:se},[...n[11]||(n[11]=[(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1),(0,o.createElementVNode)('span',{class:'option-content'},'自定义',-1),(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1)])],2)):(0,o.createCommentVNode)('v-if',!0)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 本页末尾的选项（融入文字，仅在最新一页显示） '),(0,o.unref)(g)===(0,o.unref)(m).length-1&&((0,o.unref)(d).length>0||(0,o.unref)(m).length>0)?((0,o.openBlock)(),(0,o.createElementBlock)('div',j,[(0,o.createElementVNode)('div',Y,[(0,o.createCommentVNode)(' 前三个选项 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(d),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:`opt-${t}`,class:(0,o.normalizeClass)(['inline-option',{disabled:(0,o.unref)(c)}]),onClick:t=>!(0,o.unref)(c)&&(async e=>{if(c.value)return;let t=!0;if(a.dialogueConfig.onOptionSelect){const o=a.dialogueConfig.onOptionSelect(e);'boolean'==typeof o&&!1===o&&(t=!1)}if(t){const t=e.text;if(r(t),v(t),a.dialogueConfig.onUserMessage)try{await a.dialogueConfig.onUserMessage(t)}catch(e){console.error('用户消息回调执行失败:',e)}d.value=[],de(),await ce()}else console.log('选项选择被阻止，直接关闭对话'),d.value=[],de(),setTimeout(()=>{me()},100)})(e)},[n[12]||(n[12]=(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1)),(0,o.createElementVNode)('span',Q,(0,o.toDisplayString)(e.text),1),n[13]||(n[13]=(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1))],10,K))),128)),(0,o.createCommentVNode)(' 第四个选项：自定义输入 '),((0,o.unref)(d).length>0||(0,o.unref)(m).length>0)&&!0===e.dialogueConfig.showCustomInput?((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['inline-option custom-option',{disabled:(0,o.unref)(c)}]),onClick:se},[...n[14]||(n[14]=[(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1),(0,o.createElementVNode)('span',{class:'option-content'},'自定义',-1),(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1)])],2)):(0,o.createCommentVNode)('v-if',!0)])])):(0,o.createCommentVNode)('v-if',!0)])])],512)])]),(0,o.createCommentVNode)(' 自定义输入面板 '),(0,o.unref)(ne)&&!0===e.dialogueConfig.showCustomInput?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'custom-input-overlay',onClick:le},[(0,o.createElementVNode)('div',{class:'custom-input-panel',onClick:n[3]||(n[3]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'custom-input-header'},[n[15]||(n[15]=(0,o.createElementVNode)('h3',null,'自定义输入',-1)),(0,o.createElementVNode)('button',{class:'close-panel-btn',onClick:le},'✕')]),(0,o.createElementVNode)('div',X,[(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':n[2]||(n[2]=e=>(0,o.isRef)(f)?f.value=e:null),class:'custom-input-textarea',placeholder:(0,o.unref)(oe),disabled:(0,o.unref)(c),rows:'5',onKeydown:(0,o.withKeys)((0,o.withModifiers)(re,['exact']),['enter'])},null,40,Z),[[o.vModelText,(0,o.unref)(f)]])]),(0,o.createElementVNode)('div',ee,[(0,o.createElementVNode)('button',{class:'submit-btn',disabled:!(0,o.unref)(f).trim()||(0,o.unref)(c),onClick:re},(0,o.toDisplayString)((0,o.unref)(c)?'发送中...':'发送'),9,te)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 编辑对话框 '),(0,o.unref)(ge)>=0?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'edit-dialog-overlay',onClick:ye},[(0,o.createElementVNode)('div',{class:'edit-dialog',onClick:n[5]||(n[5]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'edit-dialog-header'},[n[16]||(n[16]=(0,o.createElementVNode)('h3',null,'编辑消息',-1)),(0,o.createElementVNode)('button',{class:'close-dialog-btn',onClick:ye},'✕')]),(0,o.createElementVNode)('div',ae,[(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':n[4]||(n[4]=e=>(0,o.isRef)(he)?he.value=e:null),class:'edit-textarea',rows:'8',placeholder:'编辑消息内容...'},null,512),[[o.vModelText,(0,o.unref)(he)]])]),(0,o.createElementVNode)('div',{class:'edit-dialog-footer'},[(0,o.createElementVNode)('button',{class:'save-btn',onClick:fe},'保存'),(0,o.createElementVNode)('button',{class:'cancel-btn',onClick:ye},'取消')])])])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' 删除确认框 '),(0,o.createVNode)(y,{show:(0,o.unref)(pe),title:(0,o.unref)(ve).title,message:(0,o.unref)(ve).message,details:(0,o.unref)(ve).details,'confirm-text':(0,o.unref)(ve).confirmText,'cancel-text':(0,o.unref)(ve).cancelText,'show-cancel':(0,o.unref)(ve).showCancel,'show-close':(0,o.unref)(ve).showClose,type:(0,o.unref)(ve).type,onConfirm:be,onCancel:Ne,onClose:Ne},null,8,['show','title','message','details','confirm-text','cancel-text','show-cancel','show-close','type'])],64))}}),ne=oe,se=(0,o.defineComponent)({__name:'事件对话界面',props:{event:{default:void 0},show:{type:Boolean,default:!1}},emits:['close','event-completed'],setup(e,{emit:t}){const a=e,n=t,s=(0,o.ref)(!1),l=(0,o.ref)(!1),r=i.getInstance(),u=(0,o.ref)(''),m=(0,o.computed)(()=>{if(!a.event)return'';const e=u.value?'\n\n✅ 已获取到AI回复内容':'\n\n⚠️ 未获取到AI回复内容，将使用事件基本信息';return`是否将"${a.event.name}"的故事内容保存到世界书中？${e}\n\n这将帮助AI更好地了解游戏世界的发展历程。`}),g=(0,o.computed)(()=>a.event?{...a.event.dialogueConfig,saveKey:`event_${a.event.id}`,onAIReply:async(e,t)=>{console.log('AI回复内容:',e),u.value=e}}:{title:'随机事件',subtitle:'未知事件',welcomeText:'🎭 事件开始',welcomeHint:'一个随机事件发生了...',initialOptions:[{text:'继续',label:'继续',value:'continue'}],saveKey:'random_event'}),h=()=>{s.value=a.show&&!!a.event},p=()=>{a.event&&a.event.dialogueConfig.onDialogueClose&&a.event.dialogueConfig.onDialogueClose(),l.value=!0},v=()=>{s.value=!1,l.value=!1,n('close')},f=async()=>{if(a.event)try{const e=k(),t=b();await _.WorldbookService.createEventStoryRecord(a.event.id,a.event.name,e,t),console.log(`事件故事已保存到世界书: ${a.event.name}`)}catch(e){console.error('保存事件故事到世界书失败:',e)}finally{v()}else v()},b=()=>{const e=c.l.resources.value.rounds;return`${d.Q.getTimeInfo(e,!0).formattedDate}`},N=()=>{v()},E=()=>{if(a.event){const e=r.processEventResult(a.event,'completed');n('event-completed',a.event,e)}p()},k=()=>a.event&&u.value?(console.log('使用AI回复内容作为事件内容:',u.value.substring(0,100)+'...'),u.value):'';return(0,o.onMounted)(()=>{h()}),(0,o.watch)(()=>a.show,h),(0,o.watch)(()=>a.event,h),(e,t)=>s.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'event-dialog-overlay',onClick:v},[(0,o.createElementVNode)('div',{class:'event-dialog',onClick:t[0]||(t[0]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createCommentVNode)(' 使用通用对话界面组件 '),(0,o.createVNode)(ne,{'dialogue-config':g.value,onClose:p,onEndDialogue:E},null,8,['dialogue-config'])]),(0,o.createCommentVNode)(' 世界书保存确认弹窗 '),l.value?((0,o.openBlock)(),(0,o.createBlock)(y,{key:0,show:l.value,title:'保存事件故事',message:m.value,'confirm-text':'保存到世界书','cancel-text':'不保存',onConfirm:f,onCancel:N},null,8,['show','message'])):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0)}}),le=(0,o.defineComponent)({__name:'随机事件管理器',props:{currentRound:{},gameState:{}},emits:['event-triggered','event-completed'],setup(e,{expose:t,emit:a}){const n=e,s=a,l=i.getInstance(),r=(0,o.ref)(null),c=(0,o.ref)(!1),d=e=>{r.value=e,c.value=!0,s('event-triggered',e)},u=()=>{c.value=!1,r.value=null},m=(e,t)=>{console.log('事件完成:',e.name,t),s('event-completed',e,t),u()};return t({checkRoundStartEvents:()=>{try{const e=l.checkRoundStartEvents(n.currentRound,n.gameState);e.triggered&&e.event?(console.log('触发随机事件:',e.event.name),d(e.event)):console.log('未触发随机事件:',e.reason)}catch(e){console.error('检查随机事件失败:',e)}},triggerEvent:d}),(0,o.onMounted)(()=>{console.log('随机事件管理器已初始化')}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',null,[(0,o.createCommentVNode)(' 随机事件对话框 '),r.value?((0,o.openBlock)(),(0,o.createBlock)(se,{key:0,event:r.value,show:c.value,onClose:u,onEventCompleted:m},null,8,['event','show'])):(0,o.createCommentVNode)('v-if',!0)]))}}),re={key:0,class:'history-modal'},ie={class:'modal-content'},ce={class:'history-content'},de={key:0,class:'no-history'},ue={key:1,class:'history-list'},me={class:'history-header'},ge={class:'history-time'},he={class:'history-title'},pe={class:'history-changes'},ve={class:'resource-icon'},fe={class:'resource-name'},ye=(0,o.defineComponent)({__name:'历史记录界面',props:{show:{type:Boolean}},emits:['close'],setup(e,{expose:t,emit:a}){const n=e,s=a,l=(0,o.ref)([]),r=()=>{const e=c.l.getModuleData({moduleName:'history'});e&&(l.value=e.roundHistory)},i=()=>{const e={roundHistory:l.value,maxHistoryEntries:100};c.l.updateModuleData({moduleName:'history',data:e})};(0,o.watch)(()=>n.show,e=>{e&&r()}),(0,o.onMounted)(()=>{r()});const d=e=>({gold:'金钱',food:'食物',threat:'威胁',slaves:'俘虏',time:'时间',rounds:'回合',normalGoblins:'普通哥布林',warriorGoblins:'哥布林战士',shamanGoblins:'哥布林萨满',paladinGoblins:'哥布林圣骑士',trainingSlaves:'调教俘虏'}[e]||e),u=()=>{s('close')};return t({addHistoryEntry:e=>{l.value.unshift(e);l.value.length>100&&(l.value=l.value.slice(0,100)),i()},loadHistoryFromSave:r,saveHistoryToSave:i}),(e,t)=>n.show?((0,o.openBlock)(),(0,o.createElementBlock)('div',re,[(0,o.createElementVNode)('div',{class:'modal-overlay',onClick:u}),(0,o.createElementVNode)('div',ie,[(0,o.createElementVNode)('div',{class:'modal-header'},[t[0]||(t[0]=(0,o.createElementVNode)('h3',{class:'modal-title'},'历史日志',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:u},'×')]),(0,o.createElementVNode)('div',ce,[0===l.value.length?((0,o.openBlock)(),(0,o.createElementBlock)('div',de,[...t[1]||(t[1]=[(0,o.createElementVNode)('div',{class:'no-history-icon'},'📜',-1),(0,o.createElementVNode)('div',{class:'no-history-text'},'暂无回合信息',-1),(0,o.createElementVNode)('div',{class:'no-history-hint'},'点击"结束回合"开始游戏',-1)])])):((0,o.openBlock)(),(0,o.createElementBlock)('div',ue,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(l.value,(e,t)=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'history-item'},[(0,o.createElementVNode)('div',me,[(0,o.createElementVNode)('div',ge,(0,o.toDisplayString)((a=e.timestamp,new Date(a).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}))),1),(0,o.createElementVNode)('div',he,(0,o.toDisplayString)(e.title),1)]),(0,o.createElementVNode)('div',pe,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.changes,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.type,class:(0,o.normalizeClass)(['history-change',e.amount>0?'positive':'negative'])},[(0,o.createElementVNode)('span',ve,(0,o.toDisplayString)((t=e.type,{gold:'💰',food:'🍖',threat:'⚠️',slaves:'🔒',time:'⏰',rounds:'🔄',normalGoblins:'👹',warriorGoblins:'⚔️',shamanGoblins:'🔮',paladinGoblins:'🛡️',trainingSlaves:'🔒'}[t]||'❓')),1),(0,o.createElementVNode)('span',fe,(0,o.toDisplayString)(d(e.type)),1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['change-amount',e.amount>0?'positive':'negative'])},(0,o.toDisplayString)(e.amount>0?'+':'')+(0,o.toDisplayString)(e.amount),3)],2);var t}),128))])]);var a}),128))]))])])])):(0,o.createCommentVNode)('v-if',!0)}}),be=(0,f.A)(ye,[['__scopeId','data-v-30acccdb']]),Ne={key:0,class:'save-load-modal'},Ee={class:'modal-content'},ke={class:'save-slots'},Se={class:'slot-header'},Ve={class:'slot-number'},Ce={class:'slot-time'},we={key:0,class:'slot-info'},xe={class:'resource-info'},De={class:'resource-item'},$e={class:'resource-value'},Be={class:'resource-item'},Ae={class:'resource-value'},Te={class:'resource-item'},Me={class:'resource-value'},Re={class:'resource-item'},_e={class:'resource-value'},Ge={class:'slot-actions'},Ie=['onClick'],Oe=['onClick'],Pe={key:1,class:'empty-slot'},Le=['onClick'],Ue=(0,o.defineComponent)({__name:'存档界面',props:{show:{type:Boolean,default:!1},currentResources:{default:()=>({gold:0,food:0,threat:0,slaves:0,normalGoblins:0,warriorGoblins:0,shamanGoblins:0,paladinGoblins:0,trainingSlaves:0,rounds:0,actionPoints:3,maxActionPoints:3,conqueredRegions:0})},currentGameState:{default:null},latestRoundInfo:{default:null},roundHistory:{default:()=>[]}},emits:['close','save','load','error'],setup(e,{emit:t}){const a=e,n=t,s=(0,o.ref)(a.show),l=(0,o.ref)([]),r=(0,o.ref)(!1);(0,o.watch)(()=>a.show,e=>{s.value=e,e&&i()});const i=async()=>{try{r.value||(await c.l.init(),r.value=!0);const e=await c.l.getAllSlots();console.log('获取到的存档槽位:',e),l.value=e}catch(e){console.error('加载存档槽位失败:',e),n('error','加载存档槽位失败')}},d=async e=>{try{c.l.getCurrentGameData()||c.l.createNewGame(),a.currentResources&&c.l.updateBaseResources(a.currentResources);await c.l.saveCurrentGameData(e,`存档 ${e}`)?(await i(),n('save',e)):n('error',`保存到槽位 ${e} 失败`)}catch(e){n('error',`保存失败: ${e}`)}};(0,o.onMounted)(async()=>{});const u=()=>{s.value=!1,n('close')};return(e,t)=>s.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ne,[(0,o.createElementVNode)('div',{class:'modal-overlay',onClick:u}),(0,o.createElementVNode)('div',Ee,[(0,o.createElementVNode)('div',{class:'modal-header'},[t[0]||(t[0]=(0,o.createElementVNode)('h3',{class:'modal-title'},'存档管理',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:u},'×')]),(0,o.createElementVNode)('div',ke,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(l.value,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.slot,class:(0,o.normalizeClass)(['save-slot',{'has-save':e.timestamp>0,empty:0===e.timestamp,'auto-save':0===e.slot&&e.timestamp>0}])},[(0,o.createElementVNode)('div',Se,[(0,o.createElementVNode)('span',Ve,(0,o.toDisplayString)(0===e.slot?'自动存档':`槽位 ${e.slot}`),1),(0,o.createElementVNode)('span',Ce,(0,o.toDisplayString)((a=e.timestamp,c.l.formatTime(a))),1)]),e.timestamp>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',we,[(0,o.createElementVNode)('div',xe,[(0,o.createElementVNode)('div',De,[t[1]||(t[1]=(0,o.createElementVNode)('span',{class:'resource-icon'},'🔄',-1)),(0,o.createElementVNode)('span',$e,(0,o.toDisplayString)(e.data?.baseResources?.rounds||0),1)]),(0,o.createElementVNode)('div',Be,[t[2]||(t[2]=(0,o.createElementVNode)('span',{class:'resource-icon'},'💰',-1)),(0,o.createElementVNode)('span',Ae,(0,o.toDisplayString)(e.data?.baseResources?.gold||0),1)]),(0,o.createElementVNode)('div',Te,[t[3]||(t[3]=(0,o.createElementVNode)('span',{class:'resource-icon'},'🍖',-1)),(0,o.createElementVNode)('span',Me,(0,o.toDisplayString)(e.data?.baseResources?.food||0),1)]),(0,o.createElementVNode)('div',Re,[t[4]||(t[4]=(0,o.createElementVNode)('span',{class:'resource-icon'},'💋',-1)),(0,o.createElementVNode)('span',_e,(0,o.toDisplayString)(e.data?.baseResources?.trainingSlaves||0),1)])]),(0,o.createElementVNode)('div',Ge,[(0,o.createElementVNode)('button',{class:'action-btn load-action',onClick:t=>(async e=>{try{const t=await c.l.loadFromSlot({slot:e});t?(n('load',e,t),u()):n('error',`槽位 ${e} 没有存档`)}catch(e){n('error',`读取失败: ${e}`)}})(e.slot)},[...t[5]||(t[5]=[(0,o.createElementVNode)('span',{class:'icon'},'📂',-1),(0,o.createElementVNode)('span',{class:'text'},'读取',-1)])],8,Ie),0!==e.slot?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'action-btn save-action',onClick:t=>d(e.slot)},[...t[6]||(t[6]=[(0,o.createElementVNode)('span',{class:'icon'},'💾',-1),(0,o.createElementVNode)('span',{class:'text'},'保存',-1)])],8,Oe)):(0,o.createCommentVNode)('v-if',!0)])])):((0,o.openBlock)(),(0,o.createElementBlock)('div',Pe,[t[8]||(t[8]=(0,o.createElementVNode)('div',{class:'empty-icon'},'📁',-1)),t[9]||(t[9]=(0,o.createElementVNode)('div',{class:'empty-text'},'空槽位',-1)),(0,o.createElementVNode)('button',{class:'action-btn save-action',onClick:t=>d(e.slot)},[...t[7]||(t[7]=[(0,o.createElementVNode)('span',{class:'icon'},'💾',-1),(0,o.createElementVNode)('span',{class:'text'},'保存',-1)])],8,Le)]))],2);var a}),128))])])])):(0,o.createCommentVNode)('v-if',!0)}}),Fe=(0,f.A)(Ue,[['__scopeId','data-v-dee4d05e']]);class He{static getMaxLevelFromMyCharacters(){try{const e=c.l.getCurrentGameData();if(!e)return 1;const t=e.training.characters.filter(e=>'player'!==e.status&&'enemy'!==e.status&&'uncaptured'!==e.status);if(0===t.length)return 1;const a=Math.max(...t.map(e=>Math.floor(e.offspring/10)));return Math.max(1,a)}catch(e){return console.error('计算我方最高等级失败:',e),1}}static updatePlayerLevel(){try{const e=c.l.getCurrentGameData();if(!e)return;const t=e.training.characters.find(e=>'player-1'===e.id);if(t){const a=this.getMaxLevelFromMyCharacters();t.level=a,c.l.updateModuleData({moduleName:'training',data:e.training}),console.log(`玩家角色等级已更新为: ${a}`)}}catch(e){console.error('更新玩家角色等级失败:',e)}}static getPlayerLevel(){try{const e=c.l.getCurrentGameData();if(!e)return 1;const t=e.training.characters.find(e=>'player-1'===e.id);return t?.level||1}catch(e){return console.error('获取玩家角色等级失败:',e),1}}static checkAndUpdatePlayerLevel(){const e=this.getPlayerLevel();this.getMaxLevelFromMyCharacters()>e&&this.updatePlayerLevel()}}class qe{static calculateBreeding(e,t){const a=[];let o=0;const n=Math.floor(e.loyalty/25)+Math.floor(e.fertility/40),s='S'===e.rating||'A'===e.rating,l=s||['B','C','D'].includes(e.rating),r=this.calculateGoblinCount(5,10,n);if(r>0&&(a.push({type:'普通哥布林',count:r,date:new Date,round:t}),o+=r),l){const e=this.calculateGoblinCount(3,5,n);e>0&&(a.push({type:'哥布林战士',count:e,date:new Date,round:t}),o+=e)}if(s){const e=this.calculateGoblinCount(2,4,n);e>0&&(a.push({type:'哥布林萨满',count:e,date:new Date,round:t}),o+=e)}if(s){const e=this.calculateGoblinCount(1,3,n);e>0&&(a.push({type:'哥布林圣骑士',count:e,date:new Date,round:t}),o+=e)}return{characterId:e.id,characterName:e.name,totalOffspring:o,records:a}}static calculateGoblinCount(e,t,a){const o=Math.floor(Math.random()*(t-e+1))+e,n=Math.floor(a/2);return Math.max(0,o+n)}static getBreedingPermissions(e){switch(e){case'S':case'A':return'可生育：普通哥布林、哥布林战士、哥布林萨满、哥布林圣骑士';case'B':case'C':case'D':return'可生育：普通哥布林、哥布林战士';default:return'可生育：普通哥布林'}}static formatBreedingRecords(e){return 0===e.length?'无生育记录':e.map(e=>`${e.type} x${e.count}`).join('、')}static getBreedingStats(e){const t={普通哥布林:0,哥布林战士:0,哥布林萨满:0,哥布林圣骑士:0};return e.forEach(e=>{t[e.type]+=e.count}),t}static processSlaveBreeding(e,t){if(e<=0)return{newGoblins:0,deadSlaves:0,remainingSlaves:0,messages:['没有奴隶，无法生育']};const a=[],o=e*(Math.floor(3*Math.random())+2),n=100*(.3*Math.random()+.4),s=Math.floor(e*n/100),l=e-s;return a.push(`奴隶们生育了 ${o} 个普通哥布林`),a.push(`${s} 个奴隶死亡 (死亡率: ${n.toFixed(1)}%)`),a.push(`剩余奴隶: ${l} 个`),{newGoblins:o,deadSlaves:s,remainingSlaves:l,messages:a}}static formatSlaveBreedingResult(e){return e.messages.join('；')}}const Je=(0,o.ref)({show:!1,title:'提示',message:'',confirmText:'确定',cancelText:'取消',showCancel:!0,showClose:!0,type:'info'});class ze{static showInfo(e,t='提示',a){return new Promise(o=>{Je.value={show:!0,title:t,message:e,details:a,confirmText:'确定',cancelText:'',showCancel:!1,showClose:!0,type:'info',resolve:()=>{Je.value.show=!1,o()}}})}static showSuccess(e,t='成功',a){return new Promise(o=>{Je.value={show:!0,title:t,message:e,details:a,confirmText:'确定',cancelText:'',showCancel:!1,showClose:!0,type:'success',resolve:()=>{Je.value.show=!1,o()}}})}static showWarning(e,t='警告',a){return new Promise(o=>{Je.value={show:!0,title:t,message:e,details:a,confirmText:'确定',cancelText:'取消',showCancel:!0,showClose:!0,type:'warning',resolve:e=>{Je.value.show=!1,o(e)}}})}static showDanger(e,t='危险操作',a){return new Promise(o=>{Je.value={show:!0,title:t,message:e,details:a,confirmText:'确认执行',cancelText:'取消',showCancel:!0,showClose:!0,type:'danger',resolve:e=>{Je.value.show=!1,o(e)}}})}static showConfirm(e){return new Promise(t=>{Je.value={show:!0,title:e.title||'确认',message:e.message,details:e.details,confirmText:e.confirmText||'确定',cancelText:e.cancelText||'取消',showCancel:!1!==e.showCancel,showClose:!1!==e.showClose,type:e.type||'info',resolve:e=>{Je.value.show=!1,t(e)}}})}static handleConfirm(){Je.value.resolve&&Je.value.resolve(!0)}static handleCancel(){Je.value.resolve&&Je.value.resolve(!1)}static handleClose(){Je.value.resolve&&Je.value.resolve(!1)}static getState(){return Je}}const We={class:'mini-goblin'},je={key:0,class:'decorative-border'},Ye={class:'content-wrapper'},Ke={class:'stats-container'},Qe={class:'stats-row'},Xe={class:'stats-card time-info'},Ze={class:'time-content'},et={class:'date'},tt={class:'season'},at={class:'stats-row'},ot={class:'stats-card'},nt={class:'stat-item'},st={class:'value'},lt={class:'stats-card'},rt={class:'stat-item'},it={class:'value'},ct={class:'action-points-row'},dt={class:'action-points-card'},ut={class:'action-points-display'},mt={class:'resources-grid eight-columns'},gt={class:'resource-item'},ht={class:'resource-value'},pt={class:'resource-item'},vt={class:'resource-value'},ft={class:'resource-item'},yt={class:'resource-value'},bt={class:'resource-item'},Nt={class:'resource-value'},Et={class:'resource-item'},kt={class:'resource-value'},St={class:'resource-item'},Vt={class:'resource-value'},Ct={class:'resource-item'},wt={class:'resource-value'},xt={class:'resource-item'},Dt={class:'resource-value'},$t={class:'action-buttons'},Bt={class:'info-display'},At={class:'info-content'},Tt={key:0,class:'round-summary'},Mt={class:'round-title'},Rt={class:'resource-changes'},_t={class:'resource-icon'},Gt={class:'resource-name'},It={key:1,class:'no-round-info'},Ot={class:'bottom-nav'},Pt=(0,o.defineComponent)({__name:'app',setup(e){const t=(0,n.useRoute)(),s=(0,o.computed)(()=>c.l.resources.value),l=(0,o.computed)(()=>s.value.gold),r=(0,o.computed)(()=>s.value.food),i=(0,o.computed)(()=>s.value.threat),u=(0,o.computed)(()=>s.value.slaves),m=(0,o.computed)(()=>s.value.normalGoblins),g=(0,o.computed)(()=>s.value.warriorGoblins),h=(0,o.computed)(()=>s.value.shamanGoblins),p=(0,o.computed)(()=>s.value.paladinGoblins),v=(0,o.computed)(()=>s.value.trainingSlaves),f=(0,o.computed)(()=>s.value.maxActionPoints),b=(0,o.computed)(()=>s.value.actionPoints);let N=null;const E=(0,o.computed)(()=>c.l.resources.value.rounds),k=(0,o.computed)(()=>{const e=c.l.resources.value.rounds||0;return d.Q.getTimeInfo(e,!1).formattedDate}),S=(0,o.computed)(()=>{const e=c.l.resources.value.rounds||0;return d.Q.getTimeInfo(e,!0).season||'春季'}),V=(0,o.computed)(()=>({resources:s.value,threat:s.value.threat,rounds:s.value.rounds})),C=(0,o.ref)(),w=e=>{console.log('随机事件触发:',e.name)},x=(e,t)=>{console.log('随机事件完成:',e.name,t)};function D(){const e=document.querySelector('.mini-goblin');document.fullscreenElement?document.exitFullscreen():e?.requestFullscreen().catch(e=>{console.error(`Error attempting to enable fullscreen: ${e}`)})}const B=(0,o.ref)(null),A=(0,o.ref)(!1),T=(0,o.ref)(!1),M=(0,o.ref)(null),R=(0,o.ref)(!1),G=(0,o.ref)(null),I=async()=>{try{if(T.value)return;await c.l.init();const e={gold:c.l.resources.value.gold||0,food:c.l.resources.value.food||0,slaves:c.l.resources.value.slaves||0,normalGoblins:c.l.resources.value.normalGoblins||0,warriorGoblins:c.l.resources.value.warriorGoblins||0,shamanGoblins:c.l.resources.value.shamanGoblins||0,paladinGoblins:c.l.resources.value.paladinGoblins||0,trainingSlaves:c.l.resources.value.trainingSlaves||0,rounds:c.l.resources.value.rounds||0,threat:c.l.resources.value.threat||0,actionPoints:c.l.resources.value.actionPoints||3,maxActionPoints:c.l.resources.value.maxActionPoints||3,conqueredRegions:c.l.resources.value.conqueredRegions||0};await _.WorldbookService.initializeResourcesWorldbook(e),console.log('资源世界书条目初始化完成'),T.value=!0,console.log('存档系统初始化完成')}catch(e){console.error('存档系统初始化失败:',e)}},O=()=>{try{let e=c.l.getCurrentGameData();e||(c.l.createNewGame(),e=c.l.getCurrentGameData()),c.l.updateBaseResources({gold:c.l.resources.value.gold,food:c.l.resources.value.food,threat:c.l.resources.value.threat,slaves:c.l.resources.value.slaves,normalGoblins:c.l.resources.value.normalGoblins,warriorGoblins:c.l.resources.value.warriorGoblins,shamanGoblins:c.l.resources.value.shamanGoblins,paladinGoblins:c.l.resources.value.paladinGoblins,trainingSlaves:c.l.resources.value.trainingSlaves,rounds:c.l.resources.value.rounds,actionPoints:c.l.resources.value.actionPoints,maxActionPoints:c.l.resources.value.maxActionPoints,conqueredRegions:c.l.resources.value.conqueredRegions}),console.log('游戏状态已保存到模块化系统')}catch(e){console.error('保存游戏状态失败:',e)}},P=()=>{A.value=!0},L=async e=>{try{console.log(`保存到槽位 ${e}`),T.value||await I(),O();await c.l.saveCurrentGameData(e,`存档 ${e}`)?console.log(`游戏已保存到槽位 ${e}`):console.error(`保存到槽位 ${e} 失败`)}catch(e){console.error('保存游戏失败:',e)}},U=async(e,t)=>{try{console.log(`从槽位 ${e} 读取:`,t),T.value||await I();const n=await c.l.loadFromSlot({slot:e});if(n){(o=n.baseResources)&&(c.l.setResource('gold',o.gold),c.l.setResource('food',o.food),c.l.setResource('threat',o.threat),c.l.setResource('slaves',o.slaves),c.l.setResource('normalGoblins',o.normalGoblins),c.l.setResource('warriorGoblins',o.warriorGoblins),c.l.setResource('shamanGoblins',o.shamanGoblins),c.l.setResource('paladinGoblins',o.paladinGoblins),c.l.setResource('trainingSlaves',o.trainingSlaves),c.l.setResource('rounds',o.rounds),c.l.setResource('actionPoints',o.actionPoints||3),c.l.setResource('maxActionPoints',o.maxActionPoints||3),c.l.setResource('conqueredRegions',o.conqueredRegions||0),console.log('基础资源已恢复'));const t=n.exploration;if(t){const{exploreService:e}=await Promise.resolve().then(a.bind(a,208));await e.restoreFromSaveData(t),console.log('探索数据已恢复')}const s=c.l.getModuleData({moduleName:'history'});if(s&&s.roundHistory&&s.roundHistory.length>0){const e=s.roundHistory[0];M.value=e,console.log('最后一个回合信息已恢复:',e)}else M.value=null,console.log('没有历史记录，清空回合信息显示');console.log(`游戏已从槽位 ${e} 加载`)}A.value=!1}catch(e){console.error('加载游戏失败:',e)}var o},F=async e=>{console.error('存档错误:',e),await ze.showDanger(e,'存档错误','请检查存档文件是否损坏或权限是否足够')},H=()=>{A.value=!1},q=async()=>{try{console.log('开始新游戏...'),T.value||await I(),c.l.resetResources(),c.l.createNewGame(),B.value=null,M.value=null;const{exploreService:e}=await Promise.resolve().then(a.bind(a,208));e.resetExploreData(),console.log('探索数据已初始化'),O();const t={gold:c.l.resources.value.gold||0,food:c.l.resources.value.food||0,slaves:c.l.resources.value.slaves||0,normalGoblins:c.l.resources.value.normalGoblins||0,warriorGoblins:c.l.resources.value.warriorGoblins||0,shamanGoblins:c.l.resources.value.shamanGoblins||0,paladinGoblins:c.l.resources.value.paladinGoblins||0,trainingSlaves:c.l.resources.value.trainingSlaves||0,rounds:c.l.resources.value.rounds||0,threat:c.l.resources.value.threat||0,actionPoints:c.l.resources.value.actionPoints||3,maxActionPoints:c.l.resources.value.maxActionPoints||3,conqueredRegions:c.l.resources.value.conqueredRegions||0};await _.WorldbookService.initializeResourcesWorldbook(t),console.log('新游戏资源世界书条目初始化完成'),console.log('新游戏开始完成')}catch(e){console.error('开始新游戏失败:',e)}},J=()=>{R.value=!0},W=()=>{R.value=!1},j=e=>({gold:'金钱',food:'食物',threat:'威胁',slaves:'俘虏',normalGoblins:'普通哥布林',warriorGoblins:'战士哥布林',shamanGoblins:'萨满哥布林',paladinGoblins:'圣骑士哥布林',trainingSlaves:'调教人物',rounds:'回合'}[e]||e),Y=e=>({S:3,A:2.5,B:2,C:1.5,D:1}[e]||1),K=async()=>{try{console.log('开始处理回合结束...');const e=(()=>{try{const e=c.l.getModuleData({moduleName:'training'});if(!e||!e.characters)return;const t=e.characters;let a=!1;const o=[];return t.forEach(e=>{if('imprisoned'===e.status||'surrendered'===e.status||'deployed'===e.status){const t=Y(e.rating||'D'),o=Math.floor(e.loyalty/20),n=10*t+o,s=10*t+o,l=e.maxStamina||200,r=e.maxFertility||200;e.stamina=Math.min(l,e.stamina+n),e.fertility=Math.min(r,e.fertility+s),a=!0}else if('player'===e.status){const t=10*Y(e.rating||'D')+Math.floor(e.loyalty/30),o=e.maxStamina||200;e.stamina=Math.min(o,e.stamina+t),a=!0}else if('training'===e.status)e.loyalty=Math.min(100,e.loyalty+Math.floor(10*Math.random())+5),e.loyalty>=100?(console.log(`${e.name} 调教完成，堕落值已满，可以手动触发堕落！`),e.status='imprisoned'):(e.status='imprisoned',console.log(`${e.name} 调教完成，忠诚度提升`)),a=!0;else if('breeding'===e.status){const t=c.l.resources.value.rounds||1,n=qe.calculateBreeding(e,t);e.offspring+=n.totalOffspring;const s=(e=>{switch(e){case'S':return.5;case'A':return.7;case'B':return.8;case'C':return.9;default:return 1}})(e.rating||'D'),l='surrendered'===e.status?.5:1,r=3*n.totalOffspring*s,i=Math.ceil(r*l);e.fertility=Math.max(0,e.fertility-i);const d='surrendered'===e.status?'已堕落(-50%)':'';console.log(`${e.name} 生育${n.totalOffspring}个后代，评级${e.rating||'D'}(×${s})${d}，消耗生育值 ${i} 点，当前生育值: ${e.fertility}`);const u=Math.floor(3*Math.random())+1;e.loyalty=Math.min(100,e.loyalty+u),console.log(`${e.name} 生育过程中堕落值增加 ${u} 点，当前堕落值: ${e.loyalty}`),e.status='imprisoned',console.log(`${e.name} 生育完成，回到关押状态`),e.locationId=void 0,e.breedingRecords||(e.breedingRecords=[]),e.breedingRecords.push(...n.records),He.checkAndUpdatePlayerLevel(),n.records.forEach(t=>{switch(t.type){case'普通哥布林':c.l.addResource('normalGoblins',t.count,`${e.name} 生育了 ${t.count} 个普通哥布林`);break;case'哥布林战士':c.l.addResource('warriorGoblins',t.count,`${e.name} 生育了 ${t.count} 个哥布林战士`);break;case'哥布林萨满':c.l.addResource('shamanGoblins',t.count,`${e.name} 生育了 ${t.count} 个哥布林萨满`);break;case'哥布林圣骑士':c.l.addResource('paladinGoblins',t.count,`${e.name} 生育了 ${t.count} 个哥布林圣骑士`)}}),o.push({characterName:e.name,totalOffspring:n.totalOffspring,records:n.records,rating:e.rating||'D'}),a=!0,console.log(`${e.name} 交配完成，生育了 ${n.totalOffspring} 个哥布林`),console.log('生育详情:',qe.formatBreedingRecords(n.records))}}),a&&(c.l.updateModuleData({moduleName:'training',data:e}),console.log('人物回合逻辑处理完成')),o}catch(e){return console.error('处理人物回合逻辑失败:',e),[]}})(),t=c.l.processNestIncome();console.log('巢穴收入处理结果:',t);const a=c.l.resources.value.slaves||0,o=c.l.resources.value.rounds||0,n=qe.processSlaveBreeding(a,o);console.log('奴隶生育结果:',n),n.deadSlaves>0&&c.l.consumeResource('slaves',n.deadSlaves,'奴隶死亡'),n.newGoblins>0&&c.l.addResource('normalGoblins',n.newGoblins,'奴隶生育'),c.l.addResource('rounds',1,'回合结束');const s=c.l.resources.value.maxActionPoints;c.l.setResource('actionPoints',s),console.log(`行动力已恢复到上限: ${s}`),(()=>{const e=document.querySelector('.time-content');e&&(e.classList.add('date-updated'),setTimeout(()=>{e.classList.remove('date-updated')},1e3))})();const l=Q(t.changes);if(n.deadSlaves>0&&l.push({type:'slaves',amount:-n.deadSlaves,reason:'奴隶死亡'}),e&&e.length>0){const t={S:5,A:4,B:3,C:2,D:1};e.sort((e,a)=>(t[a.rating]||0)-(t[e.rating]||0));const a=e.slice(0,2),o={};a.forEach(e=>{e.records.forEach(e=>{const t={普通哥布林:'normalGoblins',哥布林战士:'warriorGoblins',哥布林萨满:'shamanGoblins',哥布林圣骑士:'paladinGoblins'}[a=e.type]||a;var a;o[t]=(o[t]||0)+e.count})}),n.newGoblins>0&&(o.normalGoblins=(o.normalGoblins||0)+n.newGoblins),Object.entries(o).forEach(([e,t])=>{l.push({type:e,amount:t})})}else n.newGoblins>0&&l.push({type:'normalGoblins',amount:n.newGoblins,reason:'奴隶生育'});let r=`第${c.l.resources.value.rounds-1}回合结束`;const i=[];if(e&&e.length>0){const t=e.slice(0,2).map(e=>e.characterName).join('、');i.push(`${t} 生育了哥布林`)}else n.newGoblins>0&&i.push(`奴隶生育了 ${n.newGoblins} 个哥布林`);i.length>0&&(r+=` (${i.join('；')})`);const d={title:r,changes:l,timestamp:Date.now()};M.value=d,G.value&&G.value.addHistoryEntry(d),O(),console.log('开始同步繁殖间占用信息...');try{(()=>{try{const e=[],t=c.l.getModuleData({moduleName:'training'});t&&t.characters&&t.characters.forEach(t=>{t.locationId&&t.locationId.startsWith('breeding-')&&e.push({roomId:t.locationId,characterId:t.id,characterName:t.name,status:'breeding'===t.status?'breeding':'imprisoned',occupiedAt:new Date})});const a=c.l.getModuleData({moduleName:'nest'});c.l.updateModuleData({moduleName:'nest',data:{...a,breedingRoomInfo:e}}),console.log('繁殖间占用信息已同步到巢穴模块:',e)}catch(e){console.error('同步繁殖间信息失败:',e)}})(),console.log('繁殖间占用信息同步完成')}catch(e){console.error('同步繁殖间占用信息失败:',e)}console.log('开始更新世界书状态...');try{console.log('开始更新资源世界书...');const e={gold:c.l.resources.value.gold||0,food:c.l.resources.value.food||0,slaves:c.l.resources.value.slaves||0,normalGoblins:c.l.resources.value.normalGoblins||0,warriorGoblins:c.l.resources.value.warriorGoblins||0,shamanGoblins:c.l.resources.value.shamanGoblins||0,paladinGoblins:c.l.resources.value.paladinGoblins||0,trainingSlaves:c.l.resources.value.trainingSlaves||0,rounds:c.l.resources.value.rounds||0,threat:c.l.resources.value.threat||0,actionPoints:c.l.resources.value.actionPoints||3,maxActionPoints:c.l.resources.value.maxActionPoints||3,conqueredRegions:c.l.resources.value.conqueredRegions||0};await _.WorldbookService.updateResourcesWorldbook(e),console.log('资源世界书更新完成')}catch(e){console.error('更新资源世界书失败:',e)}console.log('人物世界书状态已通过调教界面自动同步'),console.log('检查回合开始随机事件...'),C.value&&C.value.checkRoundStartEvents(),console.log('回合结束处理完成')}catch(e){console.error('结束回合失败:',e),M.value={title:'回合结束失败',changes:[],timestamp:Date.now()}}},Q=e=>{const t={};return e.forEach(e=>{t[e.type]?t[e.type]+=e.amount:t[e.type]=e.amount}),Object.entries(t).map(([e,t])=>({type:e,amount:t}))};return(0,o.onMounted)(async()=>{await I();try{console.log('界面重载：开始清理世界书...'),await _.WorldbookService.clearCharacterAndStoryEntries(),console.log('已清空所有人物档案和剧情记录世界书条目');const e={gold:c.l.resources.value.gold||0,food:c.l.resources.value.food||0,slaves:c.l.resources.value.slaves||0,normalGoblins:c.l.resources.value.normalGoblins||0,warriorGoblins:c.l.resources.value.warriorGoblins||0,shamanGoblins:c.l.resources.value.shamanGoblins||0,paladinGoblins:c.l.resources.value.paladinGoblins||0,trainingSlaves:c.l.resources.value.trainingSlaves||0,rounds:c.l.resources.value.rounds||0,threat:c.l.resources.value.threat||0,actionPoints:c.l.resources.value.actionPoints||3,maxActionPoints:c.l.resources.value.maxActionPoints||3,conqueredRegions:c.l.resources.value.conqueredRegions||0};await _.WorldbookService.updateResourcesWorldbook(e),console.log('资源世界书已更新到初始状态')}catch(e){console.error('清理世界书失败:',e)}(()=>{try{console.log('建筑数据初始化已由数据库系统处理')}catch(e){console.error('初始化建筑数据失败:',e)}})(),N&&clearInterval(N),N=setInterval(async()=>{try{T.value&&(await c.l.saveCurrentGameData(0,'自动存档'),console.log('自动保存完成'))}catch(e){console.error('自动保存失败:',e)}},3e4),(0,o.onUnmounted)(()=>{N&&(clearInterval(N),N=null)}),null!==c.l.getCurrentGameData()?console.log('检测到保存的游戏数据'):console.log('开始新游戏')}),(0,o.onUnmounted)(()=>{O()}),(e,a)=>{const n=(0,o.resolveComponent)('router-view'),s=(0,o.resolveComponent)('router-link');return(0,o.openBlock)(),(0,o.createElementBlock)('div',We,[(0,o.createCommentVNode)(' 首页内容 '),'/'===(0,o.unref)(t).path?((0,o.openBlock)(),(0,o.createElementBlock)('div',je,[(0,o.createElementVNode)('div',Ye,[(0,o.createElementVNode)('header',{class:'header'},[a[2]||(a[2]=(0,o.createElementVNode)('h1',{class:'main-title'},'哥布林巢穴',-1)),(0,o.createElementVNode)('button',{class:'fullscreen-btn',onClick:D},[...a[1]||(a[1]=[(0,o.createElementVNode)('span',{class:'icon'},'⛶',-1)])])]),(0,o.createCommentVNode)(' 统计信息 '),(0,o.createElementVNode)('section',Ke,[(0,o.createCommentVNode)(' 时间和季节信息 '),(0,o.createElementVNode)('div',Qe,[(0,o.createElementVNode)('div',Xe,[(0,o.createElementVNode)('div',Ze,[(0,o.createElementVNode)('div',et,(0,o.toDisplayString)(k.value),1),(0,o.createElementVNode)('div',tt,'🍂 '+(0,o.toDisplayString)(S.value),1)])])]),(0,o.createCommentVNode)(' 回合数和威胁度并列一行 '),(0,o.createElementVNode)('div',at,[(0,o.createElementVNode)('div',ot,[(0,o.createElementVNode)('div',nt,[a[3]||(a[3]=(0,o.createElementVNode)('span',{class:'icon'},'🔄',-1)),(0,o.createElementVNode)('div',st,'第'+(0,o.toDisplayString)(E.value)+'回合',1)])]),(0,o.createElementVNode)('div',lt,[(0,o.createElementVNode)('div',rt,[a[4]||(a[4]=(0,o.createElementVNode)('span',{class:'icon'},'⚠️',-1)),(0,o.createElementVNode)('div',it,'威胁度 '+(0,o.toDisplayString)(i.value),1)])])]),(0,o.createCommentVNode)(' 行动力显示 '),(0,o.createElementVNode)('div',ct,[(0,o.createElementVNode)('div',dt,[(0,o.createElementVNode)('div',ut,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(f.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:e,class:(0,o.normalizeClass)(['action-point',{filled:e<=b.value}])},(0,o.toDisplayString)(e<=b.value?'❤️':'🤍'),3))),128)),(0,o.createCommentVNode)(' 其他emoji组合选择：\n                    火焰系：🔥 / 🌫️\n                    宝石系：💎 / ⬜ (当前)\n                    能量系：⚡ / ⚪\n                    魔法系：🔮 / ⭕\n                    心系：❤️ / 🤍\n                    太阳系：☀️ / ⚫\n                    剑系：⚔️ / ⬛\n                    盾系：🛡️ / ⬜\n                  ')])])]),(0,o.createCommentVNode)(' 所有资源 - 八个并列 '),(0,o.createElementVNode)('div',mt,[(0,o.createElementVNode)('div',gt,[a[5]||(a[5]=(0,o.createElementVNode)('div',{class:'resource-icon'},'💰',-1)),(0,o.createElementVNode)('div',ht,(0,o.toDisplayString)(l.value),1)]),(0,o.createElementVNode)('div',pt,[a[6]||(a[6]=(0,o.createElementVNode)('div',{class:'resource-icon'},'🍖',-1)),(0,o.createElementVNode)('div',vt,(0,o.toDisplayString)(r.value),1)]),(0,o.createElementVNode)('div',ft,[a[7]||(a[7]=(0,o.createElementVNode)('div',{class:'resource-icon'},'🔒',-1)),(0,o.createElementVNode)('div',yt,(0,o.toDisplayString)(u.value),1)]),(0,o.createElementVNode)('div',bt,[a[8]||(a[8]=(0,o.createElementVNode)('div',{class:'resource-icon'},'💋',-1)),(0,o.createElementVNode)('div',Nt,(0,o.toDisplayString)(v.value),1)]),(0,o.createElementVNode)('div',Et,[a[9]||(a[9]=(0,o.createElementVNode)('div',{class:'resource-icon'},'👺',-1)),(0,o.createElementVNode)('div',kt,(0,o.toDisplayString)(m.value),1)]),(0,o.createElementVNode)('div',St,[a[10]||(a[10]=(0,o.createElementVNode)('div',{class:'resource-icon'},'⚔️',-1)),(0,o.createElementVNode)('div',Vt,(0,o.toDisplayString)(g.value),1)]),(0,o.createElementVNode)('div',Ct,[a[11]||(a[11]=(0,o.createElementVNode)('div',{class:'resource-icon'},'🔮',-1)),(0,o.createElementVNode)('div',wt,(0,o.toDisplayString)(h.value),1)]),(0,o.createElementVNode)('div',xt,[a[12]||(a[12]=(0,o.createElementVNode)('div',{class:'resource-icon'},'✨',-1)),(0,o.createElementVNode)('div',Dt,(0,o.toDisplayString)(p.value),1)])])]),(0,o.createCommentVNode)(' 操作按钮区域 '),(0,o.createElementVNode)('div',$t,[(0,o.createElementVNode)('button',{class:'action-btn save-load-btn',title:'存档管理',onClick:P},[...a[13]||(a[13]=[(0,o.createElementVNode)('span',{class:'icon'},'💾',-1),(0,o.createElementVNode)('span',{class:'text'},'存档管理',-1)])]),(0,o.createElementVNode)('button',{class:'action-btn round-btn',title:'结束回合',onClick:a[0]||(a[0]=()=>K())},[...a[14]||(a[14]=[(0,o.createElementVNode)('span',{class:'icon'},'⏭️',-1),(0,o.createElementVNode)('span',{class:'text'},'结束回合',-1)])])]),(0,o.createCommentVNode)(' 信息显示区域 '),(0,o.createElementVNode)('div',Bt,[(0,o.createElementVNode)('div',{class:'info-header'},[a[16]||(a[16]=(0,o.createElementVNode)('span',{class:'info-title'},'回合信息',-1)),(0,o.createElementVNode)('button',{class:'history-btn',title:'查看历史日志',onClick:J},[...a[15]||(a[15]=[(0,o.createElementVNode)('span',{class:'icon'},'📜',-1)])])]),(0,o.createElementVNode)('div',At,[M.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Tt,[(0,o.createElementVNode)('div',Mt,(0,o.toDisplayString)(M.value.title),1),(0,o.createElementVNode)('div',Rt,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(M.value.changes,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.type,class:(0,o.normalizeClass)(['resource-change',e.amount>0?'positive':'negative'])},[(0,o.createElementVNode)('span',_t,(0,o.toDisplayString)((t=e.type,{gold:'💰',food:'🍖',threat:'⚠️',slaves:'🔒',normalGoblins:'👺',warriorGoblins:'⚔️',shamanGoblins:'🔮',paladinGoblins:'✨',trainingSlaves:'💋',rounds:'🔄'}[t]||'❓')),1),(0,o.createElementVNode)('span',Gt,(0,o.toDisplayString)(j(e.type)),1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['change-amount',e.amount>0?'positive':'negative'])},(0,o.toDisplayString)(e.amount>0?'+':'')+(0,o.toDisplayString)(e.amount),3)],2);var t}),128))])])):((0,o.openBlock)(),(0,o.createElementBlock)('div',It,[...a[17]||(a[17]=[(0,o.createElementVNode)('div',{class:'no-info-text'},'暂无回合信息',-1),(0,o.createElementVNode)('div',{class:'no-info-hint'},'点击"结束回合"开始游戏',-1)])]))])])])])):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 其他界面内容 '),(0,o.createVNode)(n,null,{default:(0,o.withCtx)(({Component:e})=>[((0,o.openBlock)(),(0,o.createBlock)(o.KeepAlive,null,[((0,o.openBlock)(),(0,o.createBlock)((0,o.resolveDynamicComponent)(e)))],1024))]),_:1})],64)),(0,o.createCommentVNode)(' 底部导航栏 '),(0,o.createElementVNode)('nav',Ot,[(0,o.createVNode)(s,{to:'/探索',class:'nav-item','active-class':'active'},{default:(0,o.withCtx)(()=>[...a[18]||(a[18]=[(0,o.createElementVNode)('span',{class:'icon'},'🗺️',-1),(0,o.createElementVNode)('span',{class:'label'},'探索',-1)])]),_:1}),(0,o.createVNode)(s,{to:'/部队编制',class:'nav-item','active-class':'active'},{default:(0,o.withCtx)(()=>[...a[19]||(a[19]=[(0,o.createElementVNode)('span',{class:'icon'},'⚔️',-1),(0,o.createElementVNode)('span',{class:'label'},'编制',-1)])]),_:1}),(0,o.createVNode)(s,{to:'/',class:'nav-item center-nav','active-class':'active'},{default:(0,o.withCtx)(()=>[...a[20]||(a[20]=[(0,o.createElementVNode)('span',{class:'icon'},'🏠',-1),(0,o.createElementVNode)('span',{class:'label'},'首页',-1)])]),_:1}),(0,o.createVNode)(s,{to:'/巢穴',class:'nav-item','active-class':'active'},{default:(0,o.withCtx)(()=>[...a[21]||(a[21]=[(0,o.createElementVNode)('span',{class:'icon'},'🏰',-1),(0,o.createElementVNode)('span',{class:'label'},'巢穴',-1)])]),_:1}),(0,o.createVNode)(s,{to:'/调教',class:'nav-item','active-class':'active'},{default:(0,o.withCtx)(()=>[...a[22]||(a[22]=[(0,o.createElementVNode)('span',{class:'icon'},'💋',-1),(0,o.createElementVNode)('span',{class:'label'},'调教',-1)])]),_:1})]),(0,o.createCommentVNode)(' 存档管理界面 '),(0,o.createVNode)(Fe,{show:A.value,'current-resources':{gold:(0,o.unref)(c.l).resources.value.gold,food:(0,o.unref)(c.l).resources.value.food,threat:(0,o.unref)(c.l).resources.value.threat,slaves:(0,o.unref)(c.l).resources.value.slaves,normalGoblins:(0,o.unref)(c.l).resources.value.normalGoblins,warriorGoblins:(0,o.unref)(c.l).resources.value.warriorGoblins,shamanGoblins:(0,o.unref)(c.l).resources.value.shamanGoblins,paladinGoblins:(0,o.unref)(c.l).resources.value.paladinGoblins,trainingSlaves:(0,o.unref)(c.l).resources.value.trainingSlaves,rounds:(0,o.unref)(c.l).resources.value.rounds,actionPoints:(0,o.unref)(c.l).resources.value.actionPoints,maxActionPoints:(0,o.unref)(c.l).resources.value.maxActionPoints,conqueredRegions:(0,o.unref)(c.l).resources.value.conqueredRegions},'current-game-state':B.value,'latest-round-info':M.value,onClose:H,onSave:L,onLoad:U,onError:F,onInit:q},null,8,['show','current-resources','current-game-state','latest-round-info']),(0,o.createCommentVNode)(' 历史记录弹窗 '),(0,o.createVNode)(be,{ref_key:'historyModalRef',ref:G,show:R.value,onClose:W},null,8,['show']),(0,o.createCommentVNode)(' 自定义确认框 '),(0,o.createVNode)(y,{show:(0,o.unref)(Je).show,title:(0,o.unref)(Je).title,message:(0,o.unref)(Je).message,details:(0,o.unref)(Je).details,'confirm-text':(0,o.unref)(Je).confirmText,'cancel-text':(0,o.unref)(Je).cancelText,'show-cancel':(0,o.unref)(Je).showCancel,'show-close':(0,o.unref)(Je).showClose,type:(0,o.unref)(Je).type,onConfirm:(0,o.unref)(ze).handleConfirm,onCancel:(0,o.unref)(ze).handleCancel,onClose:(0,o.unref)(ze).handleClose},null,8,['show','title','message','details','confirm-text','cancel-text','show-cancel','show-close','type','onConfirm','onCancel','onClose']),(0,o.createCommentVNode)(' 随机事件管理器 '),(0,o.createVNode)(le,{ref_key:'randomEventManagerRef',ref:C,'current-round':E.value,'game-state':V.value,onEventTriggered:w,onEventCompleted:x},null,8,['current-round','game-state'])])}}}),Lt=(0,f.A)(Pt,[['__scopeId','data-v-6af1078e']]);var Ut=a(588),Ft=a(633);const Ht={class:'army-formation-container'},qt={class:'formation-content'},Jt={class:'captains-section'},zt={class:'captains-grid'},Wt=['onClick'],jt={key:0,class:'captain-card'},Yt={class:'captain-portrait'},Kt=['src','alt'],Qt={key:1,class:'default-portrait'},Xt={class:'portrait-icon'},Zt={class:'captain-name-vertical-left'},ea={class:'captain-actions'},ta=['onClick'],aa=['onClick'],oa={class:'captain-level-badge'},na={class:'level-value'},sa={class:'captain-info-grid'},la={class:'captain-troops'},ra={class:'troop-count'},ia={class:'health-count'},ca={class:'captain-stats'},da={class:'stat-item'},ua={class:'stat-item'},ma={class:'stat-item'},ga={class:'stat-item'},ha={class:'captain-list'},pa=['onClick'],va={class:'captain-avatar'},fa=['src','alt'],ya={key:1},ba={class:'captain-details'},Na={class:'captain-attributes'},Ea={class:'attr-item'},ka={class:'attr-item'},Sa={class:'attr-item'},Va={class:'attr-item'},Ca={class:'captain-level'},wa={key:0,class:'used-badge'},xa={class:'troop-config-content'},Da={class:'captain-info-section'},$a={class:'captain-details'},Ba={class:'captain-attributes'},Aa={class:'attr-item'},Ta={class:'bonus-text'},Ma={class:'attr-item'},Ra={class:'bonus-text'},_a={class:'attr-item'},Ga={class:'bonus-text'},Ia={class:'attr-item'},Oa={class:'bonus-text'},Pa={class:'attr-item'},La={class:'bonus-text'},Ua={class:'troops-config-section'},Fa={class:'troops-limit'},Ha={class:'troops-sliders'},qa={class:'troop-label'},Ja={class:'troop-name'},za={class:'troop-description'},Wa={class:'slider-container'},ja=['max','value','onInput'],Ya={class:'slider-value'},Ka={class:'config-manager-content'},Qa={class:'save-config-section'},Xa={class:'save-form'},Za=['disabled'],eo={class:'config-list-section'},to={class:'config-list'},ao={class:'config-info'},oo={class:'config-name'},no={key:0,class:'config-desc'},so={class:'config-meta'},lo={class:'config-actions'},ro=['onClick'],io=['onClick'],co={key:0,class:'no-configs'},uo=(0,o.defineComponent)({__name:'部队编制界面',setup(e){const t=(0,o.ref)(Array(6).fill(null)),a=(0,o.ref)(null),n=(0,o.ref)([]),s=(0,o.ref)([]),l=(0,o.ref)(!1),r=(0,o.ref)(!1),i=(0,o.ref)(!1),d=(0,o.ref)(null),u=(0,o.ref)([]),m=(0,o.ref)(''),g=(0,o.ref)(''),h=(0,o.ref)(!1),p=(0,o.ref)({title:'提示',message:'',details:'',confirmText:'确定',cancelText:'取消',type:'info',showCancel:!0,showClose:!0}),v=(0,o.ref)(null),f=(0,o.computed)(()=>null===d.value?null:t.value[d.value]),b=()=>{l.value=!0},N=()=>{l.value=!1},E=()=>{r.value=!1,d.value=null},k=()=>{if(null!==d.value&&f.value){const e=D('attack'),a=D('defense'),o=D('intelligence'),n=D('speed'),s=D('health'),l={...f.value,originalAttributes:{...f.value.attributes},attributes:{...f.value.attributes,attack:f.value.attributes.attack+e,defense:f.value.attributes.defense+a,intelligence:f.value.attributes.intelligence+o,speed:f.value.attributes.speed+n,health:f.value.attributes.health+s},troopBonuses:{attack:e,defense:a,intelligence:o,speed:n,health:s}};t.value[d.value]=l,console.log(`队长 ${l.name} 属性已更新:`,{原始属性:l.originalAttributes,部队加成:l.troopBonuses,最终属性:l.attributes}),R()}r.value=!1,d.value=null},S=()=>{d.value,r.value=!1,d.value=null},V=e=>e.troops?Object.values(e.troops).reduce((e,t)=>e+t,0):0,C=e=>f.value?.troops&&f.value.troops[e]||0,w=e=>{if(!f.value)return 0;const t=x(e),a=B[e]||1;return Math.floor(t/a)},x=e=>{if(!f.value?.troops)return f.value?.level||0;const t=f.value.troops;let a=0;return Object.keys(t).forEach(o=>{o!==e&&(a+=(t[o]||0)*(B[o]||0))}),Math.max(0,(f.value.level||0)-a)},D=e=>{if(!f.value?.troops)return 0;const t=f.value.troops;let a=0;return Object.entries(t).forEach(([t,o])=>{const n=Ft.Mq.find(e=>e.id===t);if(n&&o>0){const s=n.attributes,l=Math.min(n.level,10),r=l/10;switch(console.log(`计算部队加成: ${t} x${o}, 等级:${l}, 倍数:${r}`),e){case'attack':{const e=Math.floor(o*s.attack*r);a+=e,console.log(`攻击加成: ${o} * ${s.attack} * ${r} = ${e}`);break}case'defense':{const e=Math.floor(o*s.defense*r);a+=e,console.log(`防御加成: ${o} * ${s.defense} * ${r} = ${e}`);break}case'intelligence':{const e=Math.floor(o*s.intelligence*r);a+=e,console.log(`智力加成: ${o} * ${s.intelligence} * ${r} = ${e}`);break}case'speed':{const e=Math.floor(o*s.speed*r);a+=e,console.log(`速度加成: ${o} * ${s.speed} * ${r} = ${e}`);break}case'health':{const e=Math.floor(o*n.attributes.health*r);a+=e,console.log(`血量加成: ${o} * ${n.attributes.health} * ${r} = ${e}`);break}}}}),console.log(`总${e}加成: ${a}`),a},B={普通哥布林:.1,哥布林战士:1,哥布林萨满:1,哥布林圣骑士:1},A=e=>{try{c.l.getCurrentGameData()||(console.log('存档系统未初始化，创建新游戏数据'),c.l.createNewGame());const t={普通哥布林:'normalGoblins',哥布林战士:'warriorGoblins',哥布林萨满:'shamanGoblins',哥布林圣骑士:'paladinGoblins'}[e]||e,a=c.l.resources.value[t]||0;return console.log(`获取哥布林数量 ${e} (${t}): ${a}`),a}catch(e){return console.error('获取哥布林数量失败:',e),0}},T=e=>{if(!e)return 0;const t=e.attributes?.health||10*e.level;let a=0;return e.troops&&Object.entries(e.troops).forEach(([e,t])=>{const o=Ft.Mq.find(t=>t.id===e);if(o&&t>0){const e=Math.min(o.level,10)/10;a+=Math.floor(t*o.attributes.health*e)}}),t+a},M=(e,t)=>{if(!e?.troops)return 0;let a=0;return Object.entries(e.troops).forEach(([e,o])=>{const n=Ft.Mq.find(t=>t.id===e);if(n&&o>0){const e=n.attributes,s=Math.min(n.level,10)/10;switch(t){case'attack':a+=Math.floor(o*e.attack*s);break;case'defense':a+=Math.floor(o*e.defense*s);break;case'intelligence':a+=Math.floor(o*e.intelligence*s);break;case'speed':a+=Math.floor(o*e.speed*s)}}}),a},R=async()=>{try{await Ut.FormationService.saveFormationData(t.value),console.log('部队编制已自动保存')}catch(e){console.error('自动保存失败:',e)}},G=()=>{try{const e=c.l.getModuleData({moduleName:'training'});e&&e.characters&&(t.value.forEach(t=>{if(t){const a=e.characters.find(e=>e.id===t.id);a&&(a.status='surrendered',t.originalAttributes&&(a.attributes={...t.originalAttributes},console.log(`人物 ${a.name} 属性已恢复为原始属性:`,a.attributes)),console.log(`人物 ${a.name} 状态已恢复为已堕落`))}}),c.l.updateModuleData({moduleName:'training',data:e}))}catch(e){console.error('重置人物状态失败:',e)}t.value=Array(6).fill(null),a.value=null,n.value.forEach(e=>{e.isUsed=!1}),R()},I=()=>{P(),i.value=!0},O=()=>{i.value=!1,m.value='',g.value=''},P=()=>{try{u.value=Ut.FormationService.getFormationConfigs()}catch(e){console.error('加载配置列表失败:',e),u.value=[]}},L=()=>{if(m.value.trim())try{Ut.FormationService.saveFormationConfig({name:m.value.trim(),description:g.value.trim()||void 0,captainSlots:t.value}),U({title:'保存成功',message:'配置保存成功！',type:'success',showCancel:!1}),m.value='',g.value='',P()}catch(e){console.error('保存配置失败:',e),U({title:'保存失败',message:'保存配置失败，请重试！',type:'danger',showCancel:!1})}else U({title:'输入错误',message:'请输入配置名称！',type:'warning',showCancel:!1})},U=e=>{p.value={title:e.title||'提示',message:e.message,details:e.details||'',confirmText:e.confirmText||'确定',cancelText:e.cancelText||'取消',type:e.type||'info',showCancel:!1!==e.showCancel,showClose:!1!==e.showClose},v.value=e.onConfirm||null,h.value=!0},F=()=>{v.value&&v.value(),h.value=!1,v.value=null},H=()=>{h.value=!1,v.value=null},q=()=>{h.value=!1,v.value=null},J=e=>{e.target.style.display='none'},W=()=>{const e=t.value.filter(e=>null!==e).map(e=>e.id);n.value.forEach(t=>{t.isUsed=e.includes(t.id)}),console.log('已同步队长使用状态:',{usedCaptainIds:e,availableCaptains:n.value.map(e=>({id:e.id,name:e.name,isUsed:e.isUsed}))})};return(0,o.onMounted)(async()=>{try{c.l.getCurrentGameData()||(console.log('部队编制界面：存档系统未初始化，正在初始化...'),await c.l.init(),c.l.createNewGame())}catch(e){console.error('初始化存档系统失败:',e)}(()=>{try{const e=c.l.getModuleData({moduleName:'training'});if(e&&e.characters){const t=e.characters.filter(e=>('surrendered'===e.status||'player'===e.status)&&!0===e.canCombat||'哥布林之王'===e.name);s.value=t,console.log('可用人物数据（已过滤不可战斗角色）:',t)}}catch(e){console.error('加载人物数据失败:',e),s.value=[]}})(),n.value=s.value.map(e=>({id:e.id,name:e.name,avatar:e.avatar||'👤',level:e.level||1,offspring:e.offspring||0,attributes:{attack:e.attributes.attack,defense:e.attributes.defense,intelligence:e.attributes.intelligence,speed:e.attributes.speed,health:e.attributes.health},description:`${e.title} - 堕落值: ${e.loyalty||0}`,isUsed:!1})),(()=>{try{const e=Ut.FormationService.loadFormationData();e&&e.length>0&&(t.value=e,console.log('已从存档系统加载部队编制数据:',e),W())}catch(e){console.error('加载部队编制数据失败:',e)}})()}),(e,s)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',Ht,[(0,o.createElementVNode)('div',qt,[(0,o.createCommentVNode)(' 标题区域 '),s[13]||(s[13]=(0,o.createElementVNode)('header',{class:'formation-header'},[(0,o.createElementVNode)('h1',{class:'main-title'},'⚔️ 部队编制')],-1)),(0,o.createCommentVNode)(' 队长编制区域 '),(0,o.createElementVNode)('section',Jt,[(0,o.createElementVNode)('div',zt,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(t.value,(e,l)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:l,class:(0,o.normalizeClass)(['captain-slot',{empty:!e,selected:a.value===l}]),onClick:e=>(e=>{a.value=e})(l)},[e?((0,o.openBlock)(),(0,o.createElementBlock)('div',jt,[(0,o.createCommentVNode)(' 队长肖像图片区域 - 占满整个卡片 '),(0,o.createElementVNode)('div',Yt,[e.avatar&&e.avatar.startsWith('http')?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.avatar,alt:e.name,onError:J},null,40,Kt)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Qt,[(0,o.createElementVNode)('span',Xt,(0,o.toDisplayString)(e.avatar||'👤'),1)])),(0,o.createCommentVNode)(' 队长名称 - 竖排显示在左上角 '),(0,o.createElementVNode)('div',Zt,(0,o.toDisplayString)(e.name),1),(0,o.createCommentVNode)(' 操作按钮 - 放在右上角 '),(0,o.createElementVNode)('div',ea,[(0,o.createElementVNode)('button',{class:'configure-troops-btn',title:'配置部队',onClick:(0,o.withModifiers)(e=>(e=>{d.value=e,r.value=!0})(l),['stop'])},'⚙️',8,ta),(0,o.createElementVNode)('button',{class:'remove-captain-btn',title:'移除队长',onClick:(0,o.withModifiers)(e=>(e=>{const o=t.value[e];if(o){const s=n.value.find(e=>e.id===o.id);s&&(s.isUsed=!1);try{const e=c.l.getModuleData({moduleName:'training'});if(e&&e.characters){const t=e.characters.find(e=>e.id===o.id);t&&(t.status='surrendered',o.originalAttributes&&(t.attributes={...o.originalAttributes},console.log(`人物 ${t.name} 属性已恢复为原始属性:`,t.attributes)),c.l.updateModuleData({moduleName:'training',data:e}),console.log(`人物 ${t.name} 状态已恢复为已堕落`))}}catch(e){console.error('恢复人物状态失败:',e)}t.value[e]=null,a.value===e&&(a.value=null),R()}})(l),['stop'])},'×',8,aa)]),(0,o.createCommentVNode)(' 等级标识 - 放在操作按钮下面 '),(0,o.createElementVNode)('div',oa,[s[5]||(s[5]=(0,o.createElementVNode)('span',{class:'level-icon'},'⭐',-1)),(0,o.createElementVNode)('span',na,(0,o.toDisplayString)(Math.floor(e.offspring/10)),1)]),(0,o.createCommentVNode)(' 四维和部队信息网格 '),(0,o.createElementVNode)('div',sa,[(0,o.createCommentVNode)(' 部队信息 - 移到上面 '),(0,o.createElementVNode)('div',la,[(0,o.createElementVNode)('div',ra,'部队: '+(0,o.toDisplayString)(V(e)),1),(0,o.createElementVNode)('div',ia,'血量: '+(0,o.toDisplayString)(T(e)),1)]),(0,o.createCommentVNode)(' 四维属性 '),(0,o.createElementVNode)('div',ca,[(0,o.createElementVNode)('div',da,[s[6]||(s[6]=(0,o.createElementVNode)('span',null,'攻:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.attack+M(e,'attack')),1)]),(0,o.createElementVNode)('div',ua,[s[7]||(s[7]=(0,o.createElementVNode)('span',null,'防:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.defense+M(e,'defense')),1)]),(0,o.createElementVNode)('div',ma,[s[8]||(s[8]=(0,o.createElementVNode)('span',null,'知:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.intelligence+M(e,'intelligence')),1)]),(0,o.createElementVNode)('div',ga,[s[9]||(s[9]=(0,o.createElementVNode)('span',null,'速:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.speed+M(e,'speed')),1)])])])])])):((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'empty-slot',onClick:b},[...s[10]||(s[10]=[(0,o.createElementVNode)('div',{class:'empty-icon'},'+',-1),(0,o.createElementVNode)('div',{class:'empty-text'},'选择队长',-1)])]))],10,Wt))),128))])]),(0,o.createCommentVNode)(' 操作按钮 '),(0,o.createElementVNode)('div',{class:'formation-actions'},[(0,o.createElementVNode)('button',{class:'action-btn config-btn',title:'管理部队配置',onClick:I},[...s[11]||(s[11]=[(0,o.createElementVNode)('span',{class:'text'},'配置管理',-1)])]),(0,o.createElementVNode)('button',{class:'action-btn reset-btn',title:'清空所有队长配置',onClick:G},[...s[12]||(s[12]=[(0,o.createElementVNode)('span',{class:'text'},'重置编制',-1)])])])]),(0,o.createCommentVNode)(' 队长选择弹窗 '),l.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'captain-selection-modal',onClick:N},[(0,o.createElementVNode)('div',{class:'modal-content',onClick:s[0]||(s[0]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[s[14]||(s[14]=(0,o.createElementVNode)('h3',null,'🎯 选择队长',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:N},'×')]),(0,o.createElementVNode)('div',ha,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(n.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['captain-option',{disabled:e.isUsed}]),onClick:o=>(e=>{if(e.isUsed)return;const o=t.value.findIndex(e=>null===e);if(-1===o)return;const n={...e,troops:{普通哥布林:0,哥布林战士:0,哥布林萨满:0,哥布林圣骑士:0}};t.value[o]=n,e.isUsed=!0,a.value=o,l.value=!1,R()})(e)},[(0,o.createElementVNode)('div',va,[e.avatar&&e.avatar.startsWith('http')?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.avatar,alt:e.name,onError:J},null,40,fa)):((0,o.openBlock)(),(0,o.createElementBlock)('span',ya,(0,o.toDisplayString)(e.avatar),1))]),(0,o.createElementVNode)('div',ba,[(0,o.createElementVNode)('h4',null,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('p',null,(0,o.toDisplayString)(e.description),1),(0,o.createElementVNode)('div',Na,[(0,o.createElementVNode)('div',Ea,[s[15]||(s[15]=(0,o.createElementVNode)('span',null,'攻:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.attack),1)]),(0,o.createElementVNode)('div',ka,[s[16]||(s[16]=(0,o.createElementVNode)('span',null,'防:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.defense),1)]),(0,o.createElementVNode)('div',Sa,[s[17]||(s[17]=(0,o.createElementVNode)('span',null,'知:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.intelligence),1)]),(0,o.createElementVNode)('div',Va,[s[18]||(s[18]=(0,o.createElementVNode)('span',null,'速:',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.attributes.speed),1)])]),(0,o.createElementVNode)('div',Ca,'等级 '+(0,o.toDisplayString)(e.level),1)]),e.isUsed?((0,o.openBlock)(),(0,o.createElementBlock)('div',wa,'已使用')):(0,o.createCommentVNode)('v-if',!0)],10,pa))),128))])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 部队配置弹窗 '),r.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'troop-config-modal',onClick:E},[(0,o.createElementVNode)('div',{class:'modal-content',onClick:s[1]||(s[1]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[s[19]||(s[19]=(0,o.createElementVNode)('h3',null,'⚔️ 配置部队',-1)),(0,o.createElementVNode)('div',{class:'modal-actions'},[(0,o.createElementVNode)('button',{class:'confirm-btn',onClick:k},'✓'),(0,o.createElementVNode)('button',{class:'close-btn',onClick:S},'×')])]),(0,o.createElementVNode)('div',xa,[(0,o.createCommentVNode)(' 队长信息 '),(0,o.createElementVNode)('div',Da,[(0,o.createElementVNode)('div',$a,[(0,o.createElementVNode)('h4',null,(0,o.toDisplayString)(f.value?.name),1),(0,o.createElementVNode)('div',Ba,[(0,o.createElementVNode)('div',Aa,[s[20]||(s[20]=(0,o.createElementVNode)('span',null,'攻:',-1)),(0,o.createElementVNode)('span',null,[(0,o.createTextVNode)((0,o.toDisplayString)(f.value?.attributes.attack),1),(0,o.createElementVNode)('span',Ta,'+'+(0,o.toDisplayString)(D('attack')),1)])]),(0,o.createElementVNode)('div',Ma,[s[21]||(s[21]=(0,o.createElementVNode)('span',null,'防:',-1)),(0,o.createElementVNode)('span',null,[(0,o.createTextVNode)((0,o.toDisplayString)(f.value?.attributes.defense),1),(0,o.createElementVNode)('span',Ra,'+'+(0,o.toDisplayString)(D('defense')),1)])]),(0,o.createElementVNode)('div',_a,[s[22]||(s[22]=(0,o.createElementVNode)('span',null,'知:',-1)),(0,o.createElementVNode)('span',null,[(0,o.createTextVNode)((0,o.toDisplayString)(f.value?.attributes.intelligence),1),(0,o.createElementVNode)('span',Ga,'+'+(0,o.toDisplayString)(D('intelligence')),1)])]),(0,o.createElementVNode)('div',Ia,[s[23]||(s[23]=(0,o.createElementVNode)('span',null,'速:',-1)),(0,o.createElementVNode)('span',null,[(0,o.createTextVNode)((0,o.toDisplayString)(f.value?.attributes.speed),1),(0,o.createElementVNode)('span',Oa,'+'+(0,o.toDisplayString)(D('speed')),1)])]),(0,o.createElementVNode)('div',Pa,[s[24]||(s[24]=(0,o.createElementVNode)('span',null,'血:',-1)),(0,o.createElementVNode)('span',null,[(0,o.createTextVNode)((0,o.toDisplayString)(f.value?f.value.attributes?.health||10*f.value.level:0),1),(0,o.createElementVNode)('span',La,'+'+(0,o.toDisplayString)(D('health')),1)])])])])]),(0,o.createCommentVNode)(' 部队配置 '),(0,o.createElementVNode)('div',Ua,[(0,o.createElementVNode)('div',Fa,'可配置部队等级: '+(0,o.toDisplayString)(f.value?.level)+' 个',1),(0,o.createElementVNode)('div',Ha,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(Ft.Mq),e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:'troop-slider-item'},[(0,o.createElementVNode)('div',qa,[(0,o.createElementVNode)('span',Ja,(0,o.toDisplayString)(e.id),1),(0,o.createElementVNode)('span',za,(0,o.toDisplayString)(e.title),1)]),(0,o.createElementVNode)('div',Wa,[(0,o.createElementVNode)('input',{type:'range',class:'troop-slider',min:0,max:w(e.id),value:C(e.id),onInput:t=>{return a=e.id,o=parseInt(t.target.value),void(f.value&&(f.value.troops||(f.value.troops={普通哥布林:0,哥布林战士:0,哥布林萨满:0,哥布林圣骑士:0}),a in f.value.troops&&(f.value.troops[a]=o)));var a,o}},null,40,ja),(0,o.createElementVNode)('span',Ya,(0,o.toDisplayString)(C(e.id))+'/'+(0,o.toDisplayString)(A(e.id)),1)])]))),128))])])])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 配置管理弹窗 '),i.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:2,class:'config-manager-modal',onClick:O},[(0,o.createElementVNode)('div',{class:'modal-content',onClick:s[4]||(s[4]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[s[25]||(s[25]=(0,o.createElementVNode)('h3',null,'📋 部队配置管理',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:O},'×')]),(0,o.createElementVNode)('div',Ka,[(0,o.createCommentVNode)(' 保存当前配置 '),(0,o.createElementVNode)('div',Qa,[s[26]||(s[26]=(0,o.createElementVNode)('h4',null,'保存当前配置',-1)),(0,o.createElementVNode)('div',Xa,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':s[2]||(s[2]=e=>m.value=e),type:'text',placeholder:'配置名称',class:'config-name-input'},null,512),[[o.vModelText,m.value]]),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':s[3]||(s[3]=e=>g.value=e),type:'text',placeholder:'配置描述（可选）',class:'config-desc-input'},null,512),[[o.vModelText,g.value]]),(0,o.createElementVNode)('button',{class:'save-config-btn',disabled:!m.value.trim(),onClick:L},' 保存配置 ',8,Za)])]),(0,o.createCommentVNode)(' 配置列表 '),(0,o.createElementVNode)('div',eo,[s[27]||(s[27]=(0,o.createElementVNode)('h4',null,'已保存的配置',-1)),(0,o.createElementVNode)('div',to,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(u.value,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:'config-item'},[(0,o.createElementVNode)('div',ao,[(0,o.createElementVNode)('div',oo,(0,o.toDisplayString)(e.name),1),e.description?((0,o.openBlock)(),(0,o.createElementBlock)('div',no,(0,o.toDisplayString)(e.description),1)):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',so,'创建时间: '+(0,o.toDisplayString)((a=e.createdAt,new Date(a).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}))),1)]),(0,o.createElementVNode)('div',lo,[(0,o.createElementVNode)('button',{class:'load-config-btn',title:'加载配置',onClick:a=>(e=>{try{const a=Ut.FormationService.loadFormationConfig(e);t.value=a,W(),R(),U({title:'加载成功',message:'配置加载成功！',type:'success',showCancel:!1}),O()}catch(e){console.error('加载配置失败:',e),U({title:'加载失败',message:'加载配置失败，请重试！',type:'danger',showCancel:!1})}})(e.id)},'📂',8,ro),(0,o.createElementVNode)('button',{class:'delete-config-btn',title:'删除配置',onClick:t=>{return a=e.id,void U({title:'确认删除',message:'确定要删除这个配置吗？',details:'删除后无法恢复，请谨慎操作。',type:'danger',confirmText:'删除',cancelText:'取消',onConfirm:()=>{try{Ut.FormationService.deleteFormationConfig(a)?(U({title:'删除成功',message:'配置删除成功！',type:'success',showCancel:!1}),P()):U({title:'删除失败',message:'删除配置失败，请重试！',type:'danger',showCancel:!1})}catch(e){console.error('删除配置失败:',e),U({title:'删除失败',message:'删除配置失败，请重试！',type:'danger',showCancel:!1})}}});var a}},'🗑️',8,io)])]);var a}),128)),0===u.value.length?((0,o.openBlock)(),(0,o.createElementBlock)('div',co,'暂无保存的配置')):(0,o.createCommentVNode)('v-if',!0)])])])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 自定义确认框 '),(0,o.createVNode)(y,{show:h.value,title:p.value.title,message:p.value.message,details:p.value.details,'confirm-text':p.value.confirmText,'cancel-text':p.value.cancelText,'show-cancel':p.value.showCancel,'show-close':p.value.showClose,type:p.value.type,onConfirm:F,onCancel:H,onClose:q},null,8,['show','title','message','details','confirm-text','cancel-text','show-cancel','show-close','type'])]))}}),mo=(0,f.A)(uo,[['__scopeId','data-v-2c630af3']]),go={class:'toast-container'},ho=['onClick'],po=['innerHTML'],vo={class:'toast-content'},fo={key:0,class:'toast-title'},yo={class:'toast-message'},bo=['onClick'],No=(0,o.defineComponent)({__name:'弹窗提示',setup(e,{expose:t}){const a=(0,o.ref)([]),n=new Map,s=(0,o.computed)(()=>document.fullscreenElement?document.fullscreenElement:'body'),l=()=>{};'undefined'!=typeof window&&document.addEventListener('fullscreenchange',l);const r=e=>{const t=e.id||Math.random().toString(36).substr(2,9),o={id:t,title:e.title||'',message:e.message,type:e.type||'info',duration:e.duration||4e3,persistent:e.persistent||!1};if(a.value.push(o),!o.persistent){const e=window.setTimeout(()=>{i(t)},o.duration);n.set(t,e)}return t},i=e=>{const t=a.value.findIndex(t=>t.id===e);if(t>-1){a.value.splice(t,1);const o=n.get(e);o&&(clearTimeout(o),n.delete(e))}};return(0,o.onUnmounted)(()=>{n.forEach(e=>clearTimeout(e)),n.clear(),'undefined'!=typeof window&&document.removeEventListener('fullscreenchange',l)}),t({addToast:r,removeToast:i,clearAllToasts:()=>{a.value=[],n.forEach(e=>clearTimeout(e)),n.clear()},success:(e,t)=>r({...t,message:e,type:'success'}),error:(e,t)=>r({...t,message:e,type:'error'}),warning:(e,t)=>r({...t,message:e,type:'warning'}),info:(e,t)=>r({...t,message:e,type:'info'})}),(e,t)=>((0,o.openBlock)(),(0,o.createBlock)(o.Teleport,{to:s.value},[(0,o.createElementVNode)('div',go,[(0,o.createVNode)(o.TransitionGroup,{name:'toast',tag:'div'},{default:(0,o.withCtx)(()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(a.value,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['toast-item',`toast-${e.type}`]),onClick:t=>i(e.id)},[(0,o.createElementVNode)('div',{class:'toast-icon',innerHTML:(a=e.type,{success:()=>'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <polyline points="20,6 9,17 4,12"></polyline>\n    </svg>',error:()=>'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <circle cx="12" cy="12" r="10"></circle>\n      <line x1="15" y1="9" x2="9" y2="15"></line>\n      <line x1="9" y1="9" x2="15" y2="15"></line>\n    </svg>',warning:()=>'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>\n      <line x1="12" y1="9" x2="12" y2="13"></line>\n      <line x1="12" y1="17" x2="12.01" y2="17"></line>\n    </svg>',info:()=>'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <circle cx="12" cy="12" r="10"></circle>\n      <line x1="12" y1="16" x2="12" y2="12"></line>\n      <line x1="12" y1="8" x2="12.01" y2="8"></line>\n    </svg>'}[a])()},null,8,po),(0,o.createElementVNode)('div',vo,[e.title?((0,o.openBlock)(),(0,o.createElementBlock)('div',fo,(0,o.toDisplayString)(e.title),1)):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',yo,(0,o.toDisplayString)(e.message),1)]),(0,o.createElementVNode)('button',{class:'toast-close',onClick:(0,o.withModifiers)(t=>i(e.id),['stop'])},[...t[0]||(t[0]=[(0,o.createElementVNode)('svg',{width:'16',height:'16',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,o.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'}),(0,o.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'})],-1)])],8,bo),(0,o.createElementVNode)('div',{class:'toast-progress',style:(0,o.normalizeStyle)({animationDuration:`${e.duration}ms`})},null,4)],10,ho);var a}),128))]),_:1})])],8,['to']))}}),Eo=(0,f.A)(No,[['__scopeId','data-v-e2806492']]);const ko=new class{app=null;instance=null;container=null;fullscreenListener=null;init(){if(this.instance)return;this.container=document.createElement('div'),this.container.id='toast-service-container';(document.fullscreenElement||document.body).appendChild(this.container),this.app=(0,o.createApp)(Eo),this.instance=this.app.mount(this.container),this.setupFullscreenListener()}destroy(){this.app&&(this.app.unmount(),this.app=null),this.container&&(this.container.remove(),this.container=null),this.instance=null,this.removeFullscreenListener()}success(e,t){return this.ensureInitialized(),this.instance?.success(e,t)}error(e,t){return this.ensureInitialized(),this.instance?.error(e,t)}warning(e,t){return this.ensureInitialized(),this.instance?.warning(e,t)}info(e,t){return this.ensureInitialized(),this.instance?.info(e,t)}add(e){return this.ensureInitialized(),this.instance?.addToast(e)}remove(e){this.instance&&this.instance.removeToast(e)}clear(){this.instance&&this.instance.clearAllToasts()}setupFullscreenListener(){this.fullscreenListener=()=>{if(this.container){this.container.remove();(document.fullscreenElement||document.body).appendChild(this.container)}},document.addEventListener('fullscreenchange',this.fullscreenListener)}removeFullscreenListener(){this.fullscreenListener&&(document.removeEventListener('fullscreenchange',this.fullscreenListener),this.fullscreenListener=null)}ensureInitialized(){this.instance||this.init()}},So=(e,t)=>ko.error(e,t),Vo=(e,t)=>ko.warning(e,t);$(window).on('pagehide',()=>{ko.destroy()});const Co=class{static ACTION_COSTS={scoutLocation:{actionType:'scoutLocation',cost:1,description:'侦察据点'},attackLocation:{actionType:'attackLocation',cost:1,description:'进攻据点'},sendScoutTeam:{actionType:'sendScoutTeam',cost:1,description:'派出侦察队'},singleTraining:{actionType:'singleTraining',cost:1,description:'调教'},singleBreeding:{actionType:'singleBreeding',cost:1,description:'生育'},batchTraining:{actionType:'batchTraining',cost:1,description:'全部调教'},batchBreeding:{actionType:'batchBreeding',cost:1,description:'全部生育'}};static hasEnoughActionPoints(e){const t=this.ACTION_COSTS[e];if(!t)return console.warn(`未知的行动类型: ${e}`),!1;const a=c.l.resources.value.actionPoints,o=a>=t.cost;return console.log(`行动力检查 - 类型: ${e}, 需要: ${t.cost}, 当前: ${a}, 足够: ${o}`),o}static consumeActionPoints(e){const t=this.ACTION_COSTS[e];if(!t)return console.warn(`未知的行动类型: ${e}`),!1;if(!this.hasEnoughActionPoints(e))return console.warn(`行动力不足: 需要 ${t.cost}，当前 ${c.l.resources.value.actionPoints}`),!1;const a=c.l.consumeResource('actionPoints',t.cost,t.description);return a&&console.log(`消耗行动力: ${t.description} (-${t.cost})`),a}static refundActionPoints(e){const t=this.ACTION_COSTS[e];if(!t)return console.warn(`未知的行动类型: ${e}`),!1;const a=c.l.resources.value.maxActionPoints,o=c.l.resources.value.actionPoints,n=Math.min(t.cost,a-o);if(n>0){const e=c.l.addResource('actionPoints',n,`${t.description}失败返还`);return e&&console.log(`返还行动力: ${t.description} (+${n})`),e}return!0}static getActionCost(e){return this.ACTION_COSTS[e]||null}static getActionPointsStatus(){const e=c.l.resources.value.actionPoints,t=c.l.resources.value.maxActionPoints;return{current:e,max:t,remaining:t-e}}static getInsufficientActionPointsMessage(e){const t=this.ACTION_COSTS[e];if(!t)return`未知的行动类型: ${e}`;const a=c.l.resources.value.actionPoints;return`行动力不足！${t.description}需要 ${t.cost} 点行动力，当前只有 ${a} 点`}};class wo{static parseMoraleChange(e){console.log('🔍 开始解析士气变化数据...'),console.log('📝 AI回复内容:',e);try{const t=e.match(/\[OPTIONS_JSON\]([\s\S]*?)\[\/OPTIONS_JSON\]/);if(!t)return console.warn('❌ 未找到OPTIONS_JSON标签'),console.log('📄 完整AI回复:',e),{moraleChange:0,reason:'未找到士气数据',confidence:0};const a=t[1].trim();console.log('📋 提取的JSON字符串:',a);const o=JSON.parse(a);if(console.log('📊 解析的JSON数据:',o),o.morale_changes){console.log('✅ 找到士气变化数据:',o.morale_changes);const e=o.morale_changes;if(void 0!==e.morale){return{moraleChange:this.getRandomMoraleChange(e.morale),reason:`AI输出士气变化：${e.morale}%`,confidence:1}}}return console.warn('⚠️ JSON数据中未找到morale_changes字段'),console.log('📋 可用字段:',Object.keys(o)),{moraleChange:0,reason:'未找到士气变化数据',confidence:0}}catch(t){return console.error('❌ 解析士气变化数据失败:',t),console.log('📄 原始AI回复:',e),{moraleChange:0,reason:'解析失败',confidence:0}}}static getRandomMoraleChange(e){const t=Math.floor(.2*Math.abs(e)),a=e-t,o=e+t,n=Math.floor(Math.random()*(o-a+1))+a;return console.log(`🎲 士气随机化: 基础值=${e}, 变化范围=[${a}, ${o}], 结果=${n}`),n}static getMoraleStatusDescription(e){return e>=90?'士气高昂':e>=70?'士气良好':e>=50?'士气一般':e>=30?'士气低落':e>=10?'士气极低':'士气崩溃'}static getMoraleColor(e){return e>=70?'#22c55e':e>=40?'#f59e0b':e>=20?'#f97316':'#dc2626'}}class xo{static createDialogueConfig(e,t){const{currentMorale:a,enemyInfo:o}=e;return{title:'战前对话',subtitle:`通过言语降低敌方士气 - 当前士气：${a.toFixed(1)}% (${wo.getMoraleStatusDescription(a)})`,welcomeText:`你决定在战斗前与敌方进行对话，试图通过言语来削弱他们的士气...\n\n${o}\n\n通过你的话语，敌方的士气会根据你的言辞效果而动态变化。`,welcomeHint:'选择你的策略来影响敌方士气，AI会根据你的话语内容动态调整士气',customPlaceholder:'输入你的话语...',characterName:e.enemyCharacters[0]?.name||'敌方角色',showCustomInput:!0,initialOptions:[{text:'威胁恐吓',label:'威胁',value:'threat'},{text:'心理战术',label:'心理',value:'psychology'},{text:'嘲讽挑衅',label:'嘲讽',value:'taunt'},{text:'直接开战',label:'开战',value:'fight'}],saveKey:'battle_dialogue',onOptionSelect:e=>'fight'!==e.value,onCustomInput:e=>!0,onAIGenerate:async a=>{const o=t.getCurrentMorale?t.getCurrentMorale():e.currentMorale;return await this.generateAIResponse(a,e,t.onMoraleChange,o)},onAIReply:async(t,a)=>{const o=e.lastUserInput;o&&await this.saveDialoguePairToWorldbook(o,t,a,e)},onUserMessage:async t=>{e.lastUserInput=t},onDialogueClose:t.onDialogueClose}}static async generateAIResponse(e,t,a,o){const n=void 0!==o?o:t.currentMorale,s=this.buildAIPrompt(e,t,n),l=await window.TavernHelper.generate({user_input:s});return this.processMoraleChange(l,n,a),l}static async saveDialoguePairToWorldbook(e,t,o,n){try{const{WorldbookService:s}=await Promise.resolve().then(a.bind(a,844)),l=n.gameTime,r=Date.now();for(const a of n.enemyCharacters){const n={gameTime:l,sender:'user',content:e,timestamp:r},i={gameTime:l,sender:o,content:t,timestamp:r+1};console.log(`为${a.name}保存对话对:`,{userMessage:n,aiMessage:i}),await s.addMultipleDialogueRecords(a.name,a.name,[n,i],'enemy'),console.log(`✅ 已保存${a.name}的对话对到世界书`)}}catch(e){console.error('保存对话对到世界书失败:',e)}}static buildAIPrompt(e,t,a){const{enemyCharacters:o,enemyInfo:n,locationInfo:s,allyForces:l,enemyForces:r}=t;let i=`正在与${n}进行战前对话。当前敌方部队整体士气：${(void 0!==a?a:t.currentMorale).toFixed(1)}%\n\n`,c='';return s&&(c+='据点信息:\n',c+=`  大陆: "${s.continent}"\n`,c+=`  区域: "${s.region}"\n`,c+=`  难度: "${s.difficulty}"\n`,c+=`  名称: "${s.name}"\n`,c+=`  介绍: "${s.description}"\n`),l&&l.length>0&&(c+='我方部队:\n',l.forEach(e=>{if(c+=`  - "${e.name}":\n`,e.troops){const t=e.troops;t.normalGoblins&&t.normalGoblins>0&&(c+=`      普通哥布林: ${t.normalGoblins}\n`),t.warriorGoblins&&t.warriorGoblins>0&&(c+=`      哥布林战士: ${t.warriorGoblins}\n`),t.shamanGoblins&&t.shamanGoblins>0&&(c+=`      哥布林萨满: ${t.shamanGoblins}\n`),t.paladinGoblins&&t.paladinGoblins>0&&(c+=`      哥布林圣骑士: ${t.paladinGoblins}\n`)}})),r&&r.length>0&&(c+='敌方部队:\n',r.forEach(e=>{c+=`  - "${e.name}":\n`,e.troops&&(c+=`      ${e.troops.type}: ${e.troops.count}\n`)})),o&&o.length>0&&(c+='敌方人物:\n',o.forEach(e=>{c+=`  - "${e.name}"\n`})),c&&(i+=`\`\`\`yaml\n${c}\`\`\`\n\n`),i+=`请在你的回复末尾包含以下格式的数据：\n[OPTIONS_JSON]\n{\n  "options": [\n    {"strategy": "保守", "text": "继续威胁"},\n    {"strategy": "激进", "text": "直接攻击"},\n    {"strategy": "平稳", "text": "观察情况"}\n  ],\n  "morale_changes": {\n    "morale": -5\n  }\n}\n[/OPTIONS_JSON]\n\n1. 注意：morale_changes.morale 应该是士气变化值（负数表示士气下降，正数表示士气上升），范围建议在-10到+10之间。\n2. 回复时请考虑敌方角色身份性格等信息\n3. 根据据点难度和双方实力对比来调整对话内容和士气影响\n\n{{user}}：${e}\n`,i}static processMoraleChange(e,t,a){const o=wo.parseMoraleChange(e);if(0!==o.moraleChange){const e=t,n=this.rollMoraleDice(o.moraleChange),s=n.finalChange,l=Math.max(0,Math.min(100,t+s)),r=`${o.reason}${n.diceDescription}`;a(e,l,r),console.log(`士气变化：${e.toFixed(1)}% → ${l.toFixed(1)}% (${s>0?'+':''}${s.toFixed(1)}%)`),console.log(`变化原因：${r}`),console.log(`置信度：${(100*o.confidence).toFixed(1)}%`),console.log(`🎲 随机筛子：${n.diceDescription}`)}}static rollMoraleDice(e){let t=1,a='';switch(Math.floor(6*Math.random())+1){case 1:t=.5,a=' (🎲1-大失败：效果减半)';break;case 2:t=.75,a=' (🎲2-失败：效果减少25%)';break;case 3:t=1,a=' (🎲3-普通：正常效果)';break;case 4:t=1.25,a=' (🎲4-成功：效果增加25%)';break;case 5:t=1.5,a=' (🎲5-大成功：效果增加50%)';break;case 6:t=2,a=' (🎲6-完美：效果翻倍)'}return{finalChange:Math.round(e*t*10)/10,diceDescription:a}}static updateDialogueSubtitle(e,t){e&&(e.subtitle=`通过言语降低敌方士气 - 当前士气：${t.toFixed(1)}% (${wo.getMoraleStatusDescription(t)})`)}}var Do;!function(e){e.PHYSICAL_ATTACK='physical_attack',e.MAGICAL_ATTACK='magical_attack',e.DEFEND='defend',e.SKILL='skill',e.FLEE='flee'}(Do||(Do={}));class $o{battleState;battleHistory=[];actionQueue=[];currentActionIndex=0;constructor(e,t){this.battleState={allies:e.map(e=>({...e,currentHealth:e.maxHealth,isAlive:!0})),enemies:t.map(e=>({...e,currentHealth:e.maxHealth,isAlive:!0})),currentTurn:1,isFinished:!1},this.generateActionQueue()}generateActionQueue(){const e=[...this.battleState.allies,...this.battleState.enemies];this.actionQueue=e.sort((e,t)=>t.attributes.speed-e.attributes.speed),this.currentActionIndex=0}executeBattle(){for(;!this.battleState.isFinished;)this.executeTurn();return this.generateBattleResult()}executeSingleTurn(){if(this.battleState.isFinished)return null;const e=[],t=this.cloneBattleState(),a=[...this.battleState.allies,...this.battleState.enemies].filter(e=>e.isAlive).sort((e,t)=>t.attributes.speed-e.attributes.speed);for(const t of a){if(!t.isAlive||this.battleState.isFinished)break;const a=this.executeUnitAction(t);a&&e.push(a),this.checkBattleEnd()}const o={turnNumber:this.battleState.currentTurn,actions:e,startState:t,endState:this.cloneBattleState()};return this.battleHistory.push(o),this.battleState.currentTurn++,o}executeSingleAction(e){if(this.battleState.isFinished)return null;let t=null;for(;this.currentActionIndex<this.actionQueue.length;){const e=this.actionQueue[this.currentActionIndex];if(e.isAlive){t=e;break}this.currentActionIndex++}if(!t){if(this.generateActionQueue(),0===this.actionQueue.length)return null;t=this.actionQueue[0]}const a=this.executeUnitAction(t,e);return a?(this.currentActionIndex++,this.currentActionIndex>=this.actionQueue.length&&(this.currentActionIndex=0),{...a,endState:this.cloneBattleState()}):null}executeTurn(){const e=[],t=this.cloneBattleState(),a=[...this.battleState.allies,...this.battleState.enemies].filter(e=>e.isAlive).sort((e,t)=>t.attributes.speed-e.attributes.speed);for(const t of a){if(!t.isAlive||this.battleState.isFinished)break;const a=this.executeUnitAction(t);a&&e.push(a),this.checkBattleEnd()}const o={turnNumber:this.battleState.currentTurn,actions:e,startState:t,endState:this.cloneBattleState()};this.battleHistory.push(o),this.battleState.currentTurn++}executeUnitAction(e,t){let a=null;if(this.battleState.allies.includes(e)&&t){this.battleState.enemies.some(e=>e.id===t.id)?(a=this.battleState.enemies.find(e=>e.id===t.id)||null,console.log('集火攻击目标:',a?.name,'是否存活:',a?.isAlive),a&&!a.isAlive&&(console.log('集火目标已死亡，使用AI选择'),a=null)):console.log('集火目标不是敌方单位，使用AI选择')}if(a||(a=this.selectTarget(e),console.log('AI选择目标:',a?.name)),!a)return null;const o=this.selectActionType(e);return this.executeAction(e,a,o)}selectTarget(e){const t=(this.battleState.allies.includes(e)?this.battleState.enemies:this.battleState.allies).filter(e=>e.isAlive);return 0===t.length?null:t.reduce((e,t)=>t.currentHealth<e.currentHealth?t:e)}selectActionType(e){return'magical'===e.type||e.attributes.intelligence>e.attributes.attack?Do.MAGICAL_ATTACK:Do.PHYSICAL_ATTACK}executeAction(e,t,a){let o=0,n=!1,s=!1;switch(a){case Do.PHYSICAL_ATTACK:({damage:o,hit:n,critical:s}=this.calculatePhysicalDamage(e,t));break;case Do.MAGICAL_ATTACK:({damage:o,hit:n,critical:s}=this.calculateMagicalDamage(e,t));break;case Do.DEFEND:return this.applyDefendStatus(e),{type:a,actor:e,description:`${e.name} 进入防御姿态`}}return n&&this.applyDamage(t,o),{type:a,actor:e,target:t,damage:n?o:0,hit:n,critical:s,description:this.generateActionDescription(e,t,a,o,n,s)}}calculatePhysicalDamage(e,t){const a=e.attributes.attack,o=t.attributes.defense,n=.9+.01*(e.attributes.speed-t.attributes.speed);if(!(Math.random()<Math.max(.1,Math.min(.95,n))))return{damage:0,hit:!1,critical:!1};const s=.05+.002*e.attributes.intelligence,l=Math.random()<s,r=a-o,i=l?2:1;return{damage:Math.max(1,Math.floor(r*i)),hit:!0,critical:l}}calculateMagicalDamage(e,t){const a=e.attributes.intelligence,o=t.attributes.defense,n=.85+.005*e.attributes.intelligence;if(!(Math.random()<Math.max(.15,Math.min(.95,n))))return{damage:0,hit:!1,critical:!1};const s=.08+.003*e.attributes.intelligence,l=Math.random()<s,r=a-Math.floor(.5*o),i=l?2.5:1;return{damage:Math.max(1,Math.floor(r*i)),hit:!0,critical:l}}applyDamage(e,t){const a=e.currentHealth;e.currentHealth=Math.max(0,e.currentHealth-t),e.troops&&this.isAllyUnit(e)&&this.handleGoblinLoss(e,a,e.currentHealth),0===e.currentHealth&&(e.isAlive=!1)}handleGoblinLoss(e,t,a){if(!e.troops)return;const o=t-a;if(o<=0)return;const n=this.calculateGoblinHealthBonus(e);if(n<=0)return;const s=o/n,l=Math.min(s,1);if(e.troops.normalGoblins&&e.troops.normalGoblins>0){const t=Math.floor(e.troops.normalGoblins*l);e.troops.normalGoblins=Math.max(0,e.troops.normalGoblins-t)}if(e.troops.warriorGoblins&&e.troops.warriorGoblins>0){const t=Math.floor(e.troops.warriorGoblins*l);e.troops.warriorGoblins=Math.max(0,e.troops.warriorGoblins-t)}if(e.troops.shamanGoblins&&e.troops.shamanGoblins>0){const t=Math.floor(e.troops.shamanGoblins*l);e.troops.shamanGoblins=Math.max(0,e.troops.shamanGoblins-t)}if(e.troops.paladinGoblins&&e.troops.paladinGoblins>0){const t=Math.floor(e.troops.paladinGoblins*l);e.troops.paladinGoblins=Math.max(0,e.troops.paladinGoblins-t)}console.log(`单位 ${e.name} 按比例损失哥布林，损失比例: ${(100*l).toFixed(1)}%，剩余血量: ${a}/${e.maxHealth}`)}calculateGoblinHealthBonus(e){if(!e.troops)return 0;let t=0;return e.troops.normalGoblins&&e.troops.normalGoblins>0&&(t+=2*e.troops.normalGoblins),e.troops.warriorGoblins&&e.troops.warriorGoblins>0&&(t+=5*e.troops.warriorGoblins),e.troops.shamanGoblins&&e.troops.shamanGoblins>0&&(t+=4*e.troops.shamanGoblins),e.troops.paladinGoblins&&e.troops.paladinGoblins>0&&(t+=8*e.troops.paladinGoblins),t}isAllyUnit(e){return this.battleState.allies.some(t=>t.id===e.id)}applyDefendStatus(e){}checkBattleEnd(){const e=this.battleState.allies.filter(e=>e.isAlive),t=this.battleState.enemies.filter(e=>e.isAlive);0===e.length?(this.battleState.isFinished=!0,this.battleState.winner='enemies'):0===t.length&&(this.battleState.isFinished=!0,this.battleState.winner='allies')}generateActionDescription(e,t,a,o,n,s){if(!n)return`${e.name} 攻击 ${t.name}，但被躲开了！`;let l='';return a===Do.PHYSICAL_ATTACK?l=`${e.name} 对 ${t.name} 进行物理攻击`:a===Do.MAGICAL_ATTACK&&(l=`${e.name} 对 ${t.name} 施展法术`),l+=s?`，造成暴击伤害 ${o} 点！`:`，造成 ${o} 点伤害。`,t.isAlive||(l+=` ${t.name} 被击败了！`),l}generateBattleResult(){const e=this.calculateTotalDamageDealt(),t=this.calculateTotalDamageReceived(),a=this.countCriticalHits(),o=this.countMisses();return{victory:'allies'===this.battleState.winner,totalTurns:this.battleState.currentTurn-1,turns:this.battleHistory,finalState:this.battleState,statistics:{totalDamageDealt:e,totalDamageReceived:t,criticalHits:a,misses:o}}}calculateTotalDamageDealt(){return this.battleHistory.reduce((e,t)=>e+t.actions.reduce((e,t)=>e+(t.damage||0),0),0)}calculateTotalDamageReceived(){return this.calculateTotalDamageDealt()}countCriticalHits(){return this.battleHistory.reduce((e,t)=>e+t.actions.filter(e=>e.critical).length,0)}countMisses(){return this.battleHistory.reduce((e,t)=>e+t.actions.filter(e=>!e.hit).length,0)}cloneBattleState(){return JSON.parse(JSON.stringify(this.battleState))}getCurrentState(){return this.battleState}getBattleHistory(){return this.battleHistory}}class Bo{static createBattleUnit(e,t=1){const a=(0,Ft.zw)(e);if(!a)return null;const o=1+.2*(t-1);return{id:a.name,name:a.name,type:a.unitType||'physical',level:a.level,attributes:{attack:Math.floor(a.attributes.attack*o),defense:Math.floor(a.attributes.defense*o),intelligence:Math.floor(a.attributes.intelligence*o),speed:Math.floor(a.attributes.speed*o)},maxHealth:Math.floor(a.attributes.health*o),currentHealth:Math.floor(a.attributes.health*o),isAlive:!0}}static createBattleUnitFromCharacter(e){return e&&e.attributes?{id:e.name,name:e.name,type:e.unitType||'physical',level:e.level||1,attributes:{attack:e.attributes.attack||0,defense:e.attributes.defense||0,intelligence:e.attributes.intelligence||0,speed:e.attributes.speed||0},maxHealth:e.attributes.health||10*(e.level||1),currentHealth:e.attributes.health||10*(e.level||1),isAlive:!0,avatar:e.avatar,fallbackAvatar:e.avatar&&!e.avatar.startsWith('http')?e.avatar:void 0}:null}static createBattleUnitFromEnemyCharacter(e){return e&&'enemy'===e.status&&e.canCombat?{id:e.name,name:e.name,type:e.unitType||'physical',level:e.level,attributes:{attack:e.attributes.attack,defense:e.attributes.defense,intelligence:e.attributes.intelligence,speed:e.attributes.speed},maxHealth:e.attributes.health,currentHealth:e.attributes.health,isAlive:!0,avatar:e.avatar,fallbackAvatar:e.avatar&&!e.avatar.startsWith('http')?e.avatar:void 0}:null}static createRandomEnemy(e=1){const t=Ft.YD[Math.floor(Math.random()*Ft.YD.length)];return this.createBattleUnit(t.name,e)}static createRandomEnemyCharacter(){const e=(0,Ft.P$)();return this.createBattleUnitFromEnemyCharacter(e)}static createRandomEnemyCharacterByLevel(e){const t=Ft.YD.filter(t=>t.level===e);if(0===t.length){const e=(0,Ft.P$)();return this.createBattleUnitFromEnemyCharacter(e)}const a=t[Math.floor(Math.random()*t.length)];return this.createBattleUnitFromEnemyCharacter(a)}static createRandomEnemyCharacterByRace(e){const t=(0,Ft.jr)(e);return this.createBattleUnitFromEnemyCharacter(t)}static createEnemyByRarity(e,t=1){const a=Ft.YD.filter(t=>t.rating===e);if(0===a.length)return null;const o=a[Math.floor(Math.random()*a.length)];return this.createBattleUnit(o.name,t)}static createGoblinArmy(e){const t=[];if(e.grunts)for(let a=0;a<e.grunts;a++){const e=this.createBattleUnit('哥布林');e&&t.push(e)}if(e.warriors)for(let a=0;a<e.warriors;a++){const e=this.createBattleUnit('哥布林战士');e&&t.push(e)}if(e.shamans)for(let a=0;a<e.shamans;a++){const e=this.createBattleUnit('哥布林萨满');e&&t.push(e)}if(e.paladins)for(let a=0;a<e.paladins;a++){const e=this.createBattleUnit('哥布林圣骑士');e&&t.push(e)}return t}static createGoblinArmyWithLevelLimit(e,t){const a=this.calculateMaxUnitsByLevel(e),o=(t.grunts||0)+(t.warriors||0)+(t.shamans||0)+(t.paladins||0);let n={...t};if(o>a){const e=a/o;n={grunts:Math.floor((t.grunts||0)*e),warriors:Math.floor((t.warriors||0)*e),shamans:Math.floor((t.shamans||0)*e),paladins:Math.floor((t.paladins||0)*e)}}const s=this.createGoblinArmy(n),l=s.length;return{army:s,isValid:l<=a,maxUnits:a,currentUnits:l}}static calculateMaxUnitsByLevel(e){return Math.max(5,2*e+5)}static createHumanGuard(e,t=1){const a=[];for(let o=0;o<e;o++){const e=this.createBattleUnit('人类守卫',t);e&&a.push(e)}return a}static createMixedEnemyArmy(e){const t=[];if(e.guards)for(let a=0;a<e.guards;a++){const e=this.createBattleUnit('人类守卫');e&&t.push(e)}if(e.soldiers)for(let a=0;a<e.soldiers;a++){const e=this.createBattleUnit('人类士兵');e&&t.push(e)}if(e.archers)for(let a=0;a<e.archers;a++){const e=this.createBattleUnit('人类弓箭手');e&&t.push(e)}if(e.mages)for(let a=0;a<e.mages;a++){const e=this.createBattleUnit('人类法师');e&&t.push(e)}if(e.priests)for(let a=0;a<e.priests;a++){const e=this.createBattleUnit('人类牧师');e&&t.push(e)}if(e.knights)for(let a=0;a<e.knights;a++){const e=this.createBattleUnit('人类骑士');e&&t.push(e)}return t}static createAIDefenseArmy(e){const t=[];if(e.guards)for(let a=0;a<e.guards;a++){const e=this.createBattleUnit('人类守卫');e&&t.push(e)}if(e.soldiers)for(let a=0;a<e.soldiers;a++){const e=this.createBattleUnit('人类士兵');e&&t.push(e)}if(e.archers)for(let a=0;a<e.archers;a++){const e=this.createBattleUnit('人类弓箭手');e&&t.push(e)}if(e.mages)for(let a=0;a<e.mages;a++){const e=this.createBattleUnit('人类法师');e&&t.push(e)}if(e.priests)for(let a=0;a<e.priests;a++){const e=this.createBattleUnit('人类牧师');e&&t.push(e)}if(e.knights)for(let a=0;a<e.knights;a++){const e=this.createBattleUnit('人类骑士');e&&t.push(e)}if(e.elves)for(let a=0;a<e.elves;a++){const e=this.createBattleUnit('永恒精灵游侠');e&&t.push(e)}if(e.undead)for(let a=0;a<e.undead;a++){const e=this.createBattleUnit('骷髅战士');e&&t.push(e)}if(e.demons)for(let a=0;a<e.demons;a++){const e=this.createBattleUnit('恶魔战士');e&&t.push(e)}if(e.angels)for(let a=0;a<e.angels;a++){const e=this.createBattleUnit('守护天使');e&&t.push(e)}return t}static createEnemyCharacterArmy(e){const t=[];if(e.human){const a=(0,Ft.sq)('人类');for(let o=0;o<e.human;o++){const e=a[Math.floor(Math.random()*a.length)],o=this.createBattleUnitFromEnemyCharacter(e);o&&t.push(o)}}if(e.elf){const a=(0,Ft.sq)('永恒精灵');for(let o=0;o<e.elf;o++){const e=a[Math.floor(Math.random()*a.length)],o=this.createBattleUnitFromEnemyCharacter(e);o&&t.push(o)}}if(e.undead){const a=(0,Ft.sq)('亡灵');for(let o=0;o<e.undead;o++){const e=a[Math.floor(Math.random()*a.length)],o=this.createBattleUnitFromEnemyCharacter(e);o&&t.push(o)}}if(e.angel){const a=(0,Ft.sq)('天使');for(let o=0;o<e.angel;o++){const e=a[Math.floor(Math.random()*a.length)],o=this.createBattleUnitFromEnemyCharacter(e);o&&t.push(o)}}if(e.demon){const a=(0,Ft.sq)('魔族');for(let o=0;o<e.demon;o++){const e=a[Math.floor(Math.random()*a.length)],o=this.createBattleUnitFromEnemyCharacter(e);o&&t.push(o)}}return t}static createEnemyCharacterArmyByLocation(e){let t={};switch(e){case'village':t={human:2};break;case'town':case'fortress':t={human:3};break;case'city':t={human:4};break;case'ruins':case'dungeon':t={undead:2}}return this.createEnemyCharacterArmy(t)}static createEnemyUnitCaptainArmy(e,t=2){const a=[],o=this.createBattleUnit(e);if(!o)return a;a.push(o);const n=(0,Ft.zw)(e);if(!n?.canLeadRaces)return a;const s=n.canLeadRaces[0],l=(0,Ft.sq)(s);if(0===l.length)return a;for(let e=0;e<t;e++){const e=l[Math.floor(Math.random()*l.length)],t=this.createBattleUnit(e.name);t&&a.push(t)}return a}static createBattle(e,t){return new $o(e,t)}static createBattleArmyFromFormation(e){const t=[];return e.forEach(e=>{e?.troops&&Object.entries(e.troops).forEach(([e,a])=>{const o=a;for(let a=0;a<o;a++){const a=this.getGoblinUnitNameByType(e),o=this.createBattleUnit(a);o&&t.push(o)}})}),t}static calculateFormationPower(e){let t=0;return e.forEach(e=>{e&&(t+=e.attributes.attack+e.attributes.defense+e.attributes.intelligence+e.attributes.speed)}),e.forEach(e=>{e?.troops&&Object.entries(e.troops).forEach(([e,a])=>{const o=a;for(let a=0;a<o;a++){const a=this.getGoblinUnitNameByType(e),o=this.createBattleUnit(a);o&&(t+=o.attributes.attack+o.attributes.defense+o.attributes.intelligence+o.attributes.speed)}})}),t}static createGoblinNestBattle(e,t=3){const a=[];for(let e=0;e<t;e++){const e=this.createRandomEnemy();e&&a.push(e)}return new $o(e,a)}static createLocationAttackBattle(e,t){let a=2,o=1;switch(t){case'village':a=2,o=1;break;case'town':case'dungeon':a=3,o=2;break;case'city':a=5,o=3;break;case'fortress':a=4,o=3;break;case'ruins':a=2,o=2}const n=[];for(let e=0;e<a;e++){const e=this.createRandomEnemy(o);e&&n.push(e)}return new $o(e,n)}static getUnitDescription(e){const{attack:t,defense:a,intelligence:o,speed:n}=e.attributes;return`${e.name} (等级:${e.level} 攻:${t} 防:${a} 知:${o} 速:${n})`}static getArmyPower(e){return e.reduce((e,t)=>e+t.attributes.attack+t.attributes.intelligence,0)}static getArmyAverageSpeed(e){if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t.attributes.speed,0);return Math.floor(t/e.length)}static getLevelStatistics(e){if(0===e.length)return{totalUnits:0,averageLevel:0,maxLevel:0,minLevel:0};const t=e.map(e=>e.level||1),a=t.reduce((e,t)=>e+t,0);return{totalUnits:e.length,averageLevel:Math.floor(a/e.length*100)/100,maxLevel:Math.max(...t),minLevel:Math.min(...t)}}static getGoblinUnitNameByType(e){return{grunt:'普通哥布林',warrior:'哥布林战士',shaman:'哥布林萨满',paladin:'哥布林圣骑士'}[e]||'普通哥布林'}}class Ao{static async generateBattleSummary(e){try{const t=this.buildBattleSummaryPrompt(e),a=await window.TavernHelper.generate({user_input:t});console.log('🧹 原始AI回复:',a);const o=formatAsTavernRegexedString(a,'ai_output','display');console.log('🎨 应用酒馆正则后的回复:',o),console.log('🔄 内容是否发生变化:',a!==o);const n=this.parseBattleSummary(o),s=this.extractKeyMoments(e),l=this.calculateCasualties(e),r=this.calculateStatistics(e);return await this.saveBattleSummaryToWorldbook(e,n),{summary:n,keyMoments:s,casualties:l,statistics:r}}catch(e){throw console.error('生成战斗总结失败:',e),new Error('生成战斗总结失败')}}static buildBattleSummaryPrompt(e){console.log('=== 战斗总结服务调试信息 ==='),console.log('战斗数据:',e),console.log('我方单位数量:',e.finalState?.allies?.length||0),console.log('敌方单位数量:',e.finalState?.enemies?.length||0),console.log('initialTroopState:',e.initialTroopState),e.finalState?.allies&&(console.log('我方单位详情:'),e.finalState.allies.forEach((e,t)=>{console.log(`  单位${t+1}:`,{name:e.name,id:e.id,troops:e.troops,initialTroops:e.initialTroops,originalTroops:e.originalTroops})}));let t=`\n<battlesummary>\n## 请根据以下战斗数据，生成一个详细的人物战斗被俘过程描述：\n\n## 战斗基本信息：\n  - 战斗结果：${e.victory?'胜利':'失败'}\n  - 总回合数：${e.totalTurns}\n  - 胜利方：${'allies'===e.finalState?.winner?'我方':'敌方'}\n\n## 战斗详细过程：`;if(e.turns&&e.turns.length>0&&e.turns.forEach((e,a)=>{t+=`\n\n第${a+1}回合：`,e.actions&&e.actions.length>0&&e.actions.forEach(e=>{e.description&&(t+=`\n${e.description}`)})}),e.finalState){if(t+='\n## 最终状态：',e.finalState.allies){let a=0,o=0,n='';console.log('=== 计算我方部队损失 ==='),console.log('我方单位数量:',e.finalState.allies.length),e.finalState.allies.forEach((t,s)=>{if(console.log(`\n处理单位 ${s+1}: ${t.name}`),console.log('单位数据:',{id:t.id,troops:t.troops,initialTroops:t.initialTroops,originalTroops:t.originalTroops}),t.troops){const s=e.initialTroopState?.[t.id]||{};console.log('获取到的初始部队数据:',s);const l=Math.max(0,(s.normalGoblins||0)-(t.troops.normalGoblins||0)),r=Math.max(0,(s.warriorGoblins||0)-(t.troops.warriorGoblins||0)),i=Math.max(0,(s.shamanGoblins||0)-(t.troops.shamanGoblins||0)),c=Math.max(0,(s.paladinGoblins||0)-(t.troops.paladinGoblins||0)),d=l+r+i+c,u=(s.normalGoblins||0)+(s.warriorGoblins||0)+(s.shamanGoblins||0)+(s.paladinGoblins||0);a+=d,o+=u,n+=`\n- ${t.name}:`,n+=` 普通哥布林-${l}`,n+=` 哥布林战士-${r}`,n+=` 哥布林萨满-${i}`,n+=` 哥布林圣骑士-${c}`}}),t+=`\n我方部队：损失 ${a}/${o} 人`,n&&(t+=n)}if(e.finalState.enemies){let a=0,o=0,n='';console.log('=== 计算敌方部队损失 ==='),console.log('敌方单位数量:',e.finalState.enemies.length),e.finalState.enemies.forEach((e,t)=>{if(console.log(`\n处理敌方单位 ${t+1}: ${e.name}`),console.log('敌方单位数据:',{id:e.id,troops:e.troops,initialTroops:e.initialTroops}),e.troops){const t=e.troops.count||0,s=t;console.log(`敌方单位 ${e.name} 损失计算:`,{部队数量:t,损失数量:s}),a+=s,o+=t;const l=e.troops.type||e.name||'未知部队';n+=`\n- ${e.name}: ${l}-${s}`}}),t+=`\n敌方部队：损失 ${a}/${o} 人`,n&&(t+=n)}}return t+='\n\n请生成一个生动、详细的人物战斗被俘过程描述，包括：\n1. 人物在战斗中的表现和挣扎\n2. 关键时刻人物的反应和决策\n3. 人物被击败的详细过程\n4. 被俘时的心理状态和身体状态\n5. 被俘后的处境和感受\n\n要求：\n- 使用第三人称叙述\n- 语言生动，富有戏剧性\n- 重点描述人物的心理变化和身体状态\n- 体现哥布林巢穴的黑暗奇幻风格\n- 长度控制在500-800字左右\n- 重点描述人物被俘的详细过程\n\n**注意：剧情应到被俘为止，不要出现被俘后的剧情**\n**注意：回合/伤害等信息只是参考，不要出现，而是化用为战斗情景**\n</battlesummary>\n',t}static parseBattleSummary(e){console.log('🔧 parseBattleSummary 被调用:',{responseLength:e?.length||0,responsePreview:e?.substring(0,100)||'无内容'});let t=e.replace(/\[OPTIONS_JSON\][\s\S]*?\[\/OPTIONS_JSON\]/gi,'').trim();return t=t.replace(/<[^>]+>/g,''),console.log('🔧 解析后的战斗总结:',{summaryLength:t?.length||0,summaryPreview:t?.substring(0,100)||'无内容'}),(!t||t.length<50)&&(console.log('🔧 战斗总结内容不足，使用默认内容'),t='战斗总结生成失败，请重试。'),console.log('🔧 最终战斗总结:',{finalLength:t.length,finalPreview:t.substring(0,100)}),t}static extractKeyMoments(e){const t=[];return e.turns&&0!==e.turns.length?(e.turns.forEach((e,a)=>{e.actions&&e.actions.length>0&&e.actions.forEach(e=>{(e.critical||e.damage>50||e.description?.includes('死亡')||e.description?.includes('阵亡'))&&t.push(`第${a+1}回合: ${e.description}`)})}),t.slice(0,5)):t}static calculateCasualties(e){const t={allies:[],enemies:[]};return e.finalState&&(e.finalState.allies&&e.finalState.allies.forEach(a=>{if(a.troops){const o=e.initialTroopState?.[a.id]||{},n=Math.max(0,(o.normalGoblins||0)-(a.troops.normalGoblins||0)),s=Math.max(0,(o.warriorGoblins||0)-(a.troops.warriorGoblins||0)),l=Math.max(0,(o.shamanGoblins||0)-(a.troops.shamanGoblins||0)),r=Math.max(0,(o.paladinGoblins||0)-(a.troops.paladinGoblins||0));(n>0||s>0||l>0||r>0)&&t.allies.push({unitName:a.name,losses:{normalGoblins:n,warriorGoblins:s,shamanGoblins:l,paladinGoblins:r,total:n+s+l+r}})}}),e.finalState.enemies&&e.finalState.enemies.forEach(e=>{if(e.troops){const a=e.initialTroops?.count||e.troops.count||0,o=e.troops.count||0,n=Math.max(0,a-o);n>0&&t.enemies.push({unitName:e.name,losses:{count:n,total:n}})}})),t}static calculateStatistics(e){let t=0,a=0;return e.turns&&e.turns.forEach(e=>{e.actions&&e.actions.forEach(e=>{e.damage&&(t+=e.damage),e.critical&&a++})}),{totalDamage:t,criticalHits:a,battleDuration:e.totalTurns}}static formatBattleSummary(e){return e.split('\n').filter(e=>e.trim()).map(e=>`<p>${e.trim()}</p>`).join('')}static saveBattleSummary(e,t){try{const a=getVariables({type:'character'});a[`battle_summary_${t}`]=e,replaceVariables(a,{type:'character'})}catch(e){console.error('保存战斗总结失败:',e)}}static loadBattleSummary(e){try{return getVariables({type:'character'})[`battle_summary_${e}`]||null}catch(e){return console.error('加载战斗总结失败:',e),null}}static async saveBattleSummaryToWorldbook(e,t){try{console.log('🔧 开始保存战斗总结到世界书:',{summary:t?'有内容':'无内容',summaryLength:t?.length||0});const o=this.getCurrentGameTime(),n=e.initialTroopState?.rewards?.heroes||[];console.log('🔧 据点英雄人物信息:',{总数:n.length,详情:n.map(e=>({name:e.name,id:e.id,status:e.status,canCombat:e.canCombat}))});const s=n.filter(e=>'enemy'===e.status&&!0===e.canCombat);if(console.log(`🔧 筛选出 ${s.length} 个敌方人物需要保存战斗总结`),s.length>0){const{WorldbookService:e}=await Promise.resolve().then(a.bind(a,844));for(const a of s){const n={gameTime:o,content:t,timestamp:Date.now()};await e.addMultipleBattleSummaryRecords(a.name,a.name,[n],a.status||'enemy'),console.log(`✅ 已保存敌方人物 ${a.name} 的战斗总结记录到世界书`)}}else console.log('🔧 据点中没有敌方人物，跳过战斗总结保存')}catch(e){console.error('保存战斗总结到世界书失败:',e)}}static getCurrentGameTime(){try{if('undefined'!=typeof window&&window.modularSaveManager){const e=window.modularSaveManager.resources.value.rounds||0;return d.Q.getTimeInfo(e).formattedDate}return d.Q.getTimeInfo(0).formattedDate}catch(e){return console.warn('获取当前游戏时间失败:',e),d.Q.getTimeInfo(0).formattedDate}}}const To={class:'battle-summary-container'},Mo={class:'summary-panel'},Ro={class:'summary-header'},_o={class:'summary-info'},Go={class:'summary-title'},Io={class:'summary-subtitle'},Oo={class:'header-buttons'},Po=['disabled'],Lo={class:'summary-shell'},Uo={class:'summary-viewport'},Fo={class:'summary-content'},Ho={key:0,class:'generating-state'},qo=['innerHTML'],Jo={class:'initial-state'},zo={class:'initial-welcome'},Wo={class:'welcome-text'},jo={class:'welcome-hint'},Yo={class:'initial-actions'},Ko=['disabled'],Qo=(0,o.defineComponent)({__name:'战斗总结界面',props:{summaryConfig:{}},emits:['close','summary-generated','summary-saved'],setup(e,{emit:t}){const a=e,n=t,s=(0,o.ref)(!1),l=(0,o.ref)(''),r=(0,o.computed)(()=>l.value?b.formatMessage(l.value,{enableMarkdown:!0,enableCodeHighlight:!0,enableQuote:!0}):''),i=async()=>{if(!s.value)try{s.value=!0;const e=await Ao.generateBattleSummary(a.summaryConfig.battleData);l.value=e.summary,a.summaryConfig.onSummaryGenerated&&a.summaryConfig.onSummaryGenerated(e.summary),n('summary-generated',e.summary)}catch(e){console.error('生成战斗总结失败:',e),toastr.error('生成战斗总结失败','AI生成失败')}finally{s.value=!1}},c=async()=>{l.value='',await i()},d=()=>{a.summaryConfig.onClose&&a.summaryConfig.onClose(),n('close')};return(0,o.onMounted)(()=>{a.summaryConfig.initialSummary?l.value=a.summaryConfig.initialSummary:(()=>{if(a.summaryConfig.saveKey)try{const e=Ao.loadBattleSummary(a.summaryConfig.saveKey);e&&(l.value=e)}catch(e){console.error('加载保存的总结失败:',e)}})()}),(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',To,[(0,o.createElementVNode)('div',Mo,[(0,o.createCommentVNode)(' 头部信息 '),(0,o.createElementVNode)('div',Ro,[(0,o.createElementVNode)('div',_o,[(0,o.createElementVNode)('div',Go,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(e.summaryConfig.title),1),(0,o.createElementVNode)('div',Io,(0,o.toDisplayString)(e.summaryConfig.subtitle),1)])]),(0,o.createElementVNode)('div',Oo,[(0,o.createElementVNode)('button',{class:'header-btn regenerate-btn',title:'重新生成总结',disabled:s.value,onClick:c},[...a[0]||(a[0]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🔄',-1)])],8,Po),(0,o.createElementVNode)('button',{class:'header-btn close-btn',title:'关闭总结界面',onClick:d},[...a[1]||(a[1]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'✕',-1)])])])]),(0,o.createCommentVNode)(' 总结内容区域 '),(0,o.createElementVNode)('div',Lo,[(0,o.createElementVNode)('div',Uo,[(0,o.createElementVNode)('div',Fo,[(0,o.createCommentVNode)(' 生成中的状态 '),s.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ho,[...a[2]||(a[2]=[(0,o.createElementVNode)('div',{class:'generating-animation'},[(0,o.createElementVNode)('div',{class:'spinner'}),(0,o.createElementVNode)('p',{class:'generating-text'},'正在生成战斗总结...')],-1)])])):l.value?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 总结内容 '),(0,o.createCommentVNode)(' eslint-disable-next-line vue/no-v-html '),(0,o.createElementVNode)('div',{class:'summary-text typo-book',innerHTML:r.value},null,8,qo)],2112)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:2},[(0,o.createCommentVNode)(' 初始空白状态 '),(0,o.createElementVNode)('div',Jo,[(0,o.createElementVNode)('div',zo,[(0,o.createElementVNode)('p',Wo,(0,o.toDisplayString)(e.summaryConfig.welcomeText),1),(0,o.createElementVNode)('p',jo,(0,o.toDisplayString)(e.summaryConfig.welcomeHint),1)]),(0,o.createElementVNode)('div',Yo,[(0,o.createElementVNode)('button',{class:'generate-btn',disabled:s.value,onClick:i},(0,o.toDisplayString)(s.value?'生成中...':'🎯 生成战斗总结'),9,Ko)])])],2112))])])])])]))}}),Xo={class:'battle-main'},Zo={class:'battle-content'},en={class:'units-panel allies-panel'},tn={class:'units-grid'},an={class:'unit-name-vertical-left'},on=['title','onClick'],nn=['src','alt'],sn={key:1,class:'default-portrait'},ln={class:'portrait-icon'},rn={class:'unit-health-bar-horizontal'},cn={class:'health-text-horizontal'},dn={class:'unit-attributes-vertical'},un={class:'attr-item'},mn={class:'attr-value'},gn={class:'attr-item'},hn={class:'attr-value'},pn={class:'attr-item'},vn={class:'attr-value'},fn={class:'attr-item'},yn={class:'attr-value'},bn={class:'battle-log-panel'},Nn={class:'log-container'},En={key:0,class:'battle-status-section'},kn={class:'battle-controls'},Sn=['title','disabled'],Vn={key:0,class:'focus-target-hint'},Cn={key:1,class:'battle-end-section'},wn={class:'history-button-container'},xn={key:0,class:'victory-section'},Dn={key:2,class:'action-list'},$n={class:'action-messages'},Bn={class:'action-description'},An={key:0,class:'action-damage'},Tn={key:0,class:'critical-mark'},Mn={key:0,class:'pagination-controls-horizontal'},Rn=['disabled'],_n=['title'],Gn={class:'units-panel enemies-panel'},In={class:'units-grid'},On=['onClick'],Pn={class:'unit-name-vertical-left'},Ln=['title','onClick'],Un=['src','alt'],Fn={key:1,class:'default-portrait'},Hn={class:'portrait-icon'},qn={class:'unit-health-bar-horizontal'},Jn={class:'health-text-horizontal'},zn={class:'unit-attributes-vertical'},Wn={class:'attr-item'},jn={class:'attr-value'},Yn={class:'attr-item'},Kn={class:'attr-value'},Qn={class:'attr-item'},Xn={class:'attr-value'},Zn={class:'attr-item'},es={class:'attr-value'},ts={class:'modal-header'},as={class:'modal-content'},os={key:0,class:'troops-list'},ns={key:0,class:'troop-item'},ss={class:'troop-count'},ls={key:1,class:'troop-item'},rs={class:'troop-count'},is={key:2,class:'troop-item'},cs={class:'troop-count'},ds={key:3,class:'troop-item'},us={class:'troop-count'},ms={key:4,class:'troop-item'},gs={class:'troop-name'},hs={class:'troop-count'},ps={key:5,class:'troop-item no-troops'},vs={class:'modal-content'},fs={class:'rewards-list'},ys={key:0,class:'reward-item'},bs={class:'reward-value'},Ns={key:1,class:'reward-item'},Es={class:'reward-value'},ks={key:2,class:'reward-item'},Ss={class:'reward-value'},Vs={key:3,class:'reward-item'},Cs={class:'reward-value'},ws={key:4,class:'reward-item'},xs={class:'reward-value'},Ds={key:5,class:'reward-item'},$s={class:'reward-value'},Bs={key:6,class:'reward-item hero-reward'},As={class:'heroes-list'},Ts={class:'reward-name'},Ms={class:'reward-value'},Rs={class:'reward-item hero-reward'},_s={class:'reward-name'},Gs={class:'reward-value'},Is={key:0,class:'history-modal'},Os={class:'modal-content'},Ps={class:'history-content'},Ls={key:0,class:'no-history'},Us={key:1,class:'history-list'},Fs={class:'history-header'},Hs={class:'history-turn'},qs={class:'history-actions'},Js={class:'action-description'},zs={key:0,class:'action-damage'},Ws={key:0,class:'critical-mark'},js=(0,o.defineComponent)({__name:'高级战斗界面',props:{battleData:{},isModal:{type:Boolean}},emits:['battle-complete','close-battle'],setup(e,{emit:t}){const n=e,s=t,l=(0,o.ref)('idle'),r=(0,o.ref)(1),i=(0,o.ref)([]),u=(0,o.ref)([]),m=(0,o.ref)([]),g=(0,o.ref)(null),h=(0,o.ref)(null),p=(0,o.ref)(!1),v=(0,o.ref)(!1),f=(0,o.ref)(null),b=(0,o.ref)(!1),N=(0,o.ref)(null),E=(0,o.ref)(!1),k=(0,o.ref)(null),S=(0,o.ref)(!1),V=(0,o.ref)(1),C=(0,o.ref)({}),w=(0,o.ref)(!1),x=(0,o.ref)(),D=(0,o.ref)(!1),B=(0,o.ref)(100),A=(0,o.ref)(null),T=(0,o.ref)(!1),M=(0,o.ref)(!1),R=(0,o.ref)(!1),G=(0,o.ref)(null),I=(0,o.ref)(''),O=(0,o.computed)(()=>0===m.value.length?null:m.value[V.value-1]||null),P=(0,o.computed)(()=>{try{const e=n.battleData?.target;if(e?.rewards?.heroes&&Array.isArray(e.rewards.heroes))return e.rewards.heroes.some(e=>'enemy'===e.status&&!0===e.canCombat);const t=c.l.getModuleData({moduleName:'training'});if(t&&t.characters)return t.characters.some(e=>'enemy'===e.status&&!0===e.canCombat)}catch(e){console.error('检查敌方人物失败:',e)}return!1}),L=(0,o.computed)(()=>P.value&&!T.value),U=e=>{if(e.avatar&&!e.avatar.startsWith('http'))return e.avatar;if(e.fallbackAvatar)return e.fallbackAvatar;switch(e.type){case'physical':return'⚔️';case'magical':return'🔮';case'defensive':return'🛡️';case'agile':return'🏹';case'hybrid':return'✨';default:return'👤'}},F=e=>Math.max(0,e.currentHealth/e.maxHealth*100),H=e=>{const t=[];if(e.actor){const a=i.value.some(t=>t.id===e.actor.id),o=u.value.some(t=>t.id===e.actor.id);a?t.push('ally-action'):o&&t.push('enemy-action')}return e.critical?t.push('action-critical'):e.hit?t.push('action-normal'):t.push('action-miss'),t.join(' ')},q=e=>{if(!e)return'未知部队';let t=Ft.YD.find(t=>t.name===e);return t||(t=Ft.YD.find(t=>t.id===e)),t?t.name:e},J=e=>{f.value=e,v.value=!0},W=()=>{v.value=!1,f.value=null},j=()=>{b.value=!1,N.value=null},Y=()=>{E.value=!0},K=()=>{E.value=!1},Q=()=>{g.value?(G.value={title:'人物战斗总结',subtitle:`胜利 - 第${g.value.totalTurns}回合`,welcomeText:'生成人物战斗被俘过程',welcomeHint:'AI将根据战斗数据生成详细的人物战斗被俘过程描述',battleData:g.value,saveKey:`battle_summary_${Date.now()}`,initialSummary:I.value,onSummaryGenerated:e=>{console.log('人物战斗总结已生成:',e),I.value=e},onSummarySaved:e=>{console.log('人物战斗总结已保存:',e)},onClose:()=>{R.value=!1}},R.value=!0):x.value?.error('战斗数据不完整，无法生成总结',{title:'错误',duration:3e3})},X=()=>{R.value=!1,G.value=null},Z=async()=>{if(console.log('确认奖励:',N.value),N.value?.heroes&&N.value.heroes.length>0)for(const e of N.value.heroes)await ee(e);else N.value?.hero&&await ee(N.value.hero);j(),pe()},ee=async e=>{try{const t=c.l.getModuleData({moduleName:'training'})||{characters:[]},o=t.characters.findIndex(t=>t.name===e.name&&('uncaptured'===t.status||'enemy'===t.status));if(-1!==o){const e=c.l.resources.value.rounds||0,n=d.Q.getTimeInfo(e).formattedDate,s={...t.characters[o],status:'imprisoned',capturedAt:n,loyalty:t.characters[o].loyalty||0,offspring:t.characters[o].offspring||0,lastTraining:void 0,favorite:t.characters[o].favorite||!1};t.characters[o]=s,console.log('英雄状态已更新为已捕获:',s.name);try{console.log('📚 [战斗界面] 开始更新英雄世界书...');const{WorldbookService:e}=await Promise.resolve().then(a.bind(a,844));await e.updateCharacterEntry(s),console.log('✅ [战斗界面] 英雄世界书已更新')}catch(e){console.error('❌ [战斗界面] 更新英雄世界书失败:',e)}}else console.warn('未找到对应的未捕获或敌方英雄:',e.name);c.l.updateModuleData({moduleName:'training',data:t}),console.log('英雄状态已更新为已捕获')}catch(e){console.error('更新英雄状态失败:',e)}},te=e=>{const t=e.target,a=t.parentElement;if(a){t.style.display='none';const e=a.querySelector('.default-portrait');e&&(e.style.display='block')}},ae=()=>{'idle'===l.value?re():'fighting'===l.value?(S.value&&(console.log('手动模式：执行下一回合战斗'),console.log('当前集火目标:',k.value?.name||'无'),k.value&&console.log('我方单位将优先攻击集火目标:',k.value.name)),ie()):'finished'===l.value&&console.log('战斗已结束，请使用相应的操作按钮')},oe=()=>{console.log('=== 开始手动战斗检查 ==='),console.log('当前我方单位数量:',i.value.length),console.log('当前敌方单位数量:',u.value.length);const e=Ut.FormationService.hasFormationData();return console.log('部队编制检查结果:',e),e?0===i.value.length||0===u.value.length?(console.log('单位数量不足，显示警告'),void Vo('请先设置战斗单位！')):(console.log('所有检查通过，开始战斗'),l.value='fighting',h.value=new $o(i.value,u.value),S.value=!0,void ie()):(console.log('没有部队编制数据，显示警告弹窗'),void(w.value=!0))},se=()=>{Ut.FormationService.hasFormationData()?0!==i.value.length&&0!==u.value.length?(l.value='fighting',h.value=new $o(i.value,u.value),S.value=!1,k.value=null,le()):Vo('请先设置战斗单位！'):w.value=!0},le=()=>{const e=()=>{if('fighting'!==l.value)return;const t=h.value?.executeSingleAction();if(t){console.log('执行行动:',t),m.value.push({turnNumber:m.value.length+1,actions:[t],startState:h.value?.getCurrentState()||{allies:i.value,enemies:u.value,currentTurn:r.value,isFinished:!1,winner:void 0},endState:t.endState}),V.value=m.value.length,i.value=t.endState?.allies||i.value,u.value=t.endState?.enemies||u.value;const a=i.value.filter(e=>e.isAlive),o=u.value.filter(e=>e.isAlive);0===a.length||0===o.length?(l.value='finished',console.log('战斗结束'),g.value={victory:a.length>0,totalTurns:m.value.length,finalState:{allies:i.value,enemies:u.value,currentTurn:r.value,isFinished:!0,winner:a.length>0?'allies':'enemies'},turns:m.value,statistics:{totalDamageDealt:0,totalDamageReceived:0,criticalHits:0,misses:0},initialTroopState:C.value},console.log('战斗结果:',g.value),me(),n.isModal&&s('battle-complete',g.value)):setTimeout(e,100)}};e()},re=()=>{if(!Co.hasEnoughActionPoints('attackLocation'))return w.value=!1,void Vo(Co.getInsufficientActionPointsMessage('attackLocation'));Co.consumeActionPoints('attackLocation')?oe():So('行动力消耗失败')},ie=()=>{if(!h.value)return;console.log('传递集火目标到战斗系统:',k.value?.name,'ID:',k.value?.id),console.log('当前战斗状态 - 我方单位:',i.value.map(e=>e.name),'敌方单位:',u.value.map(e=>e.name));const e=h.value.executeSingleAction(k.value||void 0);if(e){console.log('执行行动:',e),m.value.push({turnNumber:m.value.length+1,actions:[e],startState:h.value.getCurrentState(),endState:e.endState}),V.value=m.value.length,i.value=e.endState?.allies||i.value,u.value=e.endState?.enemies||u.value,k.value&&!k.value.isAlive&&(k.value=null,console.log('集火目标已被消灭，清除集火状态'));const t=i.value.filter(e=>e.isAlive),a=u.value.filter(e=>e.isAlive);0===t.length||0===a.length?(l.value='finished',console.log('战斗结束'),g.value={victory:t.length>0,totalTurns:m.value.length,finalState:{allies:i.value,enemies:u.value,currentTurn:r.value,isFinished:!0,winner:t.length>0?'allies':'enemies'},turns:m.value,statistics:{totalDamageDealt:0,totalDamageReceived:0,criticalHits:0,misses:0},initialTroopState:C.value},console.log('战斗结果:',g.value),g.value?.victory?x.value?.success('🎉 战斗胜利！据点已被征服！',{title:'胜利',duration:4e3}):x.value?.error('💀 战斗失败！部队损失惨重！',{title:'失败',duration:4e3}),n.isModal&&s('battle-complete',g.value)):S.value||setTimeout(()=>{'fighting'===l.value&&ie()},200)}},ce=()=>{V.value>1&&V.value--},de=()=>{console.log('显示据点奖励');const e=ue();b.value=!0,N.value=e},ue=()=>{const e=n.battleData?.target?.rewards||{gold:100,food:50,normalGoblins:2,warriorGoblins:0,shamanGoblins:0,paladinGoblins:0},t=n.battleData?.target;return t?.rewards?.heroes&&t.rewards.heroes.length>0&&(e.heroes=t.rewards.heroes),console.log('据点奖励数据:',{locationRewards:e,heroes:t?.rewards?.heroes}),e},me=()=>{console.log('开始同步哥布林损失到资源系统');let e=0,t=0,a=0,o=0;i.value.forEach(n=>{if(n.troops&&C.value[n.id]){const s=C.value[n.id],l={normalGoblins:n.troops.normalGoblins||0,warriorGoblins:n.troops.warriorGoblins||0,shamanGoblins:n.troops.shamanGoblins||0,paladinGoblins:n.troops.paladinGoblins||0},r=Math.max(0,s.normalGoblins-l.normalGoblins),i=Math.max(0,s.warriorGoblins-l.warriorGoblins),c=Math.max(0,s.shamanGoblins-l.shamanGoblins),d=Math.max(0,s.paladinGoblins-l.paladinGoblins);e+=r,t+=i,a+=c,o+=d,console.log(`单位 ${n.name} 损失:`,{normal:r,warrior:i,shaman:c,paladin:d})}});try{e>0&&c.l.consumeResource('normalGoblins',e,'战斗损失'),t>0&&c.l.consumeResource('warriorGoblins',t,'战斗损失'),a>0&&c.l.consumeResource('shamanGoblins',a,'战斗损失'),o>0&&c.l.consumeResource('paladinGoblins',o,'战斗损失'),console.log('哥布林损失已同步到存档系统:',{normalLoss:e,warriorLoss:t,shamanLoss:a,paladinLoss:o});const n=e+t+a+o;n>0&&x.value?.warning(`💀 战斗中损失了 ${n} 个哥布林！`,{title:'部队损失',duration:5e3})}catch(e){console.error('同步哥布林损失失败:',e)}},ge=()=>{console.log('撤退'),Co.refundActionPoints('attackLocation'),pe()},he=()=>{console.log('再来一次'),l.value='idle',r.value=1,m.value=[],g.value=null,h.value=null,V.value=1,i.value.forEach(e=>{e.currentHealth=e.maxHealth,e.isAlive=!0}),u.value.forEach(e=>{e.currentHealth=e.maxHealth,e.isAlive=!0})},pe=()=>{n.isModal?s('close-battle'):window.parent.postMessage({type:'close-battle'},'*')},ve=()=>{w.value=!1},fe=()=>{w.value=!1,window.parent.postMessage({type:'navigate-to-formation'},'*')},ye=()=>{if(console.log('开始初始化战斗数据...'),p.value&&i.value.length>0)return void console.log('战斗数据已初始化，跳过重复初始化');i.value=[];const e=Ut.FormationService.hasFormationData();if(console.log('=== 初始化战斗数据 ==='),console.log('检查是否有部队编制数据:',e),e){console.log('发现部队编制数据，加载已编制的部队');const e=Ut.FormationService.getFormationData();console.log('获取到的部队编制数据:',e),i.value=[...e],console.log('设置我方单位数量:',i.value.length);const t=Ut.FormationService.getFormationStats();console.log('部队编制统计:',t)}else console.log('没有部队编制数据，不设置任何我方单位'),i.value=[],console.log('我方单位数量:',i.value.length);console.log('保存初始部队状态'),C.value={},i.value.forEach(e=>{e.troops&&(C.value[e.id]={normalGoblins:e.troops.normalGoblins||0,warriorGoblins:e.troops.warriorGoblins||0,shamanGoblins:e.troops.shamanGoblins||0,paladinGoblins:e.troops.paladinGoblins||0})}),n.battleData?.target?.rewards&&(C.value.rewards=n.battleData.target.rewards,console.log('已保存据点奖励信息:',{gold:n.battleData.target.rewards.gold,food:n.battleData.target.rewards.food,heroes:n.battleData.target.rewards.heroes?.length||0})),console.log('初始部队状态已保存:',C.value),p.value=!0,be()},be=()=>{if(n.battleData?.enemyForces?.units&&n.battleData.enemyForces.units.length>0)console.log('使用据点敌方单位数据:',n.battleData.enemyForces.units),u.value=n.battleData.enemyForces.units.map((e,t)=>{console.log(`处理敌方单位 ${t}:`,{name:e.name,race:e.race,troops:e.troops,attributes:e.attributes});let a=0,o=0,n=0,s=0,l=0;if(e.troops&&e.troops.count>0||e.troopCount&&e.troopCount>0){const t=(0,Ft.sq)(e.race||'人类');let r,i;e.troops&&e.troops.count>0?(r=e.troops.type,i=e.troops.count):(r=e.name||e.class||'战士',i=e.troopCount||0),console.log(`单位 ${e.name} 部队信息:`,{troopType:r,troopCount:i,race:e.race,availableUnits:t.map(e=>({id:e.id,name:e.name}))});let c=t.find(e=>e.name===r);if(c||(c=t.find(e=>e.id===r)),c){const t=Math.min(c.level,10),d=t/10;a=Math.floor(i*c.attributes.attack*d),o=Math.floor(i*c.attributes.defense*d),n=Math.floor(i*c.attributes.intelligence*d),s=Math.floor(i*c.attributes.speed*d),l=Math.floor(i*c.attributes.health*d),console.log(`单位 ${e.name} 的部队属性加成:`,{troopType:r,matchingUnit:c.name,troopCount:i,troopLevel:t,troopMultiplier:d,bonuses:{attack:a,defense:o,intelligence:n,speed:s,health:l}})}else console.warn('未找到匹配的单位数据:',{race:e.race,troopType:r,availableUnits:t.map(e=>({id:e.id,name:e.name}))})}const r={attack:e.attributes?.attack||0,defense:e.attributes?.defense||0,intelligence:e.attributes?.intelligence||0,speed:e.attributes?.speed||0,health:e.attributes?.health||10},i={attack:r.attack+a,defense:r.defense+o,intelligence:r.intelligence+n,speed:r.speed+s},c=r.health+l;console.log(`单位 ${e.name} 属性计算:`,{基础属性:r,部队加成:{attack:a,defense:o,intelligence:n,speed:s,health:l},最终属性:{...i,health:c}});const d=e.troops||(e.troopCount>0?{type:e.name||e.class||'战士',count:e.troopCount}:null);return{id:e.id||`enemy_${t}`,name:e.name,type:e.unitType||'physical',level:e.level||1,attributes:i,maxHealth:c,currentHealth:c,isAlive:!0,avatar:e.avatar,troops:d}});else{const e=(()=>{try{const e=c.l.getModuleData({moduleName:'training'});if(e&&e.characters){const t=e.characters.filter(e=>'enemy'===e.status&&!0===e.canCombat);if(t.length>0)return console.log('找到enemy状态的可战斗人物:',t.length,'个'),t.map(e=>{const t=Bo.createBattleUnitFromEnemyCharacter(e);return t?(console.log(`成功创建敌方战斗单位: ${e.name}`,t),t):null}).filter(e=>null!==e)}}catch(e){console.error('加载enemy状态人物失败:',e)}return[]})();if(e.length>0)return console.log('没有据点敌方单位数据，使用调教模块中的enemy状态人物:',e),void(u.value=e);console.log('没有据点敌方单位数据和enemy状态人物，使用示例数据'),u.value=[{id:'human_guard_1',name:'人类守卫',type:'defensive',level:2,attributes:{attack:6,defense:8,intelligence:2,speed:3},maxHealth:25,currentHealth:25,isAlive:!0},{id:'human_mage_1',name:'人类法师',type:'magical',level:4,attributes:{attack:2,defense:1,intelligence:12,speed:3},maxHealth:18,currentHealth:18,isAlive:!0},{id:'human_archer_1',name:'人类弓箭手',type:'ranged',level:3,attributes:{attack:7,defense:3,intelligence:4,speed:6},maxHealth:20,currentHealth:20,isAlive:!0},{id:'human_knight_1',name:'人类骑士',type:'physical',level:5,attributes:{attack:10,defense:9,intelligence:3,speed:4},maxHealth:35,currentHealth:35,isAlive:!0},{id:'human_priest_1',name:'人类牧师',type:'magical',level:3,attributes:{attack:3,defense:2,intelligence:10,speed:4},maxHealth:22,currentHealth:22,isAlive:!0},{id:'human_assassin_1',name:'人类刺客',type:'physical',level:4,attributes:{attack:9,defense:2,intelligence:5,speed:8},maxHealth:16,currentHealth:16,isAlive:!0}]}},Ne=()=>{if(!L.value)return void console.log('无法进行战前对话：',{hasEnemyCharacters:P.value,dialogueCompleted:T.value});B.value=100;const e=(()=>{const e=n.battleData?.target;return e?.rewards?.heroes&&Array.isArray(e.rewards.heroes)?e.rewards.heroes.filter(e=>'enemy'===e.status&&!0===e.canCombat):[]})(),t=`当前据点中的敌方人物：${e.map(e=>e.name).join('、')}`,a=c.l.resources.value.rounds||0,o=d.Q.getTimeInfo(a).formattedDate;console.log('战前对话 - 时间戳:',Date.now());const s={enemyCharacters:e.map(e=>({name:e.name})),currentMorale:B.value,enemyInfo:t,gameTime:o,locationInfo:n.battleData?.target?{continent:n.battleData.target.continent||'未知大陆',region:n.battleData.target.region||'未知区域',difficulty:n.battleData.target.difficulty||'普通',name:n.battleData.target.name||'未知据点',description:n.battleData.target.description||'这是一个神秘的据点'}:void 0,allyForces:i.value.map(e=>({name:e.name,troops:e.troops?{normalGoblins:e.troops.normalGoblins||0,warriorGoblins:e.troops.warriorGoblins||0,shamanGoblins:e.troops.shamanGoblins||0,paladinGoblins:e.troops.paladinGoblins||0}:void 0})),enemyForces:u.value.map(e=>({name:e.name,type:e.type,troops:e.troops?{type:e.troops.type||e.name,count:e.troops.count||0}:void 0}))};A.value=xo.createDialogueConfig(s,{onMoraleChange:(e,t,a)=>{B.value=t,A.value&&xo.updateDialogueSubtitle(A.value,t)},onDialogueClose:()=>{Ee()},getCurrentMorale:()=>B.value}),D.value=!0},Ee=()=>{M.value=!0},ke=async()=>{console.log('确认结束战前对话，应用士气效果'),Ve(),T.value=!0,D.value=!1,A.value=null,M.value=!1,x.value?.success(`战前对话已结束！敌方士气降至 ${B.value.toFixed(1)}%，属性已调整`,{title:'对话结束',duration:4e3})},Se=()=>{M.value=!1},Ve=()=>{if(B.value>=100)return;const e=B.value/100;console.log(`应用士气效果：士气${B.value.toFixed(1)}%，属性调整为${(100*e).toFixed(1)}%`),u.value.forEach(t=>{t.attributes&&(t.attributes.attack=Math.round(t.attributes.attack*e),t.attributes.defense=Math.round(t.attributes.defense*e),t.attributes.intelligence=Math.round(t.attributes.intelligence*e),t.attributes.speed=Math.round(t.attributes.speed*e)),t.maxHealth&&(t.maxHealth=Math.round(t.maxHealth*e),t.currentHealth=Math.min(t.currentHealth,t.maxHealth))}),console.log('敌方单位属性已根据士气调整')};return(0,o.onMounted)(()=>{ye()}),(t,a)=>{return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['advanced-battle-interface',{'modal-mode':e.isModal}])},[(0,o.createCommentVNode)(' 战斗主体区域 '),(0,o.createElementVNode)('div',Xo,[(0,o.createCommentVNode)(' 战斗内容区域 '),(0,o.createElementVNode)('div',Zo,[(0,o.createCommentVNode)(' 左侧：我方单位信息 '),(0,o.createElementVNode)('div',en,[(0,o.createElementVNode)('div',tn,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['unit-card',{'unit-dead':!e.isAlive}])},[(0,o.createCommentVNode)(' 单位名称 - 竖直显示在左侧 '),(0,o.createElementVNode)('div',an,(0,o.toDisplayString)(e.name),1),(0,o.createCommentVNode)(' 单位肖像图片区域 '),(0,o.createElementVNode)('div',{class:'unit-portrait',title:e.troops?'点击查看下辖部队':'',onClick:t=>J(e)},[e.avatar&&e.avatar.startsWith('http')?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.avatar,alt:e.name,onError:te},null,40,nn)):((0,o.openBlock)(),(0,o.createElementBlock)('div',sn,[(0,o.createElementVNode)('span',ln,(0,o.toDisplayString)(U(e)),1)])),(0,o.createCommentVNode)(' 血量条 - 水平显示在顶部中心 '),(0,o.createElementVNode)('div',rn,[(0,o.createElementVNode)('div',{class:'health-fill-horizontal',style:(0,o.normalizeStyle)({width:F(e)+'%'})},null,4)]),(0,o.createElementVNode)('div',cn,(0,o.toDisplayString)(e.currentHealth)+'/'+(0,o.toDisplayString)(e.maxHealth),1)],8,on),(0,o.createCommentVNode)(' 四维属性显示 '),(0,o.createElementVNode)('div',dn,[(0,o.createElementVNode)('div',un,[a[4]||(a[4]=(0,o.createElementVNode)('span',{class:'attr-icon'},'⚔️',-1)),(0,o.createElementVNode)('span',mn,(0,o.toDisplayString)(e.attributes.attack),1)]),(0,o.createElementVNode)('div',gn,[a[5]||(a[5]=(0,o.createElementVNode)('span',{class:'attr-icon'},'🛡️',-1)),(0,o.createElementVNode)('span',hn,(0,o.toDisplayString)(e.attributes.defense),1)]),(0,o.createElementVNode)('div',pn,[a[6]||(a[6]=(0,o.createElementVNode)('span',{class:'attr-icon'},'🔮',-1)),(0,o.createElementVNode)('span',vn,(0,o.toDisplayString)(e.attributes.intelligence),1)]),(0,o.createElementVNode)('div',fn,[a[7]||(a[7]=(0,o.createElementVNode)('span',{class:'attr-icon'},'💨',-1)),(0,o.createElementVNode)('span',yn,(0,o.toDisplayString)(e.attributes.speed),1)])])],2))),128))])]),(0,o.createCommentVNode)(' 中间：历史记录 '),(0,o.createElementVNode)('div',bn,[(0,o.createElementVNode)('div',Nn,[(0,o.createCommentVNode)(' 战斗状态显示 '),'idle'===l.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',En,[(0,o.createElementVNode)('div',kn,[P.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:(0,o.normalizeClass)(['dialogue-btn',{disabled:!L.value}]),title:L.value?'战前讲话 - 降低敌方士气':'战前对话已完成，无法再次进行',disabled:!L.value,onClick:Ne},' 💬 战前讲话 ',10,Sn)):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('button',{class:'manual-battle-btn',onClick:oe},[a[8]||(a[8]=(0,o.createTextVNode)(' ⚔️ 手动战斗 ',-1)),k.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',Vn,'(集火: '+(0,o.toDisplayString)(k.value.name)+')',1)):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('button',{class:'auto-battle-btn',onClick:se},'🤖 自动战斗'),(0,o.createElementVNode)('button',{class:'retreat-btn',onClick:ge},'🏃 撤退')])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 战斗结束 '),'finished'===l.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Cn,[(0,o.createCommentVNode)(' 历史记录按钮 '),(0,o.createElementVNode)('div',wn,[(0,o.createElementVNode)('button',{class:'history-btn',title:'查看战斗历史',onClick:Y},'📜 查看战斗记录'),(0,o.createCommentVNode)(' 只有胜利且有人物单位时才显示战斗总结按钮 '),g.value?.victory&&P.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'summary-btn',title:'生成战斗总结',onClick:Q},' 📝 生成战斗总结 ')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' 胜利界面 '),g.value?.victory?((0,o.openBlock)(),(0,o.createElementBlock)('div',xn,[(0,o.createElementVNode)('button',{class:'harvest-btn',onClick:de},'🎁 开始收获')])):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 失败界面 '),(0,o.createElementVNode)('div',{class:'defeat-section'},[(0,o.createElementVNode)('div',{class:'defeat-actions'},[(0,o.createElementVNode)('button',{class:'retreat-btn',onClick:ge},'🏃 撤退'),(0,o.createElementVNode)('button',{class:'retry-btn',onClick:he},'🔄 再来一次')])])],2112))])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 当前行动显示 '),O.value&&'fighting'===l.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Dn,[(0,o.createElementVNode)('div',$n,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(O.value.actions,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:(0,o.normalizeClass)(['action-item',H(e)])},[(0,o.createElementVNode)('div',Bn,[(0,o.createTextVNode)((0,o.toDisplayString)(e.description)+' ',1),e.damage?((0,o.openBlock)(),(0,o.createElementBlock)('span',An,[(0,o.createTextVNode)(' (伤害: '+(0,o.toDisplayString)(e.damage)+' ',1),e.critical?((0,o.openBlock)(),(0,o.createElementBlock)('span',Tn,'💥')):(0,o.createCommentVNode)('v-if',!0),a[9]||(a[9]=(0,o.createTextVNode)(') ',-1))])):(0,o.createCommentVNode)('v-if',!0)])],2))),128))]),(0,o.createCommentVNode)(' 翻页按钮 - 左右样式 '),m.value.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Mn,[(0,o.createElementVNode)('button',{class:'pagination-btn left-pagination',disabled:V.value<=1,title:'上一回合',onClick:ce},' ← ',8,Rn),(0,o.createElementVNode)('button',{class:'pagination-btn right-pagination',disabled:!1,title:S.value&&'fighting'===l.value?'执行下一回合战斗':'下一回合',onClick:ae},' → ',8,_n)])):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createCommentVNode)(' 右侧：敌方单位信息 '),(0,o.createElementVNode)('div',Gn,[(0,o.createElementVNode)('div',In,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(u.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['unit-card',{'unit-dead':!e.isAlive,'unit-selected':k.value?.id===e.id,'unit-selectable':e.isAlive}]),onClick:t=>(e=>{if(!e.isAlive)return void console.log('目标已死亡，无法选择');u.value.some(t=>t.id===e.id)?(k.value=e,console.log('选择集火目标:',e.name,'ID:',e.id),S.value||(S.value=!0,console.log('自动设置为手动模式'))):console.log('只能选择敌方单位作为目标')})(e)},[(0,o.createCommentVNode)(' 单位名称 - 竖直显示在左侧 '),(0,o.createElementVNode)('div',Pn,(0,o.toDisplayString)(e.name),1),(0,o.createCommentVNode)(' 单位肖像图片区域 '),(0,o.createElementVNode)('div',{class:'unit-portrait',title:e.troops?'点击查看下辖部队':'',onClick:t=>J(e)},[e.avatar&&e.avatar.startsWith('http')?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.avatar,alt:e.name,onError:te},null,40,Un)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Fn,[(0,o.createElementVNode)('span',Hn,(0,o.toDisplayString)(U(e)),1)])),(0,o.createCommentVNode)(' 血量条 - 水平显示在顶部中心 '),(0,o.createElementVNode)('div',qn,[(0,o.createElementVNode)('div',{class:'health-fill-horizontal',style:(0,o.normalizeStyle)({width:F(e)+'%'})},null,4)]),(0,o.createElementVNode)('div',Jn,(0,o.toDisplayString)(e.currentHealth)+'/'+(0,o.toDisplayString)(e.maxHealth),1)],8,Ln),(0,o.createCommentVNode)(' 四维属性显示 '),(0,o.createElementVNode)('div',zn,[(0,o.createElementVNode)('div',Wn,[a[10]||(a[10]=(0,o.createElementVNode)('span',{class:'attr-icon'},'⚔️',-1)),(0,o.createElementVNode)('span',jn,(0,o.toDisplayString)(e.attributes.attack),1)]),(0,o.createElementVNode)('div',Yn,[a[11]||(a[11]=(0,o.createElementVNode)('span',{class:'attr-icon'},'🛡️',-1)),(0,o.createElementVNode)('span',Kn,(0,o.toDisplayString)(e.attributes.defense),1)]),(0,o.createElementVNode)('div',Qn,[a[12]||(a[12]=(0,o.createElementVNode)('span',{class:'attr-icon'},'🔮',-1)),(0,o.createElementVNode)('span',Xn,(0,o.toDisplayString)(e.attributes.intelligence),1)]),(0,o.createElementVNode)('div',Zn,[a[13]||(a[13]=(0,o.createElementVNode)('span',{class:'attr-icon'},'💨',-1)),(0,o.createElementVNode)('span',es,(0,o.toDisplayString)(e.attributes.speed),1)])])],10,On))),128))])])])]),(0,o.createCommentVNode)(' 部队信息弹窗 '),v.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'troops-modal-overlay',onClick:W},[(0,o.createElementVNode)('div',{class:'troops-modal',onClick:a[0]||(a[0]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',ts,[(0,o.createElementVNode)('h3',null,'👥 '+(0,o.toDisplayString)(f.value?.name)+' 的下辖部队',1),(0,o.createElementVNode)('button',{class:'close-button',onClick:W},'×')]),(0,o.createElementVNode)('div',as,[f.value?.troops?((0,o.openBlock)(),(0,o.createElementBlock)('div',os,[(0,o.createCommentVNode)(' 哥布林部队（我方单位） '),(f.value.troops.normalGoblins||0)>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ns,[a[14]||(a[14]=(0,o.createElementVNode)('span',{class:'troop-name'},'🟢 普通哥布林:',-1)),(0,o.createElementVNode)('span',ss,(0,o.toDisplayString)(f.value.troops.normalGoblins||0),1)])):(0,o.createCommentVNode)('v-if',!0),(f.value.troops.warriorGoblins||0)>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ls,[a[15]||(a[15]=(0,o.createElementVNode)('span',{class:'troop-name'},'⚔️ 哥布林战士:',-1)),(0,o.createElementVNode)('span',rs,(0,o.toDisplayString)(f.value.troops.warriorGoblins||0),1)])):(0,o.createCommentVNode)('v-if',!0),(f.value.troops.shamanGoblins||0)>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',is,[a[16]||(a[16]=(0,o.createElementVNode)('span',{class:'troop-name'},'🔮 哥布林萨满:',-1)),(0,o.createElementVNode)('span',cs,(0,o.toDisplayString)(f.value.troops.shamanGoblins||0),1)])):(0,o.createCommentVNode)('v-if',!0),(f.value.troops.paladinGoblins||0)>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ds,[a[17]||(a[17]=(0,o.createElementVNode)('span',{class:'troop-name'},'✨ 哥布林圣骑士:',-1)),(0,o.createElementVNode)('span',us,(0,o.toDisplayString)(f.value.troops.paladinGoblins||0),1)])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 敌方部队（敌方单位） '),(f.value.troops.count||0)>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ms,[(0,o.createElementVNode)('span',gs,'👥 '+(0,o.toDisplayString)(q(f.value.troops.type))+':',1),(0,o.createElementVNode)('span',hs,(0,o.toDisplayString)(f.value.troops.count||0),1)])):(0,o.createCommentVNode)('v-if',!0),0===(n=f.value,n.troops?void 0!==n.troops.normalGoblins?(n.troops.normalGoblins||0)+(n.troops.warriorGoblins||0)+(n.troops.shamanGoblins||0)+(n.troops.paladinGoblins||0):void 0!==n.troops.count?n.troops.count:0:0)?((0,o.openBlock)(),(0,o.createElementBlock)('div',ps,[...a[18]||(a[18]=[(0,o.createElementVNode)('span',{class:'troop-name'},'无下辖部队',-1)])])):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 奖励弹窗 '),b.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'rewards-modal-overlay',onClick:j},[(0,o.createElementVNode)('div',{class:'rewards-modal',onClick:a[1]||(a[1]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[a[19]||(a[19]=(0,o.createElementVNode)('h3',null,'🎁 据点奖励',-1)),(0,o.createElementVNode)('button',{class:'close-button',onClick:j},'×')]),(0,o.createElementVNode)('div',vs,[(0,o.createElementVNode)('div',fs,[N.value?.gold>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ys,[a[20]||(a[20]=(0,o.createElementVNode)('span',{class:'reward-icon'},'💰',-1)),a[21]||(a[21]=(0,o.createElementVNode)('span',{class:'reward-name'},'金币:',-1)),(0,o.createElementVNode)('span',bs,'+'+(0,o.toDisplayString)(N.value.gold),1)])):(0,o.createCommentVNode)('v-if',!0),N.value?.food>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ns,[a[22]||(a[22]=(0,o.createElementVNode)('span',{class:'reward-icon'},'🍖',-1)),a[23]||(a[23]=(0,o.createElementVNode)('span',{class:'reward-name'},'食物:',-1)),(0,o.createElementVNode)('span',Es,'+'+(0,o.toDisplayString)(N.value.food),1)])):(0,o.createCommentVNode)('v-if',!0),N.value?.normalGoblins>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ks,[a[24]||(a[24]=(0,o.createElementVNode)('span',{class:'reward-icon'},'👺',-1)),a[25]||(a[25]=(0,o.createElementVNode)('span',{class:'reward-name'},'普通哥布林:',-1)),(0,o.createElementVNode)('span',Ss,'+'+(0,o.toDisplayString)(N.value.normalGoblins),1)])):(0,o.createCommentVNode)('v-if',!0),N.value?.warriorGoblins>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Vs,[a[26]||(a[26]=(0,o.createElementVNode)('span',{class:'reward-icon'},'⚔️',-1)),a[27]||(a[27]=(0,o.createElementVNode)('span',{class:'reward-name'},'哥布林战士:',-1)),(0,o.createElementVNode)('span',Cs,'+'+(0,o.toDisplayString)(N.value.warriorGoblins),1)])):(0,o.createCommentVNode)('v-if',!0),N.value?.shamanGoblins>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',ws,[a[28]||(a[28]=(0,o.createElementVNode)('span',{class:'reward-icon'},'🔮',-1)),a[29]||(a[29]=(0,o.createElementVNode)('span',{class:'reward-name'},'哥布林萨满:',-1)),(0,o.createElementVNode)('span',xs,'+'+(0,o.toDisplayString)(N.value.shamanGoblins),1)])):(0,o.createCommentVNode)('v-if',!0),N.value?.paladinGoblins>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ds,[a[30]||(a[30]=(0,o.createElementVNode)('span',{class:'reward-icon'},'✨',-1)),a[31]||(a[31]=(0,o.createElementVNode)('span',{class:'reward-name'},'哥布林圣骑士:',-1)),(0,o.createElementVNode)('span',$s,'+'+(0,o.toDisplayString)(N.value.paladinGoblins),1)])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 英雄奖励 '),N.value?.heroes&&N.value.heroes.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Bs,[(0,o.createElementVNode)('div',As,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(N.value.heroes,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:'hero-item'},[a[32]||(a[32]=(0,o.createElementVNode)('span',{class:'reward-icon'},'👑',-1)),(0,o.createElementVNode)('span',Ts,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('span',Ms,(0,o.toDisplayString)(e.title||'英雄'),1)]))),128))])])):N.value?.hero?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:7},[(0,o.createCommentVNode)(' 兼容单个英雄格式 '),(0,o.createElementVNode)('div',Rs,[a[33]||(a[33]=(0,o.createElementVNode)('span',{class:'reward-icon'},'👑',-1)),(0,o.createElementVNode)('span',_s,(0,o.toDisplayString)(N.value.hero.name),1),(0,o.createElementVNode)('span',Gs,(0,o.toDisplayString)(N.value.hero.title||'英雄'),1)])],2112)):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createElementVNode)('div',{class:'modal-actions'},[(0,o.createElementVNode)('button',{class:'confirm-button success-button',onClick:Z},'确定')])])])):(0,o.createCommentVNode)('v-if',!0)],2),(0,o.createCommentVNode)(' 战斗历史记录弹窗 '),E.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Is,[(0,o.createElementVNode)('div',{class:'modal-overlay',onClick:K}),(0,o.createElementVNode)('div',Os,[(0,o.createElementVNode)('div',{class:'modal-header'},[a[34]||(a[34]=(0,o.createElementVNode)('h3',{class:'modal-title'},'战斗历史记录',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:K},'×')]),(0,o.createElementVNode)('div',Ps,[0===m.value.length?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ls,[...a[35]||(a[35]=[(0,o.createElementVNode)('div',{class:'no-history-icon'},'⚔️',-1),(0,o.createElementVNode)('div',{class:'no-history-text'},'暂无战斗记录',-1),(0,o.createElementVNode)('div',{class:'no-history-hint'},'开始战斗后记录将显示在这里',-1)])])):((0,o.openBlock)(),(0,o.createElementBlock)('div',Us,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(m.value,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'history-item'},[(0,o.createElementVNode)('div',Fs,[(0,o.createElementVNode)('div',Hs,'回合 '+(0,o.toDisplayString)(t+1),1),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['history-status',t<m.value.length-1?'finished':'ongoing'])},(0,o.toDisplayString)(t<m.value.length-1?'已结束':'进行中'),3)]),(0,o.createElementVNode)('div',qs,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.actions,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:(0,o.normalizeClass)(['history-action',H(e)])},[(0,o.createElementVNode)('div',Js,[(0,o.createTextVNode)((0,o.toDisplayString)(e.description)+' ',1),e.damage?((0,o.openBlock)(),(0,o.createElementBlock)('span',zs,[(0,o.createTextVNode)(' (伤害: '+(0,o.toDisplayString)(e.damage)+' ',1),e.critical?((0,o.openBlock)(),(0,o.createElementBlock)('span',Ws,'💥')):(0,o.createCommentVNode)('v-if',!0),a[36]||(a[36]=(0,o.createTextVNode)(') ',-1))])):(0,o.createCommentVNode)('v-if',!0)])],2))),128))])]))),128))]))])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 自定义确认框 '),(0,o.createVNode)(y,{show:w.value,title:'无法开始战斗',message:'请先进行部队编制！',details:'没有编制部队无法参与战斗，请前往部队编制界面进行编制。','confirm-text':'前往编制','cancel-text':'取消',type:'warning',onConfirm:fe,onCancel:ve,onClose:ve},null,8,['show']),(0,o.createCommentVNode)(' 战前对话结束确认框 '),(0,o.createVNode)(y,{show:M.value,title:'结束战前对话',message:'确定要结束战前对话吗？',details:`当前敌方士气：${B.value.toFixed(1)}%。结束对话后，敌方单位属性将按士气百分比进行调整，且无法再次进行战前对话。`,'confirm-text':'结束对话','cancel-text':'继续对话',type:'warning',onConfirm:ke,onCancel:Se,onClose:Se},null,8,['show','details']),(0,o.createCommentVNode)(' 弹窗提示组件 '),(0,o.createVNode)(Eo,{ref_key:'toastRef',ref:x},null,512),(0,o.createCommentVNode)(' 战前对话界面 '),D.value?((0,o.openBlock)(),(0,o.createBlock)(ne,{key:1,'dialogue-config':A.value,onClose:Ee},null,8,['dialogue-config'])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 战斗总结界面 '),R.value?((0,o.openBlock)(),(0,o.createBlock)(Qo,{key:2,'summary-config':G.value,onClose:X,onSummaryGenerated:a[2]||(a[2]=e=>console.log('总结生成:',e)),onSummarySaved:a[3]||(a[3]=e=>console.log('总结保存:',e))},null,8,['summary-config'])):(0,o.createCommentVNode)('v-if',!0)],64);var n}}}),Ys=(0,f.A)(js,[['__scopeId','data-v-ff977f92']]);class Ks{static TYPE_MAPPING={城镇:'town',村庄:'village',城市:'city',要塞:'fortress',废墟:'ruins',地牢:'dungeon'};static DIFFICULTY_MAPPING={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10};static parseLocations(e){console.log('🔍 [据点解析器] 开始解析据点信息'),console.log('📝 [据点解析器] 原始文本长度:',e.length),console.log('📝 [据点解析器] 原始文本开头:',e.substring(0,100)+'...');try{let t=e.trim();console.log('🧹 [据点解析器] 清理后文本长度:',t.length),console.log('🔧 [据点解析器] 应用酒馆正则清理文本...');const a=formatAsTavernRegexedString(t,'ai_output','display');return console.log('🔧 [据点解析器] 酒馆正则处理前长度:',t.length),console.log('🔧 [据点解析器] 酒馆正则处理后长度:',a.length),console.log('🔧 [据点解析器] 酒馆正则处理是否有效:',t!==a),t!==a?(t=a,console.log('✅ [据点解析器] 酒馆正则处理完成，使用清理后的文本')):console.log('ℹ️ [据点解析器] 酒馆正则未改变文本，继续使用原始文本'),console.log('🔧 [据点解析器] 开始提取JSON数据...'),t=this.extractJsonFromText(t),console.log('🔧 [据点解析器] 提取JSON后长度:',t.length),console.log('🔧 [据点解析器] 提取的JSON开头:',t.substring(0,100)+'...'),console.log('✅ [据点解析器] 检查JSON格式...'),console.log('✅ [据点解析器] 文本开头字符:',t.charAt(0)),console.log('✅ [据点解析器] 是否以{开头:',t.startsWith('{')),console.log('✅ [据点解析器] 是否以[开头:',t.startsWith('[')),t.startsWith('{')||t.startsWith('[')?(console.log('✅ [据点解析器] JSON格式验证通过，开始解析JSON...'),t.startsWith('[')?this.parseMultipleJsonLocations(t):this.parseJsonLocation(t)):(console.error('❌ [据点解析器] 无法找到有效的JSON数据'),console.error('❌ [据点解析器] 清理后的文本:',t.substring(0,200)+'...'),null)}catch(e){return console.error('❌ [据点解析器] 解析据点信息失败:',e),console.error('❌ [据点解析器] 错误堆栈:',e.stack),null}}static parseJsonLocation(e){console.log('🔍 [JSON解析器] 开始解析JSON数据'),console.log('📝 [JSON解析器] JSON文本长度:',e.length),console.log('📝 [JSON解析器] JSON文本开头:',e.substring(0,100)+'...');try{console.log('🔧 [JSON解析器] 开始JSON.parse()...');const t=JSON.parse(e);console.log('✅ [JSON解析器] JSON解析成功'),console.log('📊 [JSON解析器] 数据类型:',typeof t,Array.isArray(t)?'(数组)':'(对象)');const a=Array.isArray(t)?t[0]:t;if(console.log('📊 [JSON解析器] 据点数据:',a),!a)throw console.error('❌ [JSON解析器] JSON数据为空'),new Error('JSON数据为空');console.log('🔄 [JSON解析器] 开始类型转换...'),console.log('🔄 [JSON解析器] 原始类型:',a.type),console.log('🔄 [JSON解析器] 原始难度:',a.difficulty);const o=this.TYPE_MAPPING[a.type]||a.type,n=this.DIFFICULTY_MAPPING[a.difficulty]||('number'==typeof a.difficulty?a.difficulty:1);if(console.log('🔄 [JSON解析器] 转换后类型:',o),console.log('🔄 [JSON解析器] 转换后难度:',n),console.log('✅ [JSON解析器] 验证必要字段...'),console.log('✅ [JSON解析器] name:',a.name),console.log('✅ [JSON解析器] type:',a.type),console.log('✅ [JSON解析器] description:',a.description?'存在':'缺失'),console.log('✅ [JSON解析器] difficulty:',a.difficulty),!(a.name&&a.type&&a.description&&a.difficulty))throw console.error('❌ [JSON解析器] 缺少必要字段'),console.error('❌ [JSON解析器] name存在:',!!a.name),console.error('❌ [JSON解析器] type存在:',!!a.type),console.error('❌ [JSON解析器] description存在:',!!a.description),console.error('❌ [JSON解析器] difficulty存在:',!!a.difficulty),new Error('缺少必要字段');console.log('✅ [JSON解析器] 所有必要字段验证通过'),console.log('🆔 [JSON解析器] 生成唯一ID...');const s=this.generateLocationId(a.name);console.log('🆔 [JSON解析器] 生成的ID:',s),console.log('🏗️ [JSON解析器] 构建Location对象...');const l={id:s,name:a.name,type:o,icon:a.icon||this.getDefaultIcon(o),description:a.description,difficulty:n,distance:a.distance||0,rewards:{...a.rewards?.gold>0&&{gold:a.rewards.gold},...a.rewards?.food>0&&{food:a.rewards.food},...a.rewards?.slaves>0&&{slaves:a.rewards.slaves}},status:'unknown'};return console.log('🏗️ [JSON解析器] 基础Location对象构建完成:',l),a.baseGuards&&(console.log('⚔️ [JSON解析器] 添加基础守军:',a.baseGuards),l.baseGuards=a.baseGuards),a.specialUnit&&(console.log('👤 [JSON解析器] 添加特殊单位:',a.specialUnit),l.specialUnit=a.specialUnit),a.continent&&(console.log('🌍 [JSON解析器] 添加大陆信息:',a.continent),l.continent=a.continent),a.region&&(console.log('🗺️ [JSON解析器] 添加区域信息:',a.region),l.region=a.region),a.race&&(console.log('🧬 [JSON解析器] 添加种族信息:',a.race),l.race=a.race),console.log('🎉 [JSON解析器] 解析完成，最终Location对象:',l),console.log('🔍 [JSON解析器] 最终Location的baseGuards:',l.baseGuards),console.log('🔍 [JSON解析器] 最终Location的specialUnit:',l.specialUnit),l}catch(e){return console.error('❌ [JSON解析器] 解析JSON据点信息失败:',e),console.error('❌ [JSON解析器] 错误类型:',e.constructor.name),console.error('❌ [JSON解析器] 错误消息:',e.message),console.error('❌ [JSON解析器] 错误堆栈:',e.stack),null}}static generateLocationId(e){const t=Date.now(),a=Math.random().toString(36).substr(2,5);return`${e.replace(/\s+/g,'_').toLowerCase()}_${t}_${a}`}static getDefaultIcon(e){return{town:'🏙️',village:'🏘️',city:'🏛️',fortress:'🏰',ruins:'🏚️',dungeon:'🕳️'}[e]||'📍'}static validateLocation(e){const t=[];return e.id||t.push('缺少ID'),e.name||t.push('缺少名称'),e.type||t.push('缺少类型'),e.description||t.push('缺少描述'),e.difficulty||t.push('缺少难度'),isNaN(e.distance)&&t.push('距离必须是数字'),e.distance<0&&t.push('距离不能为负数'),{valid:0===t.length,errors:t}}static parseMultipleJsonLocations(e){try{const t=e.trim();if(console.log('🔍 [批量解析器] 开始解析多个据点'),console.log('📝 [批量解析器] 输入文本长度:',t.length),console.log('📝 [批量解析器] 输入文本开头:',t.substring(0,50)+'...'),console.log('🔍 [批量解析器] 检查JSON数组格式...'),console.log('🔍 [批量解析器] 清理后文本长度:',t.length),console.log('🔍 [批量解析器] 清理后文本开头:',t.substring(0,50)+'...'),console.log('🔍 [批量解析器] 是否以[开头:',t.startsWith('[')),!t.startsWith('['))return console.error('❌ [批量解析器] 无法找到有效的JSON数组数据'),console.error('❌ [批量解析器] 原始文本:',e.substring(0,200)+'...'),console.error('❌ [批量解析器] 清理后文本:',t.substring(0,200)+'...'),[];const a=JSON.parse(t);if(console.log('🔍 [批量解析器] JSON解析成功，数据类型:',Array.isArray(a)?'数组':'对象'),console.log('🔍 [批量解析器] 据点数量:',a.length),!Array.isArray(a))return console.error('❌ [批量解析器] JSON数据不是数组格式'),[];const o=[];console.log('🔍 [批量解析器] 开始解析',a.length,'个据点...');for(let e=0;e<a.length;e++){const t=a[e];console.log(`🔍 [批量解析器] 解析第${e+1}个据点:`,t.name);try{const a=this.TYPE_MAPPING[t.type]||t.type,n=this.DIFFICULTY_MAPPING[t.difficulty]||('number'==typeof t.difficulty?t.difficulty:1);if(!(t.name&&t.type&&t.description&&t.difficulty)){console.warn('据点缺少必要字段:',t);continue}const s={id:this.generateLocationId(t.name),name:t.name,type:a,icon:t.icon||this.getDefaultIcon(a),description:t.description,difficulty:n,distance:t.distance||0,rewards:{...t.rewards?.gold>0&&{gold:t.rewards.gold},...t.rewards?.food>0&&{food:t.rewards.food},...t.rewards?.slaves>0&&{slaves:t.rewards.slaves}},status:'unknown'};t.enemyUnits&&Array.isArray(t.enemyUnits)&&(s.enemyUnits=t.enemyUnits),t.baseGuards&&(console.log('⚔️ [批量解析器] 添加基础守军:',t.baseGuards),s.baseGuards=t.baseGuards),t.specialUnit&&(console.log('👤 [批量解析器] 添加特殊单位:',t.specialUnit),s.specialUnit=t.specialUnit),t.continent&&(console.log('🌍 [批量解析器] 添加大陆信息:',t.continent),s.continent=t.continent),t.region&&(console.log('🗺️ [批量解析器] 添加区域信息:',t.region),s.region=t.region),t.race&&(console.log('🧬 [批量解析器] 添加种族信息:',t.race),s.race=t.race),o.push(s),console.log(`✅ [批量解析器] 第${e+1}个据点解析成功:`,s.name)}catch(a){console.error(`❌ [批量解析器] 第${e+1}个据点解析失败:`,a,t)}}return console.log('🎉 [批量解析器] 批量解析完成，成功解析',o.length,'个据点'),o}catch(e){return console.error('解析JSON多个据点失败:',e),[]}}static extractJsonFromText(e){if(console.log('🔍 [JSON提取器] 开始提取JSON数据'),console.log('📝 [JSON提取器] 输入文本长度:',e.length),console.log('📝 [JSON提取器] 输入文本开头:',e.substring(0,50)+'...'),console.log('🔧 [JSON提取器] 检查是否包含<json>标签...'),e.includes('<json>')){console.log('✅ [JSON提取器] 找到<json>标签');const t=e.indexOf('<json>')+6,a=e.indexOf('</json>',t);if(console.log('🔧 [JSON提取器] JSON开始位置:',t),console.log('🔧 [JSON提取器] JSON结束位置:',a),-1!==a){const o=e.substring(t,a).trim();return console.log('✅ [JSON提取器] 成功从<json>标签提取JSON，长度:',o.length),console.log('✅ [JSON提取器] 提取的JSON开头:',o.substring(0,50)+'...'),o}console.log('❌ [JSON提取器] 未找到结束的</json>标签')}else console.log('❌ [JSON提取器] 未找到<json>标签');if(console.log('🔧 [JSON提取器] 检查是否包含```json标记...'),e.includes('```json')){console.log('✅ [JSON提取器] 找到```json标记');const t=e.indexOf('```json')+7,a=e.indexOf('```',t);if(console.log('🔧 [JSON提取器] JSON开始位置:',t),console.log('🔧 [JSON提取器] JSON结束位置:',a),-1!==a){const o=e.substring(t,a).trim();return console.log('✅ [JSON提取器] 成功提取JSON，长度:',o.length),console.log('✅ [JSON提取器] 提取的JSON开头:',o.substring(0,50)+'...'),o}console.log('❌ [JSON提取器] 未找到结束的```标记')}else console.log('❌ [JSON提取器] 未找到```json标记');if(console.log('🔧 [JSON提取器] 检查是否包含普通```标记...'),e.includes('```')){console.log('✅ [JSON提取器] 找到普通```标记');const t=e.indexOf('```'),a=e.indexOf('{',t),o=e.indexOf('```',a);if(console.log('🔧 [JSON提取器] 代码块开始位置:',t),console.log('🔧 [JSON提取器] JSON开始位置:',a),console.log('🔧 [JSON提取器] JSON结束位置:',o),-1!==a&&-1!==o){const t=e.substring(a,o).trim();return console.log('✅ [JSON提取器] 从普通代码块提取JSON，长度:',t.length),console.log('✅ [JSON提取器] 提取的JSON开头:',t.substring(0,50)+'...'),t}console.log('❌ [JSON提取器] 普通代码块中未找到有效的JSON')}else console.log('❌ [JSON提取器] 未找到普通```标记');console.log('🔧 [JSON提取器] 使用正则表达式查找JSON对象...');const t=e.match(/\{[\s\S]*\}/);if(t){const e=t[0].trim();return console.log('✅ [JSON提取器] 通过正则匹配到JSON对象，长度:',e.length),console.log('✅ [JSON提取器] 匹配的JSON开头:',e.substring(0,50)+'...'),e}console.log('❌ [JSON提取器] 正则未匹配到JSON对象'),console.log('🔧 [JSON提取器] 使用正则表达式查找JSON数组...');const a=e.match(/\[[\s\S]*\]/);if(a){const e=a[0].trim();return console.log('✅ [JSON提取器] 通过正则匹配到JSON数组，长度:',e.length),console.log('✅ [JSON提取器] 匹配的JSON开头:',e.substring(0,50)+'...'),e}console.log('❌ [JSON提取器] 正则未匹配到JSON数组'),console.log('⚠️ [JSON提取器] 所有方法都失败，返回原始文本');const o=e.trim();return console.log('⚠️ [JSON提取器] 返回文本长度:',o.length),console.log('⚠️ [JSON提取器] 返回文本开头:',o.substring(0,50)+'...'),o}static getStarDifficultyText(e){return'★'.repeat(e)}static formatLocationForDisplay(e){const t=Object.entries(e.rewards).filter(([_,e])=>Array.isArray(e)?e.length>0:e&&e>0).map(([e,t])=>{const a={gold:'💰',food:'🍖',slaves:'🔒'};return Array.isArray(t)?`${a[e]||'📦'}${t.join(', ')}`:`${a[e]||'📦'}${t}`}).join(' ');return`${e.icon} ${e.name} (${this.getStarDifficultyText(e.difficulty)}, ${e.distance}km) - ${t}`}}var Qs=a(885),Xs=a(208);class Zs{static LOCATION_GENERATION_PROMPT='\n# 据点侦察模式规则：\n1. 生成指定数量的符合哥布林巢穴游戏设定类型的据点\n2. 目标类型要多样化（村庄、城镇、城市、要塞、废墟、地牢）\n3. 难度要合理分布，奖励要与难度匹配\n4. baseGuards\n5. specialUnit为可选的特殊单位，可以是据点特有的精英单位，***不允许是人物***\n\n<json>\n{\n  "name": "{据点名称}",\n  "type": "{城镇|村庄|城市|要塞|废墟|地牢}",\n  "icon": "{emoji图标}",\n  "description": "{据点描述}",\n  "difficulty": {星级难度，1-10的数字},\n  "distance": {距离公里数},\n  "continent": "{大陆名称}",\n  "region": "{区域名称}",\n  "race": "{据点主要种族，人类/永恒精灵/狐族/黑暗精灵/亡灵/恶魔，只允许选择一个种族}",\n  "baseGuards": {此值为据点守军总人数，根据据点难度和类型合理设定，也要符合现实，比如*一个村落不可能有几百人的部队，同时一个要塞不可能只有几十人守军*},\n  "rewards": {\n    "gold": {金币数量},\n    "food": {食物数量},\n    "slaves": {女性奴隶数量，请参考据点实际情况，数量符合现实即可}\n  },\n  "specialUnit": {\n    "name": "{特殊单位名称}",\n    "race": "{特殊单位种族}",\n    "class": "{特殊单位职业}",\n    "attributes": {\n      "attack": {攻击力，5-20范围},\n      "defense": {防御力，5-20范围},\n      "intelligence": {智力，5-20范围},\n      "speed": {速度，5-20范围},\n      "health": {生命值，20-40范围}\n    }\n  }\n}\n</json>\n\n***请只输出json信息，使用<json>标签包裹，禁止出现剧情发展***\n';static async generateLocations(e=1,t,a,o,n){try{let s=this.LOCATION_GENERATION_PROMPT;if(s+=`\n\n# 据点数量要求：\n请生成 ${e} 个据点${1===e?'':'，返回JSON数组格式'}`,a&&o){s=s.replace('{大陆名称}',a),s=s.replace('{区域名称}',o);const e=Qs.continentExploreService.continents.value.find(e=>e.name===a);e&&(s+=`\n# 大陆描述参考：${e.description}`);const t=e?.regions.find(e=>e.name===o);t&&(s+=`\n# 区域描述参考：${t.description}`)}if(a&&o){const e=Qs.continentExploreService.continents.value.find(e=>e.name===a),t=e?.regions.find(e=>e.name===o);if(e&&t){const a=e.difficulty,o=e.difficulty+t.difficulty;s=s.replace('{星级难度，1-10的数字}',`{${a}-${o}}`),s+=`\n# 区域难度信息：当前区域的难度范围应在 ${a}-${o} 星之间`}}n?.type&&(s+=`\n\n侦察队重点寻找类型：${n.type}`),s+=t||'';const l=await window.TavernHelper.generate({user_input:s});if(!l)return{success:!1,error:'侦察队未返回有效报告'};if(1===e){const e=Ks.parseLocations(l);if(!e||Array.isArray(e))return{success:!1,error:'无法解析据点信息',aiResponse:l};const t=e,a=Ks.validateLocation(t);if(!a.valid)return{success:!1,error:`据点数据验证失败: ${a.errors.join(', ')}`,aiResponse:l};const o=t;return Xs.exploreService.addLocation(o)?{success:!0,location:o,aiResponse:l}:{success:!1,error:'据点已存在，无法重复添加'}}{const e=Ks.parseLocations(l);if(!e||!Array.isArray(e))return{success:!1,locations:[],errors:['无法从侦察报告中提取据点信息'],totalAdded:0,aiResponse:l};const t=e,a=[],o=[];for(const e of t)try{const t=Ks.validateLocation(e);if(!t.valid){a.push(`据点 ${e.name}: ${t.errors.join(', ')}`);continue}const n=e;Xs.exploreService.addLocation(n)?o.push(n):a.push(`据点 ${e.name} 已存在，无法重复添加`)}catch(t){console.error(`处理据点 ${e.name} 时出错:`,t),a.push(`据点 ${e.name} 处理失败: ${t}`)}return{success:o.length>0,locations:o,errors:a,totalAdded:o.length,aiResponse:l}}}catch(e){return console.error('据点生成失败:',e),{success:!1,error:`据点生成失败: ${e}`}}}}const el={class:'explore-container'},tl={class:'explore-header'},al={class:'header-right'},ol={class:'explore-stats'},nl={class:'stat-item'},sl={class:'value'},ll={class:'stat-item'},rl={class:'value'},il=['disabled'],cl={class:'continent-tabs'},dl={class:'tabs-container'},ul=['disabled','onClick'],ml={class:'tab-icon'},gl={class:'tab-content'},hl={class:'tab-name'},pl={class:'tab-progress'},vl={class:'progress-bar'},fl={class:'progress-text'},yl={key:0,class:'conquered-badge'},bl={key:0,class:'region-tabs'},Nl={class:'tabs-container'},El=['disabled','onClick'],kl={class:'tab-icon'},Sl={class:'tab-content'},Vl={class:'tab-name'},Cl={class:'tab-progress'},wl={class:'progress-bar'},xl={class:'progress-text'},Dl={key:0,class:'conquered-badge'},$l={class:'explore-content'},Bl={class:'explore-filters'},Al={class:'filter-group'},Tl={class:'filter-buttons'},Ml=['onClick'],Rl={class:'explore-scroll-container'},_l={class:'explore-grid'},Gl={class:'card-header'},Il={class:'explore-icon'},Ol={class:'explore-info'},Pl={class:'explore-name'},Ll={class:'explore-description'},Ul={class:'explore-stats'},Fl={class:'distance'},Hl={key:0,class:'scout-results'},ql={class:'scout-details'},Jl={class:'detail-item'},zl={class:'value'},Wl={class:'detail-item'},jl={class:'value'},Yl={key:0},Kl={key:1},Ql={key:2},Xl={key:0,class:'detail-item'},Zl={class:'value'},er={class:'explore-actions'},tr=['onClick'],ar={key:1,class:'scouting-button',disabled:''},or=['onClick'],nr={key:3,class:'conquered-button',disabled:''},sr={key:1,class:'battle-modal-overlay'},lr={class:'battle-modal'},rr={class:'modal-header'},ir={class:'modal-content'},cr={class:'modal-content'},dr={class:'scout-options'},ur={class:'option-group'},mr={class:'option-group'},gr={class:'option-group'},hr={class:'scout-location-info'},pr={class:'location-display'},vr={class:'location-value'},fr={class:'location-description'},yr={class:'description-text'},br={key:0,class:'scout-result'},Nr={key:0,class:'success-message'},Er={key:0,class:'discovered-locations'},kr={key:1,class:'error-message'},Sr={class:'modal-actions'},Vr=['disabled'],Cr=(0,o.defineComponent)({__name:'探索界面',setup(e){const t=(0,o.ref)(!1),n=(0,o.ref)(null),s=(0,o.ref)(null),l=(0,o.ref)('古拉尔大陆'),r=(0,o.ref)('巢穴附近'),i=(0,o.ref)(!1),u=(0,o.ref)(!1),m=(0,o.ref)(1),g=(0,o.ref)(''),h=(0,o.ref)(''),p=(0,o.ref)(null),v=(0,o.ref)(new Set),f=(0,o.ref)(new Set),b=(0,o.ref)(!1),N=(0,o.ref)({title:'AI英雄生成失败',message:'',details:'',confirmText:'放弃英雄，直接进攻',cancelText:'重新侦察',showCancel:!0,showClose:!1,type:'warning'}),E=(0,o.ref)(null),k=(0,o.ref)('all'),S=[{value:'all',label:'全部'},{value:'scouted',label:'已侦察'},{value:'conquered',label:'已征服'},{value:'hide-conquered',label:'可操作'}],V=e=>e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,'')+'M':e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,'')+'k':e.toString(),C=(0,o.computed)(()=>{console.log('🔍 [探索界面] 大陆数据:',Qs.continentExploreService.continents.value),console.log('🔍 [探索界面] 大陆数量:',Qs.continentExploreService.continents.value.length);const e=Qs.continentExploreService.continents.value.filter(e=>e.isUnlocked);return console.log('🔍 [探索界面] 解锁的大陆:',e),e}),w=(0,o.computed)(()=>Qs.continentExploreService.continents.value.find(e=>e.name===l.value)),x=(0,o.computed)(()=>{const e=Qs.continentExploreService.continents.value.find(e=>e.name===l.value);return e?.regions||[]}),D=(0,o.computed)(()=>(console.log('🔍 [探索界面] 当前大陆区域:',x.value),console.log('🔍 [探索界面] 区域数量:',x.value.length),x.value)),B=(0,o.computed)(()=>x.value.find(e=>e.name===r.value)),A=(0,o.computed)(()=>{const e=Xs.exploreService.getAllLocations();return console.log('🔍 [探索界面] 所有据点数据:',e),console.log('🔍 [探索界面] 据点数量:',e.length),e}),T=(0,o.computed)(()=>{let e=A.value;if(console.log('🔍 [探索界面] 筛选前据点数量:',e.length),l.value&&(console.log('🔍 [探索界面] 按大陆筛选:',l.value),e=e.filter(e=>{const t=e.continent===l.value;return console.log(`🔍 [探索界面] 据点 ${e.name} (${e.continent}) 匹配 ${l.value}:`,t),t}),console.log('🔍 [探索界面] 大陆筛选后据点数量:',e.length)),r.value){const t=B.value;console.log('🔍 [探索界面] 按区域筛选:',r.value,t),t&&(e=e.filter(e=>{const a=e.region===t.name;return console.log(`🔍 [探索界面] 据点 ${e.name} (${e.region}) 匹配 ${t.name}:`,a),a}),console.log('🔍 [探索界面] 区域筛选后据点数量:',e.length))}switch(k.value){case'scouted':return e.filter(e=>'scouted'===e.status);case'conquered':return e.filter(e=>'conquered'===e.status);case'hide-conquered':return e.filter(e=>'conquered'!==e.status);default:return e}}),M=e=>{if(v.value.has(e.id))return'侦察中';return{unknown:'未知',scouted:'已侦察',attacked:'已攻击',conquered:'已征服'}[e.status]||'未知'},R=e=>v.value.has(e.id)?'scouting':e.status,G=e=>'★'.repeat(e),I=(e,t)=>{const a=Xs.exploreService.calculateScoutCost(e,t);return`💰${a.gold} 🍖${a.food}`},O=e=>e.enemyUnits&&e.enemyUnits.length>0?e.enemyUnits.reduce((e,t)=>e+t.troopCount,0):e.baseGuards||0,P=async(e,t)=>{console.log('处理AI生成失败:',e.name,t),N.value.message=`据点 "${e.name}" 的AI英雄生成失败。`,N.value.details=`您可以选择：\n1. 放弃英雄，直接进攻该据点（无英雄奖励）\n2. 重新侦察，尝试再次生成英雄（退还 ${t.gold} 金币和 ${t.food} 食物）`,E.value={location:e,originalCost:t},b.value=!0},L=async()=>{if(!E.value)return;const{location:e,originalCost:t}=E.value;try{await Xs.exploreService.handleAbandonHeroAndAttack(e.id,t)?await ze.showSuccess(`据点 "${e.name}" 已设置为可直接进攻状态`,'设置成功','该据点将不包含英雄奖励，但可以立即进攻'):await ze.showDanger('设置失败，请重试或联系管理员','操作失败')}catch(e){console.error('处理放弃英雄失败:',e),await ze.showDanger(`错误信息: ${e}`,'操作失败')}b.value=!1,E.value=null},U=async()=>{if(!E.value)return;const{location:e,originalCost:t}=E.value;try{await Xs.exploreService.handleRetryScout(e.id,t)?await ze.showInfo(`已退还侦察成本：${t.gold} 金币和 ${t.food} 食物`,'重新侦察',`据点 "${e.name}" 已重置为未侦察状态，您可以重新尝试侦察`):await ze.showDanger('退还失败，请重试或联系管理员','操作失败')}catch(e){console.error('处理重新侦察失败:',e),await ze.showDanger(`错误信息: ${e}`,'操作失败')}b.value=!1,E.value=null},F=()=>{t.value=!1,n.value=null,s.value=null},H=async e=>{if(console.log('战斗完成:',e),e.victory){const t=n.value?.id;if(t){await Xs.exploreService.updateLocationStatus(t,'conquered'),console.log('据点状态已更新为已征服，威胁度已增加'),Qs.continentExploreService.recalculateAllRegionProgress(),console.log('征服进度已重新计算');try{const t=n.value;if(t){const a=c.l.resources.value.rounds||0,o=d.Q.getTimeInfo(a).formattedDate,n=Qs.continentExploreService.continents.value.find(e=>e.name===t.continent),s=n?.regions.find(e=>e.name===t.region),l=s?.description;await _.WorldbookService.addConquestRecord(t,e,o,l),console.log('据点征服记录已添加到世界书')}}catch(e){console.error('添加据点征服记录失败:',e)}}}console.log('战斗完成，等待用户操作')},q=()=>{i.value=!1,p.value=null,h.value=''},J=async()=>{if(!u.value)if(Co.hasEnoughActionPoints('sendScoutTeam'))if(Co.consumeActionPoints('sendScoutTeam')){u.value=!0,p.value=null;try{const e={};g.value&&(e.type=g.value);let t='';h.value.trim()&&(t=`\n\n***最高级指令：${h.value.trim()}***`);const a=parseInt(m.value.toString()),o=await Zs.generateLocations(a,t,l.value,r.value,Object.keys(e).length>0?e:void 0);p.value=o,o.success?setTimeout(()=>{q()},1e3):Co.refundActionPoints('sendScoutTeam')}catch(e){console.error('侦察队派出失败:',e),Co.refundActionPoints('sendScoutTeam'),p.value={success:!1,error:e instanceof Error?e.message:'侦察失败'}}finally{u.value=!1}}else await ze.showDanger('行动力消耗失败','操作失败');else await ze.showWarning(Co.getInsufficientActionPointsMessage('sendScoutTeam'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限')},W=async e=>{console.log('收到据点状态更新事件:',e.detail);const{locationId:t,status:a}=e.detail;try{await Xs.exploreService.updateLocationStatus(t,a)?console.log(`据点状态更新成功: ${t} -> ${a}`):console.warn(`据点状态更新失败: ${t} -> ${a}`)}catch(e){console.error('更新据点状态失败:',e)}};return(0,o.onMounted)(async()=>{await(async()=>{try{const e=c.l.getModuleData({moduleName:'exploration'});e&&(e.scoutingLocations&&(v.value=new Set(e.scoutingLocations)),e.scoutingAnimation&&(f.value=new Set(e.scoutingAnimation)))}catch(e){console.error('加载侦察状态失败:',e)}})(),await(async()=>{try{console.log('🔍 [探索界面] 开始检查未加入世界书的人物...');const e=Xs.exploreService.getAllLocations();console.log('🔍 [探索界面] 检查据点数量:',e.length);let t=0;for(const a of e)if(a.rewards?.heroes&&a.rewards.heroes.length>0){console.log(`🔍 [探索界面] 检查据点 ${a.name} 的英雄人物:`,a.rewards.heroes.length,'个');for(const e of a.rewards.heroes)if('uncaptured'===e.status||'enemy'===e.status){console.log(`🔍 [探索界面] 检查英雄 ${e.name} (状态: ${e.status})`);try{await _.WorldbookService.getCharacterEntry(e.id)?console.log(`ℹ️ [探索界面] 英雄 ${e.name} 已存在于世界书中`):(console.log(`📚 [探索界面] 英雄 ${e.name} 未加入世界书，正在添加...`),await _.WorldbookService.createCharacterWorldbook(e),t++,console.log(`✅ [探索界面] 英雄 ${e.name} 已加入世界书`))}catch(t){console.error(`❌ [探索界面] 添加英雄 ${e.name} 到世界书失败:`,t)}}else console.log(`ℹ️ [探索界面] 跳过英雄 ${e.name} (状态: ${e.status})`)}t>0?console.log(`🎉 [探索界面] 检查完成，共添加了 ${t} 个人物到世界书`):console.log('✅ [探索界面] 检查完成，所有人物都已加入世界书')}catch(e){console.error('❌ [探索界面] 检查人物世界书状态失败:',e)}})(),window.addEventListener('location-status-updated',W),(0,o.onUnmounted)(()=>{window.removeEventListener('location-status-updated',W)})}),(e,d)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',el,[(0,o.createElementVNode)('div',tl,[d[10]||(d[10]=(0,o.createElementVNode)('h1',{class:'explore-title'},'🗺️ 探索模式',-1)),(0,o.createElementVNode)('div',al,[(0,o.createElementVNode)('div',ol,[(0,o.createElementVNode)('div',nl,[d[7]||(d[7]=(0,o.createElementVNode)('span',{class:'icon'},'💰',-1)),(0,o.createElementVNode)('span',sl,(0,o.toDisplayString)(V((0,o.unref)(c.l).resources.value.gold)),1)]),(0,o.createElementVNode)('div',ll,[d[8]||(d[8]=(0,o.createElementVNode)('span',{class:'icon'},'🍖',-1)),(0,o.createElementVNode)('span',rl,(0,o.toDisplayString)(V((0,o.unref)(c.l).resources.value.food)),1)])]),(0,o.createElementVNode)('button',{class:'scout-team-button',disabled:u.value,style:{background:'linear-gradient(180deg, #3b82f6, #2563eb) !important',border:'1px solid rgba(59, 130, 246, 0.6) !important',color:'#ffffff !important','font-weight':'600 !important','font-size':'12px !important','border-radius':'4px !important',padding:'4px 8px !important','box-shadow':'0 2px 4px rgba(59, 130, 246, 0.3) !important',transition:'all 0.2s ease !important'},onClick:d[0]||(d[0]=e=>i.value=!0),onMouseover:d[1]||(d[1]=e=>e.target.style.background='linear-gradient(180deg, #2563eb, #1d4ed8)'),onMouseout:d[2]||(d[2]=e=>e.target.style.background='linear-gradient(180deg, #3b82f6, #2563eb)')},[d[9]||(d[9]=(0,o.createElementVNode)('span',{class:'icon',style:{'font-size':'14px !important'}},'🔍',-1)),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(u.value?'侦察中...':'派出侦察队'),1)],40,il)])]),(0,o.createCommentVNode)(' 大陆选项卡 '),(0,o.createElementVNode)('div',cl,[(0,o.createElementVNode)('div',dl,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(C.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:e.name,class:(0,o.normalizeClass)(['continent-tab',{active:l.value===e.name,conquered:e.isConquered,locked:!e.isUnlocked}]),disabled:!e.isUnlocked,onClick:t=>(e=>{l.value=e;const t=x.value.find(e=>e.isUnlocked);t&&(r.value=t.name),console.log(`切换到大陆: ${e}`)})(e.name)},[(0,o.createElementVNode)('div',ml,(0,o.toDisplayString)(e.icon),1),(0,o.createElementVNode)('div',gl,[(0,o.createElementVNode)('div',hl,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('div',pl,[(0,o.createElementVNode)('div',vl,[(0,o.createElementVNode)('div',{class:'progress-fill',style:(0,o.normalizeStyle)({width:`${e.conquestProgress}%`})},null,4)]),(0,o.createElementVNode)('span',fl,(0,o.toDisplayString)(Math.round(e.conquestProgress))+'%',1)])]),e.isConquered?((0,o.openBlock)(),(0,o.createElementBlock)('div',yl,'✅')):(0,o.createCommentVNode)('v-if',!0)],10,ul))),128))])]),(0,o.createCommentVNode)(' 区域选项卡 '),D.value.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',bl,[(0,o.createElementVNode)('div',Nl,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(D.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:e.name,class:(0,o.normalizeClass)(['region-tab',{active:r.value===e.name,conquered:e.isConquered,locked:!e.isUnlocked}]),disabled:!e.isUnlocked,onClick:t=>{return a=e.name,r.value=a,void console.log(`切换到区域: ${a}`);var a}},[(0,o.createElementVNode)('div',kl,(0,o.toDisplayString)(e.icon),1),(0,o.createElementVNode)('div',Sl,[(0,o.createElementVNode)('div',Vl,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('div',Cl,[(0,o.createElementVNode)('div',wl,[(0,o.createElementVNode)('div',{class:'progress-fill',style:(0,o.normalizeStyle)({width:`${e.conquestProgress}%`})},null,4)]),(0,o.createElementVNode)('span',xl,(0,o.toDisplayString)(Math.round(e.conquestProgress))+'%',1)])]),e.isConquered?((0,o.openBlock)(),(0,o.createElementBlock)('div',Dl,'✅')):(0,o.createCommentVNode)('v-if',!0)],10,El))),128))])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 探索界面 '),(0,o.createElementVNode)('div',$l,[(0,o.createCommentVNode)(' 筛选器 '),(0,o.createElementVNode)('div',Bl,[(0,o.createElementVNode)('div',Al,[(0,o.createElementVNode)('div',Tl,[((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(S,e=>(0,o.createElementVNode)('button',{key:e.value,class:(0,o.normalizeClass)(['filter-button',{active:k.value===e.value}]),onClick:t=>k.value=e.value},[(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.label),1)],10,Ml)),64))])])]),(0,o.createCommentVNode)(' 滚动容器 '),(0,o.createElementVNode)('div',Rl,[(0,o.createElementVNode)('div',_l,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(T.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:'explore-card'},[(0,o.createElementVNode)('div',Gl,[(0,o.createElementVNode)('div',Il,(0,o.toDisplayString)(e.icon),1),(0,o.createElementVNode)('div',Ol,[(0,o.createElementVNode)('h4',Pl,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('p',Ll,(0,o.toDisplayString)(e.description),1),(0,o.createElementVNode)('div',Ul,[(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['difficulty',`star-${e.difficulty}`])},(0,o.toDisplayString)(G(e.difficulty)),3),(0,o.createElementVNode)('span',Fl,(0,o.toDisplayString)(e.distance)+'km',1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['status-badge',R(e)])},(0,o.toDisplayString)(M(e)),3)])])]),(0,o.createCommentVNode)(' 侦察结果 '),'scouted'!==e.status||v.value.has(e.id)?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('div',Hl,[(0,o.createElementVNode)('div',ql,[(0,o.createElementVNode)('div',Jl,[d[11]||(d[11]=(0,o.createElementVNode)('span',{class:'label'},'防御：',-1)),(0,o.createElementVNode)('span',zl,(0,o.toDisplayString)(O(e))+'名守军',1)]),(0,o.createElementVNode)('div',Wl,[d[12]||(d[12]=(0,o.createElementVNode)('span',{class:'label'},'奖励：',-1)),(0,o.createElementVNode)('span',jl,[e.rewards.gold?((0,o.openBlock)(),(0,o.createElementBlock)('span',Yl,'💰'+(0,o.toDisplayString)(e.rewards.gold),1)):(0,o.createCommentVNode)('v-if',!0),e.rewards.food?((0,o.openBlock)(),(0,o.createElementBlock)('span',Kl,'🍖'+(0,o.toDisplayString)(e.rewards.food),1)):(0,o.createCommentVNode)('v-if',!0),e.rewards.slaves?((0,o.openBlock)(),(0,o.createElementBlock)('span',Ql,'🔒'+(0,o.toDisplayString)(e.rewards.slaves),1)):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createCommentVNode)(' 英雄奖励 '),e.rewards.heroes&&e.rewards.heroes.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Xl,[d[13]||(d[13]=(0,o.createElementVNode)('span',{class:'label'},'英雄：',-1)),(0,o.createElementVNode)('span',Zl,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.rewards.heroes,e=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:e.id,class:'hero-reward'},' 👤'+(0,o.toDisplayString)(e.name)+' ('+(0,o.toDisplayString)(e.title)+') ',1))),128))])])):(0,o.createCommentVNode)('v-if',!0)])])),(0,o.createCommentVNode)(' 操作按钮 '),(0,o.createElementVNode)('div',er,['unknown'!==e.status||v.value.has(e.id)?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'scout-button',onClick:t=>(async e=>{try{if(!Co.hasEnoughActionPoints('scoutLocation'))return void await ze.showWarning(Co.getInsufficientActionPointsMessage('scoutLocation'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限');if(!Co.consumeActionPoints('scoutLocation'))return void await ze.showDanger('行动力消耗失败','操作失败');v.value.add(e.id),f.value.add(e.id);const t=await Xs.exploreService.scoutLocation(e.id);if(t.needsUserDecision&&t.aiFailureData)return v.value.delete(e.id),f.value.delete(e.id),Co.refundActionPoints('scoutLocation'),void await P(t.aiFailureData.location,t.aiFailureData.originalCost);await new Promise(e=>setTimeout(e,500)),v.value.delete(e.id),f.value.delete(e.id),t.error?(Co.refundActionPoints('scoutLocation'),await ze.showDanger(`据点 "${e.name}" 侦察失败`,'侦察失败',t.error||'侦察队未能获取有效信息')):ko.success(`据点 "${e.name}" 侦察成功！据点信息已更新`,{title:'侦察完成',duration:3e3})}catch(t){v.value.delete(e.id),f.value.delete(e.id),Co.refundActionPoints('scoutLocation'),await ze.showDanger(`侦察失败：${t}`,'侦察失败','请检查资源是否充足')}})(e)},[d[14]||(d[14]=(0,o.createElementVNode)('span',{class:'icon'},'🔍',-1)),(0,o.createElementVNode)('span',null,'侦察 ('+(0,o.toDisplayString)(I(e.difficulty,e.distance))+')',1)],8,tr)),v.value.has(e.id)?((0,o.openBlock)(),(0,o.createElementBlock)('button',ar,[...d[15]||(d[15]=[(0,o.createElementVNode)('span',{class:'icon scouting-icon'},'🔍',-1),(0,o.createElementVNode)('span',null,'侦察中...',-1)])])):(0,o.createCommentVNode)('v-if',!0),'scouted'!==e.status||v.value.has(e.id)?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:2,class:'attack-button',onClick:o=>(async e=>{if(console.log('=== 探索界面开始战斗检查 ==='),console.log('当前行动力:',c.l.resources.value.actionPoints),console.log('最大行动力:',c.l.resources.value.maxActionPoints),!Co.hasEnoughActionPoints('attackLocation'))return console.log('行动力不足，阻止战斗'),void await ze.showWarning(Co.getInsufficientActionPointsMessage('attackLocation'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限');console.log('行动力检查通过，继续检查部队编制');const{FormationService:o}=await Promise.resolve().then(a.bind(a,588)),l=o.hasFormationData();if(console.log('探索界面部队编制检查结果:',l),!l)return console.log('没有部队编制数据，显示警告'),void await ze.showWarning('请先进行部队编制！','无法开始战斗','没有编制部队无法参与战斗，请前往部队编制界面进行编制。');n.value=e;const r=Xs.exploreService.getLocationEnemyUnits(e.id,1);console.log('据点敌方单位:',r),s.value={target:e,enemyForces:{guards:O(e),name:e.name,type:e.type,difficulty:e.difficulty,units:r}},t.value=!0,console.log('所有检查通过，开始战斗')})(e)},[...d[16]||(d[16]=[(0,o.createElementVNode)('span',{class:'icon'},'⚔️',-1),(0,o.createElementVNode)('span',null,'战斗',-1)])],8,or)),'conquered'===e.status?((0,o.openBlock)(),(0,o.createElementBlock)('button',nr,[...d[17]||(d[17]=[(0,o.createElementVNode)('span',{class:'icon'},'✅',-1),(0,o.createElementVNode)('span',null,'已征服',-1)])])):(0,o.createCommentVNode)('v-if',!0)])]))),128))])])]),(0,o.createCommentVNode)(' 战斗弹窗 '),t.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',sr,[(0,o.createElementVNode)('div',lr,[(0,o.createElementVNode)('div',rr,[(0,o.createElementVNode)('h3',null,'⚔️ 战斗 - '+(0,o.toDisplayString)(n.value?.name),1)]),(0,o.createElementVNode)('div',ir,[(0,o.createVNode)(Ys,{'battle-data':s.value,'is-modal':!0,onBattleComplete:H,onCloseBattle:F},null,8,['battle-data'])])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 派出侦察队弹窗 '),i.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:2,class:'scout-team-modal-overlay',onClick:q},[(0,o.createElementVNode)('div',{class:'scout-team-modal',onClick:d[6]||(d[6]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[d[18]||(d[18]=(0,o.createElementVNode)('h3',null,'🔍 派出侦察队',-1)),(0,o.createElementVNode)('button',{class:'close-button',onClick:q},'×')]),(0,o.createElementVNode)('div',cr,[(0,o.createElementVNode)('div',dr,[(0,o.createElementVNode)('div',ur,[d[20]||(d[20]=(0,o.createElementVNode)('label',null,'据点数量：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':d[3]||(d[3]=e=>m.value=e),class:'scout-count-select'},[...d[19]||(d[19]=[(0,o.createStaticVNode)('<option value="1" data-v-456bdac5>1个据点</option><option value="2" data-v-456bdac5>2个据点</option><option value="3" data-v-456bdac5>3个据点</option><option value="4" data-v-456bdac5>4个据点</option><option value="5" data-v-456bdac5>5个据点</option>',5)])],512),[[o.vModelSelect,m.value]])]),(0,o.createElementVNode)('div',mr,[d[22]||(d[22]=(0,o.createElementVNode)('label',null,'侦察方向：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':d[4]||(d[4]=e=>g.value=e)},[...d[21]||(d[21]=[(0,o.createStaticVNode)('<option value="" data-v-456bdac5>随机探索</option><option value="village" data-v-456bdac5>村庄区域</option><option value="town" data-v-456bdac5>城镇周边</option><option value="city" data-v-456bdac5>城市中心</option><option value="fortress" data-v-456bdac5>军事要塞</option><option value="ruins" data-v-456bdac5>古代废墟</option><option value="dungeon" data-v-456bdac5>地下迷宫</option>',7)])],512),[[o.vModelSelect,g.value]])]),(0,o.createElementVNode)('div',gr,[d[24]||(d[24]=(0,o.createElementVNode)('label',null,'侦察指令：',-1)),(0,o.createElementVNode)('div',hr,[(0,o.createElementVNode)('div',pr,[d[23]||(d[23]=(0,o.createElementVNode)('span',{class:'location-label'},'当前探索位置：',-1)),(0,o.createElementVNode)('span',vr,(0,o.toDisplayString)(w.value?.name||'未知大陆')+' - '+(0,o.toDisplayString)(B.value?.name||'未知区域'),1)]),(0,o.createElementVNode)('div',fr,[(0,o.createElementVNode)('span',yr,(0,o.toDisplayString)(B.value?.description||'暂无描述'),1)])]),(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':d[5]||(d[5]=e=>h.value=e),placeholder:'可选：给侦察队下达特殊指令...',rows:'3'},null,512),[[o.vModelText,h.value]])])]),p.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',br,[d[26]||(d[26]=(0,o.createElementVNode)('h4',null,'侦察结果：',-1)),p.value.success?((0,o.openBlock)(),(0,o.createElementBlock)('div',Nr,[(0,o.createElementVNode)('p',null,'✅ 侦察队成功发现 '+(0,o.toDisplayString)(p.value.totalAdded||1)+' 个目标！',1),p.value.locations&&p.value.locations.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Er,[d[25]||(d[25]=(0,o.createElementVNode)('h5',null,'发现的目标：',-1)),(0,o.createElementVNode)('ul',null,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(p.value.locations,e=>((0,o.openBlock)(),(0,o.createElementBlock)('li',{key:e.id,class:'location-item'},(0,o.toDisplayString)(e.icon)+' '+(0,o.toDisplayString)(e.name)+' ('+(0,o.toDisplayString)(G(e.difficulty))+', '+(0,o.toDisplayString)(e.distance)+'km) ',1))),128))])])):(0,o.createCommentVNode)('v-if',!0)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',kr,[(0,o.createElementVNode)('p',null,'❌ 侦察失败：'+(0,o.toDisplayString)(p.value.error),1)]))])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',Sr,[(0,o.createElementVNode)('button',{class:'cancel-button',onClick:q},'取消'),(0,o.createElementVNode)('button',{class:'scout-button',disabled:u.value,onClick:J},(0,o.toDisplayString)(u.value?'侦察中...':'派出侦察队'),9,Vr)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' AI生成失败确认框 '),(0,o.createVNode)(y,{show:b.value,title:N.value.title,message:N.value.message,details:N.value.details,'confirm-text':N.value.confirmText,'cancel-text':N.value.cancelText,'show-cancel':N.value.showCancel,'show-close':N.value.showClose,type:N.value.type,onConfirm:L,onCancel:U,onClose:U},null,8,['show','title','message','details','confirm-text','cancel-text','show-cancel','show-close','type'])]))}}),wr=(0,f.A)(Cr,[['__scopeId','data-v-456bdac5']]),xr={class:'nest-container'},Dr={class:'nest-header'},$r={class:'income-summary'},Br={key:0,class:'income-item'},Ar={class:'income-amount'},Tr={key:1,class:'income-item'},Mr={class:'income-amount'},Rr={class:'building-tabs'},_r={class:'building-content'},Gr={key:0,class:'building-section'},Ir={class:'building-scroll-container'},Or={class:'building-grid'},Pr=['onClick'],Lr={key:0,class:'building'},Ur={class:'building-icon'},Fr={class:'building-name'},Hr={key:0,class:'breeding-status'},qr={key:0,class:'occupied-status'},Jr={class:'occupant-name'},zr={class:'occupant-status'},Wr={key:1,class:'available-status'},jr=['onClick'],Yr={class:'next-unlock-slot'},Kr={class:'expand-cost'},Qr={key:1,class:'building-section'},Xr={class:'building-scroll-container'},Zr={class:'building-grid'},ei=['onClick'],ti={key:0,class:'building'},ai={class:'building-icon'},oi={class:'building-name'},ni={key:0,class:'building-income'},si={key:0,class:'income-display'},li={class:'income-text'},ri={key:1,class:'income-display'},ii={class:'income-text'},ci=['onClick'],di={class:'next-unlock-slot'},ui={class:'expand-cost'},mi={key:0,class:'building-menu'},gi={class:'building-options'},hi=['onClick'],pi={class:'option-icon'},vi={class:'option-name'},fi={class:'option-cost'},yi=(0,o.defineComponent)({__name:'巢穴界面',setup(e){const t=c.l.getInsufficientResourcesMessage.bind(c.l),a=e=>c.l.hasEnoughResources([{type:'gold',amount:e.gold,reason:'建筑成本'},{type:'food',amount:e.food,reason:'建筑成本'}]),n=(0,o.ref)('breeding'),s=(0,o.ref)(!1),l=(0,o.ref)(-1),r=(0,o.ref)('breeding'),i=(0,o.ref)([]),d=(0,o.ref)([]),u=(0,o.ref)([]),m=[{id:'breeding',name:'繁殖间',icon:'👶',description:'用于俘虏生育哥布林',cost:{gold:50,food:30},category:'breeding',effects:[{type:'breeding',icon:'👶',description:'俘虏生育哥布林'}]}],g=[{id:'food',name:'食物间',icon:'🍖',description:'每回合生成食物',cost:{gold:100,food:50},category:'resource',income:{food:20},effects:[{type:'food',icon:'🍖',description:'每回合+20食物'}]},{id:'trade',name:'贸易间',icon:'💰',description:'每回合生成金钱',cost:{gold:150,food:30},category:'resource',income:{gold:30},effects:[{type:'gold',icon:'💰',description:'每回合+30金钱'}]}],h=(0,o.computed)(()=>{const e='breeding'===n.value?m:g;return'breeding'===n.value?e.map(e=>{if('breeding'===e.id){const t=i.value.filter(e=>'breeding'===e.building?.id).length;return{...e,cost:{gold:e.cost.gold+25*t,food:e.cost.food+15*t}}}return e}):e}),p=(0,o.computed)(()=>{let e=0,t=0;return i.value.forEach(a=>{a.building&&a.building.income&&(a.building.income.gold&&(e+=a.building.income.gold),a.building.income.food&&(t+=a.building.income.food))}),d.value.forEach(a=>{a.building&&a.building.income&&(a.building.income.gold&&(e+=a.building.income.gold),a.building.income.food&&(t+=a.building.income.food))}),{gold:e,food:t}}),v=(e,t)=>{if('breeding'===t){const e=i.value.filter(e=>'breeding'===e.building?.id).length;return{gold:50+25*e,food:30+15*e}}{const t=200,a=100,o=Math.max(0,e-1);return{gold:t+50*o,food:a+20*o}}},f=(e,a)=>{const o=('breeding'===a?i.value:d.value)[e];if(o.unlocked)o.building||E(e,a);else if(y(e,a)){const n=v(e,a);if((e=>c.l.hasEnoughResources([{type:'gold',amount:e.gold,reason:'槽位开通'},{type:'food',amount:e.food,reason:'槽位开通'}]))(n))(e=>c.l.consumeResources([{type:'gold',amount:e.gold,reason:'开通槽位'},{type:'food',amount:e.food,reason:'开通槽位'}]))(n)&&(o.unlocked=!0,(e=>{'breeding'===e?i.value.push({building:null,unlocked:!1}):d.value.push({building:null,unlocked:!1})})(a),w(),console.log('槽位开通成功，数据已保存'));else{const e=t([{type:'gold',amount:n.gold,reason:'槽位开通'},{type:'food',amount:n.food,reason:'槽位开通'}]);console.log(e)}}},y=(e,t)=>{const a='breeding'===t?i.value:d.value;if('breeding'===t){if(0===e)return!0;for(let t=1;t<e;t++)if(!a[t].unlocked)return!1;return!0}if(e<2)return!0;for(let t=2;t<e;t++)if(!a[t].unlocked)return!1;return!0},b=(e,t)=>{const a='breeding'===t?i.value:d.value;if(a[e].unlocked)return!1;if('breeding'===t){for(let t=1;t<a.length;t++)if(!a[t].unlocked)return t===e}else for(let t=2;t<a.length;t++)if(!a[t].unlocked)return t===e;return!1},N=(e,t,a)=>({occupied:!!e.building,empty:!e.building&&e.unlocked,locked:!e.unlocked,nextUnlock:b(t,a)}),E=(e,t)=>{l.value=e,r.value=t,s.value=!0},k=()=>{s.value=!1,l.value=-1},S=e=>{if('breeding'===e.id){const t=i.value.filter(e=>'breeding'===e.building?.id).length,o={gold:e.cost.gold+25*t,food:e.cost.food+15*t};return a(o)}return a(e.cost)},V=e=>{if(!S(e)){let a=e.cost;if('breeding'===e.id){const t=i.value.filter(e=>'breeding'===e.building?.id).length;a={gold:e.cost.gold+25*t,food:e.cost.food+15*t}}const o=t([{type:'gold',amount:a.gold,reason:`建设${e.name}`},{type:'food',amount:a.food,reason:`建设${e.name}`}]);return void console.log(o)}if(l.value>=0){let t=e.cost;if('breeding'===e.id){const a=i.value.filter(e=>'breeding'===e.building?.id).length;t={gold:e.cost.gold+25*a,food:e.cost.food+15*a}}if(a=t,o=e.name,c.l.consumeResources([{type:'gold',amount:a.gold,reason:`建设${o}`},{type:'food',amount:a.food,reason:`建设${o}`}])){('breeding'===r.value?i.value:d.value)[l.value].building=e,w(),console.log('建筑建设成功，数据已保存'),k()}}var a,o},C=async(e,t)=>{const a='breeding'===t?i.value:d.value,o=a[e].building;if(!o)return;await ze.showWarning(`确定要拆除 ${o.name} 吗？`,'确认拆除','拆除后将失去该建筑的所有效果，且无法恢复。')&&(a[e].building=null,w(),console.log('建筑拆除成功，数据已保存'))},w=()=>{try{const e=p.value,t={breedingSlots:i.value,resourceSlots:d.value,activeTab:n.value,totalIncome:e,breedingRoomInfo:[]};console.log('保存巢穴数据到模块化存档系统:',t),c.l.updateModuleData({moduleName:'nest',data:t}),console.log('巢穴数据保存成功')}catch(e){console.error('保存巢穴数据失败:',e)}},x=()=>{try{console.log('从模块化存档系统加载巢穴数据');const e=c.l.getCurrentGameData();if(e&&e.nest){const t=e.nest;console.log('加载到巢穴数据:',t),i.value=t.breedingSlots||[],d.value=t.resourceSlots||[],n.value=t.activeTab||'breeding',console.log('巢穴数据加载成功')}else{console.log('没有找到巢穴数据，使用初始数据');const e=c.l.getInitialNestData();e?(i.value=e.breedingSlots,d.value=e.resourceSlots,n.value=e.activeTab,console.log('使用初始巢穴数据')):console.warn('无法获取初始巢穴数据')}}catch(e){console.error('加载巢穴数据失败:',e);try{const e=c.l.getInitialNestData();e&&(i.value=e.breedingSlots,d.value=e.resourceSlots,n.value=e.activeTab,console.log('使用初始数据作为后备方案'))}catch(e){console.error('后备方案也失败:',e)}}};(0,o.watch)([i,d,n],()=>{setTimeout(()=>{w()},100)},{deep:!0}),(0,o.onMounted)(()=>{console.log('巢穴界面挂载'),console.log('开始初始化槽位...'),i.value=[],i.value.push({building:m.find(e=>'breeding'===e.id)||null,unlocked:!0}),i.value.push({building:null,unlocked:!1}),d.value=[],d.value.push({building:g.find(e=>'food'===e.id)||null,unlocked:!0}),d.value.push({building:g.find(e=>'trade'===e.id)||null,unlocked:!0}),d.value.push({building:null,unlocked:!1}),console.log('槽位初始化完成:'),console.log('繁殖间槽位:',i.value),console.log('资源建筑槽位:',d.value),x(),B()});const D=e=>{const t=`breeding-${e}`;try{const e=c.l.getModuleData({moduleName:'nest'});if(e&&e.breedingRoomInfo){const a=e.breedingRoomInfo.find(e=>e.roomId===t);if(a)return{id:a.characterId,name:a.characterName,status:a.status}}}catch(e){console.error('从巢穴模块获取繁殖间信息失败:',e)}return u.value.find(e=>e.locationId===t&&('breeding'===e.status||'imprisoned'===e.status))},B=()=>{try{const e=c.l.getModuleData({moduleName:'training'});e&&e.characters&&(u.value=e.characters)}catch(e){console.error('加载人物数据失败:',e)}};return(0,o.onActivated)(()=>{console.log('巢穴界面激活'),x(),B(),(()=>{try{const e=[];u.value.forEach(t=>{t.locationId&&t.locationId.startsWith('breeding-')&&e.push({roomId:t.locationId,characterId:t.id,characterName:t.name,status:'breeding'===t.status?'breeding':'imprisoned',occupiedAt:new Date})});const t=c.l.getModuleData({moduleName:'nest'});c.l.updateModuleData({moduleName:'nest',data:{...t,breedingRoomInfo:e}}),console.log('巢穴界面：繁殖间占用信息已同步:',e)}catch(e){console.error('巢穴界面：同步繁殖间信息失败:',e)}})()}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',xr,[(0,o.createCommentVNode)(' 巢穴头部信息 '),(0,o.createElementVNode)('div',Dr,[t[5]||(t[5]=(0,o.createElementVNode)('h3',{class:'nest-title'},'🏰 哥布林巢穴',-1)),(0,o.createElementVNode)('div',$r,[p.value.gold>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Br,[t[2]||(t[2]=(0,o.createElementVNode)('span',{class:'income-icon'},'💰',-1)),(0,o.createElementVNode)('span',Ar,'+'+(0,o.toDisplayString)(p.value.gold),1)])):(0,o.createCommentVNode)('v-if',!0),p.value.food>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Tr,[t[3]||(t[3]=(0,o.createElementVNode)('span',{class:'income-icon'},'🍖',-1)),(0,o.createElementVNode)('span',Mr,'+'+(0,o.toDisplayString)(p.value.food),1)])):(0,o.createCommentVNode)('v-if',!0),t[4]||(t[4]=(0,o.createElementVNode)('div',{class:'income-label'},'每回合',-1))])]),(0,o.createCommentVNode)(' 建筑分类标签 '),(0,o.createElementVNode)('div',Rr,[(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['tab-button',{active:'breeding'===n.value}]),onClick:t[0]||(t[0]=e=>n.value='breeding')},' 👶 繁殖间 ',2),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['tab-button',{active:'resource'===n.value}]),onClick:t[1]||(t[1]=e=>n.value='resource')},' 🏗️ 资源建筑 ',2)]),(0,o.createCommentVNode)(' 建筑内容区域 '),(0,o.createElementVNode)('div',_r,[(0,o.createCommentVNode)(' 繁殖间建筑槽位 '),'breeding'===n.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Gr,[(0,o.createElementVNode)('div',Ir,[(0,o.createElementVNode)('div',Or,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.value,(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:`breeding-${a}`,class:(0,o.normalizeClass)(['building-slot',N(e,a,'breeding')]),onClick:e=>f(a,'breeding')},[(0,o.createCommentVNode)(' 已建设建筑 '),e.building?((0,o.openBlock)(),(0,o.createElementBlock)('div',Lr,[(0,o.createElementVNode)('div',Ur,(0,o.toDisplayString)(e.building.icon),1),(0,o.createElementVNode)('div',Fr,(0,o.toDisplayString)(e.building.name),1),(0,o.createCommentVNode)(' 显示交配间占用情况 '),'breeding'===e.building.id?((0,o.openBlock)(),(0,o.createElementBlock)('div',Hr,[D(a)?((0,o.openBlock)(),(0,o.createElementBlock)('div',qr,[(0,o.createElementVNode)('span',Jr,(0,o.toDisplayString)(D(a)?.name),1),(0,o.createElementVNode)('span',zr,(0,o.toDisplayString)('breeding'===D(a)?.status?'交配中':'待命'),1)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',Wr,[...t[6]||(t[6]=[(0,o.createElementVNode)('span',{class:'available-text'},'空闲',-1)])]))])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('button',{class:'remove-button',title:'拆除建筑',onClick:(0,o.withModifiers)(e=>C(a,'breeding'),['stop'])},' × ',8,jr)])):e.unlocked?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 空槽位 '),t[7]||(t[7]=(0,o.createElementVNode)('div',{class:'empty-slot'},[(0,o.createElementVNode)('div',{class:'empty-icon'},'🏗️'),(0,o.createElementVNode)('div',{class:'empty-text'},'空槽位')],-1))],2112)):b(a,'breeding')?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:2},[(0,o.createCommentVNode)(' 可开通槽位 '),(0,o.createElementVNode)('div',Yr,[t[8]||(t[8]=(0,o.createElementVNode)('div',{class:'expand-icon'},'+',-1)),t[9]||(t[9]=(0,o.createElementVNode)('div',{class:'expand-text'},'开通槽位',-1)),(0,o.createElementVNode)('div',Kr,(0,o.toDisplayString)(v(a,'breeding').gold)+'💰 '+(0,o.toDisplayString)(v(a,'breeding').food)+'🍖 ',1)])],2112)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:3},[(0,o.createCommentVNode)(' 锁定槽位 '),t[10]||(t[10]=(0,o.createElementVNode)('div',{class:'locked-slot'},[(0,o.createElementVNode)('div',{class:'locked-icon'},'🔒'),(0,o.createElementVNode)('div',{class:'locked-text'},'锁定')],-1))],2112))],10,Pr))),128))])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 资源建筑槽位 '),'resource'===n.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Qr,[(0,o.createElementVNode)('div',Xr,[(0,o.createElementVNode)('div',Zr,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(d.value,(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:`resource-${a}`,class:(0,o.normalizeClass)(['building-slot',N(e,a,'resource')]),onClick:e=>f(a,'resource')},[(0,o.createCommentVNode)(' 已建设建筑 '),e.building?((0,o.openBlock)(),(0,o.createElementBlock)('div',ti,[(0,o.createElementVNode)('div',ai,(0,o.toDisplayString)(e.building.icon),1),(0,o.createElementVNode)('div',oi,(0,o.toDisplayString)(e.building.name),1),(0,o.createCommentVNode)(' 建筑收入显示 '),e.building.income?((0,o.openBlock)(),(0,o.createElementBlock)('div',ni,[e.building.income.gold?((0,o.openBlock)(),(0,o.createElementBlock)('div',si,[t[11]||(t[11]=(0,o.createElementVNode)('span',{class:'income-icon'},'💰',-1)),(0,o.createElementVNode)('span',li,'+'+(0,o.toDisplayString)(e.building.income.gold),1)])):(0,o.createCommentVNode)('v-if',!0),e.building.income.food?((0,o.openBlock)(),(0,o.createElementBlock)('div',ri,[t[12]||(t[12]=(0,o.createElementVNode)('span',{class:'income-icon'},'🍖',-1)),(0,o.createElementVNode)('span',ii,'+'+(0,o.toDisplayString)(e.building.income.food),1)])):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('button',{class:'remove-button',title:'拆除建筑',onClick:(0,o.withModifiers)(e=>C(a,'resource'),['stop'])},' × ',8,ci)])):e.unlocked?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 空槽位 '),t[13]||(t[13]=(0,o.createElementVNode)('div',{class:'empty-slot'},[(0,o.createElementVNode)('div',{class:'empty-icon'},'🏗️'),(0,o.createElementVNode)('div',{class:'empty-text'},'空槽位')],-1))],2112)):b(a,'resource')?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:2},[(0,o.createCommentVNode)(' 可开通槽位 '),(0,o.createElementVNode)('div',di,[t[14]||(t[14]=(0,o.createElementVNode)('div',{class:'expand-icon'},'+',-1)),t[15]||(t[15]=(0,o.createElementVNode)('div',{class:'expand-text'},'开通槽位',-1)),(0,o.createElementVNode)('div',ui,(0,o.toDisplayString)(v(a,'resource').gold)+'💰 '+(0,o.toDisplayString)(v(a,'resource').food)+'🍖 ',1)])],2112)):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:3},[(0,o.createCommentVNode)(' 锁定槽位 '),t[16]||(t[16]=(0,o.createElementVNode)('div',{class:'locked-slot'},[(0,o.createElementVNode)('div',{class:'locked-icon'},'🔒'),(0,o.createElementVNode)('div',{class:'locked-text'},'锁定')],-1))],2112))],10,ei))),128))])])])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' 建筑选择菜单 '),s.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',mi,[(0,o.createElementVNode)('div',{class:'menu-header'},[t[17]||(t[17]=(0,o.createElementVNode)('h4',null,'选择建筑',-1)),(0,o.createElementVNode)('button',{class:'close-menu',title:'关闭菜单',onClick:k},'×')]),(0,o.createElementVNode)('div',gi,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(h.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['building-option',{disabled:!S(e)}]),onClick:t=>V(e)},[(0,o.createElementVNode)('div',pi,(0,o.toDisplayString)(e.icon),1),(0,o.createElementVNode)('div',vi,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('div',fi,(0,o.toDisplayString)(e.cost.gold)+'💰 '+(0,o.toDisplayString)(e.cost.food)+'🍖',1)],10,hi))),128))])])):(0,o.createCommentVNode)('v-if',!0)]))}}),bi=(0,f.A)(yi,[['__scopeId','data-v-d4c78e74']]),Ni={class:'modal-header'},Ei={class:'character-title'},ki={class:'header-right'},Si={key:0,class:'modal-body'},Vi={class:'character-detail-content'},Ci={class:'character-basic-info'},wi={class:'avatar-container'},xi=['src','alt'],Di={key:1,class:'default-avatar'},$i={class:'character-level-badge'},Bi={class:'level-value'},Ai={class:'character-details'},Ti={class:'basic-info-section'},Mi={class:'info-grid'},Ri={class:'info-item'},_i={class:'info-value'},Gi={class:'info-item'},Ii={class:'info-value'},Oi={class:'info-item'},Pi={class:'info-value'},Li={class:'info-item'},Ui={class:'info-value'},Fi={key:0,class:'appearance-info-section'},Hi={class:'appearance-grid'},qi={class:'appearance-item'},Ji={class:'appearance-value'},zi={class:'appearance-item'},Wi={class:'appearance-value'},ji={class:'appearance-item'},Yi={class:'appearance-value'},Ki={key:0,class:'appearance-item'},Qi={class:'appearance-value'},Xi={key:1,class:'personality-section'},Zi={class:'detail-right'},ec={key:0,class:'detail-section'},tc={class:'appearance-description'},ac={class:'appearance-text-container',style:{position:'relative',overflow:'visible'}},oc={class:'appearance-text',style:{color:'#f0e6d2','font-size':'11px','line-height':'1.6',margin:'0','font-style':'italic','text-align':'justify','letter-spacing':'0.5px','text-shadow':'0 1px 3px rgba(0, 0, 0, 0.4)',background:'linear-gradient(135deg, rgba(240, 230, 210, 0.1), rgba(240, 230, 210, 0.05))',padding:'8px 12px','border-radius':'6px','border-left':'3px solid rgba(205, 133, 63, 0.3)',position:'relative','z-index':'1'}},nc={class:'detail-stats'},sc={class:'stat-detail'},lc={class:'stat-label'},rc={key:0,class:'max-corruption-badge'},ic={key:0,class:'max-corruption-icon'},cc={class:'stat-detail'},dc={class:'stat-bar-detail'},uc={class:'stat-value-detail'},mc={class:'stat-detail'},gc={class:'stat-bar-detail'},hc={class:'stat-value-detail'},pc={class:'stat-detail'},vc={class:'stat-value-detail'},fc={key:0,class:'breeding-records'},yc={class:'breeding-stats'},bc={class:'goblin-type'},Nc={class:'goblin-count'},Ec={key:1,class:'detail-section clothing-section'},kc={class:'clothing-grid'},Sc={class:'clothing-item'},Vc={class:'clothing-content'},Cc={class:'clothing-text'},wc={class:'clothing-item'},xc={class:'clothing-content'},Dc={class:'clothing-text'},$c={class:'clothing-item'},Bc={class:'clothing-content'},Ac={class:'clothing-text'},Tc={class:'clothing-item'},Mc={class:'clothing-content'},Rc={class:'clothing-text'},_c={class:'clothing-item'},Gc={class:'clothing-content'},Ic={class:'clothing-text'},Oc={class:'clothing-item'},Pc={class:'clothing-content'},Lc={class:'clothing-text'},Uc={class:'clothing-item'},Fc={class:'clothing-content'},Hc={class:'clothing-text'},qc={class:'clothing-item'},Jc={class:'clothing-content'},zc={class:'clothing-text'},Wc={key:0,class:'lock-icon'},jc={key:0},Yc={key:0,class:'life-story-item'},Kc={class:'detail-text'},Qc={key:1,class:'life-story-item'},Xc={class:'detail-text'},Zc={key:2,class:'life-story-item'},ed={class:'detail-text'},td={key:3,class:'life-story-item'},ad={class:'detail-text'},od={key:1,class:'locked-content'},nd={key:0,class:'lock-icon'},sd={key:0},ld={class:'detail-text'},rd={key:1,class:'locked-content'},id={key:0,class:'lock-icon'},cd={key:0,class:'sensitive-details'},dd={class:'sensitive-detail-header'},ud={class:'sensitive-part'},md={key:0,class:'sensitive-description'},gd={key:1,class:'locked-content'},hd={key:0,class:'lock-icon'},pd={key:0},vd={class:'detail-text'},fd={key:1,class:'locked-content'},yd={key:0,class:'lock-icon'},bd={key:0},Nd={class:'detail-text'},Ed={key:1,class:'locked-content'},kd={key:7,class:'detail-section'},Sd={key:0,class:'other-info-item'},Vd={class:'detail-text'},Cd={key:1,class:'other-info-item'},wd={class:'detail-text'},xd=(0,o.defineComponent)({__name:'人物卡界面',props:{show:{type:Boolean},character:{}},emits:['close','start-training','edit-avatar','execute'],setup(e,{emit:t}){const a=t,n=(0,o.ref)(!1),s=()=>{a('close')},l=(e,t)=>{const a=e/t*100;return a>=80?'high':a>=50?'medium':'low'},r=(e,t)=>{const a=e/t*100;return a>=80?'high':a>=50?'medium':'low'},i=e=>({lifeStory:e>=10,personality:e>=20,sensitivePoints:e>=30,fearsAndSecrets:e>=40}),u=e=>{if(!e)return'';if(e.startsWith('breeding-'))return`交配间 ${e.replace('breeding-','')}`;try{const t=c.l.getModuleData({moduleName:'exploration'});if(t&&t.locations){const a=t.locations.find(t=>t.id===e);return a?a.name:e}}catch(e){console.warn('获取据点名称失败:',e)}return e},m=e=>{if(!e)return'';if('string'==typeof e)return e;const t=c.l.resources.value.rounds;return d.Q.getTimeInfo(t).formattedDate};return(t,a)=>{return e.show?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:s},[(0,o.createElementVNode)('div',{class:'modal-content character-detail-modal',onClick:a[2]||(a[2]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',Ni,[a[4]||(a[4]=(0,o.createElementVNode)('div',{class:'header-left'},null,-1)),(0,o.createElementVNode)('h4',Ei,(0,o.toDisplayString)(e.character?.name),1),(0,o.createElementVNode)('div',ki,[(0,o.createElementVNode)('button',{class:'edit-avatar-btn',title:'编辑头像',onClick:a[0]||(a[0]=a=>e.character&&t.$emit('edit-avatar',e.character))},[...a[3]||(a[3]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🖼️',-1)])]),(0,o.createElementVNode)('button',{class:'close-btn',onClick:s},'×')])]),e.character?((0,o.openBlock)(),(0,o.createElementBlock)('div',Si,[(0,o.createElementVNode)('div',Vi,[(0,o.createCommentVNode)(' 人物基础信息展示 '),(0,o.createElementVNode)('div',Ci,[(0,o.createCommentVNode)(' 左侧头像 '),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['character-avatar',`rating-${(e.character.rating||'D').toLowerCase()}`])},[(0,o.createElementVNode)('div',wi,[e.character.avatar?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.character.avatar,alt:e.character.name},null,8,xi)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Di,[...a[5]||(a[5]=[(0,o.createElementVNode)('span',{class:'avatar-icon'},'👤',-1)])])),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['avatar-status',e.character.status])},(0,o.toDisplayString)((g=e.character.status,{imprisoned:'关押中',training:'调教中',breeding:'交配中',surrendered:'已堕落',deployed:'已编制'}[g]||'未知')),3),(0,o.createCommentVNode)(' 评级徽章 '),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['rating-badge-overlay',e.character.rating.toLowerCase()])},(0,o.toDisplayString)(e.character.rating),3),(0,o.createCommentVNode)(' 等级标签 '),(0,o.createElementVNode)('div',$i,[a[6]||(a[6]=(0,o.createElementVNode)('span',{class:'level-icon'},'⭐',-1)),(0,o.createElementVNode)('span',Bi,(0,o.toDisplayString)(Math.floor(e.character.offspring/10)),1)])])],2),(0,o.createCommentVNode)(' 右侧基础信息 '),(0,o.createElementVNode)('div',Ai,[(0,o.createElementVNode)('div',Ti,[a[11]||(a[11]=(0,o.createElementVNode)('h4',null,'基本信息',-1)),(0,o.createElementVNode)('div',Mi,[(0,o.createElementVNode)('div',Ri,[a[7]||(a[7]=(0,o.createElementVNode)('span',{class:'info-label'},'身份：',-1)),(0,o.createElementVNode)('span',_i,(0,o.toDisplayString)(e.character.title),1)]),(0,o.createElementVNode)('div',Gi,[a[8]||(a[8]=(0,o.createElementVNode)('span',{class:'info-label'},'种族：',-1)),(0,o.createElementVNode)('span',Ii,(0,o.toDisplayString)(e.character.race),1)]),(0,o.createElementVNode)('div',Oi,[a[9]||(a[9]=(0,o.createElementVNode)('span',{class:'info-label'},'年龄：',-1)),(0,o.createElementVNode)('span',Pi,(0,o.toDisplayString)(e.character.age)+'岁',1)]),(0,o.createElementVNode)('div',Li,[a[10]||(a[10]=(0,o.createElementVNode)('span',{class:'info-label'},'国家：',-1)),(0,o.createElementVNode)('span',Ui,(0,o.toDisplayString)(e.character.country),1)])])]),e.character.appearance?((0,o.openBlock)(),(0,o.createElementBlock)('div',Fi,[(0,o.createElementVNode)('div',Hi,[(0,o.createElementVNode)('div',qi,[a[12]||(a[12]=(0,o.createElementVNode)('span',{class:'appearance-label'},'身高：',-1)),(0,o.createElementVNode)('span',Ji,(0,o.toDisplayString)(e.character.appearance.height)+'cm',1)]),(0,o.createElementVNode)('div',zi,[a[13]||(a[13]=(0,o.createElementVNode)('span',{class:'appearance-label'},'体重：',-1)),(0,o.createElementVNode)('span',Wi,(0,o.toDisplayString)(e.character.appearance.weight)+'kg',1)]),(0,o.createElementVNode)('div',ji,[a[14]||(a[14]=(0,o.createElementVNode)('span',{class:'appearance-label'},'三围：',-1)),(0,o.createElementVNode)('span',Yi,(0,o.toDisplayString)(e.character.appearance.measurements),1)]),e.character.appearance.cupSize?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ki,[a[15]||(a[15]=(0,o.createElementVNode)('span',{class:'appearance-label'},'罩杯：',-1)),(0,o.createElementVNode)('span',Qi,(0,o.toDisplayString)(e.character.appearance.cupSize),1)])):(0,o.createCommentVNode)('v-if',!0)])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 性格特征 '),e.character.personality&&e.character.personality.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Xi,[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['personality-traits',{locked:!i(e.character.loyalty).personality}])},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.character.personality,e=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:e,class:'personality-trait'},(0,o.toDisplayString)(e),1))),128))],2)])):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createCommentVNode)(' 详细属性 '),(0,o.createElementVNode)('div',Zi,[(0,o.createCommentVNode)(' 外貌描述 '),e.character.appearance&&e.character.appearance.description?((0,o.openBlock)(),(0,o.createElementBlock)('div',ec,[(0,o.createElementVNode)('div',tc,[(0,o.createElementVNode)('div',ac,[(0,o.createElementVNode)('p',oc,(0,o.toDisplayString)(e.character.appearance.description),1),a[16]||(a[16]=(0,o.createElementVNode)('div',{class:'appearance-shimmer'},null,-1))])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',nc,[(0,o.createElementVNode)('div',sc,[(0,o.createElementVNode)('div',lc,[a[17]||(a[17]=(0,o.createElementVNode)('span',{class:'stat-icon'},'💖',-1)),a[18]||(a[18]=(0,o.createTextVNode)(' 堕落值 ',-1)),e.character.loyalty>=100?((0,o.openBlock)(),(0,o.createElementBlock)('span',rc,'已堕落')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['stat-bar-detail corruption-bar',{'max-corruption':e.character.loyalty>=100}])},[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['stat-fill-detail corruption-fill',(d=e.character.loyalty,d>=80?'high':d>=50?'medium':'low')]),style:(0,o.normalizeStyle)({width:e.character.loyalty+'%'})},null,6)],2),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['stat-value-detail corruption-value',{'max-corruption-text':e.character.loyalty>=100}])},[(0,o.createTextVNode)((0,o.toDisplayString)(e.character.loyalty)+'% ',1),e.character.loyalty>=100?((0,o.openBlock)(),(0,o.createElementBlock)('span',ic,'🔥')):(0,o.createCommentVNode)('v-if',!0)],2)]),(0,o.createElementVNode)('div',cc,[a[19]||(a[19]=(0,o.createElementVNode)('div',{class:'stat-label'},[(0,o.createElementVNode)('span',{class:'stat-icon'},'💪'),(0,o.createTextVNode)(' 体力 ')],-1)),(0,o.createElementVNode)('div',dc,[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['stat-fill-detail',l(e.character.stamina,e.character.maxStamina||200)]),style:(0,o.normalizeStyle)({width:e.character.stamina/(e.character.maxStamina||200)*100+'%'})},null,6)]),(0,o.createElementVNode)('div',uc,(0,o.toDisplayString)(e.character.stamina)+'/'+(0,o.toDisplayString)(e.character.maxStamina||200),1)]),(0,o.createElementVNode)('div',mc,[a[20]||(a[20]=(0,o.createElementVNode)('div',{class:'stat-label'},[(0,o.createElementVNode)('span',{class:'stat-icon'},'🤱'),(0,o.createTextVNode)(' 生育值 ')],-1)),(0,o.createElementVNode)('div',gc,[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['stat-fill-detail',r(e.character.fertility,e.character.maxFertility||200)]),style:(0,o.normalizeStyle)({width:e.character.fertility/(e.character.maxFertility||200)*100+'%'})},null,6)]),(0,o.createElementVNode)('div',hc,(0,o.toDisplayString)(e.character.fertility)+'/'+(0,o.toDisplayString)(e.character.maxFertility||200),1)]),(0,o.createElementVNode)('div',pc,[a[21]||(a[21]=(0,o.createElementVNode)('div',{class:'stat-label'},[(0,o.createElementVNode)('span',{class:'stat-icon'},'👶'),(0,o.createTextVNode)(' 后代数量 ')],-1)),(0,o.createElementVNode)('div',vc,(0,o.toDisplayString)(e.character.offspring),1)]),(0,o.createCommentVNode)(' 生育记录显示 '),e.character.breedingRecords&&e.character.breedingRecords.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',fc,[a[22]||(a[22]=(0,o.createElementVNode)('h4',null,[(0,o.createElementVNode)('span',{class:'section-icon'},'👶'),(0,o.createTextVNode)(' 生育记录 ')],-1)),(0,o.createElementVNode)('div',yc,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((c=e.character.breedingRecords,qe.getBreedingStats(c)),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'breeding-stat'},[(0,o.createElementVNode)('span',bc,(0,o.toDisplayString)(t),1),(0,o.createElementVNode)('span',Nc,'x'+(0,o.toDisplayString)(e),1)]))),128))])])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' 衣着信息 '),e.character.appearance?.clothing?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ec,[(0,o.createElementVNode)('h4',{class:'expandable-header',onClick:a[1]||(a[1]=e=>n.value=!(0,o.unref)(n))},[a[23]||(a[23]=(0,o.createElementVNode)('span',{class:'section-icon'},'👗',-1)),a[24]||(a[24]=(0,o.createTextVNode)(' 衣着装扮 ',-1)),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['expand-icon',{expanded:(0,o.unref)(n)}])},'▼',2)]),(0,o.withDirectives)((0,o.createElementVNode)('div',kc,[(0,o.createElementVNode)('div',Sc,[a[26]||(a[26]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'👑',-1)),(0,o.createElementVNode)('div',Vc,[a[25]||(a[25]=(0,o.createElementVNode)('div',{class:'clothing-label'},'头部',-1)),(0,o.createElementVNode)('div',Cc,(0,o.toDisplayString)(e.character.appearance.clothing.head||'无'),1)])]),(0,o.createElementVNode)('div',wc,[a[28]||(a[28]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'👕',-1)),(0,o.createElementVNode)('div',xc,[a[27]||(a[27]=(0,o.createElementVNode)('div',{class:'clothing-label'},'上装',-1)),(0,o.createElementVNode)('div',Dc,(0,o.toDisplayString)(e.character.appearance.clothing.top||'无'),1)])]),(0,o.createElementVNode)('div',$c,[a[30]||(a[30]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'👖',-1)),(0,o.createElementVNode)('div',Bc,[a[29]||(a[29]=(0,o.createElementVNode)('div',{class:'clothing-label'},'下装',-1)),(0,o.createElementVNode)('div',Ac,(0,o.toDisplayString)(e.character.appearance.clothing.bottom||'无'),1)])]),(0,o.createElementVNode)('div',Tc,[a[32]||(a[32]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'🧦',-1)),(0,o.createElementVNode)('div',Mc,[a[31]||(a[31]=(0,o.createElementVNode)('div',{class:'clothing-label'},'袜子',-1)),(0,o.createElementVNode)('div',Rc,(0,o.toDisplayString)(e.character.appearance.clothing.socks||'无'),1)])]),(0,o.createElementVNode)('div',_c,[a[34]||(a[34]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'👠',-1)),(0,o.createElementVNode)('div',Gc,[a[33]||(a[33]=(0,o.createElementVNode)('div',{class:'clothing-label'},'鞋子',-1)),(0,o.createElementVNode)('div',Ic,(0,o.toDisplayString)(e.character.appearance.clothing.shoes||'无'),1)])]),(0,o.createElementVNode)('div',Oc,[a[36]||(a[36]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'🩱',-1)),(0,o.createElementVNode)('div',Pc,[a[35]||(a[35]=(0,o.createElementVNode)('div',{class:'clothing-label'},'内衣',-1)),(0,o.createElementVNode)('div',Lc,(0,o.toDisplayString)(e.character.appearance.clothing.underwear||'无'),1)])]),(0,o.createElementVNode)('div',Uc,[a[38]||(a[38]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'💎',-1)),(0,o.createElementVNode)('div',Fc,[a[37]||(a[37]=(0,o.createElementVNode)('div',{class:'clothing-label'},'装饰',-1)),(0,o.createElementVNode)('div',Hc,(0,o.toDisplayString)(e.character.appearance.clothing.accessories||'无'),1)])]),(0,o.createElementVNode)('div',qc,[a[40]||(a[40]=(0,o.createElementVNode)('div',{class:'clothing-icon'},'🎀',-1)),(0,o.createElementVNode)('div',Jc,[a[39]||(a[39]=(0,o.createElementVNode)('div',{class:'clothing-label'},'玩具',-1)),(0,o.createElementVNode)('div',zc,(0,o.toDisplayString)(e.character.appearance.clothing.toys||'无'),1)])])],512),[[o.vShow,(0,o.unref)(n)]])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 人生经历（10%） '),e.character.lifeStory?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:2,class:(0,o.normalizeClass)(['detail-section',{locked:!i(e.character.loyalty).lifeStory}])},[(0,o.createElementVNode)('h4',null,[a[41]||(a[41]=(0,o.createElementVNode)('span',{class:'section-icon'},'📖',-1)),a[42]||(a[42]=(0,o.createTextVNode)(' 人生经历 ',-1)),i(e.character.loyalty).lifeStory?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',Wc,'🔒'))]),i(e.character.loyalty).lifeStory?((0,o.openBlock)(),(0,o.createElementBlock)('div',jc,[e.character.lifeStory.childhood&&e.character.lifeStory.childhood.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Yc,[a[43]||(a[43]=(0,o.createElementVNode)('strong',null,'童年：',-1)),(0,o.createElementVNode)('p',Kc,(0,o.toDisplayString)(e.character.lifeStory.childhood.join(' ')),1)])):(0,o.createCommentVNode)('v-if',!0),e.character.lifeStory.adolescence&&e.character.lifeStory.adolescence.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Qc,[a[44]||(a[44]=(0,o.createElementVNode)('strong',null,'青年：',-1)),(0,o.createElementVNode)('p',Xc,(0,o.toDisplayString)(e.character.lifeStory.adolescence.join(' ')),1)])):(0,o.createCommentVNode)('v-if',!0),e.character.lifeStory.adulthood&&e.character.lifeStory.adulthood.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',Zc,[a[45]||(a[45]=(0,o.createElementVNode)('strong',null,'成年：',-1)),(0,o.createElementVNode)('p',ed,(0,o.toDisplayString)(e.character.lifeStory.adulthood.join(' ')),1)])):(0,o.createCommentVNode)('v-if',!0),e.character.lifeStory.currentState&&e.character.lifeStory.currentState.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',td,[a[46]||(a[46]=(0,o.createElementVNode)('strong',null,'当前：',-1)),(0,o.createElementVNode)('p',ad,(0,o.toDisplayString)(e.character.lifeStory.currentState.join(' ')),1)])):(0,o.createCommentVNode)('v-if',!0)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',od,[...a[47]||(a[47]=[(0,o.createElementVNode)('div',{class:'lock-message'},[(0,o.createElementVNode)('span',{class:'lock-icon'},'🔒'),(0,o.createElementVNode)('p',null,'需要堕落值达到10%才能查看人生经历')],-1)])]))],2)):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 性经验（30%） '),e.character.sexExperience?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:3,class:(0,o.normalizeClass)(['detail-section',{locked:!i(e.character.loyalty).sensitivePoints}])},[(0,o.createElementVNode)('h4',null,[a[48]||(a[48]=(0,o.createElementVNode)('span',{class:'section-icon'},'💕',-1)),a[49]||(a[49]=(0,o.createTextVNode)(' 性经验 ',-1)),i(e.character.loyalty).sensitivePoints?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',nd,'🔒'))]),i(e.character.loyalty).sensitivePoints?((0,o.openBlock)(),(0,o.createElementBlock)('div',sd,[(0,o.createElementVNode)('p',ld,(0,o.toDisplayString)(e.character.sexExperience),1)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',rd,[...a[50]||(a[50]=[(0,o.createElementVNode)('div',{class:'lock-message'},[(0,o.createElementVNode)('span',{class:'lock-icon'},'🔒'),(0,o.createElementVNode)('p',null,'需要堕落值达到30%才能查看性经验')],-1)])]))],2)):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 敏感点详细信息（30%） '),e.character.sensitivePointsDetail&&e.character.sensitivePointsDetail.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:4,class:(0,o.normalizeClass)(['detail-section',{locked:!i(e.character.loyalty).sensitivePoints}])},[(0,o.createElementVNode)('h4',null,[a[51]||(a[51]=(0,o.createElementVNode)('span',{class:'section-icon'},'🔍',-1)),a[52]||(a[52]=(0,o.createTextVNode)(' 敏感点详情 ',-1)),i(e.character.loyalty).sensitivePoints?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',id,'🔒'))]),i(e.character.loyalty).sensitivePoints?((0,o.openBlock)(),(0,o.createElementBlock)('div',cd,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.character.sensitivePointsDetail,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.part,class:'sensitive-detail-item'},[(0,o.createElementVNode)('div',dd,[(0,o.createElementVNode)('span',ud,(0,o.toDisplayString)(e.part),1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['sensitive-status',{active:e.isSensitive}])},(0,o.toDisplayString)(e.isSensitive?'敏感':'不敏感'),3)]),e.description?((0,o.openBlock)(),(0,o.createElementBlock)('p',md,(0,o.toDisplayString)(e.description),1)):(0,o.createCommentVNode)('v-if',!0)]))),128))])):((0,o.openBlock)(),(0,o.createElementBlock)('div',gd,[...a[53]||(a[53]=[(0,o.createElementVNode)('div',{class:'lock-message'},[(0,o.createElementVNode)('span',{class:'lock-icon'},'🔒'),(0,o.createElementVNode)('p',null,'需要堕落值达到30%才能查看敏感点详情')],-1)])]))],2)):(0,o.createCommentVNode)('v-if',!0),e.character.fears?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:5,class:(0,o.normalizeClass)(['detail-section',{locked:!i(e.character.loyalty).fearsAndSecrets}])},[(0,o.createElementVNode)('h4',null,[a[54]||(a[54]=(0,o.createElementVNode)('span',{class:'section-icon'},'😨',-1)),a[55]||(a[55]=(0,o.createTextVNode)(' 恐惧 ',-1)),i(e.character.loyalty).fearsAndSecrets?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',hd,'🔒'))]),i(e.character.loyalty).fearsAndSecrets?((0,o.openBlock)(),(0,o.createElementBlock)('div',pd,[(0,o.createElementVNode)('p',vd,(0,o.toDisplayString)(e.character.fears),1)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',fd,[...a[56]||(a[56]=[(0,o.createElementVNode)('div',{class:'lock-message'},[(0,o.createElementVNode)('span',{class:'lock-icon'},'🔒'),(0,o.createElementVNode)('p',null,'需要堕落值达到40%才能查看恐惧信息')],-1)])]))],2)):(0,o.createCommentVNode)('v-if',!0),e.character.secrets?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:6,class:(0,o.normalizeClass)(['detail-section',{locked:!i(e.character.loyalty).fearsAndSecrets}])},[(0,o.createElementVNode)('h4',null,[a[57]||(a[57]=(0,o.createElementVNode)('span',{class:'section-icon'},'🤫',-1)),a[58]||(a[58]=(0,o.createTextVNode)(' 秘密 ',-1)),i(e.character.loyalty).fearsAndSecrets?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',yd,'🔒'))]),i(e.character.loyalty).fearsAndSecrets?((0,o.openBlock)(),(0,o.createElementBlock)('div',bd,[(0,o.createElementVNode)('p',Nd,(0,o.toDisplayString)(e.character.secrets),1)])):((0,o.openBlock)(),(0,o.createElementBlock)('div',Ed,[...a[59]||(a[59]=[(0,o.createElementVNode)('div',{class:'lock-message'},[(0,o.createElementVNode)('span',{class:'lock-icon'},'🔒'),(0,o.createElementVNode)('p',null,'需要堕落值达到40%才能查看秘密信息')],-1)])]))],2)):(0,o.createCommentVNode)('v-if',!0),e.character.locationId||e.character.capturedAt?((0,o.openBlock)(),(0,o.createElementBlock)('div',kd,[a[62]||(a[62]=(0,o.createElementVNode)('h4',null,[(0,o.createElementVNode)('span',{class:'section-icon'},'ℹ️'),(0,o.createTextVNode)(' 其他信息 ')],-1)),e.character.locationId?((0,o.openBlock)(),(0,o.createElementBlock)('div',Sd,[a[60]||(a[60]=(0,o.createElementVNode)('strong',null,'来源据点：',-1)),(0,o.createElementVNode)('span',Vd,(0,o.toDisplayString)(u(e.character.locationId)),1)])):(0,o.createCommentVNode)('v-if',!0),e.character.capturedAt?((0,o.openBlock)(),(0,o.createElementBlock)('div',Cd,[a[61]||(a[61]=(0,o.createElementVNode)('strong',null,'被俘获时间：',-1)),(0,o.createElementVNode)('span',wd,(0,o.toDisplayString)(m(e.character.capturedAt)),1)])):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0)])])])):(0,o.createCommentVNode)('v-if',!0)])])):(0,o.createCommentVNode)('v-if',!0);var c,d,g}}}),Dd=(0,f.A)(xd,[['__scopeId','data-v-d7c2ba76']]);class $d{static parseAttributeChanges(e){console.log('🔍 开始解析属性变化数据...'),console.log('📝 AI回复内容:',e);try{const t=e.match(/\[OPTIONS_JSON\]([\s\S]*?)\[\/OPTIONS_JSON\]/);if(!t)return console.warn('❌ 未找到OPTIONS_JSON标签'),console.log('📄 完整AI回复:',e),null;const a=t[1].trim();console.log('📋 提取的JSON字符串:',a);const o=JSON.parse(a);return console.log('📊 解析的JSON数据:',o),o.attribute_changes?(console.log('✅ 找到属性变化数据:',o.attribute_changes),o.attribute_changes):(console.warn('⚠️ JSON数据中未找到attribute_changes字段'),console.log('📋 可用字段:',Object.keys(o)),null)}catch(t){return console.error('❌ 解析属性变化数据失败:',t),console.log('📄 原始AI回复:',e),null}}static applyAttributeChanges(e,t,a,o=200){console.log('🎯 开始应用属性变化...'),console.log('📊 当前属性:',{loyalty:t,stamina:a,maxStamina:o}),console.log('📈 变化数据:',e);const n={loyalty:t,stamina:a};if(void 0!==e.loyalty){const a=this.getRandomLoyaltyChange(e.loyalty),o=Math.max(0,Math.min(100,t+a));n.loyalty=o,console.log(`💖 忠诚度变化: ${t} + ${a} = ${o}`)}else console.log('💖 忠诚度无变化');if(void 0!==e.stamina){const t=this.getRandomStaminaChange(e.stamina),s=Math.max(0,Math.min(o,a+t));n.stamina=s,console.log(`💪 体力变化: ${a} + ${t} = ${s}`)}else console.log('💪 体力无变化');return console.log('✅ 最终属性结果:',n),n}static getRandomLoyaltyChange(e){const t=e+1,a=Math.floor(.3*t),o=Math.max(-10,t-a),n=Math.min(12,t+a),s=Math.floor(Math.random()*(n-o+1))+o;return console.log(`🎲 忠诚度随机化: 基础值=${e}, 调整后=${t}, 变化范围=[${o}, ${n}], 结果=${s}`),s}static getRandomStaminaChange(e){const t=e-2,a=Math.floor(.5*Math.abs(t)),o=t-a,n=t+a,s=Math.floor(Math.random()*(n-o+1))+o;return console.log(`🎲 体力随机化: 基础值=${e}, 调整后=${t}, 变化范围=[${o}, ${n}], 结果=${s}`),s}static isStaminaTooLow(e){return e<20}static validateAttributeChanges(e){return void 0!==e.loyalty&&(e.loyalty<-10||e.loyalty>12)?(console.warn('忠诚度变化范围不合理:',e.loyalty),!1):void 0===e.stamina||!(e.stamina<-25||e.stamina>5)||(console.warn('体力变化范围不合理:',e.stamina),!1)}}const Bd={class:'manual-training-container'},Ad={class:'book-panel'},Td={class:'training-header'},Md={class:'character-info'},Rd={class:'character-portrait'},_d=['src','alt'],Gd={key:1,class:'portrait-placeholder'},Id={class:'character-details'},Od={class:'character-name-section'},Pd={class:'character-name'},Ld={class:'character-title'},Ud={class:'character-stats'},Fd={class:'stat-item'},Hd={class:'stat-header'},qd={class:'stat-value'},Jd={class:'stat-bar'},zd={class:'stat-item'},Wd={class:'stat-header'},jd={class:'stat-value'},Yd={class:'stat-bar'},Kd={class:'header-buttons'},Qd={class:'book-shell'},Xd={class:'book-nav'},Zd=['disabled'],eu={class:'nav-info'},tu=['disabled'],au={class:'page'},ou={class:'page-inner'},nu=['innerHTML'],su={key:1,class:'initial-state'},lu={class:'initial-welcome'},ru={class:'welcome-hint'},iu={class:'initial-options'},cu={class:'option-choices'},du=['onClick'],uu={class:'option-content'},mu={key:2,class:'inline-options'},gu={class:'option-choices'},hu=['onClick'],pu={class:'option-content'},vu={class:'custom-input-body'},fu=['disabled','onKeydown'],yu={class:'custom-input-footer'},bu=['disabled'],Nu={class:'edit-dialog-body'},Eu=(0,o.defineComponent)({__name:'选项式调教界面',props:{character:{}},emits:['update-character','close'],setup(e,{expose:t,emit:a}){const n=e,s=a,{messages:l,containerRef:r,clearMessages:i}=N({autoLoadHistory:!1}),u=()=>{const e=c.l.resources.value.rounds||0;return d.Q.getTimeInfo(e,!1).formattedDate},m=(e,t,a)=>({message_id:void 0,role:e,sender:a,time:u(),content:t}),g=e=>{const t=m('user',e,'{{user}}');l.value=[...l.value,t],b.scrollToBottom(r.value)},h=e=>e.split('\n').map(e=>e.trim()).filter(e=>e.length>0).join('\n\n'),p=(e,t='系统')=>{const a=h(e),o=m('assistant',a,t);l.value=[...l.value,o],b.scrollToBottom(r.value)},v=(0,o.ref)(!1),f=(0,o.ref)(''),k=(0,o.ref)(!1),S=(0,o.ref)(!1),V=(0,o.ref)([]),C=(0,o.ref)([{text:'观察她的情况',label:'保守'},{text:'直接开始调教',label:'激进'},{text:'和她聊一聊',label:'平稳'}]),w=(0,o.ref)([]),x=(0,o.ref)(0),D=()=>{x.value>0&&(x.value-=1)},B=()=>{x.value<w.value.length-1&&(x.value+=1)},A=e=>{const t=h(e),a=le(ne(t));w.value.push({html:a}),x.value=w.value.length-1},T=e=>{if(0===w.value.length)return;w.value[w.value.length-1].html+=`<div class="choice-line"><span class="choice-prefix">→</span> ${le(e)}</div>`},M=(0,o.ref)(''),R=(0,o.ref)(!1),G=()=>{v.value||(R.value=!0,(0,o.nextTick)(()=>{const e=document.querySelector('.custom-input-panel textarea');e&&e.focus()}))},I=()=>{R.value=!1,M.value=''},O=async()=>{console.log('🎯 submitCustomOption 被调用');const e=M.value.trim();if(console.log('📝 输入文本:',e,'isSending:',v.value),e&&!v.value){if($d.isStaminaTooLow(n.character.stamina))return console.log('⚠️ 体力过低，无法继续调教'),toastr.warning(`${n.character.name} 体力过低，无法继续调教！`),void I();I(),g(e),f.value=e,console.log('📝 暂存用户自定义输入:',e),T(e),V.value=[],H(),await U()}};t({}),(0,o.watch)(M,()=>{(0,o.nextTick)(()=>{const e=document.querySelector('.inline-custom-input');if(e){e.style.height='auto';const t=200;e.style.height=`${Math.min(e.scrollHeight,t)}px`}})}),(0,o.onMounted)(async()=>{console.log('🚀 ========== 调教界面已加载 =========='),console.log('👤 角色信息:',{name:n.character.name,status:n.character.status,id:n.character.id}),console.log('📦 开始加载历史调教消息...'),await L(),console.log('📊 加载完成后的状态:',{页面数量:w.value.length,消息数量:l.value.length}),w.value.length>0?(console.log('🔍 尝试从最后一条AI消息解析选项...'),q()):console.log('ℹ️ 没有历史页面，跳过选项解析'),console.log('📊 最终状态:',{页面数量:w.value.length,选项数量:V.value.length,初始选项数量:C.value.length}),console.log('🚀 ========== 调教界面初始化完成 ==========')}),(0,o.onUnmounted)(async()=>{});const P=()=>{const e=l.value.filter(e=>'user'===e.role).pop();return e?`[当前调教角色: ${n.character.name}]\n\n\n# 调教模式输出规则\n\n在剧情输出结尾严格输出 JSON 格式，并用 [OPTIONS_JSON] 标签包裹。要求：\n- 仅输出 3 个选项，且 strategy 固定为 保守/激进/平稳\n- text 为给{{user}}参考的选项\n- 同时输出角色根据剧情变化的*忠诚度*和*体力*属性数据，格式如下：\n\n输出格式示例：\n[OPTIONS_JSON]\n{\n  "options":[\n    {"strategy":"保守","text":"温柔地安抚她，轻声细语地安慰"},\n    {"strategy":"激进","text":"加大调教力度，让她彻底屈服"},\n    {"strategy":"平稳","text":"保持当前节奏，观察她的反应"}\n  ],\n  "attribute_changes": {\n    "loyalty": 忠诚度变化值（-5到5之间的整数）,\n    "stamina": 体力变化值（-20到5之间的整数，通常为负数）\n  }\n}\n[/OPTIONS_JSON]\n${e.content}\n`:''},L=async()=>{console.log('📖 ========== 开始加载历史调教消息 =========='),console.log('👤 角色信息:',{id:n.character.id,name:n.character.name,status:n.character.status});try{console.log('🔍 正在从世界书获取调教记录...'),console.log('📝 使用角色名称查找:',n.character.name);const e=await _.WorldbookService.getExistingTrainingHistory(n.character.name);if(console.log(`📊 获取到 ${e.length} 条调教记录`),e.length>0){console.log('📝 原始记录列表:'),e.forEach((e,t)=>{console.log(`  [${t}]`,{gameTime:e.gameTime,sender:e.sender,contentPreview:e.content.substring(0,50)+(e.content.length>50?'...':''),timestamp:e.timestamp})}),i(),console.log('🔄 消息已清空，准备重新加载');const t=e.sort((e,t)=>(e.timestamp||0)-(t.timestamp||0));console.log('📊 排序后的记录顺序:'),t.forEach((e,t)=>{console.log(`  [${t}] ${e.gameTime} - ${e.sender}`)}),t.forEach((e,t)=>{const a='user'===e.sender||'{{user}}'===e.sender;console.log(`➕ 添加第 ${t+1} 条消息:`,{isUser:a,sender:e.sender,gameTime:e.gameTime}),a?g(e.content):(p(e.content,n.character.name),A(e.content),console.log(`  📄 已添加为书页，当前页面数: ${w.value.length}`))}),console.log('✅ 历史消息加载完成'),console.log('📊 最终状态:',{消息数量:l.value.length,页面数量:w.value.length,当前页索引:x.value})}else console.log('ℹ️ 没有找到历史调教记录')}catch(e){console.error('❌ 加载历史消息失败:',e),console.error('错误详情:',{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0})}console.log('📖 ========== 历史消息加载流程结束 ==========')},U=async()=>{let e='',t=!1;try{v.value=!0;e=await window.TavernHelper.generate({user_input:P()}),t=!0;const a=E.parseNextStepOptions(e);V.value=a.options,console.log('🔍 开始解析AI回复中的属性变化...'),console.log('📝 AI回复内容:',e);const o=$d.parseAttributeChanges(e);if(console.log('📊 解析到的属性变化:',o),o&&$d.validateAttributeChanges(o)){console.log('✅ 属性变化验证通过，开始应用变化...');const e=$d.applyAttributeChanges(o,n.character.loyalty,n.character.stamina,n.character.maxStamina||200);console.log('🎯 应用后的新属性:',e);const t={...n.character,loyalty:e.loyalty,stamina:e.stamina};$d.isStaminaTooLow(t.stamina)&&(t.status='training',toastr.warning(`${t.name} 体力过低，无法继续调教！`)),console.log('更新世界书信息...'),await _.WorldbookService.updateCharacterEntry(t);const a=c.l.getModuleData({moduleName:'training'}),l=(a?.characters||[]).map(e=>e.id===n.character.id?t:e);c.l.updateModuleData({moduleName:'training',data:{...a,characters:l}}),console.log('人物属性已更新:',{loyalty:e.loyalty,stamina:e.stamina}),s('update-character',t),console.log('📤 已通知父组件更新人物数据')}else console.warn('⚠️ 属性变化解析失败或验证不通过'),console.log('📊 解析结果:',o),o?console.log('❌ 验证失败，属性变化数据:',o):console.log('❌ 未找到属性变化数据');H();const l=se(e);console.log('🧹 清理后的回复内容:',l);const r=formatAsTavernRegexedString(l,'ai_output','display');console.log('🎨 应用酒馆正则后的内容:',r),console.log('🔄 内容是否发生变化:',l!==r),p(r,n.character.name),A(r),t&&f.value&&(await F(f.value,r),f.value='')}catch(e){console.error('AI生成失败:',e),toastr.error('AI生成失败','AI生成失败')}finally{v.value=!1}},F=async(e,t)=>{try{const a=c.l.resources.value.rounds||0,o=d.Q.getTimeInfo(a).formattedDate,s=Date.now(),l={gameTime:o,sender:'user',content:e,timestamp:s},r={gameTime:o,sender:n.character.name,content:t,timestamp:s+1};console.log('📦 批量保存调教对话对:',{userMessage:l,aiMessage:r}),await _.WorldbookService.addMultipleTrainingRecords(n.character.name,n.character.name,[l,r],n.character.status),console.log('✅ 已保存调教对话对到世界书')}catch(e){console.error('❌ 保存调教对话对到世界书失败:',e)}},H=()=>{try{const e={options:V.value,timestamp:Date.now()},t=getVariables({type:'character'});t[`training_options_${n.character.id}`]=JSON.stringify(e),replaceVariables(t,{type:'character'})}catch(e){console.error('保存选项失败:',e)}},q=()=>{if(0===w.value.length)return;if((()=>{try{const e=getVariables({type:'character'})[`training_options_${n.character.id}`];if(e){const t=JSON.parse(e);return V.value=t.options||[],!0}}catch(e){console.error('加载选项失败:',e)}return!1})())return;const e=[...l.value].reverse().find(e=>'assistant'===e.role);if(!e)return;const t=e.content,a=E.parseNextStepOptions(t);V.value=a.options,V.value.length>0&&H()},J=async()=>{k.value=!0},W=async()=>{k.value=!1;const e={...n.character,status:'training',lastTraining:new Date};console.log('🎯 调教界面关闭，设置人物状态为调教中');try{console.log('🔄 关闭调教界面，更新人物数据...'),console.log('📊 当前人物数据:',{id:e.id,name:e.name,loyalty:e.loyalty,stamina:e.stamina,maxStamina:e.maxStamina,status:e.status}),await _.WorldbookService.updateCharacterEntry(e);const t=c.l.getModuleData({moduleName:'training'}),a=(t?.characters||[]).map(t=>t.id===e.id?e:t);c.l.updateModuleData({moduleName:'training',data:{...t,characters:a}}),c.l.saveCurrentGameData(0),console.log('✅ 人物数据已更新到存档系统'),console.log('📊 最终人物数据:',{loyalty:e.loyalty,stamina:e.stamina,status:e.status})}catch(e){console.error('❌ 更新人物数据失败:',e)}s('update-character',e),setTimeout(()=>{s('close')},100)},j=()=>{k.value=!1},Y=(0,o.ref)(-1),K=(0,o.ref)(''),Q=()=>{Y.value>=0&&(l.value[Y.value].content=K.value,Z(Y.value),Y.value=-1,K.value='')},X=()=>{Y.value=-1,K.value=''},Z=e=>{const t=l.value[e];if('assistant'===t.role||'system'===t.role){const a=Math.floor(e/2);if(a<w.value.length){const e=le(ne(t.content));w.value[a].html=e}}},ee=()=>{const e=l.value.filter(e=>'assistant'===e.role||'system'===e.role);if(x.value>=0&&x.value<e.length){const t=e[x.value];return l.value.findIndex(e=>e===t)}return-1},te=()=>{const e=ee();var t;e>=0&&e<l.value.length&&(t=e,Y.value=t,K.value=l.value[t].content)},ae=()=>{const e=ee();e>=0&&e<l.value.length&&(l.value.splice(e,1),w.value=[],l.value.forEach(e=>{'assistant'!==e.role&&'system'!==e.role||A(e.content)}),x.value>=w.value.length&&(x.value=Math.max(0,w.value.length-1))),S.value=!1},oe=()=>{S.value=!1},ne=e=>e.replace(/<content[^>]*>(.*?)<\/content>/gi,'$1').replace(/<message[^>]*>(.*?)<\/message>/gi,'$1').replace(/<[^>]+>/g,''),se=e=>e.replace(/\[OPTIONS_JSON\][\s\S]*?\[\/OPTIONS_JSON\]/gi,'').trim(),le=e=>{const t=formatAsTavernRegexedString(e,'ai_output','display');return b.formatMessage(t,{enableMarkdown:!0,enableCodeHighlight:!0,enableQuote:!0})},re=e=>{e.target.style.display='none'};return(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',Bd,[(0,o.createElementVNode)('div',Ad,[(0,o.createCommentVNode)(' 头部信息 '),(0,o.createElementVNode)('div',Td,[(0,o.createElementVNode)('div',Md,[(0,o.createElementVNode)('div',Rd,[e.character.avatar?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.character.avatar,alt:e.character.name,class:'portrait-image',onError:re},null,40,_d)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Gd,[...a[6]||(a[6]=[(0,o.createElementVNode)('span',{class:'portrait-icon'},'👤',-1)])]))])]),(0,o.createElementVNode)('div',Id,[(0,o.createElementVNode)('div',Od,[(0,o.createElementVNode)('h3',Pd,(0,o.toDisplayString)(e.character.name),1),(0,o.createElementVNode)('div',Ld,(0,o.toDisplayString)(e.character.title),1)]),(0,o.createElementVNode)('div',Ud,[(0,o.createElementVNode)('div',Fd,[(0,o.createElementVNode)('div',Hd,[a[7]||(a[7]=(0,o.createElementVNode)('span',{class:'stat-label'},'忠诚度',-1)),(0,o.createElementVNode)('span',qd,(0,o.toDisplayString)(e.character.loyalty)+'%',1)]),(0,o.createElementVNode)('div',Jd,[(0,o.createElementVNode)('div',{class:'stat-fill loyalty-fill',style:(0,o.normalizeStyle)({width:`${e.character.loyalty}%`})},null,4)])]),(0,o.createElementVNode)('div',zd,[(0,o.createElementVNode)('div',Wd,[a[8]||(a[8]=(0,o.createElementVNode)('span',{class:'stat-label'},'体力',-1)),(0,o.createElementVNode)('span',jd,(0,o.toDisplayString)(e.character.stamina)+'/'+(0,o.toDisplayString)(e.character.maxStamina||200),1)]),(0,o.createElementVNode)('div',Yd,[(0,o.createElementVNode)('div',{class:'stat-fill stamina-fill',style:(0,o.normalizeStyle)({width:e.character.stamina/(e.character.maxStamina||200)*100+'%'})},null,4)])])])])]),(0,o.createElementVNode)('div',Kd,[(0,o.createElementVNode)('button',{class:'header-btn edit-btn',title:'编辑当前页消息',onClick:a[0]||(a[0]=e=>te())},[...a[9]||(a[9]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'✏️',-1)])]),(0,o.createElementVNode)('button',{class:'header-btn delete-btn',title:'删除当前页消息',onClick:a[1]||(a[1]=e=>(()=>{const e=ee();e>=0&&e<l.value.length&&(S.value=!0)})())},[...a[10]||(a[10]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🗑️',-1)])]),(0,o.createElementVNode)('button',{class:'header-btn close-btn',title:'关闭调教界面',onClick:J},[...a[11]||(a[11]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'✕',-1)])])]),(0,o.createCommentVNode)(' 消息列表区域 '),(0,o.createElementVNode)('div',Qd,[(0,o.createElementVNode)('div',Xd,[(0,o.createElementVNode)('button',{class:'nav-btn',disabled:(0,o.unref)(x)<=0,onClick:D},'上一页',8,Zd),(0,o.createElementVNode)('div',eu,(0,o.toDisplayString)((0,o.unref)(x)+1)+' / '+(0,o.toDisplayString)((0,o.unref)(w).length||1),1),(0,o.createElementVNode)('button',{class:'nav-btn',disabled:(0,o.unref)(x)>=(0,o.unref)(w).length-1,onClick:B},'下一页',8,tu)]),(0,o.createElementVNode)('div',{ref_key:'dialogueContent',ref:r,class:'book-viewport'},[(0,o.createElementVNode)('div',au,[(0,o.createElementVNode)('div',ou,[(0,o.createCommentVNode)(' 当前页内容 '),(0,o.createCommentVNode)(' eslint-disable-next-line vue/no-v-html '),(0,o.unref)(w)[(0,o.unref)(x)]?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'page-content typo-book',innerHTML:(0,o.unref)(w)[(0,o.unref)(x)].html},null,8,nu)):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 初始空白状态的提示 '),0===(0,o.unref)(w).length?((0,o.openBlock)(),(0,o.createElementBlock)('div',su,[(0,o.createElementVNode)('div',lu,[a[12]||(a[12]=(0,o.createElementVNode)('p',{class:'welcome-text'},'📖 调教开始',-1)),(0,o.createElementVNode)('p',ru,'选择你对 '+(0,o.toDisplayString)(e.character.name)+' 的第一个行动...',1)]),(0,o.createElementVNode)('div',iu,[(0,o.createElementVNode)('div',cu,[(0,o.createCommentVNode)(' 初始选项 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(C),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:`initial-opt-${t}`,class:(0,o.normalizeClass)(['inline-option',{disabled:(0,o.unref)(v)}]),onClick:t=>!(0,o.unref)(v)&&(async e=>{if(console.log('🎯 chooseInitialOption 被调用',e),v.value)return void console.log('⏸️ 正在发送中，跳过初始选择');const t=e.text;g(t),f.value=t,console.log('📝 暂存用户初始选择:',t);const a=`<div class="choice-line"><span class="choice-prefix">→</span> ${le(t)}</div>`;w.value.push({html:a}),x.value=0,await U()})(e)},[a[13]||(a[13]=(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1)),(0,o.createElementVNode)('span',uu,(0,o.toDisplayString)(e.text),1),a[14]||(a[14]=(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1))],10,du))),128)),(0,o.createCommentVNode)(' 自定义选项 '),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['inline-option custom-option',{disabled:(0,o.unref)(v)}]),onClick:G},[...a[15]||(a[15]=[(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1),(0,o.createElementVNode)('span',{class:'option-content'},'自定义',-1),(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1)])],2)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 本页末尾的选项（融入文字，仅在最新一页显示） '),(0,o.unref)(x)===(0,o.unref)(w).length-1&&((0,o.unref)(V).length>0||(0,o.unref)(w).length>0)?((0,o.openBlock)(),(0,o.createElementBlock)('div',mu,[(0,o.createElementVNode)('div',gu,[(0,o.createCommentVNode)(' 前三个选项 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(V),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:`opt-${t}`,class:(0,o.normalizeClass)(['inline-option',{disabled:(0,o.unref)(v)}]),onClick:t=>!(0,o.unref)(v)&&(async e=>{if(console.log('🎯 chooseOption 被调用',e),console.log('🔍 当前状态:',{isSending:v.value,characterName:n.character.name}),v.value)return void console.log('⏸️ 正在发送中，跳过选择');if($d.isStaminaTooLow(n.character.stamina))return console.log('⚠️ 体力过低，无法继续调教'),void toastr.warning(`${n.character.name} 体力过低，无法继续调教！`);const t=e.text;g(t),f.value=t,console.log('📝 暂存用户选择:',t),T(t),V.value=[],H(),await U()})(e)},[a[16]||(a[16]=(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1)),(0,o.createElementVNode)('span',pu,(0,o.toDisplayString)(e.text),1),a[17]||(a[17]=(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1))],10,hu))),128)),(0,o.createCommentVNode)(' 第四个选项：自定义输入 '),(0,o.unref)(V).length>0||(0,o.unref)(w).length>0?((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['inline-option custom-option',{disabled:(0,o.unref)(v)}]),onClick:G},[...a[18]||(a[18]=[(0,o.createElementVNode)('span',{class:'option-bracket'},'[',-1),(0,o.createElementVNode)('span',{class:'option-content'},'自定义',-1),(0,o.createElementVNode)('span',{class:'option-bracket'},']',-1)])],2)):(0,o.createCommentVNode)('v-if',!0)])])):(0,o.createCommentVNode)('v-if',!0)])])],512)])]),(0,o.createCommentVNode)(' 自定义输入面板 '),(0,o.unref)(R)?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'custom-input-overlay',onClick:I},[(0,o.createElementVNode)('div',{class:'custom-input-panel',onClick:a[3]||(a[3]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'custom-input-header'},[a[19]||(a[19]=(0,o.createElementVNode)('h3',null,'自定义输入',-1)),(0,o.createElementVNode)('button',{class:'close-panel-btn',onClick:I},'✕')]),(0,o.createElementVNode)('div',vu,[(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':a[2]||(a[2]=e=>(0,o.isRef)(M)?M.value=e:null),class:'custom-input-textarea',placeholder:'输入你的选择…',disabled:(0,o.unref)(v),rows:'5',onKeydown:(0,o.withKeys)((0,o.withModifiers)(O,['exact']),['enter'])},null,40,fu),[[o.vModelText,(0,o.unref)(M)]])]),(0,o.createElementVNode)('div',yu,[(0,o.createElementVNode)('button',{class:'submit-btn',disabled:!(0,o.unref)(M).trim()||(0,o.unref)(v),onClick:O},(0,o.toDisplayString)((0,o.unref)(v)?'发送中...':'发送'),9,bu)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 编辑对话框 '),(0,o.unref)(Y)>=0?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'edit-dialog-overlay',onClick:X},[(0,o.createElementVNode)('div',{class:'edit-dialog',onClick:a[5]||(a[5]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'edit-dialog-header'},[a[20]||(a[20]=(0,o.createElementVNode)('h3',null,'编辑消息',-1)),(0,o.createElementVNode)('button',{class:'close-dialog-btn',onClick:X},'✕')]),(0,o.createElementVNode)('div',Nu,[(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':a[4]||(a[4]=e=>(0,o.isRef)(K)?K.value=e:null),class:'edit-textarea',rows:'8',placeholder:'编辑消息内容...'},null,512),[[o.vModelText,(0,o.unref)(K)]])]),(0,o.createElementVNode)('div',{class:'edit-dialog-footer'},[(0,o.createElementVNode)('button',{class:'save-btn',onClick:Q},'保存'),(0,o.createElementVNode)('button',{class:'cancel-btn',onClick:X},'取消')])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 关闭调教确认框 '),(0,o.createVNode)(y,{show:(0,o.unref)(k),title:'结束调教',message:'确定要结束本次调教吗？',details:'结束调教后，角色将进入调教中状态，本回合无法再次开启调教对话。','confirm-text':'确定结束','cancel-text':'继续调教',type:'warning',onConfirm:W,onCancel:j},null,8,['show']),(0,o.createCommentVNode)(' 删除消息确认框 '),(0,o.createVNode)(y,{show:(0,o.unref)(S),title:'删除消息',message:'确定要删除这条消息吗？',details:'删除后无法恢复，请谨慎操作。','confirm-text':'确定删除','cancel-text':'取消',type:'danger',onConfirm:ae,onCancel:oe},null,8,['show'])]))}}),ku={class:'training-panel'},Su={class:'panel-header'},Vu={class:'batch-buttons'},Cu=['disabled'],wu=['disabled'],xu={class:'characters-grid'},Du=['onClick'],$u={class:'character-portrait'},Bu=['src','alt'],Au={key:1,class:'default-portrait'},Tu={class:'character-level-badge'},Mu={class:'level-value'},Ru={class:'character-name'},_u=['onClick'],Gu={class:'wheel-center'},Iu={class:'character-avatar'},Ou=['src','alt'],Pu={key:1,class:'default-avatar'},Lu={class:'wheel-buttons'},Uu=['disabled','title'],Fu=['disabled','title'],Hu={class:'modal-body'},qu={class:'avatar-options'},Ju={class:'option-group'},zu={class:'url-input-group'},Wu={class:'option-group'},ju={class:'option-group'},Yu={class:'preset-avatars'},Ku=['onClick'],Qu=(0,o.defineComponent)({__name:'调教界面',setup(e){const t=(0,o.ref)(!1),a=(0,o.ref)(),n=(e=[])=>{const t=new Map;for(const a of e)a&&a.id&&!t.has(a.id)&&t.set(a.id,a);return Array.from(t.values())},s=(0,o.ref)([]),l=(0,o.ref)(null),r=(0,o.ref)(!1),i=(0,o.ref)(!1),d=(0,o.ref)(!1),u=(0,o.ref)(!1),m=(0,o.ref)(''),g=(0,o.ref)(null),h=(0,o.ref)([]),p=['Ⅰ','Ⅱ','Ⅲ','Ⅳ','Ⅴ','Ⅵ'],v=(0,o.computed)(()=>s.value.some(e=>'imprisoned'===e.status)),f=(0,o.computed)(()=>s.value.some(e=>('imprisoned'===e.status||'surrendered'===e.status)&&e.stamina>=20));let y=null,b=!1;const N=async(e=!0)=>{if(b)console.log('加载进行中，跳过本次调用');else{if(b=!0,!e&&(()=>{if(!t.value)return!1;const e=c.l.getModuleData({moduleName:'training'});if(!e)return!1;const a=e.characters||[],o=new Set(a.map(e=>e.id)).size;return!(new Set(s.value.map(e=>e.id)).size<o)&&(!s.value.some(e=>{const t=a.find(t=>t.id===e.id);return!!t&&(Math.abs(e.stamina-t.stamina)>1||Math.abs(e.fertility-t.fertility)>1||Math.abs(e.loyalty-t.loyalty)>1)})||(console.log('检测到存档数据更新，需要重新加载数据'),!1))})())return console.log('数据已完全加载，跳过重复加载'),void(b=!1);try{const e=c.l.getModuleData({moduleName:'training'});console.log('读取到调教数据:',e);let a=[];if(e&&e.characters&&e.characters.length>0){const t=e.characters.filter(e=>'uncaptured'!==e.status&&'enemy'!==e.status&&'哥布林之王'!==e.name).map(e=>({...e}));a.push(...t),console.log('可用人物数据已加载:',t)}a=n(a);const o=a.map(e=>e.id).filter(Boolean).sort().join('|');if(y&&y===o)return console.log('检测到相同签名的加载，跳过'),void(b=!1);try{const t=n(e.characters||[]);e.characters&&t.length!==e.characters.length&&(c.l.updateModuleData({moduleName:'training',data:{...e,characters:t}}),console.log('存档人物数据已去重并回写'))}catch(e){console.warn('存档人物去重失败(忽略):',e)}if(s.value=a,y=o,console.log('全量重载人物数据:',a),t.value=!0,console.log('当前总人物数量:',s.value.length),E(),e&&e.characters&&e.characters.length>0){const t=e.characters.filter(e=>('imprisoned'===e.status||'training'===e.status||'breeding'===e.status||'surrendered'===e.status||'deployed'===e.status)&&'enemy'!==e.status).map(e=>({...e}));await S(t)}b=!1}catch(e){console.error('加载调教数据失败:',e),b=!1}}},E=()=>{try{const e=s.value.filter(e=>'uncaptured'!==e.status);c.l.setResource('trainingSlaves',e.length),console.log('调教人物数量已更新:',e.length,'当前资源值:',c.l.resources.value.trainingSlaves)}catch(e){console.error('更新调教人物数量失败:',e),c.l.setResource('trainingSlaves',0)}},k=()=>{try{(()=>{try{const e=c.l.getModuleData({moduleName:'training'}),t=e?.characters||[],a=n(s.value),o=t.filter(e=>'player'===e.status||'哥布林之王'===e.name),l=[...a,...o],r=n(l);c.l.updateModuleData({moduleName:'training',data:{...e,characters:r}}),E(),console.log('人物状态已同步到模块化存档系统，保留玩家角色')}catch(e){console.error('同步人物状态失败:',e)}})(),(()=>{try{const e=[];s.value.forEach(t=>{t.locationId&&t.locationId.startsWith('breeding-')&&e.push({roomId:t.locationId,characterId:t.id,characterName:t.name,status:'breeding'===t.status?'breeding':'imprisoned',occupiedAt:new Date})});const t=c.l.getModuleData({moduleName:'nest'});c.l.updateModuleData({moduleName:'nest',data:{...t,breedingRoomInfo:e}}),console.log('繁殖间占用信息已同步到巢穴模块')}catch(e){console.error('同步繁殖间信息失败:',e)}})(),console.log('调教数据已保存')}catch(e){console.error('保存调教数据失败:',e)}},S=async e=>{try{let t=0,a=0,o=0;for(const n of e){if('player'===n.status||'player-1'===n.id||'哥布林之王'===n.name){o++,console.log(`跳过player角色 ${n.name} (ID: ${n.id}, 状态: ${n.status})`);continue}await _.WorldbookService.getCharacterEntry(n.id)?(a++,console.log(`人物 ${n.name} 已存在于世界书中，跳过添加`)):(await _.WorldbookService.createCharacterWorldbook(n),t++,console.log(`已将人物 ${n.name} 添加到世界书`))}t>0&&console.log(`已将 ${t} 个人物添加到世界书`),a>0&&console.log(`跳过 ${a} 个已存在的人物`),o>0&&console.log(`跳过 ${o} 个player角色`)}catch(e){console.error('管理世界书条目失败:',e)}},V=()=>{d.value=!1,l.value=null},C=()=>{i.value=!1,l.value=null},w=async e=>{if('training'!==e.status)if(Co.hasEnoughActionPoints('singleTraining'))if(Co.consumeActionPoints('singleTraining')){if('deployed'===e.status)return Co.refundActionPoints('singleTraining'),a.value?.warning(`${e.name} 已编制，无法进行调教！`,{title:'无法调教',duration:3e3}),void(d.value=!1);if(e.stamina<20)return Co.refundActionPoints('singleTraining'),a.value?.warning(`${e.name} 体力过低，无法开始调教！`,{title:'体力不足',duration:3e3}),void(d.value=!1);e.status='training',e.lastTraining=new Date,d.value=!1,e.stamina=Math.max(0,e.stamina-20),e.stamina<=0?T(e):(a.value?.success(`${e.name} 开始调教，将在下回合完成`,{title:'调教开始',duration:3e3}),k())}else await ze.showDanger('行动力消耗失败','操作失败');else await ze.showWarning(Co.getInsufficientActionPointsMessage('singleTraining'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限')},x=async()=>{try{const e=c.l.getModuleData({moduleName:'nest'});if(!e||!e.breedingSlots)return[];const t=[];for(let a=0;a<e.breedingSlots.length;a++){const o=e.breedingSlots[a];if(o.building&&'breeding'===o.building.id&&o.unlocked){s.value.some(e=>e.locationId===`breeding-${a}`&&'breeding'===e.status)||t.push({id:`breeding-${a}`,index:a})}}return t}catch(e){return console.error('检查交配间失败:',e),[]}},D=()=>{u.value=!1},B=e=>{console.log('🔄 开始更新人物数据...'),console.log('📊 接收到的更新数据:',{id:e.id,name:e.name,loyalty:e.loyalty,stamina:e.stamina,status:e.status}),e.loyalty>=100&&'surrendered'!==e.status&&'player'!==e.status&&'deployed'!==e.status&&(console.log(`${e.name} 堕落值达到100%，可以手动触发堕落`),a.value?.info(`${e.name} 堕落值已满，可以点击堕落按钮完成堕落！`,{title:'堕落就绪',duration:6e3}));const t=s.value.findIndex(t=>t.id===e.id);if(t>-1?(s.value[t]=e,console.log('✅ 已更新人物列表中的数据')):console.warn('⚠️ 未找到人物在列表中的索引'),l.value?.id===e.id&&(l.value=e,console.log('✅ 更新选中的人物数据')),'imprisoned'===e.status&&l.value?.id===e.id){if(console.log('🎯 手动调教结束，开始自动调教流程...'),e.status='training',e.lastTraining=new Date,e.stamina=Math.max(0,e.stamina-20),e.stamina<=0)return void T(e);t>-1&&(s.value[t]=e),l.value?.id===e.id&&(l.value=e),a.value?.success(`${e.name} 手动调教完成，已自动开始调教流程，将在下回合完成`,{title:'融合调教',duration:4e3})}k(),c.l.saveCurrentGameData(0),U(),console.log('✅ 人物数据更新完成')},A=async e=>new Promise(t=>{const a=document.createElement('div');a.className='corruption-animation',a.innerHTML=`\n      <div class="corruption-hearts">\n        <div class="heart heart-1">💖</div>\n        <div class="heart heart-2">💖</div>\n        <div class="heart heart-3">💖</div>\n        <div class="heart heart-4">💖</div>\n      </div>\n      <div class="corruption-text">${e.name} 正在堕落...</div>\n    `;const o=document.createElement('style');o.textContent='\n      .corruption-animation {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 10000;\n        pointer-events: none;\n        text-align: center;\n        color: #ff69b4;\n        font-weight: bold;\n        font-size: 24px;\n        text-shadow: 0 0 10px rgba(255, 105, 180, 0.8);\n      }\n\n      .corruption-hearts {\n        position: relative;\n        width: 300px;\n        height: 150px;\n        margin: 0 auto 20px;\n      }\n\n      .heart {\n        position: absolute;\n        font-size: 35px;\n        animation: corruptionHeart 2.5s ease-in-out infinite;\n        filter: drop-shadow(0 0 8px rgba(255, 105, 180, 0.6));\n      }\n\n      .heart-1 { top: 20px; left: 50px; animation-delay: 0s; }\n      .heart-2 { top: 40px; right: 50px; animation-delay: 0.6s; }\n      .heart-3 { top: 60px; left: 100px; animation-delay: 1.2s; }\n      .heart-4 { top: 80px; right: 100px; animation-delay: 1.8s; }\n\n      @keyframes corruptionHeart {\n        0%, 100% {\n          transform: scale(1) rotate(0deg) translateY(0px);\n          opacity: 0.7;\n        }\n        25% {\n          transform: scale(1.3) rotate(90deg) translateY(-10px);\n          opacity: 1;\n        }\n        50% {\n          transform: scale(1.5) rotate(180deg) translateY(-20px);\n          opacity: 0.9;\n        }\n        75% {\n          transform: scale(1.3) rotate(270deg) translateY(-10px);\n          opacity: 1;\n        }\n      }\n\n      .corruption-text {\n        animation: corruptionText 1.5s ease-in-out infinite;\n      }\n\n      @keyframes corruptionText {\n        0%, 100% { opacity: 0.7; transform: scale(1); }\n        50% { opacity: 1; transform: scale(1.1); }\n      }\n    ',document.head.appendChild(o),document.body.appendChild(a),setTimeout(()=>{document.body.removeChild(a),document.head.removeChild(o),t()},2e3)}),T=async e=>{if(await ze.showDanger(`确定要处决 ${e.name} 吗？`,'确认处决',`处决后将获得资源奖励，但人物将永久消失！\n\n人物评级：${e.rating||'未评级'}`)){const t=1e3,o=500,n={S:3,A:2.5,B:2,C:1.5,D:1}[e.rating||'D']||1,l=Math.floor(t*n),r=Math.floor(o*n);c.l.addResource('gold',l,`处决${e.name}获得`),c.l.addResource('food',r,`处决${e.name}获得`);const i=s.value.findIndex(t=>t.id===e.id);i>-1&&s.value.splice(i,1);try{await _.WorldbookService.deleteCharacterEntry(e.id),await _.WorldbookService.deleteCharacterStoryHistoryEntry(e.id),console.log(`已从世界书中删除人物 ${e.name} 及其剧情记录`)}catch(e){console.error('删除世界书条目失败:',e)}k(),d.value=!1,C(),a.value?.success(`处决成功！获得奖励：💰 金币 +${l}，🍖 食物 +${r}。${e.name} 已被永久处决。`,{title:'处决完成',duration:5e3}),U()}},M=e=>{g.value=e,m.value=e.avatar||'',r.value=!0},R=()=>{r.value=!1,g.value=null,m.value=''},G=()=>{g.value&&m.value&&(g.value.avatar=m.value,R())},I=e=>{const t=e.target,a=t.files?.[0];if(a&&g.value){const e=new FileReader;e.onload=e=>{g.value&&e.target?.result&&(g.value.avatar=e.target.result,R())},e.readAsDataURL(a)}},O=e=>{e.target.style.display='none'},P=async()=>{if(!Co.hasEnoughActionPoints('batchTraining'))return void await ze.showWarning(Co.getInsufficientActionPointsMessage('batchTraining'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限');if(!Co.consumeActionPoints('batchTraining'))return void await ze.showDanger('行动力消耗失败','操作失败');s.value.filter(e=>'imprisoned'===e.status&&e.stamina>=20).forEach(e=>{w(e)})},L=async()=>{if(!Co.hasEnoughActionPoints('batchBreeding'))return void await ze.showWarning(Co.getInsufficientActionPointsMessage('batchBreeding'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限');if(!Co.consumeActionPoints('batchBreeding'))return void await ze.showDanger('行动力消耗失败','操作失败');const e=s.value.filter(e=>('imprisoned'===e.status||'surrendered'===e.status)&&e.stamina>=20);if(0===e.length)return Co.refundActionPoints('batchBreeding'),void a.value?.warning('没有符合生育条件的人物！',{title:'无法生育',duration:3e3});const t=await x();if(0===t.length)return Co.refundActionPoints('batchBreeding'),void a.value?.warning('没有可用的交配间，请先在巢穴界面建设繁殖间！',{title:'缺少设施',duration:4e3});let o=0,n=0;for(const s of e){if(n>=t.length){a.value?.warning(`只有 ${t.length} 个交配间可用，剩余 ${e.length-o} 个人物无法进行生育！`,{title:'交配间不足',duration:4e3});break}const l=t[n];s.locationId=l.id,s.status='breeding',s.stamina=Math.max(0,s.stamina-20),s.stamina<=0?T(s):(o++,n++)}k(),o>0&&a.value?.success(`成功为 ${o} 个人物开始生育，将在下回合完成`,{title:'批量生育',duration:4e3})},U=()=>{const e=[...s.value];e.sort((e,t)=>{if(e.favorite&&!t.favorite)return-1;if(!e.favorite&&t.favorite)return 1;const a={S:5,A:4,B:3,C:2,D:1},o=a[e.rating||'D'],n=a[t.rating||'D'];return void 0===o||void 0===n?0:n-o}),h.value=e};return(0,o.onMounted)(async()=>{await N(!0),U(),E()}),(0,o.onActivated)(async()=>{await N(!0),U(),E()}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',ku,[(0,o.createElementVNode)('div',Su,[t[11]||(t[11]=(0,o.createElementVNode)('h3',{class:'panel-title'},'💋 调教界面',-1)),(0,o.createElementVNode)('div',Vu,[(0,o.createElementVNode)('button',{class:'batch-train-btn',disabled:!v.value,title:'批量调教',onClick:P},[...t[9]||(t[9]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'⚡',-1),(0,o.createElementVNode)('span',{class:'btn-text'},'全部调教',-1)])],8,Cu),(0,o.createElementVNode)('button',{class:'batch-breed-btn',disabled:!f.value,title:'批量生育',onClick:L},[...t[10]||(t[10]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🤱',-1),(0,o.createElementVNode)('span',{class:'btn-text'},'全部生育',-1)])],8,wu)])]),(0,o.createCommentVNode)(' 人物卡片网格 - 竖条卡片布局 '),(0,o.createElementVNode)('div',xu,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(h.value,e=>{return(0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.id,class:(0,o.normalizeClass)(['character-card',[(n=e.rating||'D',`rating-${n.toLowerCase()}`),{selected:l.value?.id===e.id}]]),onClick:t=>(e=>{l.value=e,d.value=!0})(e)},[(0,o.createCommentVNode)(' 人物肖像图片区域 '),(0,o.createElementVNode)('div',$u,[e.avatar?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:e.avatar,alt:e.name,onError:O},null,40,Bu)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Au,[...t[12]||(t[12]=[(0,o.createElementVNode)('span',{class:'portrait-icon'},'👤',-1)])])),(0,o.createCommentVNode)(' 状态标识 '),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['character-status-badge',e.status])},(0,o.toDisplayString)((a=e.status,{imprisoned:'关押中',training:'调教中',breeding:'交配中',surrendered:'已堕落',deployed:'已编制'}[a]||'未知')),3),(0,o.createCommentVNode)(' 等级标签 '),(0,o.createElementVNode)('div',Tu,[t[13]||(t[13]=(0,o.createElementVNode)('span',{class:'level-icon'},'⭐',-1)),(0,o.createElementVNode)('span',Mu,(0,o.toDisplayString)(Math.floor(e.offspring/10)),1)])]),(0,o.createCommentVNode)(' 人物名称 '),(0,o.createElementVNode)('div',Ru,(0,o.toDisplayString)(e.name),1),(0,o.createCommentVNode)(' 收藏按钮 '),(0,o.createElementVNode)('div',{class:'favorite-btn-card',onClick:(0,o.withModifiers)(t=>(e=>{e.favorite=!e.favorite,U(),k()})(e),['stop'])},[(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['favorite-icon',{favorited:e.favorite}])},(0,o.toDisplayString)(e.favorite?'⭐':'☆'),3)],8,_u)],10,Du);var a,n}),128))]),(0,o.createCommentVNode)(' 人物操作轮盘 '),d.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'character-wheel-overlay',onClick:V},[(0,o.createElementVNode)('div',{class:'character-wheel',onClick:t[6]||(t[6]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createCommentVNode)(' 轮盘中心 '),(0,o.createElementVNode)('div',Gu,[(0,o.createElementVNode)('div',Iu,[l.value?.avatar?((0,o.openBlock)(),(0,o.createElementBlock)('img',{key:0,src:l.value.avatar,alt:l.value.name},null,8,Ou)):((0,o.openBlock)(),(0,o.createElementBlock)('div',Pu,[...t[14]||(t[14]=[(0,o.createElementVNode)('span',{class:'avatar-icon'},'👤',-1)])]))]),(0,o.createElementVNode)('button',{class:'close-wheel-btn',onClick:V},'×')]),(0,o.createCommentVNode)(' 轮盘按钮 '),(0,o.createElementVNode)('div',Lu,[(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['wheel-btn primary',{'btn-0':!0}]),title:'查看详情',onClick:t[0]||(t[0]=e=>{return l.value&&(t=l.value,l.value=t,i.value=!0,void(d.value=!1));var t})},[...t[15]||(t[15]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'👁️',-1)])]),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['wheel-btn outfit',{'btn-1':!0,disabled:!1}]),disabled:!1,title:'换装（功能待实装）',onClick:t[1]||(t[1]=e=>{return l.value&&(t=l.value,a.value?.info(`${t.name} 的换装功能正在开发中，敬请期待！`,{title:'功能开发中',duration:3e3}),void(d.value=!1));var t})},[...t[16]||(t[16]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'👗',-1)])]),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['wheel-btn fertility',{'btn-3':!0,disabled:'breeding'===l.value?.status||'training'===l.value?.status||'deployed'===l.value?.status||(l.value?.stamina||0)<20}]),disabled:'breeding'===l.value?.status||'training'===l.value?.status||'deployed'===l.value?.status||(l.value?.stamina||0)<20,title:'deployed'===l.value?.status?'已编制的人物无法交配':(l.value?.stamina||0)<20?'体力过低，无法交配':'交配',onClick:t[2]||(t[2]=e=>l.value&&(async e=>{if('breeding'===e.status)return;if(!Co.hasEnoughActionPoints('singleBreeding'))return void await ze.showWarning(Co.getInsufficientActionPointsMessage('singleBreeding'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限');if(!Co.consumeActionPoints('singleBreeding'))return void await ze.showDanger('行动力消耗失败','操作失败');if('deployed'===e.status)return Co.refundActionPoints('singleBreeding'),a.value?.warning(`${e.name} 已编制，无法进行交配！`,{title:'无法交配',duration:3e3}),void(d.value=!1);if(e.stamina<20)return Co.refundActionPoints('singleBreeding'),a.value?.warning(`${e.name} 体力过低，无法开始交配！`,{title:'体力不足',duration:3e3}),void(d.value=!1);const t=await x();if(0===t.length)return Co.refundActionPoints('singleBreeding'),a.value?.warning('没有可用的交配间，请先在巢穴界面建设繁殖间！',{title:'缺少设施',duration:4e3}),void(d.value=!1);const o=t[0];e.locationId=o.id,e.status='breeding',d.value=!1,e.stamina=Math.max(0,e.stamina-20),e.stamina<=0?T(e):(a.value?.success(`${e.name} 开始交配，将在下回合完成`,{title:'交配开始',duration:3e3}),k())})(l.value))},[...t[17]||(t[17]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🤱',-1)])],10,Uu),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['wheel-btn manual',{'btn-4':!0,disabled:'training'===l.value?.status||'breeding'===l.value?.status||'deployed'===l.value?.status||(l.value?.stamina||0)<20}]),disabled:'training'===l.value?.status||'breeding'===l.value?.status||'deployed'===l.value?.status||(l.value?.stamina||0)<20,title:'deployed'===l.value?.status?'已编制的人物无法调教':(l.value?.stamina||0)<20?'体力过低，无法调教':'融合调教（手动+自动）',onClick:t[3]||(t[3]=e=>l.value&&(async e=>{if(Co.hasEnoughActionPoints('singleTraining'))if(Co.consumeActionPoints('singleTraining')){if('training'===e.status)return Co.refundActionPoints('singleTraining'),a.value?.warning(`${e.name} 正在调教中，本回合无法再次开启调教对话！`,{title:'调教中',duration:3e3}),void(d.value=!1);if('deployed'===e.status)return Co.refundActionPoints('singleTraining'),a.value?.warning(`${e.name} 已编制，无法进行调教！`,{title:'无法调教',duration:3e3}),void(d.value=!1);if(e.stamina<20)return Co.refundActionPoints('singleTraining'),a.value?.warning(`${e.name} 体力过低，无法开始调教！`,{title:'体力不足',duration:3e3}),void(d.value=!1);l.value=e,d.value=!1,u.value=!0}else await ze.showDanger('行动力消耗失败','操作失败');else await ze.showWarning(Co.getInsufficientActionPointsMessage('singleTraining'),'行动力不足','请等待下回合恢复行动力或征服更多区域增加上限')})(l.value))},[...t[18]||(t[18]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'⚡',-1)])],10,Fu),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['wheel-btn danger',{'btn-2':!0}]),title:'处决',onClick:t[4]||(t[4]=e=>l.value&&T(l.value))},[...t[19]||(t[19]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'⚔️',-1)])]),(0,o.createCommentVNode)(' 堕落按钮 - 只在忠诚度达到100%且未堕落时显示 '),l.value&&l.value.loyalty>=100&&'surrendered'!==l.value.status?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:(0,o.normalizeClass)(['wheel-btn corruption',{'btn-5':!0}]),title:'完成堕落',onClick:t[5]||(t[5]=e=>l.value&&(async e=>{if(await ze.showWarning(`确定要让 ${e.name} 完成堕落吗？`,'确认堕落',`堕落完成后，${e.name} 将对主人绝对忠诚！\n\n堕落值：${e.loyalty}%\n\n此操作不可逆转！`)){await A(e);const t=25,o={S:3,A:2.5,B:2,C:1.5,D:1}[e.rating||'D']||1,n=Math.floor(t*o);c.l.addResource('threat',n,`堕落${e.name}获得`),e.status='surrendered',console.log(`${e.name} 已完成堕落，状态已更新为已堕落`),await _.WorldbookService.updateCharacterEntry(e);const r=s.value.findIndex(t=>t.id===e.id);r>-1&&(s.value[r]=e),l.value?.id===e.id&&(l.value=e),k(),c.l.saveCurrentGameData(0),a.value?.success(`堕落成功！${e.name} 已完全堕落，对主人绝对忠诚！威胁度增加：⚠️ +${n}。`,{title:'堕落完成',duration:5e3})}})(l.value))},[...t[20]||(t[20]=[(0,o.createElementVNode)('span',{class:'btn-icon'},'🔥',-1)])])):(0,o.createCommentVNode)('v-if',!0)])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 人物详情弹窗 '),(0,o.createVNode)(Dd,{show:i.value,character:l.value,onClose:C,onStartTraining:w,onEditAvatar:M,onExecute:T},null,8,['show','character']),(0,o.createCommentVNode)(' 头像编辑弹窗 '),r.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:'modal-overlay',onClick:R},[(0,o.createElementVNode)('div',{class:'modal-content',onClick:t[8]||(t[8]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',{class:'modal-header'},[t[21]||(t[21]=(0,o.createElementVNode)('h4',null,'编辑头像',-1)),(0,o.createElementVNode)('button',{class:'close-btn',onClick:R},'×')]),(0,o.createElementVNode)('div',Hu,[(0,o.createElementVNode)('div',qu,[(0,o.createElementVNode)('div',Ju,[t[22]||(t[22]=(0,o.createElementVNode)('label',null,'网络图片URL:',-1)),(0,o.createElementVNode)('div',zu,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>m.value=e),type:'url',placeholder:'输入图片链接...',class:'url-input'},null,512),[[o.vModelText,m.value]]),(0,o.createElementVNode)('button',{class:'action-btn primary url-set-btn',onClick:G},'设置')])]),(0,o.createElementVNode)('div',Wu,[t[23]||(t[23]=(0,o.createElementVNode)('label',null,'本地图片:',-1)),(0,o.createElementVNode)('input',{type:'file',accept:'image/*',class:'file-input',onChange:I},null,32)]),(0,o.createElementVNode)('div',ju,[t[24]||(t[24]=(0,o.createElementVNode)('label',null,'预设头像:',-1)),(0,o.createElementVNode)('div',Yu,[((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(p,e=>(0,o.createElementVNode)('div',{key:e,class:'preset-avatar',onClick:t=>(e=>{g.value&&(g.value.avatar=e,R())})(e)},(0,o.toDisplayString)(e),9,Ku)),64))])])])])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 手动调教界面（暂时接入选项式界面） '),u.value&&l.value?((0,o.openBlock)(),(0,o.createBlock)(Eu,{key:2,character:l.value,onClose:D,onUpdateCharacter:B},null,8,['character'])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 弹窗提示组件 '),(0,o.createVNode)(Eo,{ref_key:'toastRef',ref:a},null,512)]))}}),Xu=(0,f.A)(Qu,[['__scopeId','data-v-2091d792']]);$(()=>{const e=(0,n.createRouter)({history:(0,n.createMemoryHistory)(),routes:[{path:'/',component:Lt},{path:'/战斗',component:Ys},{path:'/探索',component:wr},{path:'/巢穴',component:bi},{path:'/调教',component:Xu},{path:'/部队编制',component:mo}]});e.beforeEach((e,t,a)=>{a()}),(0,o.createApp)(Lt).use(e).mount('#app')});</script><style>.custom-confirm-overlay[data-v-284513a8]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000}.custom-confirm-overlay .custom-confirm-modal[data-v-284513a8]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.4);border-radius:16px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,.6);animation:modalSlideIn-284513a8 .3s ease-out}@media (max-width:768px){.custom-confirm-overlay .custom-confirm-modal[data-v-284513a8]{width:95%;max-height:90vh;border-radius:12px}}.custom-confirm-overlay .custom-confirm-modal .modal-header[data-v-284513a8]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(205,133,63,.2)}.custom-confirm-overlay .custom-confirm-modal .modal-header h3[data-v-284513a8]{margin:0;color:#ffd7a1;font-size:20px;font-weight:700}.custom-confirm-overlay .custom-confirm-modal .modal-header .close-button[data-v-284513a8]{background:none;border:none;color:#9ca3af;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease}.custom-confirm-overlay .custom-confirm-modal .modal-header .close-button[data-v-284513a8]:hover{background:rgba(239,68,68,.1);color:#ef4444}.custom-confirm-overlay .custom-confirm-modal .modal-content[data-v-284513a8]{padding:24px}@media (max-width:768px){.custom-confirm-overlay .custom-confirm-modal .modal-content[data-v-284513a8]{padding:16px}}.custom-confirm-overlay .custom-confirm-modal .modal-content .message[data-v-284513a8]{color:#f0e6d2;font-size:16px;line-height:1.5;margin-bottom:12px}.custom-confirm-overlay .custom-confirm-modal .modal-content .details[data-v-284513a8]{color:#9ca3af;font-size:14px;line-height:1.4;background:rgba(0,0,0,.2);padding:12px;border-radius:8px;border-left:3px solid rgba(205,133,63,.5)}.custom-confirm-overlay .custom-confirm-modal .modal-actions[data-v-284513a8]{display:flex;justify-content:flex-end;gap:12px;margin-top:20px;padding:16px 24px;border-top:1px solid rgba(205,133,63,.2)}@media (max-width:768px){.custom-confirm-overlay .custom-confirm-modal .modal-actions[data-v-284513a8]{padding:12px 16px;gap:8px}}.custom-confirm-overlay .custom-confirm-modal .modal-actions .cancel-button[data-v-284513a8],.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button[data-v-284513a8]{padding:10px 20px;border-radius:8px;cursor:pointer;transition:all .2s ease;font-weight:600;font-size:14px;border:none}@media (max-width:768px){.custom-confirm-overlay .custom-confirm-modal .modal-actions .cancel-button[data-v-284513a8],.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button[data-v-284513a8]{padding:8px 16px;font-size:12px}}.custom-confirm-overlay .custom-confirm-modal .modal-actions .cancel-button[data-v-284513a8]{background:rgba(107,114,128,.2);border:1px solid rgba(107,114,128,.3);color:#9ca3af}.custom-confirm-overlay .custom-confirm-modal .modal-actions .cancel-button[data-v-284513a8]:hover{background:rgba(107,114,128,.3)}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.info-button[data-v-284513a8]{background:linear-gradient(180deg,#3b82f6,#2563eb);border:1px solid rgba(59,130,246,.6);color:#fff}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.info-button[data-v-284513a8]:hover{background:linear-gradient(180deg,#2563eb,#1d4ed8);transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,.3)}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.warning-button[data-v-284513a8]{background:linear-gradient(180deg,#f59e0b,#d97706);border:1px solid rgba(245,158,11,.6);color:#fff}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.warning-button[data-v-284513a8]:hover{background:linear-gradient(180deg,#d97706,#b45309);transform:translateY(-1px);box-shadow:0 4px 12px rgba(245,158,11,.3)}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.danger-button[data-v-284513a8]{background:linear-gradient(180deg,#dc2626,#b91c1c);border:1px solid rgba(220,38,38,.6);color:#fff}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.danger-button[data-v-284513a8]:hover{background:linear-gradient(180deg,#b91c1c,#991b1b);transform:translateY(-1px);box-shadow:0 4px 12px rgba(220,38,38,.3)}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.success-button[data-v-284513a8]{background:linear-gradient(180deg,#059669,#047857);border:1px solid rgba(5,150,105,.6);color:#fff}.custom-confirm-overlay .custom-confirm-modal .modal-actions .confirm-button.success-button[data-v-284513a8]:hover{background:linear-gradient(180deg,#047857,#065f46);transform:translateY(-1px);box-shadow:0 4px 12px rgba(5,150,105,.3)}@keyframes modalSlideIn-284513a8{from{opacity:0;transform:translateY(-20px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.generic-dialogue-container{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 20% 10%,rgba(255,255,255,0.06),transparent 40%),radial-gradient(circle at 80% 90%,rgba(255,255,255,0.05),transparent 40%),linear-gradient(135deg,rgba(0,0,0,0.9),rgba(20,10,5,0.86));z-index:1000;padding:24px}@media (max-width:768px){.generic-dialogue-container{padding:8px;align-items:stretch}}.dialogue-panel{width:min(1200px,95vw);height:min(92vh,1000px);display:flex;flex-direction:column;border-radius:16px;border:2px solid rgba(205,133,63,.35);box-shadow:0 12px 36px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,200,150,.12);background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="%23cd8533" fill-opacity="0.08" d="M0 19h2v1H0zm18 0h2v1h-2zM0 0h1v2H0zm19 0h1v2h-1z"/></svg>') repeat,linear-gradient(180deg,rgba(40,26,20,0.96),rgba(26,19,19,0.95));overflow:hidden}@media (max-width:768px){.dialogue-panel{width:100%;height:100%;border-radius:8px;border-width:1px}}.dialogue-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border-bottom:3px solid rgba(205,133,63,.4);box-shadow:0 4px 12px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,200,150,.1);position:relative}.dialogue-header::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(255,215,0,0.6),transparent)}.dialogue-info{display:flex;align-items:center;gap:8px;flex:1}.dialogue-title{flex:1;margin-left:8px}.dialogue-title h3{color:#ffd7a1;font-size:28px;font-weight:800;margin:0 0 4px 0;text-shadow:0 2px 8px rgba(0,0,0,.6);letter-spacing:.5px}.dialogue-title .dialogue-subtitle{color:rgba(240,230,210,.8);font-size:14px;font-style:italic;opacity:.9;margin:0}.header-buttons{display:flex;gap:8px;align-items:center;justify-content:center}.header-btn{background:linear-gradient(135deg,#8a3c2c,#65261c);border:2px solid rgba(255,120,60,.5);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.3)}.header-btn .btn-icon{color:#ffd7a1;font-size:16px;font-weight:bold}.header-btn:hover{background:linear-gradient(135deg,#9a4c3c,#75362c);transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.4)}.dialogue-shell{flex:1;display:flex;flex-direction:column;margin:8px 12px;min-height:0}.dialogue-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;gap:12px}.nav-btn{background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);color:#ffe9d2;border-radius:6px;padding:6px 10px;cursor:pointer;transition:all .3s ease}.nav-btn:hover:not(:disabled){background:#281a14;border-color:rgba(205,133,63,.6)}.nav-btn:disabled{opacity:.5;cursor:not-allowed}.nav-info{color:#ffd7a1;font-weight:700}.dialogue-viewport{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;border-radius:12px;border:2px solid rgba(205,133,63,.3);background:#1b120f;box-shadow:0 8px 24px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,200,150,.1)}.page{height:auto;overflow:visible;padding:24px;background:radial-gradient(ellipse at top,rgba(255,255,255,0.03),transparent 60%),linear-gradient(90deg,rgba(0,0,0,0.15) 0 1px,transparent 1px) repeat-x;background-size:100% 100%,24px 100%}@media (max-width:768px){.page{padding:12px}}.page-inner{max-width:820px;margin:0 auto;background:hsla(0,0%,100%,.02);border-radius:8px;padding:16px 20px}@media (max-width:768px){.page-inner{padding:12px;max-width:100%}}.page-content.typo-book{color:#f7efd9;font-family:"Georgia","Times New Roman",serif;font-size:18px;line-height:1.85;letter-spacing:.3px;text-rendering:optimizeLegibility}@media (max-width:768px){.page-content.typo-book{font-size:16px;line-height:1.75;letter-spacing:.2px}}.page-content.typo-book p{text-indent:2em;margin:0 0 12px 0;position:relative;padding-bottom:8px;border-bottom:1px dashed rgba(205,133,63,.15)}.page-content.typo-book em,.page-content.typo-book .italic-text{-webkit-text-decoration:underline dotted rgba(255,215,161,.5);text-decoration:underline dotted rgba(255,215,161,.5);text-underline-offset:2px}.page-content.typo-book .strong-text{-webkit-text-decoration:underline solid rgba(255,215,161,.35);text-decoration:underline solid rgba(255,215,161,.35);text-underline-offset:3px}.page-content.typo-book .quote{border-left-color:rgba(255,215,161,.45);background:rgba(255,215,161,.08)}.choice-line{margin-top:8px;color:#ffd7a1;font-weight:600}.choice-prefix{color:#ffbd7a;margin-right:6px}.initial-state{margin-top:40px;text-align:center;font-family:"Georgia","Times New Roman",serif}.initial-welcome{margin-bottom:30px;padding:24px;background:radial-gradient(ellipse at center,rgba(205,133,63,0.08),transparent 70%);border-radius:12px}.welcome-text{color:#ffd7a1;font-size:22px;font-weight:600;margin:0 0 12px 0;letter-spacing:1px}.welcome-hint{color:rgba(247,239,217,.7);font-size:16px;font-style:italic;margin:0;line-height:1.6}.initial-options{max-width:800px;margin:0 auto;padding:20px;background:rgba(40,26,20,.3);border:1px solid rgba(205,133,63,.25);border-radius:12px}.option-choices{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;align-items:center;line-height:2;margin-bottom:16px}.inline-option{display:inline-block;margin:0 6px 8px 0;padding:2px 0;color:#ffd7a1;font-size:17px;cursor:pointer;transition:all .3s ease;position:relative}.inline-option:hover:not(.disabled){color:#ffedcc;transform:translateY(-1px)}.inline-option.disabled{opacity:.5;cursor:not-allowed}.option-bracket{color:rgba(205,133,63,.6);font-weight:600}.option-content{padding:0 4px;text-decoration:underline;text-decoration-style:dotted;text-decoration-color:rgba(205,133,63,.4);text-underline-offset:3px}.inline-option:hover:not(.disabled) .option-content{text-decoration-color:rgba(205,133,63,.8)}.inline-option.custom-option{color:#b8d7ff}.inline-option.custom-option .option-bracket{color:rgba(184,215,255,.6)}.inline-option.custom-option .option-content{text-decoration-color:rgba(184,215,255,.4)}.inline-option.custom-option:hover:not(.disabled){color:#d4e8ff}.inline-option.custom-option:hover:not(.disabled) .option-content{text-decoration-color:rgba(184,215,255,.8)}.inline-options{margin-top:24px;padding-top:20px;border-top:1px dashed rgba(205,133,63,.25);font-family:"Georgia","Times New Roman",serif}.custom-input-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000;animation:fadeIn .2s ease;overflow:hidden}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.custom-input-panel{background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border:2px solid rgba(205,133,63,.6);border-radius:12px;width:min(500px,90vw);max-height:480px !important;display:flex;flex-direction:column;box-shadow:0 12px 36px rgba(0,0,0,.5);animation:slideIn .3s ease;overflow:hidden;position:relative;top:-8vh}@keyframes slideIn{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.custom-input-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(205,133,63,.3)}.custom-input-header h3{color:#ffd7a1;font-size:18px;font-weight:700;margin:0}.close-panel-btn{background:rgba(200,60,60,.8);border:1px solid #c83c3c;border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;font-size:14px;transition:all .3s ease}.close-panel-btn:hover{background:#c83c3c}.custom-input-body{padding:20px 20px 0 20px;overflow-y:auto;display:flex;flex-direction:column;flex:1}.custom-input-textarea{width:100%;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:12px;color:#f7efd9;resize:none;font-family:"Georgia","Times New Roman",serif;font-size:16px;line-height:1.5;height:200px;outline:none;transition:all .3s ease}.custom-input-textarea::placeholder{color:rgba(247,239,217,.35);font-style:italic}.custom-input-textarea:focus{border-color:rgba(205,133,63,.8);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.custom-input-textarea:disabled{opacity:.5;cursor:not-allowed}.custom-input-textarea::-webkit-scrollbar{width:8px}.custom-input-textarea::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:4px}.custom-input-textarea::-webkit-scrollbar-thumb{background:rgba(205,133,63,.4);border-radius:4px}.custom-input-textarea::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.6)}.custom-input-footer{display:flex;justify-content:center;padding:10px 20px 20px 20px;width:100%;flex-shrink:0}.submit-btn{width:100%;padding:12px 20px;border-radius:6px;border:none;cursor:pointer;font-size:14px;font-weight:600;transition:all .3s ease;background:linear-gradient(135deg,#cd853f,#b8860b);color:#f7efd9;box-shadow:0 2px 8px rgba(205,133,63,.3)}.submit-btn:hover:not(:disabled){background:linear-gradient(135deg,#daa520,#cd853f);box-shadow:0 4px 12px rgba(205,133,63,.4);transform:translateY(-1px)}.submit-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}.edit-dialog-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:2000}.edit-dialog{background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border:2px solid rgba(205,133,63,.6);border-radius:12px;width:min(600px,90vw);max-height:80vh;display:flex;flex-direction:column;box-shadow:0 12px 36px rgba(0,0,0,.5)}.edit-dialog-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(205,133,63,.3)}.edit-dialog-header h3{color:#ffd7a1;font-size:18px;font-weight:700;margin:0}.close-dialog-btn{background:rgba(200,60,60,.8);border:1px solid #c83c3c;border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;font-size:14px}.close-dialog-btn:hover{background:#c83c3c}.edit-dialog-body{padding:20px;flex:1;overflow-y:auto}.edit-dialog-body .edit-textarea{width:100%;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:12px;color:#f7efd9;resize:vertical;font-family:inherit;font-size:14px;line-height:1.5;min-height:200px}.edit-dialog-body .edit-textarea:focus{outline:none;border-color:rgba(205,133,63,.8);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.edit-dialog-footer{display:flex;gap:12px;justify-content:flex-end;padding:16px 20px;border-top:1px solid rgba(205,133,63,.3)}.edit-dialog-footer .save-btn,.edit-dialog-footer .cancel-btn{padding:8px 16px;border-radius:6px;border:1px solid;cursor:pointer;font-size:14px;font-weight:600;transition:all .3s ease}.edit-dialog-footer .save-btn{background:rgba(60,100,200,.8);border-color:#3c64c8;color:#fff}.edit-dialog-footer .save-btn:hover{background:#3c64c8}.edit-dialog-footer .cancel-btn{background:rgba(200,60,60,.8);border-color:#c83c3c;color:#fff}.edit-dialog-footer .cancel-btn:hover{background:#c83c3c}@media (max-width:768px){.dialogue-header{padding:8px 10px}.dialogue-title h3{font-size:20px}.dialogue-title .dialogue-subtitle{font-size:12px}.header-btn{width:32px;height:32px}.header-btn .btn-icon{font-size:14px}.dialogue-shell{margin:4px 8px}.dialogue-nav{margin-bottom:4px}.nav-btn{padding:4px 8px;font-size:12px}.nav-info{font-size:13px}.inline-option{font-size:15px;margin:0 4px 6px 0}.initial-state{margin-top:20px}.initial-welcome{padding:16px;margin-bottom:20px}.welcome-text{font-size:18px}.welcome-hint{font-size:14px}.initial-options{padding:16px}.initial-options .option-choices{flex-direction:column;align-items:stretch;gap:8px}.initial-options .inline-option{font-size:16px;padding:12px 16px;text-align:center}.custom-input-overlay{background:rgba(0,0,0,.9);align-items:flex-start;padding-top:3vh}.custom-input-panel{width:95vw;height:70vh;max-height:70vh;top:-2vh;position:relative}.custom-input-textarea{font-size:16px;height:300px;resize:none}.custom-input-textarea::-webkit-scrollbar{display:none}.custom-input-textarea{-ms-overflow-style:none;scrollbar-width:none}}
.event-dialog-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:3000;animation:fadeIn .3s ease}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.event-dialog{width:100%;height:100%;max-width:1200px;max-height:90vh;display:flex;align-items:center;justify-content:center;animation:slideIn .3s ease}@keyframes slideIn{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}@media (max-width:768px){.event-dialog{max-width:100vw;max-height:100vh;padding:8px}}

.history-modal[data-v-30acccdb]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:flex;align-items:center;justify-content:center}.history-modal .modal-overlay[data-v-30acccdb]{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)}.history-modal .modal-content[data-v-30acccdb]{position:relative;background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.5);border-radius:16px;padding:24px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,.6)}@media (max-width:768px){.history-modal .modal-content[data-v-30acccdb]{width:95%;padding:16px;max-height:90vh;border-radius:12px}}.history-modal .modal-content .modal-header[data-v-30acccdb]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.3)}.history-modal .modal-content .modal-header .modal-title[data-v-30acccdb]{color:#ffd7a1;margin:0;font-size:20px;font-weight:700}.history-modal .modal-content .modal-header .close-btn[data-v-30acccdb]{background:none;border:none;color:#f0e6d2;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s ease}.history-modal .modal-content .modal-header .close-btn[data-v-30acccdb]:hover{background:hsla(0,0%,100%,.1);transform:scale(1.1)}.history-modal .modal-content .history-content .no-history[data-v-30acccdb]{text-align:center;padding:40px 20px;color:#9ca3af}.history-modal .modal-content .history-content .no-history .no-history-icon[data-v-30acccdb]{font-size:48px;margin-bottom:16px;opacity:.6}.history-modal .modal-content .history-content .no-history .no-history-text[data-v-30acccdb]{font-size:18px;font-weight:600;margin-bottom:8px;color:#f0e6d2}.history-modal .modal-content .history-content .no-history .no-history-hint[data-v-30acccdb]{font-size:14px;opacity:.8}.history-modal .modal-content .history-content .history-list .history-item[data-v-30acccdb]{background:linear-gradient(180deg,rgba(44,30,24,0.8),rgba(28,20,17,0.9));border:1px solid rgba(205,133,63,.2);border-radius:12px;padding:16px;margin-bottom:12px;transition:all .3s ease}.history-modal .modal-content .history-content .history-list .history-item[data-v-30acccdb]:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.3);border-color:rgba(205,133,63,.4)}.history-modal .modal-content .history-content .history-list .history-item[data-v-30acccdb]:last-child{margin-bottom:0}.history-modal .modal-content .history-content .history-list .history-item .history-header[data-v-30acccdb]{margin-bottom:12px}.history-modal .modal-content .history-content .history-list .history-item .history-header .history-time[data-v-30acccdb]{color:#9ca3af;font-size:12px;margin-bottom:4px}.history-modal .modal-content .history-content .history-list .history-item .history-header .history-title[data-v-30acccdb]{color:#ffd7a1;font-size:16px;font-weight:700}.history-modal .modal-content .history-content .history-list .history-item .history-changes[data-v-30acccdb]{display:flex;flex-wrap:wrap;gap:8px}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change[data-v-30acccdb]{display:flex;align-items:center;gap:4px;padding:6px 10px;background:rgba(0,0,0,.3);border-radius:6px;font-size:12px;transition:all .2s ease}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change[data-v-30acccdb]:hover{background:rgba(0,0,0,.4);transform:scale(1.05)}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change.positive[data-v-30acccdb]{border-left:3px solid #22c55e;background:rgba(34,197,94,.1)}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change.negative[data-v-30acccdb]{border-left:3px solid #dc2626;background:rgba(220,38,38,.1)}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change .resource-icon[data-v-30acccdb]{font-size:12px}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change .resource-name[data-v-30acccdb]{color:#f0e6d2;font-weight:500}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change .change-amount[data-v-30acccdb]{font-weight:700}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change .change-amount.positive[data-v-30acccdb]{color:#22c55e}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change .change-amount.negative[data-v-30acccdb]{color:#dc2626}@media (max-width:768px){.history-modal .modal-content .history-content .history-list .history-item[data-v-30acccdb]{padding:12px}.history-modal .modal-content .history-content .history-list .history-item .history-changes[data-v-30acccdb]{gap:6px}.history-modal .modal-content .history-content .history-list .history-item .history-changes .history-change[data-v-30acccdb]{padding:4px 8px;font-size:11px}}
.save-load-modal[data-v-dee4d05e]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:flex;align-items:center;justify-content:center}.save-load-modal .modal-overlay[data-v-dee4d05e]{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)}.save-load-modal .modal-content[data-v-dee4d05e]{position:relative;background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.5);border-radius:16px;padding:24px;max-width:800px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,.6)}@media (max-width:768px){.save-load-modal .modal-content[data-v-dee4d05e]{width:95%;padding:16px;max-height:90vh;border-radius:12px}}.save-load-modal .modal-content .modal-header[data-v-dee4d05e]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.3)}.save-load-modal .modal-content .modal-header .modal-title[data-v-dee4d05e]{color:#ffd7a1;margin:0;font-size:20px;font-weight:700}.save-load-modal .modal-content .modal-header .close-btn[data-v-dee4d05e]{background:none;border:none;color:#f0e6d2;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s ease}.save-load-modal .modal-content .modal-header .close-btn[data-v-dee4d05e]:hover{background:hsla(0,0%,100%,.1);transform:scale(1.1)}.save-load-modal .modal-content .save-slots[data-v-dee4d05e]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}@media (max-width:768px){.save-load-modal .modal-content .save-slots[data-v-dee4d05e]{grid-template-columns:1fr;gap:12px}}.save-load-modal .modal-content .save-slots .save-slot[data-v-dee4d05e]{background:linear-gradient(180deg,rgba(44,30,24,0.8),rgba(28,20,17,0.9));border:2px solid rgba(205,133,63,.3);border-radius:12px;padding:16px;transition:all .3s ease}.save-load-modal .modal-content .save-slots .save-slot.has-save[data-v-dee4d05e]{border-color:rgba(34,197,94,.5);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(28,20,17,0.9))}.save-load-modal .modal-content .save-slots .save-slot.auto-save[data-v-dee4d05e]{border-color:rgba(168,85,247,.5);background:linear-gradient(180deg,rgba(168,85,247,0.1),rgba(28,20,17,0.9))}.save-load-modal .modal-content .save-slots .save-slot.empty[data-v-dee4d05e]{border-color:rgba(107,114,128,.3);background:linear-gradient(180deg,rgba(107,114,128,0.05),rgba(28,20,17,0.9))}.save-load-modal .modal-content .save-slots .save-slot[data-v-dee4d05e]:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.3)}.save-load-modal .modal-content .save-slots .save-slot .slot-header[data-v-dee4d05e]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.save-load-modal .modal-content .save-slots .save-slot .slot-header .slot-number[data-v-dee4d05e]{color:#ffd7a1;font-weight:700;font-size:16px}.save-load-modal .modal-content .save-slots .save-slot .slot-header .slot-time[data-v-dee4d05e]{color:#9ca3af;font-size:12px}.save-load-modal .modal-content .save-slots .save-slot .slot-info .resource-info[data-v-dee4d05e]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:16px}.save-load-modal .modal-content .save-slots .save-slot .slot-info .resource-info .resource-item[data-v-dee4d05e]{display:flex;align-items:center;gap:6px;padding:6px 8px;background:rgba(0,0,0,.2);border-radius:6px}.save-load-modal .modal-content .save-slots .save-slot .slot-info .resource-info .resource-item .resource-icon[data-v-dee4d05e]{font-size:14px}.save-load-modal .modal-content .save-slots .save-slot .slot-info .resource-info .resource-item .resource-value[data-v-dee4d05e]{color:#f0e6d2;font-size:12px;font-weight:600}.save-load-modal .modal-content .save-slots .save-slot .slot-info .slot-actions[data-v-dee4d05e]{display:flex;gap:8px;flex-wrap:wrap}@media (max-width:768px){.save-load-modal .modal-content .save-slots .save-slot .slot-info .slot-actions[data-v-dee4d05e]{gap:6px}}.save-load-modal .modal-content .save-slots .save-slot .empty-slot[data-v-dee4d05e]{text-align:center;padding:20px 0}.save-load-modal .modal-content .save-slots .save-slot .empty-slot .empty-icon[data-v-dee4d05e]{font-size:32px;margin-bottom:8px;opacity:.6}.save-load-modal .modal-content .save-slots .save-slot .empty-slot .empty-text[data-v-dee4d05e]{color:#9ca3af;font-size:14px;margin-bottom:16px}.action-btn[data-v-dee4d05e]{background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:6px 10px;color:#ffd7a1;cursor:pointer;font-size:11px;font-weight:600;transition:all .3s ease;display:flex;align-items:center;gap:4px;min-width:60px;justify-content:center}@media (max-width:768px){.action-btn[data-v-dee4d05e]{padding:8px 12px;font-size:12px;min-width:70px;gap:6px}}.action-btn[data-v-dee4d05e]:hover{background:linear-gradient(180deg,rgba(50,36,30,0.9),rgba(35,27,24,0.95));border-color:rgba(205,133,63,.6);transform:translateY(-1px)}.action-btn .icon[data-v-dee4d05e]{font-size:12px}.action-btn .text[data-v-dee4d05e]{font-size:10px;font-weight:700}.action-btn.load-action[data-v-dee4d05e]{border-color:rgba(59,130,246,.4);background:linear-gradient(180deg,rgba(59,130,246,0.1),rgba(25,17,14,0.9));color:#60a5fa}.action-btn.load-action[data-v-dee4d05e]:hover{border-color:rgba(59,130,246,.6);background:linear-gradient(180deg,rgba(59,130,246,0.2),rgba(35,27,24,0.95))}.action-btn.save-action[data-v-dee4d05e]{border-color:rgba(34,197,94,.4);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(25,17,14,0.9));color:#4ade80}.action-btn.save-action[data-v-dee4d05e]:hover{border-color:rgba(34,197,94,.6);background:linear-gradient(180deg,rgba(34,197,94,0.2),rgba(35,27,24,0.95))}
.mini-goblin[data-v-6af1078e]{box-sizing:border-box;width:100%;height:800px;padding:10px;background:#1a1313;color:#f0e6d2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";position:relative;isolation:isolate;max-width:1400px;margin:0 auto}.decorative-border[data-v-6af1078e]{max-width:1400px;margin:0 auto;position:relative;padding:20px;background-image:repeating-linear-gradient(0deg,transparent,transparent 19px,rgba(205,133,63,0.1) 20px),repeating-linear-gradient(90deg,transparent,transparent 19px,rgba(205,133,63,0.1) 20px);border:2px solid rgba(205,133,63,.3);border-radius:16px;box-shadow:0 0 30px rgba(205,133,63,.2),inset 0 0 30px rgba(0,0,0,.5);height:calc(100% - 70px);margin-bottom:70px}.content-wrapper[data-v-6af1078e]{background:rgba(26,19,19,.8);border-radius:12px;padding:20px;box-shadow:inset 0 0 20px rgba(0,0,0,.5),0 0 20px rgba(205,133,63,.1);height:calc(100% - 1px);overflow-y:auto}.header[data-v-6af1078e]{position:relative;text-align:center;margin-bottom:24px;display:flex;justify-content:center;align-items:center}.header .main-title[data-v-6af1078e]{margin:0;font-size:28px;letter-spacing:2px;color:#ffd7a1;text-shadow:0 2px 6px rgba(0,0,0,.6),0 0 12px rgba(255,120,40,.3);position:relative;display:inline-block}.header .main-title[data-v-6af1078e]::after{content:"";position:absolute;left:50%;bottom:-8px;transform:translateX(-50%);width:80%;height:2px;background:linear-gradient(90deg,transparent,rgba(255,180,120,0.6),transparent)}.header .fullscreen-btn[data-v-6af1078e]{position:absolute;right:0;background:rgba(205,133,63,.2);border:1px solid rgba(205,133,63,.3);border-radius:6px;padding:4px 8px;cursor:pointer;transition:all .2s ease}.header .fullscreen-btn[data-v-6af1078e]:hover{background:rgba(205,133,63,.3);transform:scale(1.1)}.header .fullscreen-btn .icon[data-v-6af1078e]{font-size:16px;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3))}.bottom-nav[data-v-6af1078e]{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border-top:1px solid rgba(205,133,63,.3);display:flex;justify-content:space-around;padding:6px 0;z-index:100;backdrop-filter:blur(10px)}.bottom-nav .nav-item[data-v-6af1078e]{display:flex;flex-direction:column;align-items:center;gap:2px;color:#f0e6d2;text-decoration:none;padding:2px 8px;border-radius:6px;transition:all .2s ease;min-width:50px}.bottom-nav .nav-item .icon[data-v-6af1078e]{font-size:18px;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3))}.bottom-nav .nav-item .label[data-v-6af1078e]{font-size:10px;opacity:.7}.bottom-nav .nav-item.active[data-v-6af1078e]{background:rgba(205,133,63,.2);color:#ffd7a1}.bottom-nav .nav-item.active .icon[data-v-6af1078e]{filter:drop-shadow(0 2px 4px rgba(205,133,63,0.4))}.bottom-nav .nav-item.active .label[data-v-6af1078e]{opacity:1;font-weight:700}.bottom-nav .nav-item[data-v-6af1078e]:hover:not(.active){background:rgba(205,133,63,.1);transform:translateY(-1px)}.bottom-nav .nav-item.center-nav[data-v-6af1078e]{background:linear-gradient(180deg,rgba(255,120,60,0.2),rgba(205,133,63,0.1));border:1px solid rgba(255,120,60,.4);transform:scale(1.1);z-index:10;position:relative;padding:4px 12px}.bottom-nav .nav-item.center-nav[data-v-6af1078e]:hover{background:linear-gradient(180deg,rgba(255,120,60,0.3),rgba(205,133,63,0.2));border-color:rgba(255,120,60,.6);transform:scale(1.15) translateY(-1px)}.bottom-nav .nav-item.center-nav.active[data-v-6af1078e]{background:linear-gradient(180deg,rgba(255,120,60,0.4),rgba(205,133,63,0.3));border-color:rgba(255,120,60,.7);color:#ffd7a1;box-shadow:0 0 20px rgba(255,120,60,.3)}.bottom-nav .nav-item.center-nav .icon[data-v-6af1078e]{font-size:20px;filter:drop-shadow(0 2px 4px rgba(255,120,60,0.4))}.bottom-nav .nav-item.center-nav .label[data-v-6af1078e]{font-weight:700;opacity:1}.stats-container[data-v-6af1078e]{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}.stats-container .stats-row[data-v-6af1078e]{display:flex;gap:12px;justify-content:space-between}.stats-container .stats-row .stats-card[data-v-6af1078e]{background:linear-gradient(180deg,rgba(40,26,20,0.7),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.25);border-radius:12px;padding:12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.3);flex:1}.stats-container .stats-row .stats-card.time-info .time-content[data-v-6af1078e]{display:flex;justify-content:center;align-items:center;gap:12px;transition:all .3s ease}.stats-container .stats-row .stats-card.time-info .time-content .date[data-v-6af1078e]{color:#ffe9d2;font-size:16px;font-weight:700;transition:all .3s ease}.stats-container .stats-row .stats-card.time-info .time-content .season[data-v-6af1078e]{color:#ffe9d2;font-size:16px;font-weight:700;opacity:.9;transition:all .3s ease}.stats-container .stats-row .stats-card.time-info .time-content.date-updated .date[data-v-6af1078e]{color:#22c55e}.stats-container .stats-row .stats-card.time-info .time-content.date-updated .season[data-v-6af1078e]{color:#22c55e}.stats-container .stats-row .stats-card .stat-item[data-v-6af1078e]{display:flex;align-items:center;gap:8px}.stats-container .stats-row .stats-card .stat-item .icon[data-v-6af1078e]{font-size:20px;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3))}.stats-container .stats-row .stats-card .stat-item .value[data-v-6af1078e]{color:#ffe9d2;font-size:16px;font-weight:700}.stats-container .resources-grid[data-v-6af1078e]{display:grid;gap:12px;margin-top:6px;grid-template-columns:repeat(4,1fr)}@media (min-width:1024px){.stats-container .resources-grid.eight-columns[data-v-6af1078e]{grid-template-columns:repeat(8,1fr)}}.stats-container .resources-grid .resource-item[data-v-6af1078e]{background:linear-gradient(180deg,rgba(40,26,20,0.7),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.25);border-radius:12px;padding:12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.3);display:flex;flex-direction:column;align-items:center;text-align:center;transition:all .2s ease}.stats-container .resources-grid .resource-item[data-v-6af1078e]:hover{transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 6px 16px rgba(0,0,0,.4);border-color:rgba(205,133,63,.4)}.stats-container .resources-grid .resource-item .resource-icon[data-v-6af1078e]{font-size:28px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));margin-bottom:8px}.stats-container .resources-grid .resource-item .resource-value[data-v-6af1078e]{color:#ffe9d2;font-size:18px;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.5)}.stats-container .action-points-row[data-v-6af1078e]{margin-top:6px}.stats-container .action-points-row .action-points-card[data-v-6af1078e]{background:linear-gradient(180deg,rgba(40,26,20,0.7),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.25);border-radius:8px;padding:6px 12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.3)}.stats-container .action-points-row .action-points-card .action-points-display[data-v-6af1078e]{display:flex;justify-content:center;align-items:center;gap:4px;padding:2px 0}.stats-container .action-points-row .action-points-card .action-points-display .action-point[data-v-6af1078e]{font-size:16px;transition:all .4s ease;cursor:default;position:relative}.stats-container .action-points-row .action-points-card .action-points-display .action-point.filled[data-v-6af1078e]{filter:drop-shadow(0 0 6px rgba(255,100,120,0.8));animation:heartPulse-6af1078e 1.8s ease-in-out infinite}.stats-container .action-points-row .action-points-card .action-points-display .action-point[data-v-6af1078e]:not(.filled){opacity:.3;filter:drop-shadow(0 0 2px rgba(150,150,150,0.2))}.stats-container .action-points-row .action-points-card .action-points-display .action-point[data-v-6af1078e]:hover{transform:scale(1.15)}.action-buttons[data-v-6af1078e]{margin:20px 0;display:flex;justify-content:center;gap:12px;flex-wrap:nowrap}.action-buttons .action-btn[data-v-6af1078e]{background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:12px 20px;cursor:pointer;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.3);transition:all .2s ease;display:flex;align-items:center;gap:8px;flex:1;min-width:0;color:#f0e6d2}.action-buttons .action-btn[data-v-6af1078e]:hover{transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 6px 16px rgba(0,0,0,.4);border-color:rgba(205,133,63,.5)}.action-buttons .action-btn .icon[data-v-6af1078e]{font-size:16px;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3))}.action-buttons .action-btn .text[data-v-6af1078e]{font-weight:600;font-size:14px}.action-buttons .action-btn.save-load-btn[data-v-6af1078e]:hover{background:linear-gradient(180deg,rgba(168,85,247,0.2),rgba(147,51,234,0.3));border-color:rgba(168,85,247,.5);color:#a855f7}.action-buttons .action-btn.round-btn[data-v-6af1078e]:hover{background:linear-gradient(180deg,rgba(220,38,38,0.2),rgba(185,28,28,0.3));border-color:rgba(220,38,38,.5);color:#dc2626}.primary[data-v-6af1078e]{background:linear-gradient(180deg,#8a3c2c,#65261c);border-color:rgba(255,120,60,.5);box-shadow:0 8px 16px rgba(110,30,15,.35),inset 0 1px 0 rgba(255,200,150,.12)}.primary[data-v-6af1078e]:hover{background:linear-gradient(180deg,#9a4532,#6e2a1f)}@media (max-width:768px){.mini-goblin[data-v-6af1078e]{padding:10px}.decorative-border[data-v-6af1078e]{padding:10px}.content-wrapper[data-v-6af1078e]{padding:15px}.main-title[data-v-6af1078e]{font-size:24px}.stats-container .resources-grid[data-v-6af1078e]{grid-template-columns:repeat(4,1fr);gap:8px}.stats-container .resources-grid .resource-item[data-v-6af1078e]{padding:8px}.stats-container .resources-grid .resource-item .resource-icon[data-v-6af1078e]{font-size:24px}.stats-container .resources-grid .resource-item .resource-value[data-v-6af1078e]{font-size:16px}.action-buttons[data-v-6af1078e]{gap:8px;margin:16px 0}.action-buttons .action-btn[data-v-6af1078e]{padding:10px 16px;min-width:0}.action-buttons .action-btn .text[data-v-6af1078e]{font-size:12px}.action-buttons .action-btn .icon[data-v-6af1078e]{font-size:14px}}@media (max-width:480px){.stats-container .resources-grid[data-v-6af1078e]{grid-template-columns:repeat(4,1fr);gap:6px}.stats-container .resources-grid .resource-item[data-v-6af1078e]{padding:6px}.stats-container .resources-grid .resource-item .resource-icon[data-v-6af1078e]{font-size:20px}.stats-container .resources-grid .resource-item .resource-value[data-v-6af1078e]{font-size:14px}.action-buttons[data-v-6af1078e]{gap:6px;margin:12px 0}.action-buttons .action-btn[data-v-6af1078e]{padding:8px 12px}.action-buttons .action-btn .text[data-v-6af1078e]{font-size:11px}.action-buttons .action-btn .icon[data-v-6af1078e]{font-size:12px}}.info-display[data-v-6af1078e]{margin-top:20px;background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:16px;position:relative}.info-display .info-header[data-v-6af1078e]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(205,133,63,.2)}.info-display .info-header .info-title[data-v-6af1078e]{color:#ffd7a1;font-size:16px;font-weight:700}.info-display .info-header .history-btn[data-v-6af1078e]{background:rgba(205,133,63,.2);border:1px solid rgba(205,133,63,.3);border-radius:6px;padding:4px 8px;color:#f0e6d2;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:4px}.info-display .info-header .history-btn[data-v-6af1078e]:hover{background:rgba(205,133,63,.3);transform:scale(1.05)}.info-display .info-header .history-btn .icon[data-v-6af1078e]{font-size:14px}.info-display .info-content .round-summary .round-title[data-v-6af1078e]{color:#ffe9d2;font-size:14px;font-weight:600;margin-bottom:8px}.info-display .info-content .round-summary .resource-changes[data-v-6af1078e]{display:flex;flex-wrap:wrap;gap:8px}.info-display .info-content .round-summary .resource-changes .resource-change[data-v-6af1078e]{display:flex;align-items:center;gap:4px;padding:4px 8px;background:rgba(0,0,0,.2);border-radius:6px;font-size:12px}.info-display .info-content .round-summary .resource-changes .resource-change.positive[data-v-6af1078e]{border-left:3px solid #22c55e;background:rgba(34,197,94,.1)}.info-display .info-content .round-summary .resource-changes .resource-change.negative[data-v-6af1078e]{border-left:3px solid #dc2626;background:rgba(220,38,38,.1)}.info-display .info-content .round-summary .resource-changes .resource-change .resource-icon[data-v-6af1078e]{font-size:12px}.info-display .info-content .round-summary .resource-changes .resource-change .resource-name[data-v-6af1078e]{color:#f0e6d2;font-weight:500}.info-display .info-content .round-summary .resource-changes .resource-change .change-amount[data-v-6af1078e]{font-weight:700}.info-display .info-content .round-summary .resource-changes .resource-change .change-amount.positive[data-v-6af1078e]{color:#22c55e}.info-display .info-content .round-summary .resource-changes .resource-change .change-amount.negative[data-v-6af1078e]{color:#dc2626}.info-display .no-round-info[data-v-6af1078e]{text-align:center;padding:20px;color:#9ca3af}.info-display .no-round-info .no-info-text[data-v-6af1078e]{font-size:16px;font-weight:600;margin-bottom:8px;color:#f0e6d2}.info-display .no-round-info .no-info-hint[data-v-6af1078e]{font-size:14px;opacity:.8}@keyframes shimmer-6af1078e{0%{opacity:0;transform:translate(-20%,-20%) scale(1)}50%{opacity:.3;transform:translate(12%,2%) scale(1.06)}100%{opacity:0;transform:translate(28%,8%) scale(1)}}@keyframes heartPulse-6af1078e{0%{filter:drop-shadow(0 0 6px rgba(255,100,120,0.8));transform:scale(1)}25%{filter:drop-shadow(0 0 10px rgb(255,150,170));transform:scale(1.08)}50%{filter:drop-shadow(0 0 6px rgba(255,100,120,0.8));transform:scale(1)}75%{filter:drop-shadow(0 0 8px rgba(255,120,140,0.9));transform:scale(1.04)}100%{filter:drop-shadow(0 0 6px rgba(255,100,120,0.8));transform:scale(1)}}.mini-goblin[data-v-6af1078e]::before{content:"";position:absolute;inset:0;background:linear-gradient(transparent 23px,rgba(255,180,120,0.08) 24px) 0 0/24px 24px,linear-gradient(90deg,transparent 23px,rgba(255,180,120,0.08) 24px) 0 0/24px 24px,radial-gradient(circle at 25% 25%,rgba(255,255,255,0.025) 0 2px,transparent 3px) 0 0/24px 24px,radial-gradient(circle at 75% 75%,rgba(255,255,255,0.02) 0 2px,transparent 3px) 12px 12px/24px 24px,repeating-linear-gradient(45deg,rgba(255,255,255,0.02) 0 1px,transparent 1px 6px),radial-gradient(80% 60% at 50% 0%,#241515 0%,#120c0c 60%,#0e0b0b 100%);filter:contrast(1.05) saturate(0.9);z-index:-1;animation:shimmer-6af1078e 6s ease-in-out infinite}
.army-formation-container[data-v-2c630af3]{height:710px;width:100%;max-width:100%;padding:16px;background:linear-gradient(180deg,rgba(40,26,20,0.6),rgba(25,17,14,0.85));border:1px solid rgba(205,133,63,.25);border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 8px 18px rgba(0,0,0,.4);display:flex;flex-direction:column;position:relative;box-sizing:border-box;overflow:hidden;color:#f0e6d2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}.formation-content[data-v-2c630af3]{flex:1;display:flex;flex-direction:column;overflow:hidden}.formation-header[data-v-2c630af3]{position:relative;text-align:center;margin-bottom:24px;display:flex;justify-content:center;align-items:center}.formation-header .main-title[data-v-2c630af3]{margin:0;font-size:28px;letter-spacing:2px;color:#ffd7a1;text-shadow:0 2px 6px rgba(0,0,0,.6),0 0 12px rgba(255,120,40,.3);position:relative;display:inline-block}.formation-header .main-title[data-v-2c630af3]::after{content:"";position:absolute;left:50%;bottom:-8px;transform:translateX(-50%);width:80%;height:2px;background:linear-gradient(90deg,transparent,rgba(255,180,120,0.6),transparent)}.formation-header .subtitle[data-v-2c630af3]{margin-top:8px;font-size:16px;color:#9ca3af;opacity:.8}.section-header[data-v-2c630af3]{margin-bottom:16px}.section-header h3[data-v-2c630af3]{margin:0;color:#ffd7a1;font-size:16px;font-weight:700;border-bottom:1px solid rgba(205,133,63,.3);padding-bottom:8px}.captains-section[data-v-2c630af3]{flex:1;margin-bottom:16px;min-height:0;overflow:hidden;display:flex;flex-direction:column;padding-right:8px}.captains-grid[data-v-2c630af3]{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;height:100%;align-content:start;justify-content:center;padding-top:20px}.captain-slot[data-v-2c630af3]{background:rgba(0,0,0,0);border:3px solid rgba(205,133,63,.4);border-radius:12px;padding:0;cursor:pointer;transition:all .2s ease;height:300px;display:flex;flex-direction:column;overflow:hidden}.captain-slot[data-v-2c630af3]:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.4);border-color:rgba(205,133,63,.6)}.captain-slot.selected[data-v-2c630af3]{border-color:rgba(52,152,219,.6);box-shadow:0 0 15px rgba(52,152,219,.3)}.captain-slot.empty[data-v-2c630af3]{display:flex;flex-direction:column;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05)}.captain-slot.empty .empty-icon[data-v-2c630af3]{font-size:24px;color:#9ca3af;margin-bottom:8px}.captain-slot.empty .empty-text[data-v-2c630af3]{color:#9ca3af;font-size:12px}.captain-card[data-v-2c630af3]{height:100%;display:flex;flex-direction:column;position:relative;overflow:hidden}.captain-portrait[data-v-2c630af3]{position:relative;width:100%;height:100%;overflow:hidden;z-index:2;border-radius:9px}.captain-portrait img[data-v-2c630af3]{width:100%;height:100%;object-fit:cover}.captain-portrait .default-portrait[data-v-2c630af3]{width:100%;height:100%;background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(255,120,60,0.2));display:flex;align-items:center;justify-content:center}.captain-portrait .default-portrait .portrait-icon[data-v-2c630af3]{font-size:64px;opacity:.8}.captain-name-vertical-left[data-v-2c630af3]{position:absolute;top:6px;left:6px;z-index:3;color:#ffd7a1;font-size:14px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,.9);background:rgba(0,0,0,.6);padding:8px 4px;border-radius:4px;writing-mode:vertical-rl;text-orientation:mixed;max-height:80%;overflow:hidden;white-space:nowrap}.captain-actions[data-v-2c630af3]{position:absolute;top:6px;right:6px;z-index:4;display:flex;gap:4px}.captain-actions .configure-troops-btn[data-v-2c630af3]{background:rgba(0,0,0,.6);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:10px;line-height:1;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.captain-actions .configure-troops-btn[data-v-2c630af3]:hover{background:rgba(0,0,0,.8);transform:scale(1.1)}.captain-actions .remove-captain-btn[data-v-2c630af3]{background:rgba(220,38,38,.8);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px;line-height:1;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.captain-actions .remove-captain-btn[data-v-2c630af3]:hover{background:#dc2626;transform:scale(1.1)}.captain-level-badge[data-v-2c630af3]{position:absolute;top:40px;right:6px;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;text-align:center;z-index:3;background:rgba(255,215,0,.9);color:#000;display:flex;align-items:center;gap:4px;box-shadow:0 1px 3px rgba(0,0,0,.3)}.captain-level-badge .level-icon[data-v-2c630af3]{font-size:11px}.captain-level-badge .level-value[data-v-2c630af3]{font-size:12px;font-weight:700}.captain-name-vertical[data-v-2c630af3]{position:absolute;right:8px;top:50%;transform:translateY(-50%);z-index:3;color:#ffd7a1;font-size:16px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,.9);writing-mode:vertical-rl;text-orientation:mixed;background:rgba(0,0,0,.6);padding:8px 4px;border-radius:4px;max-height:80%;overflow:hidden;white-space:nowrap;max-width:40px;font-size:clamp(10px,2.5vw,16px)}.captain-info-grid[data-v-2c630af3]{position:absolute;bottom:30px;left:4px;right:4px;z-index:3;display:grid;grid-template-rows:1fr 1fr;gap:2px;height:70px}.captain-stats[data-v-2c630af3]{display:grid;grid-template-columns:repeat(2,1fr);gap:2px}.captain-stats .stat-item[data-v-2c630af3]{display:flex;justify-content:space-between;font-size:10px;color:#f0e6d2;padding:2px 4px;background:rgba(0,0,0,.6);border-radius:4px;text-shadow:0 1px 2px rgba(0,0,0,.8)}.captain-troops[data-v-2c630af3]{display:flex;flex-direction:column;gap:4px}.captain-troops .troop-count[data-v-2c630af3]{font-size:9px;color:#f59e0b;font-weight:600;text-align:center;padding:2px 4px;background:rgba(245,158,11,.2);border-radius:3px;border:1px solid rgba(245,158,11,.3);text-shadow:0 1px 2px rgba(0,0,0,.8);width:100%}.captain-troops .health-count[data-v-2c630af3]{font-size:9px;color:#dc2626;font-weight:600;text-align:center;padding:2px 4px;background:rgba(220,38,38,.2);border-radius:3px;border:1px solid rgba(220,38,38,.3);text-shadow:0 1px 2px rgba(0,0,0,.8);width:100%}.inline-troops-config[data-v-2c630af3]{margin-top:12px;padding:8px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid rgba(205,133,63,.2)}.inline-troops-config .troops-limit[data-v-2c630af3]{color:#f59e0b;font-weight:600;font-size:11px;margin-bottom:8px;text-align:center}.inline-troops-config .troops-grid-inline[data-v-2c630af3]{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-bottom:8px}.inline-troops-config .troop-type-inline[data-v-2c630af3]{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;background:hsla(0,0%,100%,.05);border-radius:4px;font-size:10px}.inline-troops-config .troop-type-inline label[data-v-2c630af3]{color:#f0e6d2;font-weight:600}.inline-troops-config .troop-controls-inline[data-v-2c630af3]{display:flex;align-items:center;gap:4px}.inline-troops-config .troop-controls-inline button[data-v-2c630af3]{background:#3b82f6;color:#fff;border:none;border-radius:3px;width:18px;height:18px;cursor:pointer;font-size:10px;font-weight:600;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.inline-troops-config .troop-controls-inline button[data-v-2c630af3]:hover:not(:disabled){background:#2563eb;transform:scale(1.1)}.inline-troops-config .troop-controls-inline button[data-v-2c630af3]:disabled{background:#6b7280;cursor:not-allowed;transform:none}.inline-troops-config .troop-controls-inline .troop-count[data-v-2c630af3]{min-width:16px;text-align:center;color:#f0e6d2;font-weight:600;font-size:10px}.inline-troops-config .troops-summary-inline[data-v-2c630af3]{display:flex;justify-content:space-between;font-size:10px;color:#9ca3af}.inline-troops-config .troops-summary-inline span.warning[data-v-2c630af3]{color:#dc2626}.troops-configuration[data-v-2c630af3]{margin-bottom:24px;background:linear-gradient(180deg,rgba(40,26,20,0.7),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.25);border-radius:12px;padding:16px}.troops-info[data-v-2c630af3]{margin-bottom:16px}.troops-info .troops-limit[data-v-2c630af3]{color:#f59e0b;font-weight:600;font-size:14px}.troops-info .troops-limit .limit-note[data-v-2c630af3]{color:#9ca3af;font-size:12px;font-weight:400}.troops-grid[data-v-2c630af3]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}.troop-type[data-v-2c630af3]{display:flex;align-items:center;justify-content:space-between;padding:8px;background:hsla(0,0%,100%,.05);border-radius:8px}.troop-type label[data-v-2c630af3]{color:#f0e6d2;font-weight:600;font-size:12px}.troop-controls[data-v-2c630af3]{display:flex;align-items:center;gap:8px}.troop-controls button[data-v-2c630af3]{background:#3b82f6;color:#fff;border:none;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:14px;font-weight:600;display:flex;align-items:center;justify-content:center}.troop-controls button[data-v-2c630af3]:disabled{background:#6b7280;cursor:not-allowed}.troop-controls .troop-count[data-v-2c630af3]{min-width:24px;text-align:center;color:#f0e6d2;font-weight:600;font-size:12px}.troops-summary[data-v-2c630af3]{display:flex;gap:16px;padding:12px;background:hsla(0,0%,100%,.05);border-radius:8px}.troops-summary .summary-item[data-v-2c630af3]{display:flex;flex-direction:column;gap:4px}.troops-summary .summary-item span[data-v-2c630af3]:first-child{color:#9ca3af;font-size:12px}.troops-summary .summary-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600;font-size:14px}.troops-summary .summary-item span:last-child.warning[data-v-2c630af3]{color:#dc2626}.army-preview[data-v-2c630af3]{margin-bottom:24px;background:linear-gradient(180deg,rgba(40,26,20,0.7),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.25);border-radius:12px;padding:16px}.preview-stats[data-v-2c630af3]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}.preview-stats .stat-item[data-v-2c630af3]{display:flex;justify-content:space-between;padding:8px;background:hsla(0,0%,100%,.05);border-radius:6px;font-size:12px}.preview-stats .stat-item span[data-v-2c630af3]:first-child{color:#9ca3af}.preview-stats .stat-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600}.preview-troops h4[data-v-2c630af3]{margin:0 0 8px 0;color:#ffd7a1;font-size:14px;font-weight:600}.troop-composition[data-v-2c630af3]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}.composition-item[data-v-2c630af3]{display:flex;justify-content:space-between;padding:6px;background:hsla(0,0%,100%,.05);border-radius:4px;font-size:11px}.composition-item span[data-v-2c630af3]:first-child{color:#9ca3af}.composition-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600}.formation-actions[data-v-2c630af3]{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-top:auto;padding-top:16px;flex-shrink:0}.action-btn[data-v-2c630af3]{background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:16px 24px;cursor:pointer;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.3);transition:all .2s ease;display:flex;flex-direction:column;align-items:center;gap:8px;color:#f0e6d2;font-size:14px;font-weight:600;min-width:120px}.action-btn[data-v-2c630af3]:hover:not(:disabled){transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 6px 16px rgba(0,0,0,.4);border-color:rgba(205,133,63,.5)}.action-btn[data-v-2c630af3]:disabled{opacity:.6;cursor:not-allowed}.action-btn .text[data-v-2c630af3]{font-weight:700;font-size:16px}.action-btn.config-btn[data-v-2c630af3]:hover:not(:disabled){background:linear-gradient(180deg,rgba(168,85,247,0.2),rgba(147,51,234,0.3));border-color:rgba(168,85,247,.5);color:#a855f7}.action-btn.reset-btn[data-v-2c630af3]:hover:not(:disabled){background:linear-gradient(180deg,rgba(59,130,246,0.2),rgba(37,99,235,0.3));border-color:rgba(59,130,246,.5);color:#3b82f6}.captain-selection-modal[data-v-2c630af3],.troop-config-modal[data-v-2c630af3]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[data-v-2c630af3]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.3);border-radius:16px;max-width:600px;width:100%;max-height:80vh;overflow:hidden;box-shadow:0 0 30px rgba(205,133,63,.2),inset 0 0 30px rgba(0,0,0,.5)}.modal-header[data-v-2c630af3]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(205,133,63,.3)}.modal-header h3[data-v-2c630af3]{margin:0;color:#ffd7a1;font-size:18px;font-weight:700}.modal-header .modal-actions[data-v-2c630af3]{display:flex;gap:8px}.modal-header .confirm-btn[data-v-2c630af3]{background:rgba(16,185,129,.2);border:1px solid rgba(16,185,129,.3);border-radius:6px;padding:4px 8px;color:#f0e6d2;cursor:pointer;font-size:16px;line-height:1;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.modal-header .confirm-btn[data-v-2c630af3]:hover{background:rgba(16,185,129,.3)}.modal-header .close-btn[data-v-2c630af3]{background:rgba(220,38,38,.2);border:1px solid rgba(220,38,38,.3);border-radius:6px;padding:4px 8px;color:#f0e6d2;cursor:pointer;font-size:16px;line-height:1;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.modal-header .close-btn[data-v-2c630af3]:hover{background:rgba(220,38,38,.3)}.captain-list[data-v-2c630af3]{max-height:60vh;overflow-y:auto;padding:16px}.captain-option[data-v-2c630af3]{display:flex;align-items:center;padding:12px;background:hsla(0,0%,100%,.05);border-radius:8px;cursor:pointer;transition:all .2s ease;position:relative;margin-bottom:8px}.captain-option[data-v-2c630af3]:hover:not(.disabled){background:hsla(0,0%,100%,.1);transform:translateX(4px)}.captain-option.disabled[data-v-2c630af3]{opacity:.5;cursor:not-allowed}.captain-option .captain-avatar[data-v-2c630af3]{font-size:24px;margin-right:12px;width:48px;height:48px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(255,120,60,0.2))}.captain-option .captain-avatar img[data-v-2c630af3]{width:100%;height:100%;object-fit:cover}.captain-option .captain-avatar span[data-v-2c630af3]{font-size:24px}.captain-option .captain-details[data-v-2c630af3]{flex:1}.captain-option .captain-details h4[data-v-2c630af3]{margin:0 0 4px 0;color:#f0e6d2;font-size:14px;font-weight:600}.captain-option .captain-details p[data-v-2c630af3]{margin:0 0 8px 0;color:#9ca3af;font-size:12px}.captain-option .captain-details .captain-attributes[data-v-2c630af3]{display:flex;gap:12px;margin-bottom:4px}.captain-option .captain-details .captain-attributes .attr-item[data-v-2c630af3]{display:flex;gap:4px;font-size:11px;color:#9ca3af}.captain-option .captain-details .captain-attributes .attr-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600}.captain-option .captain-details .captain-level[data-v-2c630af3]{color:#3b82f6;font-size:11px;font-weight:600}.captain-option .used-badge[data-v-2c630af3]{position:absolute;top:8px;right:8px;background:#dc2626;color:#fff;padding:2px 6px;border-radius:8px;font-size:10px;font-weight:600}@media (min-width:1200px){.captain-slot[data-v-2c630af3]{height:500px}}@media (max-width:1200px){.captains-grid[data-v-2c630af3]{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr)}}@media (max-width:768px){.army-formation-container[data-v-2c630af3]{padding:12px}.captains-grid[data-v-2c630af3]{grid-template-columns:repeat(3,1fr);gap:8px;flex:1;min-height:0}.captain-slot[data-v-2c630af3]{height:270px;padding:0}.captain-header[data-v-2c630af3]{margin-bottom:12px}.captain-header .captain-avatar[data-v-2c630af3]{font-size:24px}.captain-header .captain-info h4[data-v-2c630af3]{font-size:16px}.captain-header .captain-level[data-v-2c630af3]{font-size:12px}.captain-header .captain-actions[data-v-2c630af3]{gap:2px}.captain-header .configure-troops-btn[data-v-2c630af3],.captain-header .remove-captain-btn[data-v-2c630af3]{width:16px;height:16px;font-size:8px}.captain-stats[data-v-2c630af3]{gap:8px;margin-bottom:12px}.captain-stats .stat-item[data-v-2c630af3]{font-size:12px;padding:4px 6px}.captain-troops .troop-count[data-v-2c630af3]{font-size:12px}.captain-name-vertical-left[data-v-2c630af3]{font-size:12px}.preview-stats[data-v-2c630af3]{grid-template-columns:1fr}.troop-composition[data-v-2c630af3]{grid-template-columns:1fr}.formation-actions[data-v-2c630af3]{flex-direction:row;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:auto;padding-top:16px}.action-btn[data-v-2c630af3]{padding:8px 12px;font-size:12px;min-width:80px;flex:1;max-width:120px}}@media (max-width:480px){.formation-header[data-v-2c630af3]{margin-bottom:16px}.formation-header .main-title[data-v-2c630af3]{font-size:20px}.formation-header .subtitle[data-v-2c630af3]{font-size:12px}.captains-grid[data-v-2c630af3]{grid-template-columns:repeat(3,1fr);gap:4px;flex:1;min-height:0}.captain-slot[data-v-2c630af3]{height:270px;padding:0}.captain-header[data-v-2c630af3]{margin-bottom:8px}.captain-header .captain-avatar[data-v-2c630af3]{font-size:20px}.captain-header .captain-info h4[data-v-2c630af3]{font-size:14px}.captain-header .captain-level[data-v-2c630af3]{font-size:10px}.captain-header .captain-actions[data-v-2c630af3]{gap:1px}.captain-header .configure-troops-btn[data-v-2c630af3],.captain-header .remove-captain-btn[data-v-2c630af3]{width:14px;height:14px;font-size:7px}.captain-stats[data-v-2c630af3]{grid-template-columns:repeat(2,1fr);gap:6px;margin-bottom:8px}.captain-stats .stat-item[data-v-2c630af3]{font-size:10px;padding:3px 4px}.captain-troops .troop-count[data-v-2c630af3]{font-size:10px}.captain-name-vertical-left[data-v-2c630af3]{font-size:10px}.section-header h3[data-v-2c630af3]{font-size:14px}.preview-stats[data-v-2c630af3]{gap:8px}.preview-stats .stat-item[data-v-2c630af3]{padding:6px;font-size:11px}.troop-composition[data-v-2c630af3]{gap:4px}.troop-composition .composition-item[data-v-2c630af3]{padding:4px;font-size:10px}.formation-actions[data-v-2c630af3]{flex-direction:row;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:auto;padding-top:12px}.action-btn[data-v-2c630af3]{padding:6px 8px;font-size:10px;min-width:70px;flex:1;max-width:100px}.action-btn .text[data-v-2c630af3]{font-size:10px}.modal-content[data-v-2c630af3]{margin:10px;max-height:90vh}.captain-option[data-v-2c630af3]{padding:8px}.captain-option .captain-avatar[data-v-2c630af3]{font-size:20px;margin-right:8px}.captain-option .captain-details h4[data-v-2c630af3]{font-size:12px}.captain-option .captain-details p[data-v-2c630af3]{font-size:10px}.captain-option .captain-details .captain-attributes[data-v-2c630af3]{gap:8px}.captain-option .captain-details .captain-attributes .attr-item[data-v-2c630af3]{font-size:9px}.captain-option .captain-details .captain-level[data-v-2c630af3]{font-size:10px}}.troop-config-modal .modal-content[data-v-2c630af3]{max-width:500px;max-height:85vh}.config-manager-modal[data-v-2c630af3]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.config-manager-modal .modal-content[data-v-2c630af3]{max-width:800px;max-height:90vh;width:100%}.config-manager-content[data-v-2c630af3]{padding:20px;max-height:80vh;overflow-y:auto}.save-config-section[data-v-2c630af3]{margin-bottom:30px;padding:20px;background:hsla(0,0%,100%,.05);border-radius:12px;border:1px solid rgba(205,133,63,.2)}.save-config-section h4[data-v-2c630af3]{margin:0 0 16px 0;color:#ffd7a1;font-size:16px;font-weight:600}.save-config-section .save-form[data-v-2c630af3]{display:flex;flex-direction:column;gap:12px}.save-config-section .save-form .config-name-input[data-v-2c630af3],.save-config-section .save-form .config-desc-input[data-v-2c630af3]{padding:10px 12px;background:hsla(0,0%,100%,.1);border:1px solid rgba(205,133,63,.3);border-radius:6px;color:#f0e6d2;font-size:14px}.save-config-section .save-form .config-name-input[data-v-2c630af3]::placeholder,.save-config-section .save-form .config-desc-input[data-v-2c630af3]::placeholder{color:#9ca3af}.save-config-section .save-form .config-name-input[data-v-2c630af3]:focus,.save-config-section .save-form .config-desc-input[data-v-2c630af3]:focus{outline:none;border-color:rgba(205,133,63,.6);background:hsla(0,0%,100%,.15)}.save-config-section .save-form .save-config-btn[data-v-2c630af3]{background:linear-gradient(180deg,rgba(34,197,94,0.2),rgba(22,163,74,0.3));border:1px solid rgba(34,197,94,.4);border-radius:6px;padding:10px 16px;color:#f0e6d2;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s ease}.save-config-section .save-form .save-config-btn[data-v-2c630af3]:hover:not(:disabled){background:linear-gradient(180deg,rgba(34,197,94,0.3),rgba(22,163,74,0.4));border-color:rgba(34,197,94,.6)}.save-config-section .save-form .save-config-btn[data-v-2c630af3]:disabled{opacity:.5;cursor:not-allowed}.config-list-section h4[data-v-2c630af3]{margin:0 0 16px 0;color:#ffd7a1;font-size:16px;font-weight:600}.config-list-section .config-list[data-v-2c630af3]{display:flex;flex-direction:column;gap:12px}.config-list-section .config-item[data-v-2c630af3]{display:flex;justify-content:space-between;align-items:center;padding:16px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid rgba(205,133,63,.2);transition:all .2s ease}.config-list-section .config-item[data-v-2c630af3]:hover{background:hsla(0,0%,100%,.08);border-color:rgba(205,133,63,.4)}.config-list-section .config-item .config-info[data-v-2c630af3]{flex:1}.config-list-section .config-item .config-info .config-name[data-v-2c630af3]{color:#f0e6d2;font-size:16px;font-weight:600;margin-bottom:4px}.config-list-section .config-item .config-info .config-desc[data-v-2c630af3]{color:#9ca3af;font-size:14px;margin-bottom:4px}.config-list-section .config-item .config-info .config-meta[data-v-2c630af3]{color:#6b7280;font-size:12px}.config-list-section .config-item .config-actions[data-v-2c630af3]{display:flex;gap:8px}.config-list-section .config-item .config-actions .load-config-btn[data-v-2c630af3],.config-list-section .config-item .config-actions .delete-config-btn[data-v-2c630af3]{background:hsla(0,0%,100%,.1);border:1px solid rgba(205,133,63,.3);border-radius:6px;padding:8px 12px;color:#f0e6d2;cursor:pointer;font-size:16px;transition:all .2s ease}.config-list-section .config-item .config-actions .load-config-btn[data-v-2c630af3]:hover,.config-list-section .config-item .config-actions .delete-config-btn[data-v-2c630af3]:hover{background:hsla(0,0%,100%,.2);border-color:rgba(205,133,63,.5)}.config-list-section .config-item .config-actions .delete-config-btn[data-v-2c630af3]:hover{background:rgba(220,38,38,.2);border-color:rgba(220,38,38,.4)}.config-list-section .no-configs[data-v-2c630af3]{text-align:center;color:#9ca3af;font-size:14px;padding:40px 20px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px dashed rgba(205,133,63,.3)}.troop-config-content[data-v-2c630af3]{padding:20px;max-height:70vh;overflow-y:auto}.captain-info-section[data-v-2c630af3]{display:flex;align-items:center;gap:16px;margin-bottom:20px;padding:16px;background:hsla(0,0%,100%,.05);border-radius:12px;border:1px solid rgba(205,133,63,.2)}.captain-info-section .captain-avatar[data-v-2c630af3]{font-size:32px}.captain-info-section .captain-details[data-v-2c630af3]{flex:1}.captain-info-section .captain-details h4[data-v-2c630af3]{margin:0 0 8px 0;color:#f0e6d2;font-size:18px;font-weight:600}.captain-info-section .captain-details .captain-attributes[data-v-2c630af3]{display:flex;gap:16px;flex-wrap:wrap}.captain-info-section .captain-details .captain-attributes .attr-item[data-v-2c630af3]{display:flex;gap:4px;font-size:12px;color:#9ca3af}.captain-info-section .captain-details .captain-attributes .attr-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600}.captain-info-section .captain-details .bonus-text[data-v-2c630af3]{color:#dc2626 !important;font-weight:600}.troops-config-section[data-v-2c630af3]{margin-bottom:20px}.troops-config-section .troops-limit[data-v-2c630af3]{color:#f59e0b;font-weight:600;font-size:14px;margin-bottom:16px;text-align:center}.troops-config-section .troops-sliders[data-v-2c630af3]{display:flex;flex-direction:column;gap:20px}.troops-config-section .troop-slider-item[data-v-2c630af3]{display:flex;flex-direction:column;gap:10px;padding:15px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid rgba(205,133,63,.2)}.troops-config-section .troop-slider-item .troop-label[data-v-2c630af3]{display:flex;justify-content:space-between;align-items:center;gap:10px}.troops-config-section .troop-slider-item .troop-label .troop-name[data-v-2c630af3]{color:#f0e6d2;font-weight:600;font-size:14px}.troops-config-section .troop-slider-item .troop-label .troop-description[data-v-2c630af3]{color:#9ca3af;font-size:12px;flex:1;text-align:right}.troops-config-section .troop-slider-item .slider-container[data-v-2c630af3]{display:flex;align-items:center;gap:15px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]{flex:1;height:6px;background:rgba(255,200,150,.2);border-radius:3px;outline:none;cursor:pointer;-webkit-appearance:none;appearance:none}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:#ffd7a1;border-radius:50%;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3);-webkit-transition:all .2s ease;transition:all .2s ease}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-webkit-slider-thumb:hover{background:#ffed4e;transform:scale(1.1)}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-moz-range-thumb{width:20px;height:20px;background:#ffd7a1;border-radius:50%;cursor:pointer;border:none;box-shadow:0 2px 6px rgba(0,0,0,.3);-moz-transition:all .2s ease;transition:all .2s ease}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-moz-range-thumb:hover{background:#ffed4e;transform:scale(1.1)}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-webkit-slider-track{background:rgba(255,200,150,.2);border-radius:3px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-moz-range-track{background:rgba(255,200,150,.2);border-radius:3px;border:none}.troops-config-section .troop-slider-item .slider-container .slider-value[data-v-2c630af3]{min-width:30px;text-align:center;font-size:16px;font-weight:600;color:#f0e6d2;background:rgba(0,0,0,.3);padding:5px 10px;border-radius:4px;border:1px solid rgba(255,200,150,.3)}.attribute-bonus-section[data-v-2c630af3]{margin-bottom:20px;padding:16px;background:rgba(34,197,94,.1);border-radius:12px;border:1px solid rgba(34,197,94,.3)}.attribute-bonus-section h4[data-v-2c630af3]{margin:0 0 12px 0;color:#22c55e;font-size:16px;font-weight:600}.attribute-bonus-section .bonus-stats[data-v-2c630af3]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}.attribute-bonus-section .bonus-stats .bonus-item[data-v-2c630af3]{display:flex;justify-content:space-between;padding:6px 8px;background:hsla(0,0%,100%,.05);border-radius:6px}.attribute-bonus-section .bonus-stats .bonus-item .bonus-label[data-v-2c630af3]{color:#9ca3af;font-size:12px}.attribute-bonus-section .bonus-stats .bonus-item .bonus-value[data-v-2c630af3]{color:#22c55e;font-weight:600;font-size:12px}.troops-summary[data-v-2c630af3]{display:flex;gap:16px;padding:12px;background:hsla(0,0%,100%,.05);border-radius:8px}.troops-summary .summary-item[data-v-2c630af3]{display:flex;flex-direction:column;gap:4px;flex:1}.troops-summary .summary-item span[data-v-2c630af3]:first-child{color:#9ca3af;font-size:12px}.troops-summary .summary-item span[data-v-2c630af3]:last-child{color:#f0e6d2;font-weight:600;font-size:14px}.troops-summary .summary-item span:last-child.warning[data-v-2c630af3]{color:#dc2626}@media (max-width:768px){.troop-config-modal .modal-content[data-v-2c630af3]{max-width:90vw;max-height:90vh}.troop-config-content[data-v-2c630af3]{padding:16px}.captain-info-section[data-v-2c630af3]{flex-direction:column;text-align:center;gap:12px}.captain-info-section .captain-attributes[data-v-2c630af3]{justify-content:center;gap:2px;flex-wrap:nowrap;display:flex}.captain-info-section .captain-attributes .attr-item[data-v-2c630af3]{font-size:9px;padding:1px 2px;min-width:0;flex:1}.troops-config-section .troop-slider-item .troop-label .troop-name[data-v-2c630af3]{font-size:13px}.troops-config-section .troop-slider-item .troop-label .troop-description[data-v-2c630af3]{font-size:11px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]{height:7px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-webkit-slider-thumb{width:19px;height:19px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-moz-range-thumb{width:19px;height:19px}.troops-config-section .troop-slider-item .slider-container .slider-value[data-v-2c630af3]{font-size:14px;padding:4px 8px}.attribute-bonus-section .bonus-stats[data-v-2c630af3]{grid-template-columns:1fr}.troops-summary[data-v-2c630af3]{flex-direction:column;gap:8px}}@media (max-width:480px){.troop-config-content[data-v-2c630af3]{padding:12px}.captain-info-section[data-v-2c630af3]{padding:12px}.captain-info-section .captain-avatar[data-v-2c630af3]{font-size:24px}.captain-info-section .captain-details h4[data-v-2c630af3]{font-size:16px}.captain-info-section .captain-attributes[data-v-2c630af3]{gap:8px}.captain-info-section .captain-attributes .attr-item[data-v-2c630af3]{font-size:11px}.troops-config-section .troop-slider-item[data-v-2c630af3]{padding:8px}.troops-config-section .troop-slider-item .troop-label .troop-name[data-v-2c630af3]{font-size:12px}.troops-config-section .troop-slider-item .troop-label .troop-description[data-v-2c630af3]{font-size:10px}.troops-config-section .troop-slider-item .slider-container[data-v-2c630af3]{gap:8px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]{height:8px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-webkit-slider-thumb{width:18px;height:18px}.troops-config-section .troop-slider-item .slider-container .troop-slider[data-v-2c630af3]::-moz-range-thumb{width:18px;height:18px}.troops-config-section .troop-slider-item .slider-container .slider-value[data-v-2c630af3]{font-size:12px;padding:3px 6px;min-width:25px}.attribute-bonus-section[data-v-2c630af3]{padding:12px}.attribute-bonus-section h4[data-v-2c630af3]{font-size:14px}.attribute-bonus-section .bonus-stats .bonus-item[data-v-2c630af3]{padding:4px 6px;font-size:11px}}
.toast-container[data-v-e2806492]{position:fixed;top:20px;right:20px;z-index:99999;pointer-events:none}@media (max-width:768px){.toast-container[data-v-e2806492]{top:10px;right:10px;left:10px}}.toast-item[data-v-e2806492]{position:relative;display:flex;align-items:flex-start;gap:12px;min-width:320px;max-width:480px;padding:16px;margin-bottom:12px;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.3);backdrop-filter:blur(10px);border:1px solid hsla(0,0%,100%,.1);pointer-events:auto;cursor:pointer;overflow:hidden}@media (max-width:768px){.toast-item[data-v-e2806492]{min-width:auto;max-width:none;padding:12px}}.toast-item.toast-success[data-v-e2806492]{background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(21,128,61,0.25));border-color:rgba(34,197,94,.3);color:#dcfce7}.toast-item.toast-success .toast-icon[data-v-e2806492]{color:#22c55e}.toast-item.toast-success .toast-progress[data-v-e2806492]{background:linear-gradient(90deg,#22c55e,#16a34a)}.toast-item.toast-error[data-v-e2806492]{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(185,28,28,0.25));border-color:rgba(239,68,68,.3);color:#fecaca}.toast-item.toast-error .toast-icon[data-v-e2806492]{color:#ef4444}.toast-item.toast-error .toast-progress[data-v-e2806492]{background:linear-gradient(90deg,#ef4444,#dc2626)}.toast-item.toast-warning[data-v-e2806492]{background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(180,83,9,0.25));border-color:rgba(245,158,11,.3);color:#fef3c7}.toast-item.toast-warning .toast-icon[data-v-e2806492]{color:#f59e0b}.toast-item.toast-warning .toast-progress[data-v-e2806492]{background:linear-gradient(90deg,#f59e0b,#d97706)}.toast-item.toast-info[data-v-e2806492]{background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(37,99,235,0.25));border-color:rgba(59,130,246,.3);color:#dbeafe}.toast-item.toast-info .toast-icon[data-v-e2806492]{color:#3b82f6}.toast-item.toast-info .toast-progress[data-v-e2806492]{background:linear-gradient(90deg,#3b82f6,#2563eb)}.toast-item[data-v-e2806492]:hover{transform:translateY(-2px);box-shadow:0 12px 40px rgba(0,0,0,.4)}.toast-icon[data-v-e2806492]{flex-shrink:0;margin-top:2px}.toast-content[data-v-e2806492]{flex:1;min-width:0}.toast-content .toast-title[data-v-e2806492]{font-weight:600;font-size:14px;margin-bottom:4px;line-height:1.3}.toast-content .toast-message[data-v-e2806492]{font-size:13px;line-height:1.4;opacity:.9;word-wrap:break-word}.toast-close[data-v-e2806492]{flex-shrink:0;background:none;border:none;color:currentColor;opacity:.6;cursor:pointer;padding:4px;border-radius:6px;transition:all .2s ease;margin-top:-2px}.toast-close[data-v-e2806492]:hover{opacity:1;background:hsla(0,0%,100%,.1)}.toast-progress[data-v-e2806492]{position:absolute;bottom:0;left:0;height:3px;width:100%;transform-origin:left;animation:toast-progress-e2806492 linear forwards}.toast-enter-active[data-v-e2806492]{transition:all .4s cubic-bezier(0.175,0.885,0.32,1.275)}.toast-leave-active[data-v-e2806492]{transition:all .3s ease-in}.toast-enter-from[data-v-e2806492]{opacity:0;transform:translateX(100%) scale(0.8)}.toast-leave-to[data-v-e2806492]{opacity:0;transform:translateX(100%) scale(0.8)}.toast-move[data-v-e2806492]{transition:transform .3s ease}@keyframes toast-progress-e2806492{from{transform:scaleX(1)}to{transform:scaleX(0)}}@media (max-width:480px){.toast-container[data-v-e2806492]{top:10px;right:10px;left:10px}.toast-item[data-v-e2806492]{min-width:auto;padding:12px;gap:10px}.toast-item .toast-content .toast-title[data-v-e2806492]{font-size:13px}.toast-item .toast-content .toast-message[data-v-e2806492]{font-size:12px}}
.battle-summary-container{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 20% 10%,rgba(255,255,255,0.06),transparent 40%),radial-gradient(circle at 80% 90%,rgba(255,255,255,0.05),transparent 40%),linear-gradient(135deg,rgba(0,0,0,0.9),rgba(20,10,5,0.86));z-index:1000;padding:24px}@media (max-width:768px){.battle-summary-container{padding:8px;align-items:stretch}}.summary-panel{width:min(1000px,95vw);height:min(90vh,800px);display:flex;flex-direction:column;border-radius:16px;border:2px solid rgba(205,133,63,.35);box-shadow:0 12px 36px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,200,150,.12);background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="%23cd8533" fill-opacity="0.08" d="M0 19h2v1H0zm18 0h2v1h-2zM0 0h1v2H0zm19 0h1v2h-1z"/></svg>') repeat,linear-gradient(180deg,rgba(40,26,20,0.96),rgba(26,19,19,0.95));overflow:hidden}@media (max-width:768px){.summary-panel{width:100%;height:100%;border-radius:8px;border-width:1px}}.summary-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border-bottom:3px solid rgba(205,133,63,.4);box-shadow:0 4px 12px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,200,150,.1);position:relative}.summary-header::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(255,215,0,0.6),transparent)}.summary-info{display:flex;align-items:center;gap:8px;flex:1}.summary-title{flex:1;margin-left:8px}.summary-title h3{color:#ffd7a1;font-size:28px;font-weight:800;margin:0 0 4px 0;text-shadow:0 2px 8px rgba(0,0,0,.6);letter-spacing:.5px}.summary-title .summary-subtitle{color:rgba(240,230,210,.8);font-size:14px;font-style:italic;opacity:.9;margin:0}.header-buttons{display:flex;gap:8px;align-items:center;justify-content:center}.header-btn{background:linear-gradient(135deg,#8a3c2c,#65261c);border:2px solid rgba(255,120,60,.5);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.3)}.header-btn .btn-icon{color:#ffd7a1;font-size:16px;font-weight:bold}.header-btn:hover:not(:disabled){background:linear-gradient(135deg,#9a4c3c,#75362c);transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.4)}.header-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}.summary-shell{flex:1;display:flex;flex-direction:column;margin:8px 12px;min-height:0}.summary-viewport{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;border-radius:12px;border:2px solid rgba(205,133,63,.3);background:#1b120f;box-shadow:0 8px 24px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,200,150,.1)}.summary-content{height:auto;overflow:visible;padding:24px;background:radial-gradient(ellipse at top,rgba(255,255,255,0.03),transparent 60%),linear-gradient(90deg,rgba(0,0,0,0.15) 0 1px,transparent 1px) repeat-x;background-size:100% 100%,24px 100%}@media (max-width:768px){.summary-content{padding:12px}}.summary-text.typo-book{color:#f7efd9;font-family:"Georgia","Times New Roman",serif;font-size:18px;line-height:1.85;letter-spacing:.3px;text-rendering:optimizeLegibility}@media (max-width:768px){.summary-text.typo-book{font-size:16px;line-height:1.75;letter-spacing:.2px}}.summary-text.typo-book p{text-indent:2em;margin:0 0 12px 0;position:relative;padding-bottom:8px;border-bottom:1px dashed rgba(205,133,63,.15)}.summary-text.typo-book em,.summary-text.typo-book .italic-text{-webkit-text-decoration:underline dotted rgba(255,215,161,.5);text-decoration:underline dotted rgba(255,215,161,.5);text-underline-offset:2px}.summary-text.typo-book .strong-text{-webkit-text-decoration:underline solid rgba(255,215,161,.35);text-decoration:underline solid rgba(255,215,161,.35);text-underline-offset:3px}.summary-text.typo-book .quote{border-left-color:rgba(255,215,161,.45);background:rgba(255,215,161,.08)}.generating-state{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;text-align:center}.generating-animation{display:flex;flex-direction:column;align-items:center;gap:20px}.spinner{width:40px;height:40px;border:4px solid rgba(205,133,63,.3);border-top:4px solid peru;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.generating-text{color:#ffd7a1;font-size:18px;font-weight:600;margin:0}.initial-state{margin-top:40px;text-align:center;font-family:"Georgia","Times New Roman",serif}.initial-welcome{margin-bottom:30px;padding:24px;background:radial-gradient(ellipse at center,rgba(205,133,63,0.08),transparent 70%);border-radius:12px}.welcome-text{color:#ffd7a1;font-size:22px;font-weight:600;margin:0 0 12px 0;letter-spacing:1px}.welcome-hint{color:rgba(247,239,217,.7);font-size:16px;font-style:italic;margin:0;line-height:1.6}.initial-actions{max-width:400px;margin:0 auto}.generate-btn{width:100%;padding:16px 24px;background:linear-gradient(135deg,#cd853f,#b8860b);border:2px solid rgba(205,133,63,.6);border-radius:12px;color:#f7efd9;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px rgba(205,133,63,.3)}.generate-btn:hover:not(:disabled){background:linear-gradient(135deg,#daa520,#cd853f);box-shadow:0 6px 16px rgba(205,133,63,.4);transform:translateY(-2px)}.generate-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}@media (max-width:768px){.summary-header{padding:8px 10px}.summary-title h3{font-size:20px}.summary-title .summary-subtitle{font-size:12px}.header-btn{width:32px;height:32px}.header-btn .btn-icon{font-size:14px}.summary-shell{margin:4px 8px}.initial-state{margin-top:20px}.initial-welcome{padding:16px;margin-bottom:20px}.welcome-text{font-size:18px}.welcome-hint{font-size:14px}.generate-btn{font-size:16px;padding:14px 20px}}
.advanced-battle-interface[data-v-ff977f92]{width:100%;max-height:calc(100vh - 100px);background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));color:#f0e6d2;font-family:'Arial',sans-serif;overflow:hidden;display:flex;flex-direction:column}.advanced-battle-interface.modal-mode[data-v-ff977f92]{height:100%;background:transparent}.battle-header-modal[data-v-ff977f92]{background:rgba(0,0,0,0.4);padding:1rem;border-bottom:2px solid rgba(205,133,63,0.4);display:flex;justify-content:center;align-items:center}.battle-info-modal[data-v-ff977f92]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap;justify-content:center}.battle-info-modal .turn-info[data-v-ff977f92]{display:flex;align-items:center;gap:0.5rem}.battle-info-modal .battle-controls[data-v-ff977f92]{display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center}@media (max-width:768px){.battle-info-modal[data-v-ff977f92]{flex-direction:column;gap:0.5rem}.battle-info-modal .battle-controls[data-v-ff977f92]{width:100%;justify-content:center}.battle-info-modal .control-btn[data-v-ff977f92]{padding:0.4rem 0.8rem;font-size:0.8rem}}.battle-header[data-v-ff977f92]{background:rgba(0,0,0,0.4);padding:1rem;border-bottom:2px solid rgba(205,133,63,0.4);display:flex;justify-content:space-between;align-items:center}.battle-title h2[data-v-ff977f92]{margin:0;color:#ffd7a1;font-size:1.5rem;font-weight:700}.battle-status[data-v-ff977f92]{padding:0.5rem 1rem;border-radius:20px;font-weight:bold;margin-top:0.5rem;color:#f0e6d2}.battle-status.idle[data-v-ff977f92]{background:rgba(107,114,128,0.3);border:1px solid rgba(107,114,128,0.5)}.battle-status.fighting[data-v-ff977f92]{background:rgba(220,38,38,0.3);border:1px solid rgba(220,38,38,0.5);animation:pulse-ff977f92 1s infinite}.battle-status.paused[data-v-ff977f92]{background:rgba(245,158,11,0.3);border:1px solid rgba(245,158,11,0.5)}.battle-status.finished[data-v-ff977f92]{background:rgba(5,150,105,0.3);border:1px solid rgba(5,150,105,0.5)}@keyframes pulse-ff977f92{0%,100%{opacity:1}50%{opacity:0.7}}.battle-info[data-v-ff977f92]{display:flex;align-items:center;gap:2rem}.turn-info[data-v-ff977f92]{display:flex;align-items:center;gap:0.5rem}.turn-label[data-v-ff977f92]{color:#9ca3af}.turn-number[data-v-ff977f92]{background:rgba(205,133,63,0.3);border:1px solid rgba(205,133,63,0.5);color:#ffd7a1;padding:0.25rem 0.75rem;border-radius:15px;font-weight:bold}.battle-controls[data-v-ff977f92]{display:flex;gap:0.5rem}.control-btn[data-v-ff977f92]{padding:0.5rem 1rem;border:1px solid rgba(205,133,63,0.3);border-radius:8px;cursor:pointer;font-weight:bold;transition:all 0.3s ease;color:#f0e6d2}.start-btn[data-v-ff977f92]{background:linear-gradient(135deg,rgba(5,150,105,0.8),rgba(16,185,129,0.9));border-color:rgba(5,150,105,0.8);box-shadow:0 4px 15px rgba(5,150,105,0.3);font-weight:700;font-size:1.1rem;padding:0.8rem 1.5rem;border-radius:8px;transition:all 0.3s ease}.start-btn[data-v-ff977f92]:hover{background:linear-gradient(135deg,rgba(16,185,129,0.9),rgba(5,150,105,1));box-shadow:0 6px 20px rgba(5,150,105,0.5);transform:translateY(-2px)}.pause-btn[data-v-ff977f92]{background:rgba(245,158,11,0.3);border-color:rgba(245,158,11,0.5)}.resume-btn[data-v-ff977f92]{background:rgba(59,130,246,0.3);border-color:rgba(59,130,246,0.5)}.reset-btn[data-v-ff977f92]{background:rgba(147,51,234,0.3);border-color:rgba(147,51,234,0.5)}.next-turn-btn[data-v-ff977f92]{background:linear-gradient(135deg,rgba(5,150,105,0.8),rgba(16,185,129,0.9));border-color:rgba(5,150,105,0.8);box-shadow:0 4px 15px rgba(5,150,105,0.3);font-weight:700;font-size:1.1rem;padding:0.8rem 1.5rem;border-radius:8px;transition:all 0.3s ease}.next-turn-btn[data-v-ff977f92]:hover{background:linear-gradient(135deg,rgba(16,185,129,0.9),rgba(5,150,105,1));box-shadow:0 6px 20px rgba(5,150,105,0.5);transform:translateY(-2px)}.pagination-controls[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:0.5rem;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(205,133,63,0.2)}.pagination-btn[data-v-ff977f92]{background:rgba(205,133,63,0.3);border:1px solid rgba(205,133,63,0.5);color:#f0e6d2;padding:0.2rem 0.6rem;border-radius:4px;cursor:pointer;transition:all 0.3s ease;font-size:0.8rem}.pagination-btn[data-v-ff977f92]:hover:not(:disabled){background:rgba(205,133,63,0.5);transform:translateY(-1px)}.pagination-btn[data-v-ff977f92]:disabled{opacity:0.5;cursor:not-allowed}.turn-indicator[data-v-ff977f92]{color:#ffd7a1;font-weight:600;font-size:0.9rem}.left-pagination[data-v-ff977f92],.right-pagination[data-v-ff977f92]{width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:bold}.battle-start-section[data-v-ff977f92],.battle-info-section[data-v-ff977f92],.battle-end-section[data-v-ff977f92]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:1rem;margin-bottom:1rem}.battle-controls[data-v-ff977f92]{display:flex;gap:1rem;justify-content:center;align-items:center;flex-wrap:wrap}.dialogue-btn,.manual-battle-btn,.auto-battle-btn,.retreat-btn{&[data-v-ff977f92]{padding:0.8rem 1.5rem;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:700;transition:all 0.3s ease;border:2px solid transparent;white-space:nowrap;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.3);text-shadow:0 1px 2px rgba(0,0,0,0.5);min-width:140px;height:48px;display:flex;align-items:center;justify-content:center}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover::before{left:100%}}.dialogue-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,#8b5cf6,#7c3aed,#6d28d9);border:2px solid rgba(139,92,246,0.8);color:#ffffff;box-shadow:0 6px 20px rgba(139,92,246,0.4)}&[data-v-ff977f92]:hover:not(:disabled){background:linear-gradient(135deg,#7c3aed,#6d28d9,#5b21b6);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(139,92,246,0.6);border-color:rgba(139,92,246,1)}&.disabled,&:disabled{&[data-v-ff977f92]{background:linear-gradient(135deg,rgba(107,114,128,0.3),rgba(75,85,99,0.3));border:2px solid rgba(107,114,128,0.4);color:#9ca3af;cursor:not-allowed;opacity:0.6;box-shadow:0 2px 8px rgba(0,0,0,0.2)}&[data-v-ff977f92]:hover{transform:none;box-shadow:0 2px 8px rgba(0,0,0,0.2)}}}.manual-battle-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,#3b82f6,#2563eb,#1d4ed8);border:2px solid rgba(59,130,246,0.8);color:#ffffff;flex-direction:column;gap:0.2rem;box-shadow:0 6px 20px rgba(59,130,246,0.4)}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#2563eb,#1d4ed8,#1e40af);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(59,130,246,0.6);border-color:rgba(59,130,246,1)}.focus-target-hint[data-v-ff977f92]{font-size:0.7rem;color:#ffd700;font-weight:600;text-shadow:0 0 6px rgba(255,215,0,0.8);background:rgba(255,215,0,0.1);padding:1px 4px;border-radius:3px;border:1px solid rgba(255,215,0,0.3)}}.auto-battle-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,#059669,#047857,#065f46);border:2px solid rgba(5,150,105,0.8);color:#ffffff;box-shadow:0 6px 20px rgba(5,150,105,0.4)}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#047857,#065f46,#064e3b);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(5,150,105,0.6);border-color:rgba(5,150,105,1)}}.battle-controls .retreat-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,rgba(107,114,128,0.4),rgba(75,85,99,0.4));border:2px solid rgba(107,114,128,0.6);color:#d1d5db;box-shadow:0 4px 15px rgba(107,114,128,0.3)}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,rgba(107,114,128,0.6),rgba(75,85,99,0.6));transform:translateY(-2px) scale(1.01);box-shadow:0 6px 20px rgba(107,114,128,0.4);border-color:rgba(107,114,128,0.8);color:#f3f4f6}}.battle-status[data-v-ff977f92],.battle-result-info[data-v-ff977f92]{display:flex;flex-direction:column;align-items:center;gap:1rem}.status-text[data-v-ff977f92],.result-text[data-v-ff977f92]{color:#ffd7a1;font-size:1.1rem;font-weight:600}.turn-indicator-section[data-v-ff977f92]{display:flex;justify-content:center;margin-bottom:1rem;padding:0.5rem;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(205,133,63,0.2)}.close-btn[data-v-ff977f92]{background:rgba(220,38,38,0.3);border-color:rgba(220,38,38,0.5)}.refresh-btn[data-v-ff977f92]{background:rgba(147,51,234,0.3);border-color:rgba(147,51,234,0.5)}.control-btn[data-v-ff977f92]:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.3)}.battle-main[data-v-ff977f92]{flex:1;display:flex;flex-direction:column;gap:1rem;padding:1rem;overflow:hidden}@media (min-width:769px){.battle-main[data-v-ff977f92]{gap:0.5rem;padding:0.25rem 0.5rem;max-height:690px}}.battle-content[data-v-ff977f92]{flex:1;display:flex;flex-direction:column;gap:1rem;overflow:hidden}@media (min-width:769px){.battle-content[data-v-ff977f92]{gap:0.15rem}}@media (max-width:768px){.battle-main[data-v-ff977f92]{gap:0.1rem !important;padding:0.1rem !important}.battle-content[data-v-ff977f92]{flex-direction:column !important;gap:0.1rem !important;height:100% !important}.log-header[data-v-ff977f92]{flex-direction:row !important;justify-content:space-between !important;align-items:center !important;gap:0.5rem !important}.log-controls[data-v-ff977f92]{justify-content:center !important}.log-controls .control-btn[data-v-ff977f92]{padding:0.4rem 0.8rem !important;font-size:0.8rem !important}.units-grid[data-v-ff977f92]{grid-template-columns:repeat(3,1fr) !important;gap:2px !important;justify-content:center !important;align-content:center !important;justify-items:center !important}.unit-card[data-v-ff977f92]{width:80px !important;height:120px !important;margin-left:20px !important}.unit-name-vertical-left[data-v-ff977f92]{left:-20px !important;width:16px !important;font-size:8px !important;padding:4px 2px !important}.unit-health-bar-horizontal[data-v-ff977f92]{width:clamp(50px,12vw,70px) !important;height:4px !important;top:4px !important}.health-text-horizontal[data-v-ff977f92]{top:4px !important;font-size:clamp(5px,1.5vw,7px) !important;line-height:4px !important;z-index:4 !important}.unit-attributes-vertical[data-v-ff977f92]{bottom:8px !important;left:6px !important;gap:2px !important}.attr-item[data-v-ff977f92]{font-size:8px !important;padding:2px 4px !important;gap:4px !important}.attr-item .attr-icon[data-v-ff977f92]{font-size:8px !important;width:8px !important}}.units-panel[data-v-ff977f92]{flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(205,133,63,0.2);border-radius:10px;padding:1rem;overflow-y:auto}@media (min-width:769px){.units-panel[data-v-ff977f92]{flex:0 0 275px;overflow-x:auto;overflow-y:hidden}.enemies-panel[data-v-ff977f92]{flex:0 0 275px;margin-top:0}}@media (max-width:768px){.allies-panel[data-v-ff977f92]{flex:0 0 260px !important;height:100px !important}.enemies-panel[data-v-ff977f92]{flex:0 0 260px !important;height:100px !important;margin-top:0px !important}}@media (max-width:768px){.units-panel[data-v-ff977f92]{padding:0.25rem}.battle-log-panel[data-v-ff977f92]{padding:0.25rem;flex:0 0 200px !important;height:200px !important;max-height:170px !important}}.panel-title[data-v-ff977f92]{margin:0;color:#ffd7a1;font-size:1rem;font-weight:700;text-align:center;padding:0.2rem 0}.units-grid[data-v-ff977f92]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;align-content:start}@media (min-width:769px){.units-grid[data-v-ff977f92]{grid-template-columns:repeat(6,1fr);grid-template-rows:1fr;gap:8px;align-content:center;justify-content:center;width:100%}}.unit-card[data-v-ff977f92]{position:relative;background:linear-gradient(180deg,rgba(44,24,24,0.8),rgba(28,20,17,0.95));border:3px solid rgba(205,133,63,0.4);border-radius:12px;padding:0;box-shadow:inset 0 1px 0 rgba(255,200,150,0.08),0 4px 12px rgba(0,0,0,0.4);transition:all 0.3s ease;cursor:pointer;width:120px;height:180px;display:flex;flex-direction:column;overflow:visible;margin-left:30px}@media (min-width:769px){.unit-card[data-v-ff977f92]{width:auto;height:240px;margin-left:20px;flex:1}}.unit-card[data-v-ff977f92]:hover{transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,0.12),0 6px 16px rgba(0,0,0,0.4);border-color:rgba(205,133,63,0.6)}.unit-card.unit-dead[data-v-ff977f92]{opacity:0.5;filter:grayscale(100%)}.unit-card.unit-selected[data-v-ff977f92]{border:3px solid #ff6b6b !important;box-shadow:0 0 20px rgba(255,107,107,0.6) !important;transform:scale(1.05);background:linear-gradient(135deg,rgba(255,107,107,0.1),rgba(255,107,107,0.05)) !important}.unit-card.unit-selectable{&[data-v-ff977f92]{cursor:pointer;transition:all 0.3s ease;border:2px solid rgba(255,107,107,0.3)}&[data-v-ff977f92]:hover{border-color:rgba(255,107,107,0.6);box-shadow:0 0 15px rgba(255,107,107,0.4);transform:translateY(-2px);background:linear-gradient(135deg,rgba(255,107,107,0.05),rgba(255,107,107,0.02))}}.unit-portrait[data-v-ff977f92]{position:relative;width:100%;height:100%;overflow:hidden;z-index:2;border-radius:9px}.unit-portrait img[data-v-ff977f92]{width:100%;height:100%;object-fit:cover;object-position:top}.unit-portrait .default-portrait[data-v-ff977f92]{width:100%;height:100%;background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(255,120,60,0.2));display:flex;align-items:center;justify-content:center}.unit-portrait .default-portrait .portrait-icon[data-v-ff977f92]{font-size:64px;opacity:0.8}.unit-name-vertical-left[data-v-ff977f92]{position:absolute;left:-30px;top:0;bottom:0;width:24px;z-index:3;color:#ffd7a1;font-size:10px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,0.9);background:rgba(0,0,0,0.6);padding:6px 4px;border-radius:4px;text-align:center;writing-mode:vertical-rl;text-orientation:mixed;display:flex;align-items:center;justify-content:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (min-width:769px){.unit-name-vertical-left[data-v-ff977f92]{left:-20px;width:16px;font-size:8px;padding:4px 2px}}.unit-health-bar-horizontal[data-v-ff977f92]{position:absolute;top:6px;left:50%;transform:translateX(-50%);width:clamp(60px,15vw,100px);height:6px;background:rgba(0,0,0,0.4);border-radius:3px;overflow:hidden;z-index:3}@media (min-width:769px){.unit-health-bar-horizontal[data-v-ff977f92]{width:clamp(50px,12vw,80px);height:4px;top:4px}}.unit-health-bar-horizontal .health-fill-horizontal[data-v-ff977f92]{height:100%;background:linear-gradient(90deg,#dc2626,#b91c1c);border-radius:3px;transition:width 0.3s ease;box-shadow:0 0 4px rgba(220,38,38,0.6)}.health-text-horizontal[data-v-ff977f92]{position:absolute;top:6px;left:50%;transform:translateX(-50%);color:#fff;font-size:clamp(6px,2vw,10px);text-align:center;text-shadow:0 1px 2px rgba(0,0,0,0.8);z-index:4;white-space:nowrap;line-height:6px}@media (min-width:769px){.health-text-horizontal[data-v-ff977f92]{top:4px;font-size:clamp(5px,1.5vw,8px);line-height:4px}}.unit-attributes-vertical[data-v-ff977f92]{position:absolute;bottom:12px;left:8px;display:flex;flex-direction:column;gap:2px;z-index:3;align-items:flex-start}@media (min-width:769px){.unit-attributes-vertical[data-v-ff977f92]{bottom:8px;left:6px;gap:2px}}.attr-item[data-v-ff977f92]{display:flex;align-items:center;gap:6px;background:rgba(0,0,0,0.6);padding:3px 6px;border-radius:3px;font-size:clamp(8px,2.2vw,12px)}@media (min-width:769px){.attr-item[data-v-ff977f92]{font-size:clamp(7px,1.6vw,10px);padding:2px 5px;gap:4px}}.attr-item .attr-icon[data-v-ff977f92]{font-size:clamp(8px,2.2vw,12px);color:#f0e6d2;width:clamp(8px,2.2vw,12px);text-align:center}@media (min-width:769px){.attr-item .attr-icon[data-v-ff977f92]{font-size:clamp(7px,1.6vw,10px);width:clamp(7px,1.6vw,10px)}}.attr-item .attr-value[data-v-ff977f92]{font-size:clamp(8px,2.2vw,12px);color:#ffd7a1;font-weight:600}@media (min-width:769px){.attr-item .attr-value[data-v-ff977f92]{font-size:clamp(7px,1.6vw,10px)}}.troops-modal-overlay[data-v-ff977f92]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:2000}.troops-modal[data-v-ff977f92]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,0.4);border-radius:16px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,0.6);animation:modalSlideIn-ff977f92 0.3s ease-out}.troops-modal .modal-header[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(205,133,63,0.2)}.troops-modal .modal-header h3[data-v-ff977f92]{margin:0;color:#ffd7a1;font-size:20px;font-weight:700}.troops-modal .close-button[data-v-ff977f92]{background:none;border:none;color:#9ca3af;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:all 0.2s ease}.troops-modal .close-button[data-v-ff977f92]:hover{background:rgba(239,68,68,0.1);color:#ef4444}.troops-modal .modal-content[data-v-ff977f92]{padding:24px}.troops-modal .troops-list[data-v-ff977f92]{display:flex;flex-direction:column;gap:12px}.troops-modal .troop-item[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid rgba(205,133,63,0.5);font-size:16px}.troops-modal .troop-name[data-v-ff977f92]{color:#f0e6d2;font-weight:500}.troops-modal .troop-count[data-v-ff977f92]{font-weight:bold;color:#ffd7a1;font-size:18px}.troops-modal .troop-item.no-troops[data-v-ff977f92]{opacity:0.6;font-style:italic;border-left-color:#9ca3af}@keyframes modalSlideIn-ff977f92{from{opacity:0;transform:translateY(-20px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}.rewards-modal-overlay[data-v-ff977f92]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:2000}.rewards-modal[data-v-ff977f92]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,0.4);border-radius:16px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,0.6);animation:modalSlideIn-ff977f92 0.3s ease-out}.rewards-modal .modal-header[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(205,133,63,0.2)}.rewards-modal .modal-header h3[data-v-ff977f92]{margin:0;color:#ffd7a1;font-size:20px;font-weight:700}.rewards-modal .close-button[data-v-ff977f92]{background:none;border:none;color:#9ca3af;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:all 0.2s ease}.rewards-modal .close-button[data-v-ff977f92]:hover{background:rgba(239,68,68,0.1);color:#ef4444}.rewards-modal .modal-content[data-v-ff977f92]{padding:24px}.rewards-list[data-v-ff977f92]{display:flex;flex-direction:column;gap:12px}.reward-item[data-v-ff977f92]{display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:3px solid rgba(205,133,63,0.5);font-size:16px}.reward-icon[data-v-ff977f92]{font-size:20px;width:24px;text-align:center}.reward-name[data-v-ff977f92]{color:#f0e6d2;font-weight:500;flex:1}.reward-value[data-v-ff977f92]{font-weight:bold;color:#10b981;font-size:18px}.hero-reward[data-v-ff977f92]{background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,140,0,0.1));border-left:3px solid #ffd700;border-radius:8px;padding:12px;margin-top:8px;text-align:center;display:flex;justify-content:center;align-items:center}.hero-reward .reward-value[data-v-ff977f92]{color:#ffd700;font-weight:bold;font-size:16px}.heroes-list[data-v-ff977f92]{display:flex;flex-direction:column;gap:8px;width:100%}.hero-item[data-v-ff977f92]{display:flex;align-items:center;gap:12px;padding:8px 12px;background:rgba(255,215,0,0.1);border-radius:6px;border:1px solid rgba(255,215,0,0.3);transition:all 0.2s ease}.hero-item[data-v-ff977f92]:hover{background:rgba(255,215,0,0.15);border-color:rgba(255,215,0,0.5);transform:translateY(-1px)}.hero-item .reward-icon[data-v-ff977f92]{font-size:18px;width:20px;text-align:center}.hero-item .reward-name[data-v-ff977f92]{color:#f0e6d2;font-weight:600;flex:1;font-size:14px}.hero-item .reward-value[data-v-ff977f92]{color:#ffd700;font-weight:bold;font-size:12px;background:rgba(255,215,0,0.2);padding:2px 8px;border-radius:4px}.history-button-container[data-v-ff977f92]{display:flex;justify-content:center;align-items:center;gap:1rem;margin-bottom:1.5rem;width:100%;order:-1}.history-btn{&[data-v-ff977f92]{padding:0.8rem 1.5rem;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:700;transition:all 0.3s ease;border:2px solid rgba(107,114,128,0.8);white-space:nowrap;background:linear-gradient(135deg,#6b7280,#4b5563,#374151);color:#ffffff;display:flex;align-items:center;justify-content:center;gap:0.6rem;box-shadow:0 6px 20px rgba(107,114,128,0.4);text-shadow:0 1px 2px rgba(0,0,0,0.5);position:relative;overflow:hidden;min-width:140px;height:48px}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#4b5563,#374151,#1f2937);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(107,114,128,0.6);border-color:rgba(107,114,128,1)}&[data-v-ff977f92]:hover::before{left:100%}}.summary-btn{&[data-v-ff977f92]{padding:0.8rem 1.5rem;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:700;transition:all 0.3s ease;border:2px solid rgba(124,58,237,0.8);white-space:nowrap;background:linear-gradient(135deg,#7c3aed,#5b21b6,#4c1d95);color:#ffffff;display:flex;align-items:center;justify-content:center;gap:0.6rem;box-shadow:0 6px 20px rgba(124,58,237,0.4);text-shadow:0 1px 2px rgba(0,0,0,0.5);position:relative;overflow:hidden;min-width:140px;height:48px}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#5b21b6,#4c1d95,#3b0764);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(124,58,237,0.6);border-color:rgba(124,58,237,1)}&[data-v-ff977f92]:hover::before{left:100%}}.rewards-modal .modal-actions[data-v-ff977f92]{display:flex;justify-content:flex-end;gap:12px;margin-top:20px;padding:16px 24px;border-top:1px solid rgba(205,133,63,0.2)}.rewards-modal .confirm-button[data-v-ff977f92]{padding:10px 20px;border-radius:8px;cursor:pointer;transition:all 0.2s ease;font-weight:600;font-size:14px;border:none}.rewards-modal .success-button[data-v-ff977f92]{background:linear-gradient(180deg,#059669,#047857);border:1px solid rgba(5,150,105,0.6);color:#ffffff}.rewards-modal .success-button[data-v-ff977f92]:hover{background:linear-gradient(180deg,#047857,#065f46);transform:translateY(-1px);box-shadow:0 4px 12px rgba(5,150,105,0.3)}.battle-log-panel[data-v-ff977f92]{flex:0 0 120px;background:rgba(0,0,0,0.3);border:1px solid rgba(205,133,63,0.2);border-radius:10px;padding:0.5rem;display:flex;flex-direction:column;max-height:120px}@media (min-width:769px){.battle-log-panel[data-v-ff977f92]{flex:1;max-height:120px;min-height:120px}}.log-header[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;flex-wrap:wrap;gap:0.5rem;position:relative;padding:0.2rem 0}.log-controls[data-v-ff977f92]{display:flex;gap:0.5rem;flex-wrap:wrap}.log-container[data-v-ff977f92]{flex:1;overflow:hidden;padding:0.25rem;display:flex;flex-direction:column;justify-content:flex-start;min-height:100%}.action-list[data-v-ff977f92]{display:flex;flex-direction:column;gap:4px;flex:1;justify-content:flex-start;padding:0.25rem 0}.action-messages[data-v-ff977f92]{flex:1;display:flex;flex-direction:column;gap:4px;margin-bottom:0.25rem}.pagination-controls-horizontal[data-v-ff977f92]{display:flex;flex-direction:row;gap:0.25rem;align-items:center;justify-content:center;flex-shrink:0}.left-pagination,.right-pagination{&[data-v-ff977f92]{width:32px;height:32px;padding:0;display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:bold;background:linear-gradient(135deg,rgba(205,133,63,0.6),rgba(180,100,50,0.6));border:2px solid rgba(205,133,63,0.8);color:#f0e6d2;border-radius:8px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(205,133,63,0.3);text-shadow:0 1px 2px rgba(0,0,0,0.5);position:relative;overflow:hidden}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover:not(:disabled){background:linear-gradient(135deg,rgba(205,133,63,0.8),rgba(180,100,50,0.8));transform:translateY(-2px) scale(1.05);box-shadow:0 6px 16px rgba(205,133,63,0.5);border-color:rgba(205,133,63,1)}&[data-v-ff977f92]:hover:not(:disabled)::before{left:100%}&[data-v-ff977f92]:disabled{opacity:0.4;cursor:not-allowed;background:linear-gradient(135deg,rgba(107,114,128,0.3),rgba(75,85,99,0.3));border-color:rgba(107,114,128,0.4);box-shadow:0 2px 8px rgba(0,0,0,0.2)}}.turn-header[data-v-ff977f92]{margin-bottom:0.5rem}.turn-number[data-v-ff977f92]{font-weight:bold;color:#ffd7a1;font-size:1.1rem}.turn-actions[data-v-ff977f92]{display:flex;flex-direction:column;gap:0.5rem}.action-item{&[data-v-ff977f92]{padding:8px 12px;background:rgba(0,0,0,0.2);border-radius:6px;border-left:3px solid rgba(205,133,63,0.3);transition:all 0.2s ease}&[data-v-ff977f92]:hover{background:rgba(0,0,0,0.3);border-left-color:rgba(205,133,63,0.5)}&.ally-action[data-v-ff977f92]{border-left-color:#22c55e;background:rgba(34,197,94,0.1)}&.enemy-action[data-v-ff977f92]{border-left-color:#dc2626;background:rgba(220,38,38,0.1)}}.action-normal[data-v-ff977f92]{border-left:3px solid rgba(205,133,63,0.5)}.action-critical[data-v-ff977f92]{border-left:3px solid rgba(220,38,38,0.5);background:rgba(220,38,38,0.1)}.action-miss[data-v-ff977f92]{border-left:3px solid rgba(107,114,128,0.5);opacity:0.7}.action-description[data-v-ff977f92]{font-size:0.9rem;margin-bottom:0.25rem}.action-damage[data-v-ff977f92]{font-size:0.8rem;color:#ef4444;font-weight:bold}.critical-mark[data-v-ff977f92]{color:#f59e0b;margin-left:0.25rem}.empty-log[data-v-ff977f92]{text-align:center;color:#9ca3af;font-style:italic;padding:2rem}.battle-result[data-v-ff977f92]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000}.result-content[data-v-ff977f92]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));padding:2rem;border-radius:15px;text-align:center;border:2px solid rgba(205,133,63,0.4);max-width:500px;width:90%;box-shadow:0 20px 40px rgba(0,0,0,0.6)}.result-title[data-v-ff977f92]{font-size:2rem;font-weight:bold;margin-bottom:1rem}.result-title.victory[data-v-ff977f92]{color:#10b981}.result-title.defeat[data-v-ff977f92]{color:#ef4444}.victory-section{&[data-v-ff977f92]{display:flex;justify-content:center;align-items:center;padding:0.3rem;height:100%}.harvest-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,#059669,#047857,#065f46);border:2px solid rgba(5,150,105,0.8);color:#ffffff;padding:0.8rem 1.5rem;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:700;transition:all 0.3s ease;white-space:nowrap;box-shadow:0 6px 20px rgba(5,150,105,0.4);text-shadow:0 1px 2px rgba(0,0,0,0.5);position:relative;overflow:hidden;min-width:140px;height:48px;display:flex;align-items:center;justify-content:center}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#047857,#065f46,#064e3b);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(5,150,105,0.6);border-color:rgba(5,150,105,1)}&[data-v-ff977f92]:hover::before{left:100%}}}.defeat-section{&[data-v-ff977f92]{display:flex;justify-content:center;align-items:center;padding:0.3rem;height:100%;position:relative}.defeat-actions[data-v-ff977f92]{display:flex;gap:0.6rem;justify-content:center;align-items:center}.retreat-btn,.retry-btn{&[data-v-ff977f92]{padding:0.8rem 1.5rem;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:700;transition:all 0.3s ease;border:2px solid transparent;white-space:nowrap;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.3);text-shadow:0 1px 2px rgba(0,0,0,0.5);min-width:140px;height:48px;display:flex;align-items:center;justify-content:center}&[data-v-ff977f92]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s ease}&[data-v-ff977f92]:hover::before{left:100%}}.retreat-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,rgba(107,114,128,0.4),rgba(75,85,99,0.4));border:2px solid rgba(107,114,128,0.6);color:#d1d5db}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,rgba(107,114,128,0.6),rgba(75,85,99,0.6));transform:translateY(-2px) scale(1.01);box-shadow:0 6px 20px rgba(107,114,128,0.4);border-color:rgba(107,114,128,0.8);color:#f3f4f6}}.retry-btn{&[data-v-ff977f92]{background:linear-gradient(135deg,#3b82f6,#2563eb,#1d4ed8);border:2px solid rgba(59,130,246,0.8);color:#ffffff;box-shadow:0 6px 20px rgba(59,130,246,0.4)}&[data-v-ff977f92]:hover{background:linear-gradient(135deg,#2563eb,#1d4ed8,#1e40af);transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(59,130,246,0.6);border-color:rgba(59,130,246,1)}}}.result-stats[data-v-ff977f92]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem}.stat-item[data-v-ff977f92]{display:flex;flex-direction:column;align-items:center;padding:0.5rem;background:rgba(255,255,255,0.1);border-radius:8px}.stat-label[data-v-ff977f92]{font-size:0.9rem;color:#ccc;margin-bottom:0.25rem}.stat-value[data-v-ff977f92]{font-size:1.2rem;font-weight:bold;color:#4a90e2}[data-v-ff977f92]::-webkit-scrollbar{width:8px}[data-v-ff977f92]::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:4px}[data-v-ff977f92]::-webkit-scrollbar-thumb{background:#4a90e2;border-radius:4px}[data-v-ff977f92]::-webkit-scrollbar-thumb:hover{background:#357abd}.history-modal{&[data-v-ff977f92]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:flex;align-items:center;justify-content:center}.modal-overlay[data-v-ff977f92]{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px)}.modal-content{&[data-v-ff977f92]{position:relative;background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,0.5);border-radius:16px;padding:24px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,0.6)}@media (max-width:768px){&[data-v-ff977f92]{width:95%;padding:16px;max-height:90vh;border-radius:12px}}.modal-header{&[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,0.3)}.modal-title[data-v-ff977f92]{color:#ffd7a1;margin:0;font-size:20px;font-weight:700}.close-btn{&[data-v-ff977f92]{background:none;border:none;color:#f0e6d2;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all 0.2s ease}&[data-v-ff977f92]:hover{background:rgba(255,255,255,0.1);transform:scale(1.1)}}}.history-content{.no-history{&[data-v-ff977f92]{text-align:center;padding:40px 20px;color:#9ca3af}.no-history-icon[data-v-ff977f92]{font-size:48px;margin-bottom:16px;opacity:0.6}.no-history-text[data-v-ff977f92]{font-size:18px;font-weight:600;margin-bottom:8px;color:#f0e6d2}.no-history-hint[data-v-ff977f92]{font-size:14px;opacity:0.8}}.history-list{.history-item{&[data-v-ff977f92]{background:linear-gradient(180deg,rgba(44,30,24,0.8),rgba(28,20,17,0.9));border:1px solid rgba(205,133,63,0.2);border-radius:12px;padding:16px;margin-bottom:12px;transition:all 0.3s ease}&[data-v-ff977f92]:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,0.3);border-color:rgba(205,133,63,0.4)}&[data-v-ff977f92]:last-child{margin-bottom:0}.history-header{&[data-v-ff977f92]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.history-turn[data-v-ff977f92]{color:#ffd7a1;font-size:16px;font-weight:700}.history-status{&[data-v-ff977f92]{font-size:12px;padding:4px 8px;border-radius:4px;font-weight:600}&.finished[data-v-ff977f92]{background:rgba(34,197,94,0.2);color:#22c55e;border:1px solid rgba(34,197,94,0.3)}&.ongoing[data-v-ff977f92]{background:rgba(59,130,246,0.2);color:#3b82f6;border:1px solid rgba(59,130,246,0.3)}}}.history-actions{&[data-v-ff977f92]{display:flex;flex-direction:column;gap:8px}.history-action{&[data-v-ff977f92]{padding:8px 12px;background:rgba(0,0,0,0.3);border-radius:6px;border-left:3px solid transparent;transition:all 0.2s ease}&.ally-action[data-v-ff977f92]{border-left-color:#22c55e;background:rgba(34,197,94,0.25);border:1px solid rgba(34,197,94,0.3)}&.enemy-action[data-v-ff977f92]{border-left-color:#dc2626;background:rgba(220,38,38,0.25);border:1px solid rgba(220,38,38,0.3)}.action-description{&[data-v-ff977f92]{color:#f0e6d2;font-size:14px;line-height:1.4}.action-damage{&[data-v-ff977f92]{color:#ffd700;font-weight:600;margin-left:8px}.critical-mark[data-v-ff977f92]{color:#ff6b6b;font-weight:bold}}}}}}}}}}

.explore-container[data-v-456bdac5]{height:710px;padding:20px;background:#1a1313;color:#f0e6d2}@media (max-width:768px){.explore-container[data-v-456bdac5]{height:100vh;padding:8px}}.explore-header[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:8px 12px;background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:6px}@media (max-width:768px){.explore-header[data-v-456bdac5]{flex-direction:row;gap:8px;padding:6px 8px;margin-bottom:6px}}.explore-header .explore-title[data-v-456bdac5]{margin:0;font-size:18px;color:#ffd7a1;text-shadow:0 2px 6px rgba(0,0,0,.6)}@media (max-width:768px){.explore-header .explore-title[data-v-456bdac5]{font-size:16px}}.explore-header .header-right[data-v-456bdac5]{display:flex;align-items:center;gap:12px}@media (max-width:768px){.explore-header .header-right[data-v-456bdac5]{flex-direction:row;gap:6px;flex:1;justify-content:flex-end}}.explore-header .explore-stats[data-v-456bdac5]{display:flex;gap:8px}@media (max-width:768px){.explore-header .explore-stats[data-v-456bdac5]{gap:4px;flex-wrap:nowrap}}.explore-header .explore-stats .stat-item[data-v-456bdac5]{display:flex;align-items:center;gap:3px;padding:4px 8px;background:rgba(205,133,63,.1);border:1px solid rgba(205,133,63,.2);border-radius:4px}@media (max-width:768px){.explore-header .explore-stats .stat-item[data-v-456bdac5]{padding:2px 4px;gap:1px;min-width:0;flex-shrink:1}}.explore-header .explore-stats .stat-item .icon[data-v-456bdac5]{font-size:14px}@media (max-width:768px){.explore-header .explore-stats .stat-item .icon[data-v-456bdac5]{font-size:10px}}.explore-header .explore-stats .stat-item .value[data-v-456bdac5]{font-weight:700;color:#ffe9d2;font-size:12px}@media (max-width:768px){.explore-header .explore-stats .stat-item .value[data-v-456bdac5]{font-size:9px}}.explore-header .explore-stats .stat-item .label[data-v-456bdac5]{font-size:12px;opacity:.8}@media (max-width:768px){.explore-header .explore-stats .stat-item .label[data-v-456bdac5]{font-size:10px}}.continent-tabs[data-v-456bdac5]{margin-bottom:12px;padding:0 20px}@media (max-width:768px){.continent-tabs[data-v-456bdac5]{padding:0 8px;margin-bottom:8px}}.continent-tabs .tabs-container[data-v-456bdac5]{display:flex;gap:8px;overflow-x:auto;padding:4px 0}@media (max-width:768px){.continent-tabs .tabs-container[data-v-456bdac5]{gap:6px;padding:2px 0}}.continent-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar{height:4px}.continent-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:2px}.continent-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-thumb{background:rgba(205,133,63,.5);border-radius:2px}.continent-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.7)}.continent-tabs .continent-tab[data-v-456bdac5]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:8px;cursor:pointer;transition:all .3s ease;min-width:160px;position:relative;overflow:hidden}@media (max-width:768px){.continent-tabs .continent-tab[data-v-456bdac5]{min-width:120px;padding:6px 8px;gap:6px}}.continent-tabs .continent-tab[data-v-456bdac5]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.3);border-color:rgba(205,133,63,.6)}.continent-tabs .continent-tab.active[data-v-456bdac5]{background:linear-gradient(180deg,#cd853f,#b8860b);border-color:rgba(205,133,63,.8);color:#fff;box-shadow:0 4px 12px rgba(205,133,63,.4)}.continent-tabs .continent-tab.active .tab-name[data-v-456bdac5]{color:#fff;font-weight:700}.continent-tabs .continent-tab.active .progress-fill[data-v-456bdac5]{background:hsla(0,0%,100%,.8)}.continent-tabs .continent-tab.conquered[data-v-456bdac5]{border-color:rgba(34,197,94,.6);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(22,163,74,0.2))}.continent-tabs .continent-tab.conquered .tab-name[data-v-456bdac5]{color:#22c55e}.continent-tabs .continent-tab.locked[data-v-456bdac5]{opacity:.5;cursor:not-allowed;background:rgba(0,0,0,.3)}.continent-tabs .continent-tab.locked .tab-name[data-v-456bdac5]{color:#6b7280}.continent-tabs .continent-tab .tab-icon[data-v-456bdac5]{font-size:20px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));flex-shrink:0}@media (max-width:768px){.continent-tabs .continent-tab .tab-icon[data-v-456bdac5]{font-size:16px}}.continent-tabs .continent-tab .tab-content[data-v-456bdac5]{flex:1;min-width:0}.continent-tabs .continent-tab .tab-content .tab-name[data-v-456bdac5]{font-size:12px;font-weight:600;color:#f0e6d2;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width:768px){.continent-tabs .continent-tab .tab-content .tab-name[data-v-456bdac5]{font-size:10px}}.continent-tabs .continent-tab .tab-content .tab-progress[data-v-456bdac5]{display:flex;align-items:center;gap:8px}.continent-tabs .continent-tab .tab-content .tab-progress .progress-bar[data-v-456bdac5]{flex:1;height:4px;background:rgba(0,0,0,.3);border-radius:2px;overflow:hidden}.continent-tabs .continent-tab .tab-content .tab-progress .progress-bar .progress-fill[data-v-456bdac5]{height:100%;background:linear-gradient(90deg,#dc2626,#b91c1c);border-radius:2px;transition:width .3s ease}.continent-tabs .continent-tab .tab-content .tab-progress .progress-text[data-v-456bdac5]{font-size:10px;color:#f0e6d2;font-weight:600;min-width:30px;text-align:right}@media (max-width:768px){.continent-tabs .continent-tab .tab-content .tab-progress .progress-text[data-v-456bdac5]{font-size:9px;min-width:25px}}.continent-tabs .continent-tab .conquered-badge[data-v-456bdac5]{position:absolute;top:4px;right:4px;font-size:12px;background:rgba(34,197,94,.2);border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center}@media (max-width:768px){.continent-tabs .continent-tab .conquered-badge[data-v-456bdac5]{font-size:10px;width:16px;height:16px}}.region-tabs[data-v-456bdac5]{margin-bottom:12px;padding:0 20px}@media (max-width:768px){.region-tabs[data-v-456bdac5]{padding:0 8px;margin-bottom:8px}}.region-tabs .tabs-container[data-v-456bdac5]{display:flex;gap:8px;overflow-x:auto;padding:4px 0}@media (max-width:768px){.region-tabs .tabs-container[data-v-456bdac5]{gap:6px;padding:2px 0}}.region-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar{height:4px}.region-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:2px}.region-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-thumb{background:rgba(5,150,105,.5);border-radius:2px}.region-tabs .tabs-container[data-v-456bdac5]::-webkit-scrollbar-thumb:hover{background:rgba(5,150,105,.7)}.region-tabs .region-tab[data-v-456bdac5]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(5,150,105,.3);border-radius:8px;cursor:pointer;transition:all .3s ease;min-width:160px;position:relative;overflow:hidden}@media (max-width:768px){.region-tabs .region-tab[data-v-456bdac5]{min-width:120px;padding:6px 8px;gap:6px}}.region-tabs .region-tab[data-v-456bdac5]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.3);border-color:rgba(5,150,105,.6)}.region-tabs .region-tab.active[data-v-456bdac5]{background:linear-gradient(180deg,#059669,#047857);border-color:rgba(5,150,105,.8);color:#fff;box-shadow:0 4px 12px rgba(5,150,105,.4)}.region-tabs .region-tab.active .tab-name[data-v-456bdac5]{color:#fff;font-weight:700}.region-tabs .region-tab.active .progress-fill[data-v-456bdac5]{background:hsla(0,0%,100%,.8)}.region-tabs .region-tab.conquered[data-v-456bdac5]{border-color:rgba(34,197,94,.6);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(22,163,74,0.2))}.region-tabs .region-tab.conquered .tab-name[data-v-456bdac5]{color:#22c55e}.region-tabs .region-tab.locked[data-v-456bdac5]{opacity:.5;cursor:not-allowed;background:rgba(0,0,0,.3);border-color:rgba(107,114,128,.3)}.region-tabs .region-tab.locked .tab-name[data-v-456bdac5]{color:#6b7280}.region-tabs .region-tab.locked .tab-icon[data-v-456bdac5]{filter:grayscale(100%)}.region-tabs .region-tab .tab-icon[data-v-456bdac5]{font-size:18px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));flex-shrink:0}@media (max-width:768px){.region-tabs .region-tab .tab-icon[data-v-456bdac5]{font-size:14px}}.region-tabs .region-tab .tab-content[data-v-456bdac5]{flex:1;min-width:0}.region-tabs .region-tab .tab-content .tab-name[data-v-456bdac5]{font-size:11px;font-weight:600;color:#f0e6d2;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width:768px){.region-tabs .region-tab .tab-content .tab-name[data-v-456bdac5]{font-size:9px}}.region-tabs .region-tab .tab-content .tab-progress[data-v-456bdac5]{display:flex;align-items:center;gap:8px}.region-tabs .region-tab .tab-content .tab-progress .progress-bar[data-v-456bdac5]{flex:1;height:3px;background:rgba(0,0,0,.3);border-radius:2px;overflow:hidden}.region-tabs .region-tab .tab-content .tab-progress .progress-bar .progress-fill[data-v-456bdac5]{height:100%;background:linear-gradient(90deg,#dc2626,#b91c1c);border-radius:2px;transition:width .3s ease}.region-tabs .region-tab .tab-content .tab-progress .progress-text[data-v-456bdac5]{font-size:9px;color:#f0e6d2;font-weight:600;min-width:25px;text-align:right}@media (max-width:768px){.region-tabs .region-tab .tab-content .tab-progress .progress-text[data-v-456bdac5]{font-size:8px;min-width:20px}}.region-tabs .region-tab .conquered-badge[data-v-456bdac5]{position:absolute;top:4px;right:4px;font-size:10px;background:rgba(34,197,94,.2);border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center}@media (max-width:768px){.region-tabs .region-tab .conquered-badge[data-v-456bdac5]{font-size:8px;width:12px;height:12px}}.explore-filters[data-v-456bdac5]{margin-bottom:8px;padding:0 20px}@media (max-width:768px){.explore-filters[data-v-456bdac5]{padding:0 8px;margin-bottom:6px}}.explore-filters .filter-group[data-v-456bdac5]{display:flex;align-items:center;justify-content:space-between;gap:8px;width:100%}@media (max-width:768px){.explore-filters .filter-group[data-v-456bdac5]{flex-direction:column;align-items:center;gap:4px;justify-content:center}}.explore-filters .filter-group .filter-buttons[data-v-456bdac5]{display:flex;gap:6px;flex-wrap:wrap;flex:1;justify-content:space-between}@media (max-width:768px){.explore-filters .filter-group .filter-buttons[data-v-456bdac5]{width:100%;justify-content:center;flex:none}}.explore-filters .filter-group .filter-buttons .filter-button[data-v-456bdac5]{display:flex;align-items:center;gap:2px;padding:4px 8px;background:rgba(0,0,0,.3);border:1px solid rgba(205,133,63,.3);border-radius:4px;color:#f0e6d2;font-size:10px;font-weight:500;cursor:pointer;transition:all .2s ease;flex:1;justify-content:center}@media (max-width:768px){.explore-filters .filter-group .filter-buttons .filter-button[data-v-456bdac5]{padding:6px 8px;font-size:9px}}.explore-filters .filter-group .filter-buttons .filter-button[data-v-456bdac5]:hover{background:rgba(205,133,63,.2);border-color:rgba(205,133,63,.5);transform:translateY(-1px)}.explore-filters .filter-group .filter-buttons .filter-button.active[data-v-456bdac5]{background:linear-gradient(180deg,#cd853f,#b8860b);border-color:rgba(205,133,63,.8);color:#fff;box-shadow:0 2px 8px rgba(205,133,63,.3)}.explore-filters .filter-group .filter-buttons .filter-button.active[data-v-456bdac5]:hover{background:linear-gradient(180deg,#b8860b,#9a7209);transform:translateY(-1px)}.explore-content .explore-scroll-container[data-v-456bdac5]{height:450px;overflow-y:auto;padding:12px;margin-top:12px;background:linear-gradient(180deg,rgba(40,26,20,0.6),rgba(25,17,14,0.8));border:2px solid rgba(205,133,63,.4);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.3)}@media (max-width:768px){.explore-content .explore-scroll-container[data-v-456bdac5]{height:calc(100vh - 300px);padding:8px;margin-top:8px}}.explore-content .explore-scroll-container[data-v-456bdac5]::-webkit-scrollbar{width:6px}@media (max-width:768px){.explore-content .explore-scroll-container[data-v-456bdac5]::-webkit-scrollbar{width:4px}}.explore-content .explore-scroll-container[data-v-456bdac5]::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:3px}.explore-content .explore-scroll-container[data-v-456bdac5]::-webkit-scrollbar-thumb{background:rgba(205,133,63,.5);border-radius:3px}.explore-content .explore-scroll-container[data-v-456bdac5]::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.7)}.explore-content .explore-grid[data-v-456bdac5]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}@media (max-width:768px){.explore-content .explore-grid[data-v-456bdac5]{grid-template-columns:1fr;gap:8px}}.explore-content .explore-grid .explore-card[data-v-456bdac5]{background:linear-gradient(180deg,rgba(40,26,20,0.8),rgba(25,17,14,0.9));border:1px solid rgba(205,133,63,.3);border-radius:8px;padding:12px;transition:all .2s ease}@media (max-width:768px){.explore-content .explore-grid .explore-card[data-v-456bdac5]{padding:8px;border-radius:6px}}.explore-content .explore-grid .explore-card[data-v-456bdac5]:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.3)}@media (max-width:768px){.explore-content .explore-grid .explore-card[data-v-456bdac5]:hover{transform:none;box-shadow:0 4px 12px rgba(0,0,0,.2)}}.explore-content .explore-grid .explore-card .card-header[data-v-456bdac5]{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header[data-v-456bdac5]{gap:6px;margin-bottom:6px}}.explore-content .explore-grid .explore-card .card-header .explore-icon[data-v-456bdac5]{font-size:24px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));flex-shrink:0}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-icon[data-v-456bdac5]{font-size:20px}}.explore-content .explore-grid .explore-card .card-header .explore-info[data-v-456bdac5]{flex:1}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-name[data-v-456bdac5]{margin:0 0 2px 0;color:#ffe9d2;font-size:14px}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-name[data-v-456bdac5]{font-size:12px}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-description[data-v-456bdac5]{margin:0 0 4px 0;color:#f0e6d2;opacity:.8;font-size:10px;line-height:1.3}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-description[data-v-456bdac5]{font-size:9px;line-height:1.2}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats[data-v-456bdac5]{display:flex;flex-wrap:wrap;gap:4px}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats[data-v-456bdac5]{gap:3px}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty[data-v-456bdac5]{padding:1px 4px;border-radius:3px;font-size:9px;font-weight:600;display:inline-flex;align-items:center;gap:1px;font-family:monospace;letter-spacing:-0.5px}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty[data-v-456bdac5]{padding:1px 3px;font-size:8px;gap:.5px}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-1[data-v-456bdac5],.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-2[data-v-456bdac5]{background:rgba(34,197,94,.2);color:#22c55e}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-3[data-v-456bdac5],.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-4[data-v-456bdac5]{background:rgba(251,191,36,.2);color:#fbbf24}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-5[data-v-456bdac5],.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-6[data-v-456bdac5]{background:rgba(245,158,11,.2);color:#f59e0b}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-7[data-v-456bdac5],.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-8[data-v-456bdac5]{background:rgba(239,68,68,.2);color:#ef4444}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-9[data-v-456bdac5],.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .difficulty.star-10[data-v-456bdac5]{background:rgba(147,51,234,.2);color:#9333ea}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .distance[data-v-456bdac5]{font-size:9px;color:#9ca3af;padding:1px 4px;background:rgba(0,0,0,.2);border-radius:3px}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .distance[data-v-456bdac5]{font-size:8px;padding:1px 3px}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge[data-v-456bdac5]{padding:1px 4px;border-radius:3px;font-size:9px;font-weight:600}@media (max-width:768px){.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge[data-v-456bdac5]{padding:1px 3px;font-size:8px}}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge.unknown[data-v-456bdac5]{background:rgba(107,114,128,.2);color:#6b7280}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge.scouting[data-v-456bdac5]{background:rgba(245,158,11,.2);color:#f59e0b;animation:scoutingPulse-456bdac5 1.5s ease-in-out infinite}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge.scouted[data-v-456bdac5]{background:rgba(59,130,246,.2);color:#3b82f6}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats .status-badge.conquered[data-v-456bdac5]{background:rgba(34,197,94,.2);color:#22c55e}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats.status-conquered[data-v-456bdac5]{border-left:3px solid #22c55e;background:rgba(34,197,94,.05)}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats.status-conquered .location-header .location-name[data-v-456bdac5]{color:#22c55e}.explore-content .explore-grid .explore-card .card-header .explore-info .explore-stats.status-conquered .location-info .status-badge[data-v-456bdac5]{background:rgba(34,197,94,.2);color:#22c55e}.explore-content .explore-grid .explore-card .scout-results[data-v-456bdac5]{margin:12px 0;padding:12px;background:rgba(0,0,0,.3);border-radius:8px;border-left:3px solid rgba(59,130,246,.5)}@media (max-width:768px){.explore-content .explore-grid .explore-card .scout-results[data-v-456bdac5]{margin:8px 0;padding:8px;border-radius:6px}}.explore-content .explore-grid .explore-card .scout-results .scout-details[data-v-456bdac5]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px}@media (max-width:768px){.explore-content .explore-grid .explore-card .scout-results .scout-details[data-v-456bdac5]{grid-template-columns:1fr;gap:4px}}.explore-content .explore-grid .explore-card .scout-results .scout-details .hero-reward[data-v-456bdac5]{display:inline-block;margin:2px 4px 2px 0;padding:2px 6px;background:rgba(255,215,0,.2);border:1px solid rgba(255,215,0,.4);border-radius:4px;color:gold;font-size:12px;font-weight:500}.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item[data-v-456bdac5]{display:flex;justify-content:space-between;padding:2px 0}@media (max-width:768px){.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item[data-v-456bdac5]{padding:1px 0}}.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item .label[data-v-456bdac5]{color:#f0e6d2;opacity:.8;font-size:11px}@media (max-width:768px){.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item .label[data-v-456bdac5]{font-size:10px}}.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item .value[data-v-456bdac5]{color:#ffe9d2;font-weight:600;font-size:11px}@media (max-width:768px){.explore-content .explore-grid .explore-card .scout-results .scout-details .detail-item .value[data-v-456bdac5]{font-size:10px}}.explore-content .explore-grid .explore-card .explore-actions[data-v-456bdac5]{display:flex;justify-content:flex-end;gap:6px}@media (max-width:768px){.explore-content .explore-grid .explore-card .explore-actions[data-v-456bdac5]{flex-direction:column;gap:4px}}.explore-content .explore-grid .explore-card .explore-actions button[data-v-456bdac5]{display:flex;align-items:center;gap:4px;padding:4px 8px;border-radius:4px;cursor:pointer;transition:all .2s ease;font-size:10px;font-weight:600}@media (max-width:768px){.explore-content .explore-grid .explore-card .explore-actions button[data-v-456bdac5]{padding:8px 12px;font-size:12px;width:100%;justify-content:center}}.explore-content .explore-grid .explore-card .explore-actions button .icon[data-v-456bdac5]{font-size:12px}@media (max-width:768px){.explore-content .explore-grid .explore-card .explore-actions button .icon[data-v-456bdac5]{font-size:10px}}.explore-content .explore-grid .explore-card .explore-actions button.scout-button[data-v-456bdac5]{background:linear-gradient(180deg,#3b82f6,#2563eb);border:1px solid rgba(59,130,246,.6);color:#fff}.explore-content .explore-grid .explore-card .explore-actions button.scout-button[data-v-456bdac5]:hover:not(:disabled){background:linear-gradient(180deg,#2563eb,#1d4ed8);transform:translateY(-1px)}.explore-content .explore-grid .explore-card .explore-actions button.scout-button[data-v-456bdac5]:disabled{opacity:.5;cursor:not-allowed}.explore-content .explore-grid .explore-card .explore-actions button.attack-button[data-v-456bdac5]{background:linear-gradient(180deg,#dc2626,#b91c1c);border:1px solid rgba(220,38,38,.6);color:#fff}.explore-content .explore-grid .explore-card .explore-actions button.attack-button[data-v-456bdac5]:hover{background:linear-gradient(180deg,#b91c1c,#991b1b);transform:translateY(-1px)}.explore-content .explore-grid .explore-card .explore-actions button.conquered-button[data-v-456bdac5]{background:linear-gradient(180deg,#22c55e,#16a34a);border:1px solid rgba(34,197,94,.6);color:#fff;cursor:not-allowed;opacity:.8}.battle-modal-overlay[data-v-456bdac5]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000}.battle-modal[data-v-456bdac5]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.4);border-radius:16px;width:95%;height:95%;max-width:1400px;max-height:900px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,.6);animation:modalSlideIn-456bdac5 .3s ease-out}@media (max-width:768px){.battle-modal[data-v-456bdac5]{width:100%;height:100%;border-radius:0;max-width:none;max-height:none}.battle-modal .modal-content[data-v-456bdac5]{height:calc(100% - 5px)}}.battle-modal .modal-header[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(205,133,63,.2);background:rgba(0,0,0,.2)}.battle-modal .modal-header h3[data-v-456bdac5]{margin:0;color:#ffd7a1;font-size:20px;font-weight:700}.battle-modal .close-button[data-v-456bdac5]{background:none;border:none;color:#9ca3af;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease}.battle-modal .close-button[data-v-456bdac5]:hover{background:rgba(239,68,68,.1);color:#ef4444}.battle-modal .modal-content[data-v-456bdac5]{height:calc(100% - 5px);overflow:hidden}.attack-modal-overlay[data-v-456bdac5]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000}.attack-modal-overlay .attack-modal[data-v-456bdac5]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:24px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto}.attack-modal-overlay .attack-modal .modal-header[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.2)}.attack-modal-overlay .attack-modal .modal-header h3[data-v-456bdac5]{margin:0;color:#ffd7a1}.attack-modal-overlay .attack-modal .modal-header .close-button[data-v-456bdac5]{background:none;border:none;color:#f0e6d2;font-size:24px;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease}.attack-modal-overlay .attack-modal .modal-header .close-button[data-v-456bdac5]:hover{background:rgba(205,133,63,.2)}.attack-modal-overlay .attack-modal .modal-content .target-info[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview[data-v-456bdac5]{margin-bottom:20px;padding:16px;background:rgba(0,0,0,.2);border-radius:8px}.attack-modal-overlay .attack-modal .modal-content .target-info h4[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection h4[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview h4[data-v-456bdac5]{margin:0 0 12px 0;color:#ffd7a1}.attack-modal-overlay .attack-modal .modal-content .target-info .info-item[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .target-info .preview-item[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .info-item[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .preview-item[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .info-item[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .preview-item[data-v-456bdac5]{display:flex;justify-content:space-between;padding:4px 0}.attack-modal-overlay .attack-modal .modal-content .target-info .info-item .label[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .target-info .preview-item .label[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .info-item .label[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .preview-item .label[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .info-item .label[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .preview-item .label[data-v-456bdac5]{color:#f0e6d2;opacity:.8}.attack-modal-overlay .attack-modal .modal-content .target-info .info-item .value[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .target-info .preview-item .value[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .info-item .value[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .preview-item .value[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .info-item .value[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .preview-item .value[data-v-456bdac5]{color:#ffe9d2;font-weight:600}.attack-modal-overlay .attack-modal .modal-content .target-info .info-item .value.success[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .target-info .preview-item .value.success[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .info-item .value.success[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .preview-item .value.success[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .info-item .value.success[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .preview-item .value.success[data-v-456bdac5]{color:#22c55e}.attack-modal-overlay .attack-modal .modal-content .target-info .info-item .value.loss[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .target-info .preview-item .value.loss[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .info-item .value.loss[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .goblin-selection .preview-item .value.loss[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .info-item .value.loss[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-content .attack-preview .preview-item .value.loss[data-v-456bdac5]{color:#ef4444}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders[data-v-456bdac5]{display:flex;flex-direction:column;gap:12px}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group[data-v-456bdac5]{display:flex;flex-direction:column;gap:6px}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-header[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-header .goblin-type[data-v-456bdac5]{color:#f0e6d2;font-size:14px;font-weight:600}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-header .goblin-count[data-v-456bdac5]{color:#ffd7a1;font-size:12px;font-weight:600;background:rgba(205,133,63,.2);padding:2px 6px;border-radius:3px}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container[data-v-456bdac5]{position:relative;padding:4px 0}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]{width:100%;height:6px;background:rgba(0,0,0,.3);border-radius:3px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-webkit-slider-thumb{appearance:none;-webkit-appearance:none;width:16px;height:16px;background:linear-gradient(180deg,#cd853f,#b8860b);border-radius:50%;cursor:pointer;border:2px solid hsla(0,0%,100%,.3);box-shadow:0 2px 6px rgba(0,0,0,.3);-webkit-transition:all .2s ease;transition:all .2s ease}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-webkit-slider-thumb:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(205,133,63,.4)}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-moz-range-thumb{width:16px;height:16px;background:linear-gradient(180deg,#cd853f,#b8860b);border-radius:50%;cursor:pointer;border:2px solid hsla(0,0%,100%,.3);box-shadow:0 2px 6px rgba(0,0,0,.3);-moz-transition:all .2s ease;transition:all .2s ease}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-moz-range-thumb:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(205,133,63,.4)}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-webkit-slider-track{background:linear-gradient(90deg,rgba(205,133,63,0.3) 0%,rgba(205,133,63,0.6) 50%,rgba(205,133,63,0.3) 100%);border-radius:4px;height:8px}.attack-modal-overlay .attack-modal .modal-content .goblin-sliders .slider-group .slider-container .goblin-slider[data-v-456bdac5]::-moz-range-track{background:linear-gradient(90deg,rgba(205,133,63,0.3) 0%,rgba(205,133,63,0.6) 50%,rgba(205,133,63,0.3) 100%);border-radius:4px;height:8px;border:none}.attack-modal-overlay .attack-modal .modal-actions[data-v-456bdac5]{display:flex;justify-content:flex-end;gap:12px;margin-top:20px;padding-top:16px;border-top:1px solid rgba(205,133,63,.2)}.attack-modal-overlay .attack-modal .modal-actions .cancel-button[data-v-456bdac5],.attack-modal-overlay .attack-modal .modal-actions .confirm-button[data-v-456bdac5]{padding:8px 16px;border-radius:6px;cursor:pointer;transition:all .2s ease;font-weight:600}.attack-modal-overlay .attack-modal .modal-actions .cancel-button[data-v-456bdac5]{background:rgba(107,114,128,.2);border:1px solid rgba(107,114,128,.3);color:#9ca3af}.attack-modal-overlay .attack-modal .modal-actions .cancel-button[data-v-456bdac5]:hover{background:rgba(107,114,128,.3)}.attack-modal-overlay .attack-modal .modal-actions .confirm-button[data-v-456bdac5]{background:linear-gradient(180deg,#dc2626,#b91c1c);border:1px solid rgba(220,38,38,.6);color:#fff}.attack-modal-overlay .attack-modal .modal-actions .confirm-button[data-v-456bdac5]:hover:not(:disabled){background:linear-gradient(180deg,#b91c1c,#991b1b);transform:translateY(-1px)}.attack-modal-overlay .attack-modal .modal-actions .confirm-button[data-v-456bdac5]:disabled{opacity:.5;cursor:not-allowed}.scout-cooldown[data-v-456bdac5]{margin-top:8px;padding:8px 12px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:6px}.scout-cooldown .cooldown-text[data-v-456bdac5]{color:#ef4444;font-size:12px;font-weight:600}.explore-actions[data-v-456bdac5]{display:flex;gap:12px;align-items:center}@media (max-width:768px){.explore-actions[data-v-456bdac5]{width:100%;justify-content:center;margin-top:8px;flex-direction:column}}.explore-actions .filter-buttons[data-v-456bdac5]{display:flex;gap:8px;flex-wrap:wrap}@media (max-width:768px){.explore-actions .filter-buttons[data-v-456bdac5]{width:100%;justify-content:center;margin-bottom:8px}}.explore-actions .filter-buttons .filter-button[data-v-456bdac5]{display:flex;align-items:center;gap:4px;padding:6px 12px;background:rgba(0,0,0,.3);border:1px solid rgba(205,133,63,.3);border-radius:6px;color:#f0e6d2;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}@media (max-width:768px){.explore-actions .filter-buttons .filter-button[data-v-456bdac5]{padding:8px 12px;font-size:11px;flex:1;justify-content:center}}.explore-actions .filter-buttons .filter-button[data-v-456bdac5]:hover{background:rgba(205,133,63,.2);border-color:rgba(205,133,63,.5);transform:translateY(-1px)}.explore-actions .filter-buttons .filter-button.active[data-v-456bdac5]{background:linear-gradient(180deg,#cd853f,#b8860b);border-color:rgba(205,133,63,.8);color:#fff;box-shadow:0 2px 8px rgba(205,133,63,.3)}.explore-actions .filter-buttons .filter-button.active[data-v-456bdac5]:hover{background:linear-gradient(180deg,#b8860b,#9a7209);transform:translateY(-1px)}.explore-actions .filter-buttons .filter-button .icon[data-v-456bdac5]{font-size:14px}@media (max-width:768px){.explore-actions .filter-buttons .filter-button .icon[data-v-456bdac5]{font-size:12px}}.explore-actions .header-right .scout-team-button[data-v-456bdac5]{display:flex;align-items:center;gap:4px;padding:6px 12px;background:linear-gradient(135deg,rgba(5,150,105,0.2),rgba(5,150,105,0.1)) !important;border:2px solid rgba(5,150,105,.6) !important;border-radius:6px !important;color:#10b981 !important;font-weight:700 !important;font-size:12px;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(5,150,105,.1) !important}@media (max-width:768px){.explore-actions .header-right .scout-team-button[data-v-456bdac5]{padding:4px 8px;gap:3px;font-size:9px;flex-shrink:0}}.explore-actions .header-right .scout-team-button[data-v-456bdac5]:hover:not(:disabled){background:linear-gradient(135deg,rgba(5,150,105,0.4),rgba(5,150,105,0.2)) !important;border-color:rgba(5,150,105,.8) !important;color:#059669 !important;transform:translateY(-2px) !important;box-shadow:0 4px 12px rgba(5,150,105,.3) !important}.explore-actions .header-right .scout-team-button[data-v-456bdac5]:disabled{opacity:.6;cursor:not-allowed;transform:none}.explore-actions .header-right .scout-team-button .icon[data-v-456bdac5]{font-size:14px;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.2))}@media (max-width:768px){.explore-actions .header-right .scout-team-button .icon[data-v-456bdac5]{font-size:10px}}.scout-team-modal-overlay[data-v-456bdac5]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000}.scout-team-modal-overlay .scout-team-modal[data-v-456bdac5]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.4);border-radius:16px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,.6);animation:modalSlideIn-456bdac5 .3s ease-out}@media (max-width:768px){.scout-team-modal-overlay .scout-team-modal[data-v-456bdac5]{width:95%;max-height:90vh;height:710px;border-radius:12px}}.scout-team-modal-overlay .scout-team-modal .modal-header[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(205,133,63,.2)}.scout-team-modal-overlay .scout-team-modal .modal-header h3[data-v-456bdac5]{margin:0;color:#ffd7a1;font-size:20px;font-weight:700}.scout-team-modal-overlay .scout-team-modal .modal-header .close-button[data-v-456bdac5]{background:none;border:none;color:#9ca3af;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease}.scout-team-modal-overlay .scout-team-modal .modal-header .close-button[data-v-456bdac5]:hover{background:rgba(239,68,68,.1);color:#ef4444}.scout-team-modal-overlay .scout-team-modal .modal-content[data-v-456bdac5]{padding:24px}@media (max-width:768px){.scout-team-modal-overlay .scout-team-modal .modal-content[data-v-456bdac5]{padding:16px}}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group[data-v-456bdac5]{margin-bottom:20px}@media (max-width:768px){.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group[data-v-456bdac5]{margin-bottom:16px}}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group label[data-v-456bdac5]{display:block;color:#f0e6d2;font-weight:600;margin-bottom:8px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .radio-group[data-v-456bdac5]{display:flex;gap:16px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .radio-group .radio-item[data-v-456bdac5]{display:flex;align-items:center;gap:8px;cursor:pointer}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .radio-group .radio-item input[type=radio][data-v-456bdac5]{accent-color:#059669}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .radio-group .radio-item span[data-v-456bdac5]{color:#f0e6d2;font-size:14px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group select[data-v-456bdac5],.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group textarea[data-v-456bdac5]{width:100%;padding:8px 12px;background:rgba(0,0,0,.3);border:1px solid rgba(5,150,105,.3);border-radius:6px;color:#f0e6d2;font-size:14px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group select[data-v-456bdac5]:focus,.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group textarea[data-v-456bdac5]:focus{outline:none;border-color:rgba(5,150,105,.6)}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group textarea[data-v-456bdac5]{resize:vertical;min-height:80px;font-family:inherit}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-count-select[data-v-456bdac5]{width:100%;padding:8px 12px;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.3);border-radius:6px;color:#f0e6d2;font-size:14px;cursor:pointer;transition:all .2s ease}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-count-select[data-v-456bdac5]:focus{outline:none;border-color:rgba(205,133,63,.6);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-count-select option[data-v-456bdac5]{background:rgba(40,26,20,.95);color:#f0e6d2}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-location-info[data-v-456bdac5]{margin-bottom:12px;padding:12px;background:rgba(5,150,105,.1);border:1px solid rgba(5,150,105,.3);border-radius:6px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-location-info .location-display[data-v-456bdac5]{display:flex;align-items:center;gap:8px;margin-bottom:6px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-location-info .location-display .location-label[data-v-456bdac5]{color:#f0e6d2;font-size:12px;font-weight:600;opacity:.8}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-location-info .location-display .location-value[data-v-456bdac5]{color:#059669;font-size:12px;font-weight:700}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .option-group .scout-location-info .location-description .description-text[data-v-456bdac5]{color:#f0e6d2;font-size:11px;opacity:.9;line-height:1.4}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info[data-v-456bdac5]{margin-top:20px;padding:16px;background:rgba(5,150,105,.1);border:1px solid rgba(5,150,105,.3);border-radius:8px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info h4[data-v-456bdac5]{margin:0 0 12px 0;color:#059669;font-size:16px;font-weight:600}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info .team-stats[data-v-456bdac5]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info .team-stats .stat-item[data-v-456bdac5]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,0,0,.2);border-radius:6px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info .team-stats .stat-item .label[data-v-456bdac5]{color:#f0e6d2;font-size:12px;opacity:.8;flex:1}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-options .scout-team-info .team-stats .stat-item .value[data-v-456bdac5]{color:#059669;font-weight:600;font-size:12px;text-align:right;flex:1}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result[data-v-456bdac5]{margin-top:20px;padding:16px;background:rgba(0,0,0,.2);border-radius:8px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result h4[data-v-456bdac5]{margin:0 0 12px 0;color:#f0e6d2;font-size:16px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .success-message[data-v-456bdac5]{color:#22c55e}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .success-message .generated-locations[data-v-456bdac5]{margin-top:12px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .success-message .generated-locations h5[data-v-456bdac5]{margin:0 0 8px 0;color:#f0e6d2;font-size:14px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .success-message .generated-locations ul[data-v-456bdac5]{margin:0;padding-left:20px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .success-message .generated-locations ul .location-item[data-v-456bdac5]{color:#f0e6d2;font-size:14px;margin-bottom:4px}.scout-team-modal-overlay .scout-team-modal .modal-content .scout-result .error-message[data-v-456bdac5]{color:#ef4444}.scout-team-modal-overlay .scout-team-modal .modal-actions[data-v-456bdac5]{display:flex;justify-content:flex-end;gap:12px;margin-top:20px;padding:16px 24px;border-top:1px solid rgba(205,133,63,.2)}@media (max-width:768px){.scout-team-modal-overlay .scout-team-modal .modal-actions[data-v-456bdac5]{padding:12px 16px;gap:8px}}.scout-team-modal-overlay .scout-team-modal .modal-actions .cancel-button[data-v-456bdac5],.scout-team-modal-overlay .scout-team-modal .modal-actions .scout-button[data-v-456bdac5]{padding:10px 20px;border-radius:8px;cursor:pointer;transition:all .2s ease;font-weight:600;font-size:14px;border:none}@media (max-width:768px){.scout-team-modal-overlay .scout-team-modal .modal-actions .cancel-button[data-v-456bdac5],.scout-team-modal-overlay .scout-team-modal .modal-actions .scout-button[data-v-456bdac5]{padding:8px 16px;font-size:12px}}.scout-team-modal-overlay .scout-team-modal .modal-actions .cancel-button[data-v-456bdac5]{background:rgba(107,114,128,.2);border:1px solid rgba(107,114,128,.3);color:#9ca3af}.scout-team-modal-overlay .scout-team-modal .modal-actions .cancel-button[data-v-456bdac5]:hover{background:rgba(107,114,128,.3)}.scout-team-modal-overlay .scout-team-modal .modal-actions .scout-button[data-v-456bdac5]{background:linear-gradient(180deg,#059669,#047857);border:1px solid rgba(5,150,105,.6);color:#fff}.scout-team-modal-overlay .scout-team-modal .modal-actions .scout-button[data-v-456bdac5]:hover:not(:disabled){background:linear-gradient(180deg,#047857,#065f46);transform:translateY(-1px);box-shadow:0 4px 12px rgba(5,150,105,.3)}.scout-team-modal-overlay .scout-team-modal .modal-actions .scout-button[data-v-456bdac5]:disabled{opacity:.6;cursor:not-allowed;transform:none}.scout-team-modal-overlay .scout-team-modal .modal-actions .scouting-button[data-v-456bdac5]{background:linear-gradient(180deg,#f59e0b,#d97706);border:1px solid rgba(245,158,11,.6);color:#fff;cursor:not-allowed;position:relative;overflow:hidden}.scout-team-modal-overlay .scout-team-modal .modal-actions .scouting-button .scouting-icon[data-v-456bdac5]{animation:scoutingPulse-456bdac5 1.5s ease-in-out infinite}.scout-team-modal-overlay .scout-team-modal .modal-actions .scouting-button[data-v-456bdac5]::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);animation:scoutingShimmer-456bdac5 2s infinite}@keyframes scoutingPulse-456bdac5{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.8}}@keyframes scoutingShimmer-456bdac5{0%{left:-100%}100%{left:100%}}@keyframes modalSlideIn-456bdac5{from{opacity:0;transform:translateY(-20px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.nest-container[data-v-d4c78e74]{height:710px;width:100%;max-width:100%;padding:16px;background:linear-gradient(180deg,rgba(40,26,20,0.6),rgba(25,17,14,0.85));border:1px solid rgba(205,133,63,.25);border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 8px 18px rgba(0,0,0,.4);display:flex;flex-direction:column;position:relative;box-sizing:border-box;overflow:hidden}.nest-header[data-v-d4c78e74]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.nest-header .nest-title[data-v-d4c78e74]{margin:0;color:#ffd7a1;text-shadow:0 2px 6px rgba(0,0,0,.6),0 0 10px rgba(255,120,40,.2);font-size:20px}.income-summary[data-v-d4c78e74]{display:flex;align-items:center;gap:8px;background:linear-gradient(180deg,rgba(34,197,94,0.15),rgba(28,20,17,0.9));border:1px solid rgba(34,197,94,.3);border-radius:8px;padding:6px 12px}.income-summary .income-item[data-v-d4c78e74]{display:flex;align-items:center;gap:4px}.income-summary .income-item .income-icon[data-v-d4c78e74]{font-size:14px}.income-summary .income-item .income-amount[data-v-d4c78e74]{color:#22c55e;font-size:12px;font-weight:600}.income-summary .income-label[data-v-d4c78e74]{color:#9ca3af;font-size:10px;font-weight:500;margin-left:4px}.building-tabs[data-v-d4c78e74]{display:flex;gap:8px;margin-bottom:16px}.building-tabs .tab-button[data-v-d4c78e74]{background:linear-gradient(180deg,rgba(44,30,24,0.8),rgba(28,20,17,0.9));color:#f0e6d2;border:1px solid rgba(205,133,63,.3);border-radius:8px;padding:8px 16px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s ease;flex:1}.building-tabs .tab-button[data-v-d4c78e74]:hover{background:linear-gradient(180deg,rgba(44,30,24,0.9),rgba(28,20,17,0.95));border-color:rgba(205,133,63,.5);transform:translateY(-1px)}.building-tabs .tab-button.active[data-v-d4c78e74]{background:linear-gradient(180deg,rgba(34,197,94,0.2),rgba(28,20,17,0.9));border-color:rgba(34,197,94,.5);color:#22c55e}.building-content[data-v-d4c78e74]{flex:1;display:flex;flex-direction:column;overflow:hidden}.building-section[data-v-d4c78e74]{flex:1;display:flex;flex-direction:column;overflow:hidden}.building-scroll-container[data-v-d4c78e74]{flex:1;overflow-y:auto;overflow-x:hidden;padding-right:8px}.building-scroll-container[data-v-d4c78e74]::-webkit-scrollbar{width:8px}.building-scroll-container[data-v-d4c78e74]::-webkit-scrollbar-track{background:rgba(44,30,24,.3);border-radius:4px}.building-scroll-container[data-v-d4c78e74]::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(205,133,63,0.6),rgba(139,69,19,0.8));border-radius:4px;-webkit-transition:all .2s ease;transition:all .2s ease}.building-scroll-container[data-v-d4c78e74]::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,rgba(205,133,63,0.8),rgb(139,69,19))}.building-scroll-container[data-v-d4c78e74]{scrollbar-width:thin;scrollbar-color:rgba(205,133,63,.6) rgba(44,30,24,.3)}.building-grid[data-v-d4c78e74]{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;padding:8px;width:100%;min-height:-moz-fit-content;min-height:fit-content}@media (max-width:768px){.building-grid[data-v-d4c78e74]{grid-template-columns:repeat(2,1fr);gap:8px;padding:4px}}.building-slot[data-v-d4c78e74]{aspect-ratio:1;background:linear-gradient(180deg,rgba(44,30,24,0.72),rgba(28,20,17,0.92));border:2px solid rgba(205,133,63,.25);border-radius:8px;padding:8px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 10px rgba(0,0,0,.4);transition:all .3s ease;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;min-width:0;min-height:0}@media (max-width:768px){.building-slot[data-v-d4c78e74]{padding:8px;border-radius:8px}}.building-slot[data-v-d4c78e74]:hover{transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 8px 18px rgba(0,0,0,.5)}.building-slot.occupied[data-v-d4c78e74]{border-color:rgba(34,197,94,.5);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(28,20,17,0.92))}.building-slot.empty[data-v-d4c78e74]{border-color:rgba(107,114,128,.5);background:linear-gradient(180deg,rgba(107,114,128,0.1),rgba(28,20,17,0.92))}.building-slot.locked[data-v-d4c78e74]{border-color:rgba(107,114,128,.3);background:linear-gradient(180deg,rgba(107,114,128,0.05),rgba(28,20,17,0.92));opacity:.6}.building-slot.nextUnlock[data-v-d4c78e74]{border-color:rgba(34,197,94,.5);background:linear-gradient(180deg,rgba(34,197,94,0.1),rgba(28,20,17,0.92))}.building[data-v-d4c78e74]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative}.building .building-icon[data-v-d4c78e74]{font-size:40px;margin-bottom:8px}@media (max-width:768px){.building .building-icon[data-v-d4c78e74]{font-size:24px;margin-bottom:4px}}.building .building-name[data-v-d4c78e74]{color:#ffd7a1;font-weight:700;font-size:16px;text-align:center;line-height:1.2;margin-bottom:4px}@media (max-width:768px){.building .building-name[data-v-d4c78e74]{font-size:12px}}.building .building-income[data-v-d4c78e74]{display:flex;flex-direction:column;align-items:center;gap:2px;margin-bottom:4px}.building .building-income .income-display[data-v-d4c78e74]{display:flex;align-items:center;gap:2px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:4px;padding:2px 4px}.building .building-income .income-display .income-icon[data-v-d4c78e74]{font-size:10px}.building .building-income .income-display .income-text[data-v-d4c78e74]{color:#22c55e;font-size:10px;font-weight:600}.building .remove-button[data-v-d4c78e74]{position:absolute;top:4px;right:4px;width:20px;height:20px;background:linear-gradient(180deg,#dc2626,#b91c1c);color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:12px;font-weight:bold;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.building .remove-button[data-v-d4c78e74]:hover{background:linear-gradient(180deg,#ef4444,#dc2626);transform:scale(1.1)}.building .breeding-status[data-v-d4c78e74]{position:absolute;bottom:4px;left:4px;right:4px;background:rgba(0,0,0,.7);border-radius:4px;padding:2px 4px;font-size:10px}.building .breeding-status .occupied-status[data-v-d4c78e74]{display:flex;flex-direction:column;align-items:center;gap:1px}.building .breeding-status .occupied-status .occupant-name[data-v-d4c78e74]{color:#ffd7a1;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}.building .breeding-status .occupied-status .occupant-status[data-v-d4c78e74]{color:#ff6b6b;font-size:8px}.building .breeding-status .available-status[data-v-d4c78e74]{display:flex;justify-content:center;align-items:center}.building .breeding-status .available-status .available-text[data-v-d4c78e74]{color:#90ee90;font-weight:600;font-size:8px}.empty-slot[data-v-d4c78e74]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.empty-slot .empty-icon[data-v-d4c78e74]{font-size:40px;margin-bottom:8px;opacity:.6}@media (max-width:768px){.empty-slot .empty-icon[data-v-d4c78e74]{font-size:24px;margin-bottom:4px}}.empty-slot .empty-text[data-v-d4c78e74]{color:#9ca3af;font-size:14px}@media (max-width:768px){.empty-slot .empty-text[data-v-d4c78e74]{font-size:10px}}.next-unlock-slot[data-v-d4c78e74]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.next-unlock-slot .expand-icon[data-v-d4c78e74]{font-size:40px;margin-bottom:8px;color:#22c55e;font-weight:bold}@media (max-width:768px){.next-unlock-slot .expand-icon[data-v-d4c78e74]{font-size:24px;margin-bottom:4px}}.next-unlock-slot .expand-text[data-v-d4c78e74]{color:#22c55e;font-size:14px;font-weight:600;margin-bottom:4px}@media (max-width:768px){.next-unlock-slot .expand-text[data-v-d4c78e74]{font-size:10px}}.next-unlock-slot .expand-cost[data-v-d4c78e74]{color:#fbbf24;font-size:12px;font-weight:600}@media (max-width:768px){.next-unlock-slot .expand-cost[data-v-d4c78e74]{font-size:8px}}.locked-slot[data-v-d4c78e74]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.locked-slot .locked-icon[data-v-d4c78e74]{font-size:40px;margin-bottom:8px;color:#6b7280;opacity:.6}@media (max-width:768px){.locked-slot .locked-icon[data-v-d4c78e74]{font-size:24px;margin-bottom:4px}}.locked-slot .locked-text[data-v-d4c78e74]{color:#6b7280;font-size:14px;opacity:.6}@media (max-width:768px){.locked-slot .locked-text[data-v-d4c78e74]{font-size:10px}}.building-menu[data-v-d4c78e74]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:2px solid rgba(205,133,63,.5);border-radius:16px;padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.6);z-index:1000;max-width:500px;width:90%}.building-menu .menu-header[data-v-d4c78e74]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.building-menu .menu-header h4[data-v-d4c78e74]{color:#ffd7a1;margin:0;font-size:18px}.building-menu .menu-header .close-menu[data-v-d4c78e74]{background:none;border:none;color:#f0e6d2;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%}.building-menu .menu-header .close-menu[data-v-d4c78e74]:hover{background:hsla(0,0%,100%,.1)}.building-menu .building-options[data-v-d4c78e74]{display:flex;flex-direction:column;gap:12px}.building-menu .building-option[data-v-d4c78e74]{display:flex;align-items:center;gap:12px;padding:12px;background:linear-gradient(180deg,rgba(44,30,24,0.8),rgba(28,20,17,0.9));border:1px solid rgba(205,133,63,.3);border-radius:10px;cursor:pointer;transition:all .2s ease}.building-menu .building-option[data-v-d4c78e74]:hover:not(.disabled){background:linear-gradient(180deg,rgba(44,30,24,0.9),rgba(28,20,17,0.95));border-color:rgba(205,133,63,.5);transform:translateY(-2px)}.building-menu .building-option.disabled[data-v-d4c78e74]{opacity:.5;cursor:not-allowed}.building-menu .building-option .option-icon[data-v-d4c78e74]{font-size:24px}.building-menu .building-option .option-name[data-v-d4c78e74]{color:#ffd7a1;font-weight:600;font-size:16px;flex:1}.building-menu .building-option .option-cost[data-v-d4c78e74]{color:skyblue;font-size:13px}
.modal-overlay[data-v-d7c2ba76]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:hidden}.character-detail-modal[data-v-d7c2ba76]{max-width:800px;width:90%;max-height:80vh;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;scrollbar-width:thin;scrollbar-color:rgba(205,133,63,.5) rgba(0,0,0,0);will-change:auto;transform:translateZ(0);scrollbar-gutter:stable both-edges}.character-detail-modal[data-v-d7c2ba76]::-webkit-scrollbar{width:8px}.character-detail-modal[data-v-d7c2ba76]::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.character-detail-modal[data-v-d7c2ba76]::-webkit-scrollbar-thumb{background:rgba(205,133,63,.5);border-radius:4px}.character-detail-modal[data-v-d7c2ba76]::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.7)}.character-detail-modal .character-detail-content[data-v-d7c2ba76]{display:flex;flex-direction:column;gap:16px;flex:1;min-height:0;contain:layout}.character-detail-modal .character-detail-content .character-basic-info[data-v-d7c2ba76]{display:flex;flex-direction:row;gap:16px;padding:12px;background:rgba(40,26,20,.4);border-radius:8px;border:1px solid rgba(205,133,63,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar[data-v-d7c2ba76]{flex:0 0 110px;height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0;border-radius:8px;border:2px solid rgba(205,133,63,.3);background:rgba(40,26,20,.2);position:relative}.character-detail-modal .character-detail-content .character-basic-info .character-avatar.rating-s[data-v-d7c2ba76]{border:3px solid rgba(220,20,60,.9);box-shadow:0 0 25px rgba(220,20,60,.6),0 0 50px rgba(220,20,60,.3);animation:sRatingGlow-d7c2ba76 2s ease-in-out infinite alternate}.character-detail-modal .character-detail-content .character-basic-info .character-avatar.rating-a[data-v-d7c2ba76]{border:3px solid rgba(255,215,0,.8);box-shadow:0 0 20px rgba(255,215,0,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar.rating-b[data-v-d7c2ba76]{border:3px solid rgba(192,192,192,.8);box-shadow:0 0 15px rgba(192,192,192,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar.rating-c[data-v-d7c2ba76]{border:3px solid rgba(32,32,32,.8);box-shadow:0 0 10px rgba(64,64,64,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar.rating-d[data-v-d7c2ba76]{border:2px solid rgba(205,133,63,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-container[data-v-d7c2ba76]{width:100%;flex:1;border-radius:6px;overflow:hidden;position:relative;display:flex;flex-direction:column}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-container img[data-v-d7c2ba76]{width:100%;height:100%;object-fit:cover;flex:1}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-container .default-avatar[data-v-d7c2ba76]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(40,26,20,.6);color:peru;flex:1}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-container .default-avatar .avatar-icon[data-v-d7c2ba76]{font-size:32px}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status[data-v-d7c2ba76]{position:absolute;bottom:4px;right:4px;font-size:8px;padding:2px 4px;border-radius:3px;text-align:center;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);z-index:2}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status.imprisoned[data-v-d7c2ba76]{background:rgba(34,197,94,.8);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status.training[data-v-d7c2ba76]{background:rgba(245,158,11,.8);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status.breeding[data-v-d7c2ba76]{background:rgba(168,85,247,.8);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status.surrendered[data-v-d7c2ba76]{background:rgba(236,72,153,.8);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .avatar-status.deployed[data-v-d7c2ba76]{background:rgba(59,130,246,.8);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay[data-v-d7c2ba76]{position:absolute;top:4px;left:4px;font-size:10px;font-weight:700;padding:2px 6px;border-radius:3px;text-align:center;backdrop-filter:blur(2px);box-shadow:0 2px 4px rgba(0,0,0,.3);z-index:3}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay.s[data-v-d7c2ba76]{background:linear-gradient(135deg,#dc143c,#ff4757);color:#fff;box-shadow:0 0 8px rgba(220,20,60,.6);animation:sRatingGlow-d7c2ba76 2s ease-in-out infinite alternate}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay.a[data-v-d7c2ba76]{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;box-shadow:0 0 6px rgba(255,215,0,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay.b[data-v-d7c2ba76]{background:linear-gradient(135deg,#c0c0c0,#e0e0e0);color:#000;box-shadow:0 0 4px rgba(192,192,192,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay.c[data-v-d7c2ba76]{background:linear-gradient(135deg,#202020,#404040);color:#fff;box-shadow:0 0 3px rgba(64,64,64,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .rating-badge-overlay.d[data-v-d7c2ba76]{background:linear-gradient(135deg,#cd853f,#daa520);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .character-level-badge[data-v-d7c2ba76]{position:absolute;top:4px;right:4px;padding:2px 6px;border-radius:3px;font-size:8px;font-weight:600;text-align:center;z-index:3;background:rgba(255,215,0,.9);color:#000;display:flex;align-items:center;gap:2px;box-shadow:0 1px 3px rgba(0,0,0,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .character-level-badge .level-icon[data-v-d7c2ba76]{font-size:7px}.character-detail-modal .character-detail-content .character-basic-info .character-avatar .character-level-badge .level-value[data-v-d7c2ba76]{font-size:8px;font-weight:700}.character-detail-modal .character-detail-content .character-basic-info .character-details[data-v-d7c2ba76]{flex:1;display:flex;flex-direction:column;gap:12px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section h4[data-v-d7c2ba76]{color:#ffd7a1;font-size:14px;margin:0 0 8px 0;font-weight:600}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid[data-v-d7c2ba76]{display:grid;grid-template-columns:1fr 1fr;gap:8px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item[data-v-d7c2ba76]{display:flex;flex-direction:column;gap:2px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-label[data-v-d7c2ba76]{color:peru;font-size:10px;font-weight:600}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value[data-v-d7c2ba76]{color:#f0e6d2;font-size:11px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-s[data-v-d7c2ba76]{color:crimson;text-shadow:0 0 8px rgba(220,20,60,.6)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-a[data-v-d7c2ba76]{color:gold}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-b[data-v-d7c2ba76]{color:silver}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-c[data-v-d7c2ba76]{color:#202020}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-d[data-v-d7c2ba76]{color:peru}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge[data-v-d7c2ba76]{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px;font-weight:600;color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge.s[data-v-d7c2ba76]{background:linear-gradient(135deg,#dc143c,#ff4757);color:#fff;box-shadow:0 0 8px rgba(220,20,60,.6);animation:sRatingGlow-d7c2ba76 2s ease-in-out infinite alternate}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge.a[data-v-d7c2ba76]{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;box-shadow:0 0 6px rgba(255,215,0,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge.b[data-v-d7c2ba76]{background:linear-gradient(135deg,#c0c0c0,#e0e0e0);color:#000;box-shadow:0 0 4px rgba(192,192,192,.4)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge.c[data-v-d7c2ba76]{background:linear-gradient(135deg,#202020,#404040);color:#fff;box-shadow:0 0 3px rgba(64,64,64,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.rating-badge.d[data-v-d7c2ba76]{background:linear-gradient(135deg,#cd853f,#daa520);color:#fff}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge[data-v-d7c2ba76]{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px;font-weight:600}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.imprisoned[data-v-d7c2ba76]{background:rgba(34,197,94,.2);color:#22c55e;border:1px solid rgba(34,197,94,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.training[data-v-d7c2ba76]{background:rgba(245,158,11,.2);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.breeding[data-v-d7c2ba76]{background:rgba(168,85,247,.2);color:#a855f7;border:1px solid rgba(168,85,247,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.surrendered[data-v-d7c2ba76]{background:rgba(236,72,153,.2);color:#ec4899;border:1px solid rgba(236,72,153,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.deployed[data-v-d7c2ba76]{background:rgba(59,130,246,.2);color:#3b82f6;border:1px solid rgba(59,130,246,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value.status-badge.uncaptured[data-v-d7c2ba76]{background:rgba(220,38,38,.2);color:#dc2626;border:1px solid rgba(220,38,38,.3)}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section h4[data-v-d7c2ba76]{color:#ffd7a1;font-size:14px;margin:0 0 8px 0;font-weight:600}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid[data-v-d7c2ba76]{display:grid;grid-template-columns:1fr 1fr;gap:6px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item[data-v-d7c2ba76]{display:flex;flex-direction:column;gap:2px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-label[data-v-d7c2ba76]{color:peru;font-size:10px;font-weight:600}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-value[data-v-d7c2ba76]{color:#f0e6d2;font-size:10px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description[data-v-d7c2ba76]{margin-top:8px;padding-top:8px;border-top:1px solid rgba(205,133,63,.2)}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description .appearance-text[data-v-d7c2ba76]{color:#f0e6d2 !important;font-size:11px !important;line-height:1.6 !important;margin:0 !important;font-style:italic !important;text-align:justify !important;letter-spacing:.5px !important;text-shadow:0 1px 3px rgba(0,0,0,.4) !important;background:linear-gradient(135deg,rgba(240,230,210,0.1),rgba(240,230,210,0.05)) !important;padding:8px 12px !important;border-radius:6px !important;border-left:3px solid rgba(205,133,63,.3) !important;position:relative !important;overflow:hidden !important;display:block !important}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description .appearance-shimmer[data-v-d7c2ba76]{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);animation:textShimmer-d7c2ba76 3s infinite;z-index:2;pointer-events:none}.character-detail-modal .character-detail-content .character-basic-info .character-details .personality-section[data-v-d7c2ba76]{margin-top:8px;padding-top:8px;border-top:1px solid rgba(205,133,63,.2)}.character-detail-modal .character-detail-content .character-basic-info .character-details .personality-section .personality-traits[data-v-d7c2ba76]{display:flex;flex-wrap:wrap;gap:4px;position:relative}.character-detail-modal .character-detail-content .character-basic-info .character-details .personality-section .personality-traits.locked[data-v-d7c2ba76]{filter:blur(2px);opacity:.6}.character-detail-modal .character-detail-content .character-basic-info .character-details .personality-section .personality-traits .personality-trait[data-v-d7c2ba76]{background:rgba(168,85,247,.2);color:#a855f7;border:1px solid rgba(168,85,247,.3);padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600;transition:all .3s ease}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]{flex:1;display:flex;flex-direction:column;gap:12px;overflow:visible;min-height:0;scrollbar-width:thin;scrollbar-color:rgba(205,133,63,.3) rgba(0,0,0,0)}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]::-webkit-scrollbar{width:6px}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]::-webkit-scrollbar-thumb{background:rgba(205,133,63,.3);border-radius:3px}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.5)}.character-detail-modal .character-detail-content .detail-right .detail-stats[data-v-d7c2ba76]{padding:12px;background:rgba(40,26,20,.3);border-radius:6px;border:1px solid rgba(205,133,63,.2)}.character-detail-modal .character-detail-content .detail-right .detail-stats h4[data-v-d7c2ba76]{color:#ffd7a1;font-size:16px;margin:0 0 12px 0;display:flex;align-items:center;gap:6px}.character-detail-modal .character-detail-content .detail-right .detail-stats h4 .section-icon[data-v-d7c2ba76]{font-size:14px;opacity:.8}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail[data-v-d7c2ba76]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-label[data-v-d7c2ba76]{color:#f0e6d2;font-size:12px;min-width:80px;display:flex;align-items:center;gap:4px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-label .stat-icon[data-v-d7c2ba76]{font-size:14px;opacity:.8}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-label .max-corruption-badge[data-v-d7c2ba76]{background:linear-gradient(135deg,#ff6b35,#ff8c42);color:#fff;padding:2px 6px;border-radius:3px;font-size:9px;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.3);box-shadow:0 2px 4px rgba(255,107,53,.4);animation:badgeGlow-d7c2ba76 2s ease-in-out infinite alternate;margin-left:4px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail[data-v-d7c2ba76]{flex:1;height:8px;background:rgba(0,0,0,.4);border-radius:4px;overflow:hidden}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .stat-fill-detail[data-v-d7c2ba76]{height:100%;transition:width .3s ease}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .stat-fill-detail.high[data-v-d7c2ba76]{background:linear-gradient(90deg,#22c55e,#16a34a)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .stat-fill-detail.medium[data-v-d7c2ba76]{background:linear-gradient(90deg,#f59e0b,#d97706)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .stat-fill-detail.low[data-v-d7c2ba76]{background:linear-gradient(90deg,#dc2626,#b91c1c)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail.corruption-bar[data-v-d7c2ba76]{background:rgba(236,72,153,.1);border:1px solid rgba(236,72,153,.2);border-radius:6px;position:relative;overflow:hidden}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail.corruption-bar[data-v-d7c2ba76]::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 30%,rgba(236,72,153,0.1) 50%,transparent 70%);animation:corruptionShimmer-d7c2ba76 3s infinite}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail.corruption-bar.max-corruption[data-v-d7c2ba76]{background:rgba(255,107,53,.2);border:2px solid rgba(255,107,53,.6);box-shadow:0 0 12px rgba(255,107,53,.4)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail.corruption-bar.max-corruption[data-v-d7c2ba76]::before{background:linear-gradient(45deg,transparent 20%,rgba(255,107,53,0.3) 50%,transparent 80%);animation:maxCorruptionShimmer-d7c2ba76 2s infinite}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-fill[data-v-d7c2ba76]{background:linear-gradient(90deg,#ec4899,#be185d,#9d174d);position:relative;overflow:hidden;box-shadow:0 0 8px rgba(236,72,153,.4)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-fill[data-v-d7c2ba76]::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:corruptionGlow-d7c2ba76 2s infinite}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-fill.high[data-v-d7c2ba76]{background:linear-gradient(90deg,#ec4899,#be185d,#9d174d);box-shadow:0 0 12px rgba(236,72,153,.6)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-fill.medium[data-v-d7c2ba76]{background:linear-gradient(90deg,#f472b6,#ec4899,#be185d);box-shadow:0 0 8px rgba(236,72,153,.4)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-fill.low[data-v-d7c2ba76]{background:linear-gradient(90deg,#f9a8d4,#f472b6,#ec4899);box-shadow:0 0 6px rgba(236,72,153,.3)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-value[data-v-d7c2ba76]{color:#ec4899;font-weight:700;text-shadow:0 0 4px rgba(236,72,153,.5)}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-value.max-corruption-text[data-v-d7c2ba76]{color:#ff6b35;text-shadow:0 0 8px rgba(255,107,53,.8);animation:maxCorruptionPulse-d7c2ba76 2s ease-in-out infinite}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-bar-detail .corruption-value .max-corruption-icon[data-v-d7c2ba76]{margin-left:4px;font-size:12px;animation:fireGlow-d7c2ba76 1.5s ease-in-out infinite alternate}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-value-detail[data-v-d7c2ba76]{color:#ffe9d2;font-weight:600;font-size:12px;min-width:40px;text-align:right}.character-detail-modal .character-detail-content .detail-right .breeding-records[data-v-d7c2ba76]{margin-top:15px;padding:10px;background:rgba(139,69,19,.1);border-radius:8px;border:1px solid rgba(139,69,19,.3)}.character-detail-modal .character-detail-content .detail-right .breeding-records h4[data-v-d7c2ba76]{margin:0 0 10px 0;color:#8b4513;font-size:14px;font-weight:bold}.character-detail-modal .character-detail-content .detail-right .breeding-records .breeding-stats[data-v-d7c2ba76]{display:flex;flex-wrap:wrap;gap:8px}.character-detail-modal .character-detail-content .detail-right .breeding-records .breeding-stat[data-v-d7c2ba76]{display:flex;align-items:center;gap:4px;padding:4px 8px;background:rgba(139,69,19,.2);border-radius:4px;font-size:12px}.character-detail-modal .character-detail-content .detail-right .breeding-records .breeding-stat .goblin-type[data-v-d7c2ba76]{color:#8b4513;font-weight:bold}.character-detail-modal .character-detail-content .detail-right .breeding-records .breeding-stat .goblin-count[data-v-d7c2ba76]{color:#d2691e;font-weight:bold}.character-detail-modal .character-detail-content .detail-right .detail-section[data-v-d7c2ba76]{padding:10px;background:rgba(40,26,20,.4);border-radius:6px;border:1px solid rgba(205,133,63,.3);box-shadow:0 1px 4px rgba(0,0,0,.2);transition:all .3s ease;overflow:visible}.character-detail-modal .character-detail-content .detail-right .detail-section.locked[data-v-d7c2ba76]{background:rgba(40,26,20,.2);border:1px solid rgba(100,100,100,.3);opacity:.7;position:relative}.character-detail-modal .character-detail-content .detail-right .detail-section.locked[data-v-d7c2ba76]::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 40%,rgba(100,100,100,0.1) 50%,transparent 60%);animation:lockShimmer-d7c2ba76 2s infinite;pointer-events:none}.character-detail-modal .character-detail-content .detail-right .detail-section.locked h4[data-v-d7c2ba76]{color:#888;position:relative}.character-detail-modal .character-detail-content .detail-right .detail-section.locked h4 .lock-icon[data-v-d7c2ba76]{margin-left:6px;font-size:12px;opacity:.8;animation:lockPulse-d7c2ba76 1.5s infinite}.character-detail-modal .character-detail-content .detail-right .detail-section h4[data-v-d7c2ba76]{color:#ffd7a1;font-size:12px;margin:0 0 6px 0;font-weight:600;display:flex;align-items:center;gap:4px}.character-detail-modal .character-detail-content .detail-right .detail-section h4 .section-icon[data-v-d7c2ba76]{font-size:12px;opacity:.8}.character-detail-modal .character-detail-content .detail-right .detail-section .detail-text[data-v-d7c2ba76]{color:#f0e6d2;font-size:11px;line-height:1.3;margin:0}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits[data-v-d7c2ba76]{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .personality-trait[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .personality-trait[data-v-d7c2ba76]{background:rgba(205,133,63,.2);color:#ffd7a1;padding:3px 6px;border-radius:3px;font-size:10px;border:1px solid rgba(205,133,63,.3)}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details[data-v-d7c2ba76]{display:flex;flex-direction:column;gap:8px;margin-top:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item[data-v-d7c2ba76]{background:rgba(139,69,19,.1);border:1px solid rgba(139,69,19,.3);border-radius:6px;padding:8px;transition:all .2s ease}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item[data-v-d7c2ba76]:hover{background:rgba(139,69,19,.15);border-color:rgba(139,69,19,.4)}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header[data-v-d7c2ba76]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-part[data-v-d7c2ba76]{color:#8b4513;font-weight:600;font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-status[data-v-d7c2ba76]{padding:2px 6px;border-radius:3px;font-size:9px;font-weight:600;background:rgba(220,38,38,.2);color:#dc2626;border:1px solid rgba(220,38,38,.3)}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-status.active[data-v-d7c2ba76]{background:rgba(34,197,94,.2);color:#22c55e;border-color:rgba(34,197,94,.3)}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-description[data-v-d7c2ba76]{color:#f0e6d2;font-size:10px;line-height:1.3;margin:0;font-style:italic}.character-detail-modal .character-detail-content .detail-right .detail-section .life-story-item[data-v-d7c2ba76]{margin-bottom:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .life-story-item strong[data-v-d7c2ba76]{color:peru;font-size:10px}.character-detail-modal .character-detail-content .detail-right .detail-section .life-story-item p[data-v-d7c2ba76]{margin:2px 0 0 0;font-size:10px;line-height:1.2}.character-detail-modal .character-detail-content .detail-right .detail-section .appearance-item[data-v-d7c2ba76]{margin-bottom:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .appearance-item strong[data-v-d7c2ba76]{color:peru;font-size:10px}.character-detail-modal .character-detail-content .detail-right .detail-section .appearance-item p[data-v-d7c2ba76]{margin:2px 0 0 0;font-size:10px;line-height:1.2}.character-detail-modal .character-detail-content .detail-right .detail-section .other-info-item[data-v-d7c2ba76]{margin-bottom:4px}.character-detail-modal .character-detail-content .detail-right .detail-section .other-info-item strong[data-v-d7c2ba76]{color:peru;font-size:10px}.character-detail-modal .character-detail-content .detail-right .detail-section .other-info-item .detail-text[data-v-d7c2ba76]{font-size:10px;margin-left:4px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .expandable-header[data-v-d7c2ba76]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:all .2s ease;display:flex;align-items:center;justify-content:space-between}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .expandable-header[data-v-d7c2ba76]:hover{color:#ffd7a1}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .expandable-header .expand-icon[data-v-d7c2ba76]{font-size:10px;transition:transform .2s ease;opacity:.7}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .expandable-header .expand-icon.expanded[data-v-d7c2ba76]{transform:rotate(180deg)}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid[data-v-d7c2ba76]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px;margin-top:8px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item[data-v-d7c2ba76]{display:flex;align-items:center;gap:8px;padding:8px;background:rgba(139,69,19,.1);border:1px solid rgba(139,69,19,.3);border-radius:6px;transition:all .2s ease}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item[data-v-d7c2ba76]:hover{background:rgba(139,69,19,.15);border-color:rgba(139,69,19,.4);transform:translateY(-1px)}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-icon[data-v-d7c2ba76]{font-size:16px;flex-shrink:0;opacity:.8}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-content[data-v-d7c2ba76]{flex:1;min-width:0}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-content .clothing-label[data-v-d7c2ba76]{color:peru;font-size:10px;font-weight:600;margin-bottom:2px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-content .clothing-text[data-v-d7c2ba76]{color:#f0e6d2;font-size:10px;line-height:1.2;word-break:break-word}.character-detail-modal .character-detail-content .detail-right .detail-section .locked-content .lock-message[data-v-d7c2ba76]{display:flex;align-items:center;gap:8px;padding:12px;background:rgba(100,100,100,.1);border:1px dashed rgba(100,100,100,.3);border-radius:6px;text-align:center;margin-top:8px}.character-detail-modal .character-detail-content .detail-right .detail-section .locked-content .lock-message .lock-icon[data-v-d7c2ba76]{font-size:16px;opacity:.6;animation:lockPulse-d7c2ba76 1.5s infinite}.character-detail-modal .character-detail-content .detail-right .detail-section .locked-content .lock-message p[data-v-d7c2ba76]{color:#888;font-size:11px;margin:0;font-style:italic}.modal-content[data-v-d7c2ba76]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:20px;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,.5)}.modal-content .modal-header[data-v-d7c2ba76]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.2);position:relative}.modal-content .modal-header .header-left[data-v-d7c2ba76]{flex:1}.modal-content .modal-header .character-title[data-v-d7c2ba76]{margin:0;color:#ffd7a1;font-size:24px;font-weight:700;text-align:center;flex:2;text-shadow:0 0 10px rgba(255,215,161,.5),0 0 20px rgba(255,215,161,.3),0 0 30px rgba(255,215,161,.1);background:linear-gradient(45deg,#ffd7a1,#ffed4e,#ffd7a1);background-size:200% 200%;background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);animation:titleGlow-d7c2ba76 3s ease-in-out infinite;letter-spacing:1px}.modal-content .modal-header .header-right[data-v-d7c2ba76]{display:flex;align-items:center;gap:8px;flex:1;justify-content:flex-end}.modal-content .modal-header .edit-avatar-btn[data-v-d7c2ba76]{background:linear-gradient(135deg,rgba(205,133,63,0.2),rgba(139,69,19,0.3));border:1px solid rgba(205,133,63,.4);color:#ffd7a1;border-radius:6px;padding:6px 8px;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:all .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.2)}.modal-content .modal-header .edit-avatar-btn[data-v-d7c2ba76]:hover{background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(139,69,19,0.4));border-color:rgba(205,133,63,.6);transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.3)}.modal-content .modal-header .edit-avatar-btn .btn-icon[data-v-d7c2ba76]{font-size:12px;opacity:.9}.modal-content .modal-header .close-btn[data-v-d7c2ba76]{background:none;border:none;color:#f0e6d2;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}.modal-content .modal-header .close-btn[data-v-d7c2ba76]:hover{color:#ffd7a1}.action-btn[data-v-d7c2ba76]{background:linear-gradient(180deg,#3a2a22,#2a201c);color:#ffe9d2;border:1px solid rgba(205,133,63,.35);border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;box-shadow:0 4px 8px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,220,180,.08);transition:transform .15s ease,box-shadow .15s ease,filter .15s ease}.action-btn[data-v-d7c2ba76]:hover:not(:disabled){filter:brightness(1.08);transform:translateY(-1px);box-shadow:0 6px 12px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,220,180,.12)}.action-btn[data-v-d7c2ba76]:disabled{opacity:.5;cursor:not-allowed}.action-btn.primary[data-v-d7c2ba76]{background:linear-gradient(180deg,#8a3c2c,#65261c);border-color:rgba(255,120,60,.5);box-shadow:0 6px 12px rgba(110,30,15,.35),inset 0 1px 0 rgba(255,200,150,.12)}.action-btn.danger[data-v-d7c2ba76]{background:linear-gradient(180deg,#6d2c2c,#4a1f1f);border-color:rgba(255,80,80,.4);box-shadow:0 6px 12px rgba(80,20,20,.35),inset 0 1px 0 rgba(255,150,150,.08)}@keyframes sRatingGlow-d7c2ba76{0%{box-shadow:inset 0 1px 0 rgba(255,100,100,.2),0 0 10px rgba(220,20,60,.6),0 0 10px rgba(220,20,60,.3),0 4px 12px rgba(0,0,0,.4)}10%{box-shadow:inset 0 1px 0 rgba(255,100,100,.3),0 0 10px rgba(220,20,60,.8),0 0 10px rgba(220,20,60,.5),0 4px 12px rgba(0,0,0,.4)}}@keyframes lockPulse-d7c2ba76{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}}@keyframes lockShimmer-d7c2ba76{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}@keyframes corruptionShimmer-d7c2ba76{0%{transform:translateX(-100%);opacity:0}50%{opacity:1}100%{transform:translateX(100%);opacity:0}}@keyframes corruptionGlow-d7c2ba76{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}@keyframes textShimmer-d7c2ba76{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}@keyframes titleGlow-d7c2ba76{0%{background-position:0% 50%;text-shadow:0 0 10px rgba(255,215,161,.5),0 0 20px rgba(255,215,161,.3),0 0 30px rgba(255,215,161,.1)}50%{background-position:100% 50%;text-shadow:0 0 15px rgba(255,215,161,.7),0 0 25px rgba(255,215,161,.5),0 0 35px rgba(255,215,161,.3)}100%{background-position:0% 50%;text-shadow:0 0 10px rgba(255,215,161,.5),0 0 20px rgba(255,215,161,.3),0 0 30px rgba(255,215,161,.1)}}@keyframes maxCorruptionPulse-d7c2ba76{0%,100%{color:#ff6b35;text-shadow:0 0 8px rgba(255,107,53,.8)}50%{color:#ff8c42;text-shadow:0 0 12px #ff8c42}}@keyframes fireGlow-d7c2ba76{0%{filter:brightness(1);transform:scale(1)}100%{filter:brightness(1.3);transform:scale(1.1)}}@keyframes badgeGlow-d7c2ba76{0%{box-shadow:0 2px 4px rgba(255,107,53,.4);background:linear-gradient(135deg,#ff6b35,#ff8c42)}100%{box-shadow:0 4px 8px rgba(255,107,53,.6);background:linear-gradient(135deg,#ff8c42,#ffa726)}}@keyframes maxCorruptionShimmer-d7c2ba76{0%{transform:translateX(-100%);opacity:0}50%{opacity:1}100%{transform:translateX(100%);opacity:0}}@media (max-width:768px){.character-detail-modal[data-v-d7c2ba76]{max-width:95%;width:95%;max-height:90vh}.character-detail-modal .character-detail-content[data-v-d7c2ba76]{flex-direction:column;gap:12px;flex:1;min-height:0}.character-detail-modal .character-detail-content .character-basic-info[data-v-d7c2ba76]{flex-direction:row;gap:8px;padding:8px}.character-detail-modal .character-detail-content .character-basic-info .character-avatar[data-v-d7c2ba76]{flex:0 0 100px;height:auto;min-height:240px;max-width:100px;display:flex;flex-direction:column}.character-detail-modal .character-detail-content .character-basic-info .character-details[data-v-d7c2ba76]{flex:1;min-width:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid[data-v-d7c2ba76]{grid-template-columns:1fr;gap:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item[data-v-d7c2ba76]{display:flex;flex-direction:row;align-items:center;gap:4px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-label[data-v-d7c2ba76]{font-size:10px;min-width:35px;flex-shrink:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value[data-v-d7c2ba76]{font-size:11px;flex:1;word-break:break-all}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid[data-v-d7c2ba76]{grid-template-columns:1fr;gap:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item[data-v-d7c2ba76]{display:flex;flex-direction:row;align-items:center;gap:4px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-label[data-v-d7c2ba76]{font-size:10px;min-width:35px;flex-shrink:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-value[data-v-d7c2ba76]{font-size:11px;flex:1;word-break:break-all}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description[data-v-d7c2ba76]{margin-top:6px;padding-top:6px;border-top:1px solid rgba(205,133,63,.2)}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description .detail-text[data-v-d7c2ba76]{font-size:10px;line-height:1.3;word-break:break-word}.character-detail-modal .character-detail-content .detail-right[data-v-d7c2ba76]{flex:1;min-height:0}.character-detail-modal .character-detail-content .detail-right .detail-stats[data-v-d7c2ba76]{padding:8px}.character-detail-modal .character-detail-content .detail-right .detail-stats h4[data-v-d7c2ba76]{font-size:14px;margin-bottom:8px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail[data-v-d7c2ba76]{margin-bottom:6px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-label[data-v-d7c2ba76]{font-size:11px;min-width:70px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-value-detail[data-v-d7c2ba76]{font-size:11px;min-width:35px}.character-detail-modal .character-detail-content .detail-right .detail-section[data-v-d7c2ba76]{padding:8px}.character-detail-modal .character-detail-content .detail-right .detail-section h4[data-v-d7c2ba76]{font-size:13px;margin-bottom:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .detail-text[data-v-d7c2ba76]{font-size:12px;line-height:1.4}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits[data-v-d7c2ba76]{gap:3px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .personality-trait[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .personality-trait[data-v-d7c2ba76]{font-size:11px;padding:2px 5px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item[data-v-d7c2ba76]{padding:6px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-part[data-v-d7c2ba76]{font-size:12px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-status[data-v-d7c2ba76]{font-size:10px;padding:1px 4px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-description[data-v-d7c2ba76]{font-size:11px;line-height:1.3}.character-detail-modal .character-detail-content .detail-right .detail-section .life-story-item strong[data-v-d7c2ba76]{font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section .life-story-item p[data-v-d7c2ba76]{font-size:11px;line-height:1.3}.character-detail-modal .character-detail-content .detail-right .detail-section .appearance-item strong[data-v-d7c2ba76]{font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section .appearance-item p[data-v-d7c2ba76]{font-size:11px;line-height:1.3}.character-detail-modal .character-detail-content .detail-right .detail-section .other-info-item strong[data-v-d7c2ba76]{font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section .other-info-item .detail-text[data-v-d7c2ba76]{font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .expandable-header .expand-icon[data-v-d7c2ba76]{font-size:9px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid[data-v-d7c2ba76]{grid-template-columns:repeat(2,1fr);gap:6px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item[data-v-d7c2ba76]{padding:6px;gap:6px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-icon[data-v-d7c2ba76]{font-size:14px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-content .clothing-label[data-v-d7c2ba76]{font-size:11px}.character-detail-modal .character-detail-content .detail-right .detail-section.clothing-section .clothing-grid .clothing-item .clothing-content .clothing-text[data-v-d7c2ba76]{font-size:11px}}@media (max-width:480px){.character-detail-modal[data-v-d7c2ba76]{max-width:98%;width:98%;padding:10px}.character-detail-modal .modal-header[data-v-d7c2ba76]{margin-bottom:10px;padding-bottom:6px}.character-detail-modal .modal-header .character-title[data-v-d7c2ba76]{font-size:18px}.character-detail-modal .modal-header .edit-avatar-btn[data-v-d7c2ba76]{padding:4px 6px;font-size:12px}.character-detail-modal .modal-header .edit-avatar-btn .btn-icon[data-v-d7c2ba76]{font-size:10px}.character-detail-modal .modal-header .close-btn[data-v-d7c2ba76]{font-size:16px;width:18px;height:18px}.character-detail-modal .character-detail-content .character-basic-info[data-v-d7c2ba76]{flex-direction:row;gap:6px;padding:6px}.character-detail-modal .character-detail-content .character-basic-info .character-avatar[data-v-d7c2ba76]{flex:0 0 80px;height:auto;min-height:200px;max-width:80px;display:flex;flex-direction:column}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid[data-v-d7c2ba76]{gap:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-label[data-v-d7c2ba76]{font-size:9px;min-width:30px}.character-detail-modal .character-detail-content .character-basic-info .character-details .basic-info-section .info-grid .info-item .info-value[data-v-d7c2ba76]{font-size:10px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid[data-v-d7c2ba76]{gap:0}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-label[data-v-d7c2ba76]{font-size:9px;min-width:30px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-grid .appearance-item .appearance-value[data-v-d7c2ba76]{font-size:10px}.character-detail-modal .character-detail-content .character-basic-info .character-details .appearance-info-section .appearance-description .detail-text[data-v-d7c2ba76]{font-size:9px;line-height:1.2}.character-detail-modal .character-detail-content .detail-right .detail-stats[data-v-d7c2ba76]{padding:6px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-label[data-v-d7c2ba76]{font-size:9px;min-width:50px}.character-detail-modal .character-detail-content .detail-right .detail-stats .stat-detail .stat-value-detail[data-v-d7c2ba76]{font-size:9px;min-width:25px}.character-detail-modal .character-detail-content .detail-right .detail-section[data-v-d7c2ba76]{padding:6px}.character-detail-modal .character-detail-content .detail-right .detail-section h4[data-v-d7c2ba76]{font-size:11px;margin-bottom:4px}.character-detail-modal .character-detail-content .detail-right .detail-section .detail-text[data-v-d7c2ba76]{font-size:10px;line-height:1.3}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits[data-v-d7c2ba76]{gap:2px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-points .personality-trait[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .sensitive-point[data-v-d7c2ba76],.character-detail-modal .character-detail-content .detail-right .detail-section .personality-traits .personality-trait[data-v-d7c2ba76]{font-size:9px;padding:1px 3px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item[data-v-d7c2ba76]{padding:4px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-part[data-v-d7c2ba76]{font-size:10px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-detail-header .sensitive-status[data-v-d7c2ba76]{font-size:8px;padding:1px 3px}.character-detail-modal .character-detail-content .detail-right .detail-section .sensitive-details .sensitive-detail-item .sensitive-description[data-v-d7c2ba76]{font-size:9px;line-height:1.2}}
.manual-training-container{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 20% 10%,rgba(255,255,255,0.06),transparent 40%),radial-gradient(circle at 80% 90%,rgba(255,255,255,0.05),transparent 40%),linear-gradient(135deg,rgba(0,0,0,0.9),rgba(20,10,5,0.86));z-index:1000;padding:24px}@media (max-width:768px){.manual-training-container{padding:8px;align-items:stretch}}.book-panel{width:min(1200px,95vw);height:min(92vh,1000px);display:flex;flex-direction:column;border-radius:16px;border:2px solid rgba(205,133,63,.35);box-shadow:0 12px 36px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,200,150,.12);background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="%23cd8533" fill-opacity="0.08" d="M0 19h2v1H0zm18 0h2v1h-2zM0 0h1v2H0zm19 0h1v2h-1z"/></svg>') repeat,linear-gradient(180deg,rgba(40,26,20,0.96),rgba(26,19,19,0.95));overflow:hidden}@media (max-width:768px){.book-panel{width:100%;height:100%;border-radius:8px;border-width:1px}}.manual-training-container .training-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border-bottom:3px solid rgba(205,133,63,.4);box-shadow:0 4px 12px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,200,150,.1);position:relative}.manual-training-container .training-header::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(255,215,0,0.6),transparent)}.manual-training-container .character-info{display:flex;align-items:center;gap:8px;flex:1}.manual-training-container .character-portrait{width:100px;height:100px;border-radius:50%;overflow:hidden;border:4px solid rgba(205,133,63,.7);box-shadow:0 6px 20px rgba(0,0,0,.4),0 0 0 2px rgba(255,200,150,.1),inset 0 2px 4px rgba(255,200,150,.15);transition:all .3s cubic-bezier(0.4,0,0.2,1);position:relative}.manual-training-container .character-portrait::before{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;border-radius:50%;background:linear-gradient(45deg,rgba(255,215,0,0.3),rgba(205,133,63,0.3),rgba(255,120,60,0.3));z-index:-1;opacity:0;transition:opacity .3s ease}.manual-training-container .character-portrait:hover{transform:scale(1.08) translateY(-2px);border-color:rgba(255,215,0,.8);box-shadow:0 10px 30px rgba(0,0,0,.5),0 0 0 3px rgba(255,215,0,.2),inset 0 2px 4px rgba(255,200,150,.25)}.manual-training-container .character-portrait:hover::before{opacity:1}.manual-training-container .character-portrait .portrait-image{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.manual-training-container .character-portrait .portrait-placeholder{width:100%;height:100%;background:linear-gradient(135deg,#8a3c2c,#65261c);display:flex;align-items:center;justify-content:center}.manual-training-container .character-portrait .portrait-placeholder .portrait-icon{font-size:36px;color:#ffd7a1}.manual-training-container .character-details{flex:1;margin-left:8px}.manual-training-container .character-details .character-name-section{margin-bottom:16px}.manual-training-container .character-details .character-name-section .character-name{color:#ffd7a1;font-size:28px;font-weight:800;margin:0 0 4px 0;text-shadow:0 2px 8px rgba(0,0,0,.6);letter-spacing:.5px}.manual-training-container .character-details .character-name-section .character-title{color:rgba(240,230,210,.8);font-size:14px;font-style:italic;opacity:.9;margin:0}.manual-training-container .character-details .character-stats{display:flex;flex-direction:column;gap:12px}.manual-training-container .character-details .character-stats .stat-item{display:flex;flex-direction:column;gap:6px}.manual-training-container .character-details .character-stats .stat-item .stat-header{display:flex;justify-content:space-between;align-items:center}.manual-training-container .character-details .character-stats .stat-item .stat-header .stat-label{color:#f0e6d2;font-size:14px;font-weight:600;opacity:.9}.manual-training-container .character-details .character-stats .stat-item .stat-header .stat-value{color:#ffd7a1;font-weight:700;font-size:14px;text-shadow:0 1px 3px rgba(0,0,0,.5)}.manual-training-container .character-details .character-stats .stat-item .stat-bar{width:100%;height:8px;background:rgba(0,0,0,.3);border-radius:4px;overflow:hidden;border:1px solid rgba(205,133,63,.2);box-shadow:inset 0 1px 2px rgba(0,0,0,.3)}.manual-training-container .character-details .character-stats .stat-item .stat-bar .stat-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}.manual-training-container .character-details .character-stats .stat-item .stat-bar .stat-fill::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 2s infinite}.manual-training-container .character-details .character-stats .stat-item .stat-bar .loyalty-fill{background:linear-gradient(90deg,#ff6b6b,#ff8e53,#ffa726);box-shadow:0 0 8px rgba(255,107,107,.4)}.manual-training-container .character-details .character-stats .stat-item .stat-bar .stamina-fill{background:linear-gradient(90deg,#4ecdc4,#44a08d,#2c5530);box-shadow:0 0 8px rgba(78,205,196,.4)}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.manual-training-container .header-buttons{display:flex;gap:8px;align-items:center;justify-content:center}.manual-training-container .header-btn{background:linear-gradient(135deg,#8a3c2c,#65261c);border:2px solid rgba(255,120,60,.5);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.3)}.manual-training-container .header-btn .btn-icon{color:#ffd7a1;font-size:16px;font-weight:bold}.book-shell{flex:1;display:flex;flex-direction:column;margin:8px 12px;min-height:0}.book-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;gap:12px}.nav-btn{background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);color:#ffe9d2;border-radius:6px;padding:6px 10px;cursor:pointer}.nav-info{color:#ffd7a1;font-weight:700}.book-viewport{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;border-radius:12px;border:2px solid rgba(205,133,63,.3);background:#1b120f;box-shadow:0 8px 24px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,200,150,.1)}.page{height:auto;overflow:visible;padding:24px;background:radial-gradient(ellipse at top,rgba(255,255,255,0.03),transparent 60%),linear-gradient(90deg,rgba(0,0,0,0.15) 0 1px,transparent 1px) repeat-x;background-size:100% 100%,24px 100%}@media (max-width:768px){.page{padding:12px}}.page-inner{max-width:820px;margin:0 auto;background:hsla(0,0%,100%,.02);border-radius:8px;padding:16px 20px}@media (max-width:768px){.page-inner{padding:12px;max-width:100%}}.page-content.typo-book{color:#f7efd9;font-family:"Georgia","Times New Roman",serif;font-size:18px;line-height:1.85;letter-spacing:.3px;text-rendering:optimizeLegibility}@media (max-width:768px){.page-content.typo-book{font-size:16px;line-height:1.75;letter-spacing:.2px}}.page-content.typo-book p{text-indent:2em;margin:0 0 12px 0;position:relative;padding-bottom:8px;border-bottom:1px dashed rgba(205,133,63,.15)}.page-content.typo-book em,.page-content.typo-book .italic-text{-webkit-text-decoration:underline dotted rgba(255,215,161,.5);text-decoration:underline dotted rgba(255,215,161,.5);text-underline-offset:2px}.page-content.typo-book .strong-text{-webkit-text-decoration:underline solid rgba(255,215,161,.35);text-decoration:underline solid rgba(255,215,161,.35);text-underline-offset:3px}.page-content.typo-book .quote{border-left-color:rgba(255,215,161,.45);background:rgba(255,215,161,.08)}.choice-line{margin-top:8px;color:#ffd7a1;font-weight:600}.choice-prefix{color:#ffbd7a;margin-right:6px}.manual-training-container .dialogue-message{margin-bottom:20px}.manual-training-container .message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.manual-training-container .message-sender{color:#ffd7a1;font-weight:700;font-size:16px}.manual-training-container .message-time{color:#f0e6d2;opacity:.8;font-size:13px}.manual-training-container .message-actions{display:flex;gap:4px;opacity:0;transition:opacity .3s ease}.manual-training-container .dialogue-message:hover .message-actions{opacity:1}.manual-training-container .message-body{color:#fff;line-height:1.7;padding:16px 20px;background:linear-gradient(135deg,rgba(34,19,13,0.8),rgba(44,29,18,0.6));border-radius:12px;border-left:5px solid rgba(205,133,63,.6)}.initial-state{margin-top:40px;text-align:center;font-family:"Georgia","Times New Roman",serif}.initial-welcome{margin-bottom:30px;padding:24px;background:radial-gradient(ellipse at center,rgba(205,133,63,0.08),transparent 70%);border-radius:12px}.welcome-text{color:#ffd7a1;font-size:22px;font-weight:600;margin:0 0 12px 0;letter-spacing:1px}.welcome-hint{color:rgba(247,239,217,.7);font-size:16px;font-style:italic;margin:0;line-height:1.6}.initial-options{max-width:800px;margin:0 auto;padding:20px;background:rgba(40,26,20,.3);border:1px solid rgba(205,133,63,.25);border-radius:12px}.initial-options .option-choices{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;align-items:center;line-height:2}.initial-options .inline-option{font-size:18px;padding:8px 12px;background:rgba(40,26,20,.5);border-radius:8px;transition:all .3s ease}.initial-options .inline-option:hover:not(.disabled){background:rgba(40,26,20,.8);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.3)}.inline-options{margin-top:24px;padding-top:20px;border-top:1px dashed rgba(205,133,63,.25);font-family:"Georgia","Times New Roman",serif}.option-choices{margin-bottom:16px;line-height:2}.inline-option{display:inline-block;margin:0 6px 8px 0;padding:2px 0;color:#ffd7a1;font-size:17px;cursor:pointer;transition:all .3s ease;position:relative}.inline-option:hover:not(.disabled){color:#ffedcc;transform:translateY(-1px)}.inline-option.disabled{opacity:.5;cursor:not-allowed}.option-bracket{color:rgba(205,133,63,.6);font-weight:600}.option-content{padding:0 4px;text-decoration:underline;text-decoration-style:dotted;text-decoration-color:rgba(205,133,63,.4);text-underline-offset:3px}.inline-option:hover:not(.disabled) .option-content{text-decoration-color:rgba(205,133,63,.8)}.inline-option.custom-option{color:#b8d7ff}.inline-option.custom-option .option-bracket{color:rgba(184,215,255,.6)}.inline-option.custom-option .option-content{text-decoration-color:rgba(184,215,255,.4)}.inline-option.custom-option:hover:not(.disabled){color:#d4e8ff}.inline-option.custom-option:hover:not(.disabled) .option-content{text-decoration-color:rgba(184,215,255,.8)}.custom-input-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000;animation:fadeIn .2s ease;overflow:hidden}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.custom-input-panel{background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border:2px solid rgba(205,133,63,.6);border-radius:12px;width:min(500px,90vw);max-height:480px !important;display:flex;flex-direction:column;box-shadow:0 12px 36px rgba(0,0,0,.5);animation:slideIn .3s ease;overflow:hidden;position:relative;top:-8vh}@keyframes slideIn{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.custom-input-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(205,133,63,.3)}.custom-input-header h3{color:#ffd7a1;font-size:18px;font-weight:700;margin:0}.close-panel-btn{background:rgba(200,60,60,.8);border:1px solid #c83c3c;border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;font-size:14px;transition:all .3s ease}.close-panel-btn:hover{background:#c83c3c}.custom-input-body{padding:20px 20px 0 20px;overflow-y:auto;display:flex;flex-direction:column;flex:1}.custom-input-textarea{width:100%;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:12px;color:#f7efd9;resize:none;font-family:"Georgia","Times New Roman",serif;font-size:16px;line-height:1.5;height:200px;outline:none;transition:all .3s ease}.custom-input-textarea::placeholder{color:rgba(247,239,217,.35);font-style:italic}.custom-input-textarea:focus{border-color:rgba(205,133,63,.8);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.custom-input-textarea:disabled{opacity:.5;cursor:not-allowed}.custom-input-textarea::-webkit-scrollbar{width:8px}.custom-input-textarea::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:4px}.custom-input-textarea::-webkit-scrollbar-thumb{background:rgba(205,133,63,.4);border-radius:4px}.custom-input-textarea::-webkit-scrollbar-thumb:hover{background:rgba(205,133,63,.6)}.custom-input-footer{display:flex;justify-content:center;padding:10px 20px 20px 20px;width:100%;flex-shrink:0}.submit-btn{width:100%;padding:12px 20px;border-radius:6px;border:none;cursor:pointer;font-size:14px;font-weight:600;transition:all .3s ease;background:linear-gradient(135deg,#cd853f,#b8860b);color:#f7efd9;box-shadow:0 2px 8px rgba(205,133,63,.3)}.submit-btn:hover:not(:disabled){background:linear-gradient(135deg,#daa520,#cd853f);box-shadow:0 4px 12px rgba(205,133,63,.4);transform:translateY(-1px)}.submit-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}.manual-training-container .training-input{padding:20px;background:linear-gradient(135deg,rgba(26,19,19,0.95),rgba(34,24,20,0.9));border-top:2px solid rgba(205,133,63,.3)}.manual-training-container .input-controls{display:flex;gap:12px;margin-bottom:12px}.manual-training-container .input-controls textarea{flex:1;background:rgba(40,26,20,.7);border:1px solid rgba(205,133,63,.25);border-radius:8px;padding:12px;color:#ffe9d2;resize:none}.manual-training-container .input-controls .send-btn{background:linear-gradient(180deg,#8a3c2c,#65261c);color:#ffe9d2;border:1px solid rgba(255,120,60,.5);border-radius:8px;padding:12px 20px;cursor:pointer;font-weight:700}.messages-container{padding:16px}.dialogue-message{margin-bottom:16px;border-radius:8px;overflow:hidden;border:1px solid rgba(205,133,63,.2)}.dialogue-message.message-user{background:linear-gradient(135deg,rgba(40,26,20,0.6),rgba(26,19,19,0.8));border-left:4px solid rgba(255,120,60,.6)}.dialogue-message.message-assistant{background:linear-gradient(135deg,rgba(26,19,19,0.6),rgba(40,26,20,0.8));border-left:4px solid rgba(205,133,63,.6)}.dialogue-message.message-system{background:linear-gradient(135deg,rgba(20,20,20,0.6),rgba(30,30,30,0.8));border-left:4px solid rgba(150,150,150,.6)}.message-header{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,0,0,.3);border-bottom:1px solid rgba(205,133,63,.2)}.message-sender{color:#ffd7a1;font-weight:600;font-size:14px}.message-time{color:#f0e6d2;font-size:12px;opacity:.7}.message-actions{display:flex;gap:4px;opacity:0;transition:opacity .3s ease}.dialogue-message:hover .message-actions{opacity:1}.action-btn{background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.action-btn:hover{background:#281a14;border-color:rgba(205,133,63,.6)}.edit-btn:hover{background:rgba(60,100,200,.3)}.delete-btn:hover{background:rgba(200,60,60,.3)}.message-body{padding:12px;color:#f7efd9;line-height:1.6}.edit-mode{display:flex;flex-direction:column;gap:8px}.edit-textarea{width:100%;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:8px;color:#f7efd9;resize:vertical;font-family:inherit;font-size:14px;line-height:1.4}.edit-textarea:focus{outline:none;border-color:rgba(205,133,63,.8);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.edit-actions{display:flex;gap:8px;justify-content:flex-end}.save-btn,.cancel-btn{padding:6px 12px;border-radius:4px;border:1px solid;cursor:pointer;font-size:12px;font-weight:600;transition:all .3s ease}.save-btn{background:rgba(60,100,200,.8);border-color:#3c64c8;color:#fff}.save-btn:hover{background:#3c64c8}.cancel-btn{background:rgba(200,60,60,.8);border-color:#c83c3c;color:#fff}.cancel-btn:hover{background:#c83c3c}.page-content-wrapper{position:relative}.double-quote{color:#ffd7a1;font-weight:600}.single-quote{color:#b8d7ff;font-weight:500}.strong-text{color:#ffbd7a;font-weight:700;text-decoration:underline;text-decoration-color:rgba(255,189,122,.4);text-underline-offset:2px}.italic-text{color:#d4e8ff;font-style:italic;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;text-decoration-color:rgba(212,232,255,.4);text-underline-offset:2px}.code-block{background:rgba(0,0,0,.4);border:1px solid rgba(205,133,63,.3);border-radius:6px;padding:12px;margin:8px 0;font-family:"Courier New",monospace;overflow-x:auto}.code-content{color:#f0e6d2;font-size:14px;line-height:1.4}.inline-code{background:rgba(0,0,0,.3);border:1px solid rgba(205,133,63,.2);border-radius:3px;padding:2px 4px;color:#ffd7a1;font-family:"Courier New",monospace;font-size:13px}.quote{border-left:4px solid rgba(205,133,63,.6);background:rgba(205,133,63,.1);padding:12px 16px;margin:8px 0;border-radius:0 6px 6px 0;color:#f0e6d2;font-style:italic}.message-actions-bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,0,0,.3);border:1px solid rgba(205,133,63,.2);border-radius:6px;margin-bottom:12px}.message-info{display:flex;align-items:center;gap:12px}.message-sender{color:#ffd7a1;font-weight:600;font-size:14px}.message-time{color:#f0e6d2;font-size:12px;opacity:.7}.message-controls{display:flex;gap:4px}.action-btn{background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.action-btn:hover{background:#281a14;border-color:rgba(205,133,63,.6)}.edit-btn:hover{background:rgba(60,100,200,.3)}.delete-btn:hover{background:rgba(200,60,60,.3)}.edit-dialog-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:2000}.edit-dialog{background:linear-gradient(135deg,rgba(40,26,20,0.98),rgba(26,19,19,0.98));border:2px solid rgba(205,133,63,.6);border-radius:12px;width:min(600px,90vw);max-height:80vh;display:flex;flex-direction:column;box-shadow:0 12px 36px rgba(0,0,0,.5)}.edit-dialog-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(205,133,63,.3)}.edit-dialog-header h3{color:#ffd7a1;font-size:18px;font-weight:700;margin:0}.close-dialog-btn{background:rgba(200,60,60,.8);border:1px solid #c83c3c;border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;font-size:14px}.close-dialog-btn:hover{background:#c83c3c}.edit-dialog-body{padding:20px;flex:1;overflow-y:auto}.edit-dialog-body .edit-textarea{width:100%;background:rgba(40,26,20,.8);border:1px solid rgba(205,133,63,.4);border-radius:6px;padding:12px;color:#f7efd9;resize:vertical;font-family:inherit;font-size:14px;line-height:1.5;min-height:200px}.edit-dialog-body .edit-textarea:focus{outline:none;border-color:rgba(205,133,63,.8);box-shadow:0 0 0 2px rgba(205,133,63,.2)}.edit-dialog-footer{display:flex;gap:12px;justify-content:flex-end;padding:16px 20px;border-top:1px solid rgba(205,133,63,.3)}.edit-dialog-footer .save-btn,.edit-dialog-footer .cancel-btn{padding:8px 16px;border-radius:6px;border:1px solid;cursor:pointer;font-size:14px;font-weight:600;transition:all .3s ease}.edit-dialog-footer .save-btn{background:rgba(60,100,200,.8);border-color:#3c64c8;color:#fff}.edit-dialog-footer .save-btn:hover{background:#3c64c8}.edit-dialog-footer .cancel-btn{background:rgba(200,60,60,.8);border-color:#c83c3c;color:#fff}.edit-dialog-footer .cancel-btn:hover{background:#c83c3c}@media (max-width:768px){.manual-training-container .training-header{padding:8px 10px}.manual-training-container .character-portrait{width:80px;height:80px;border-width:3px}.manual-training-container .character-details{margin-left:6px}.manual-training-container .character-details .character-name-section .character-name{font-size:20px}.manual-training-container .character-details .character-name-section .character-title{font-size:12px}.manual-training-container .character-details .character-stats{gap:8px}.manual-training-container .character-details .character-stats .stat-item{gap:4px}.manual-training-container .character-details .character-stats .stat-item .stat-header .stat-label{font-size:12px}.manual-training-container .character-details .character-stats .stat-item .stat-header .stat-value{font-size:12px}.manual-training-container .character-details .character-stats .stat-item .stat-bar{height:6px}.manual-training-container .header-btn{width:32px;height:32px}.manual-training-container .header-btn .btn-icon{font-size:14px}.book-shell{margin:4px 8px}.book-nav{margin-bottom:4px}.nav-btn{padding:4px 8px;font-size:12px}.nav-info{font-size:13px}.inline-option{font-size:15px;margin:0 4px 6px 0}.initial-state{margin-top:20px}.initial-welcome{padding:16px;margin-bottom:20px}.welcome-text{font-size:18px}.welcome-hint{font-size:14px}.initial-options{padding:16px}.initial-options .option-choices{flex-direction:column;align-items:stretch;gap:8px}.initial-options .inline-option{font-size:16px;padding:12px 16px;text-align:center}.message-actions{opacity:1}.message-controls{opacity:1}.inline-option{-webkit-tap-highlight-color:rgba(205,133,63,.2)}.inline-send-btn,.nav-btn,.header-btn{-webkit-tap-highlight-color:rgba(205,133,63,.3)}.custom-input-overlay{background:rgba(0,0,0,.9);align-items:flex-start;padding-top:3vh}.custom-input-panel{width:95vw;height:70vh;max-height:70vh;top:-2vh;position:relative}.custom-input-textarea{font-size:16px;height:300px;resize:none}.custom-input-textarea::-webkit-scrollbar{display:none}.custom-input-textarea{-ms-overflow-style:none;scrollbar-width:none}}
.training-panel[data-v-2091d792]{height:710px;width:100%;max-width:100%;padding:16px;background:linear-gradient(180deg,rgba(40,26,20,0.6),rgba(25,17,14,0.85));border:1px solid rgba(205,133,63,.25);border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 8px 18px rgba(0,0,0,.4);display:flex;flex-direction:column;position:relative;box-sizing:border-box;overflow:hidden}.panel-header[data-v-2091d792]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.2);flex-shrink:0}.panel-header .panel-title[data-v-2091d792]{margin:0;color:#ffd7a1;text-shadow:0 2px 6px rgba(0,0,0,.6),0 0 10px rgba(255,120,40,.2);font-size:18px}.panel-header .batch-buttons[data-v-2091d792]{display:flex;gap:8px;align-items:center}.panel-header .batch-train-btn[data-v-2091d792]{display:flex;align-items:center;gap:6px;background:linear-gradient(180deg,rgba(34,197,94,0.2),rgba(28,20,17,0.9));border:1px solid rgba(34,197,94,.3);border-radius:8px;padding:8px 12px;color:#22c55e;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease}.panel-header .batch-train-btn[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(180deg,rgba(34,197,94,0.3),rgba(28,20,17,0.95));border-color:rgba(34,197,94,.5);transform:translateY(-1px)}.panel-header .batch-train-btn[data-v-2091d792]:disabled{opacity:.5;cursor:not-allowed}.panel-header .batch-train-btn .btn-icon[data-v-2091d792]{font-size:14px}.panel-header .batch-train-btn .btn-text[data-v-2091d792]{font-size:12px}.panel-header .batch-breed-btn[data-v-2091d792]{display:flex;align-items:center;gap:6px;background:linear-gradient(180deg,rgba(168,85,247,0.2),rgba(28,20,17,0.9));border:1px solid rgba(168,85,247,.3);border-radius:8px;padding:8px 12px;color:#a855f7;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease}.panel-header .batch-breed-btn[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(180deg,rgba(168,85,247,0.3),rgba(28,20,17,0.95));border-color:rgba(168,85,247,.5);transform:translateY(-1px)}.panel-header .batch-breed-btn[data-v-2091d792]:disabled{opacity:.5;cursor:not-allowed}.panel-header .batch-breed-btn .btn-icon[data-v-2091d792]{font-size:14px}.panel-header .batch-breed-btn .btn-text[data-v-2091d792]{font-size:12px}.characters-grid[data-v-2091d792]{flex:1;overflow-y:auto;overflow-x:hidden;padding-right:8px;display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:12px;margin-bottom:20px;align-content:start}.characters-grid[data-v-2091d792]::-webkit-scrollbar{width:8px}.characters-grid[data-v-2091d792]::-webkit-scrollbar-track{background:rgba(44,30,24,.3);border-radius:4px}.characters-grid[data-v-2091d792]::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(205,133,63,0.6),rgba(139,69,19,0.8));border-radius:4px;-webkit-transition:all .2s ease;transition:all .2s ease}.characters-grid[data-v-2091d792]::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,rgba(205,133,63,0.8),rgb(139,69,19))}.characters-grid[data-v-2091d792]{scrollbar-width:thin;scrollbar-color:rgba(205,133,63,.6) rgba(44,30,24,.3)}.character-card[data-v-2091d792]{position:relative;background:linear-gradient(180deg,rgba(44,24,24,0.8),rgba(28,20,17,0.95));border:3px solid rgba(205,133,63,.4);border-radius:12px;padding:0;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.4);transition:all .3s ease;cursor:pointer;width:120px;height:240px;display:flex;flex-direction:column;overflow:hidden;flex-shrink:0}.character-card.rating-s[data-v-2091d792]{border:3px solid rgba(220,20,60,.9);box-shadow:inset 0 1px 0 rgba(255,100,100,.2),0 0 25px rgba(220,20,60,.6),0 0 50px rgba(220,20,60,.3),0 4px 12px rgba(0,0,0,.4);animation:sRatingGlow-2091d792 2s ease-in-out infinite alternate}.character-card.rating-a[data-v-2091d792]{border:3px solid rgba(255,215,0,.8);box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 0 20px rgba(255,215,0,.4),0 4px 12px rgba(0,0,0,.4)}.character-card.rating-b[data-v-2091d792]{border:3px solid rgba(192,192,192,.8);box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 0 15px rgba(192,192,192,.4),0 4px 12px rgba(0,0,0,.4)}.character-card.rating-c[data-v-2091d792]{border:3px solid rgba(32,32,32,.8);box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 0 10px rgba(64,64,64,.3),0 4px 12px rgba(0,0,0,.4)}.character-card.rating-d[data-v-2091d792]{border:2px solid rgba(205,133,63,.3);box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 4px 12px rgba(0,0,0,.4)}.character-card[data-v-2091d792]:hover{transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 6px 16px rgba(0,0,0,.5);border-color:rgba(205,133,63,.5)}.character-card.selected[data-v-2091d792]{border-color:rgba(244,184,184,.8);box-shadow:inset 0 1px 0 rgba(255,200,150,.12),0 0 20px rgba(255,120,60,.4)}@keyframes sRatingGlow-2091d792{0%{box-shadow:inset 0 1px 0 rgba(255,100,100,.2),0 0 10px rgba(220,20,60,.6),0 0 10px rgba(220,20,60,.3),0 4px 12px rgba(0,0,0,.4)}10%{box-shadow:inset 0 1px 0 rgba(255,100,100,.3),0 0 10px rgba(220,20,60,.8),0 0 10px rgba(220,20,60,.5),0 4px 12px rgba(0,0,0,.4)}}.character-portrait[data-v-2091d792]{position:relative;width:100%;height:100%;overflow:hidden;z-index:2}.character-portrait img[data-v-2091d792]{width:100%;height:100%;object-fit:cover}.character-portrait .default-portrait[data-v-2091d792]{width:100%;height:100%;background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(255,120,60,0.2));display:flex;align-items:center;justify-content:center}.character-portrait .default-portrait .portrait-icon[data-v-2091d792]{font-size:64px;opacity:.8}.character-status-badge[data-v-2091d792]{position:absolute;top:6px;right:6px;padding:2px 6px;border-radius:3px;font-size:8px;font-weight:600;text-align:center;z-index:3}.character-status-badge.imprisoned[data-v-2091d792]{background:rgba(34,197,94,.8);color:#fff}.character-status-badge.training[data-v-2091d792]{background:rgba(245,158,11,.8);color:#fff}.character-status-badge.breeding[data-v-2091d792]{background:rgba(168,85,247,.8);color:#fff}.character-status-badge.surrendered[data-v-2091d792]{background:rgba(236,72,153,.8);color:#fff}.character-status-badge.deployed[data-v-2091d792]{background:rgba(59,130,246,.8);color:#fff}.character-status-badge .status-icon[data-v-2091d792]{font-size:10px;color:#fff}.character-level-badge[data-v-2091d792]{position:absolute;top:24px;right:6px;padding:2px 6px;border-radius:3px;font-size:8px;font-weight:600;text-align:center;z-index:3;background:rgba(255,215,0,.9);color:#000;display:flex;align-items:center;gap:2px;box-shadow:0 1px 3px rgba(0,0,0,.3)}.character-level-badge .level-icon[data-v-2091d792]{font-size:7px}.character-level-badge .level-value[data-v-2091d792]{font-size:8px;font-weight:700}.character-name[data-v-2091d792]{position:absolute;bottom:8px;left:0;right:0;z-index:3;color:#ffd7a1;font-size:14px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,.9);text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;background:rgba(0,0,0,.6);padding:8px 4px}.favorite-btn-card[data-v-2091d792]{position:absolute;top:6px;left:6px;z-index:4;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);border-radius:50%;transition:all .2s ease}.favorite-btn-card[data-v-2091d792]:hover{background:rgba(0,0,0,.8);transform:scale(1.1)}.favorite-btn-card .favorite-icon[data-v-2091d792]{font-size:14px;color:#ccc;transition:all .2s ease}.favorite-btn-card .favorite-icon.favorited[data-v-2091d792]{color:gold;text-shadow:0 0 8px rgba(255,215,0,.5)}.character-status-bar[data-v-2091d792]{padding:2px 4px;background:#000;z-index:2;position:relative;flex:0 0 auto}.character-status-bar .stat-item[data-v-2091d792]{display:flex;align-items:center;gap:2px;margin-bottom:1px}.character-status-bar .stat-item[data-v-2091d792]:last-child{margin-bottom:0}.character-status-bar .stat-item .stat-icon[data-v-2091d792]{font-size:6px;color:#f0e6d2;width:6px;text-align:center}.character-status-bar .stat-item .stat-bar[data-v-2091d792]{flex:1;height:1px;background:rgba(0,0,0,.4);border-radius:1px;overflow:hidden}.character-status-bar .stat-item .stat-bar .stat-fill[data-v-2091d792]{height:100%;transition:width .3s ease}.character-status-bar .stat-item .stat-bar .stat-fill.high[data-v-2091d792]{background:linear-gradient(90deg,#22c55e,#16a34a)}.character-status-bar .stat-item .stat-bar .stat-fill.medium[data-v-2091d792]{background:linear-gradient(90deg,#f59e0b,#d97706)}.character-status-bar .stat-item .stat-bar .stat-fill.low[data-v-2091d792]{background:linear-gradient(90deg,#dc2626,#b91c1c)}.character-stats-vertical[data-v-2091d792]{display:flex;flex-direction:column;gap:4px;z-index:2;position:relative}.character-stats-vertical .stat-item-vertical[data-v-2091d792]{display:flex;flex-direction:column;align-items:center;gap:2px}.character-stats-vertical .stat-item-vertical .stat-icon[data-v-2091d792]{font-size:8px;color:#f0e6d2}.character-stats-vertical .stat-item-vertical .stat-bar-vertical[data-v-2091d792]{width:8px;height:40px;background:rgba(255,24,24,.4);border-radius:4px;overflow:hidden;position:relative}.character-stats-vertical .stat-item-vertical .stat-bar-vertical .stat-fill-vertical[data-v-2091d792]{position:absolute;bottom:0;left:0;right:0;transition:height .3s ease}.character-stats-vertical .stat-item-vertical .stat-bar-vertical .stat-fill-vertical.high[data-v-2091d792]{background:linear-gradient(180deg,#22c55e,#16a34a)}.character-stats-vertical .stat-item-vertical .stat-bar-vertical .stat-fill-vertical.medium[data-v-2091d792]{background:linear-gradient(180deg,#f59e0b,#d97706)}.character-stats-vertical .stat-item-vertical .stat-bar-vertical .stat-fill-vertical.low[data-v-2091d792]{background:linear-gradient(180deg,#dc2626,#b91c1c)}.character-stats-vertical .stat-item-vertical .stat-value[data-v-2091d792]{color:#ffe9d2;font-weight:600;font-size:8px;text-align:center}.character-actions[data-v-2091d792]{display:flex;gap:4px;flex-wrap:wrap;z-index:2;position:relative;margin-top:auto}.character-actions .action-btn[data-v-2091d792]{flex:1;min-width:50px;font-size:10px;padding:4px 6px}.action-btn[data-v-2091d792]{background:linear-gradient(180deg,#3a2a22,#2a201c);color:#ffe9d2;border:1px solid rgba(205,133,63,.35);border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;box-shadow:0 4px 8px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,220,180,.08);transition:transform .15s ease,box-shadow .15s ease,filter .15s ease}.action-btn[data-v-2091d792]:hover:not(:disabled){filter:brightness(1.08);transform:translateY(-1px);box-shadow:0 6px 12px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,220,180,.12)}.action-btn[data-v-2091d792]:disabled{opacity:.5;cursor:not-allowed}.action-btn.primary[data-v-2091d792]{background:linear-gradient(180deg,#8a3c2c,#65261c);border-color:rgba(255,120,60,.5);box-shadow:0 6px 12px rgba(110,30,15,.35),inset 0 1px 0 rgba(255,200,150,.12)}.action-btn.danger[data-v-2091d792]{background:linear-gradient(180deg,#6d2c2c,#4a1f1f);border-color:rgba(255,80,80,.4);box-shadow:0 6px 12px rgba(80,20,20,.35),inset 0 1px 0 rgba(255,150,150,.08)}.summary-panel[data-v-2091d792]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:16px}.summary-item[data-v-2091d792]{background:linear-gradient(180deg,rgba(44,30,24,0.7),rgba(28,20,17,0.9));border:1px solid rgba(205,133,63,.25);border-radius:10px;padding:12px;text-align:center;box-shadow:inset 0 1px 0 rgba(255,200,150,.08),0 6px 14px rgba(0,0,0,.4)}.summary-item .summary-label[data-v-2091d792]{color:#f0e6d2;opacity:.8;font-size:12px;margin-bottom:4px}.summary-item .summary-value[data-v-2091d792]{color:#ffe9d2;font-weight:700;font-size:18px}.info-actions-panel[data-v-2091d792]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding:12px;background:linear-gradient(180deg,rgba(44,30,24,0.5),rgba(28,20,17,0.7));border:1px solid rgba(205,133,63,.2);border-radius:8px}.stats-info[data-v-2091d792]{display:flex;gap:20px;align-items:center}.stats-item[data-v-2091d792]{display:flex;align-items:center;gap:4px}.stats-item .stats-label[data-v-2091d792]{color:#f0e6d2;font-size:14px;font-weight:600}.stats-item .stats-value[data-v-2091d792]{color:#ffe9d2;font-weight:700;font-size:16px}.batch-action[data-v-2091d792]{display:flex;align-items:center}.icon-btn[data-v-2091d792]{background:linear-gradient(180deg,#3a2a22,#2a201c);color:#ffe9d2;border:1px solid rgba(205,133,63,.35);border-radius:8px;padding:8px;cursor:pointer;font-size:16px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 8px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,220,180,.08);transition:transform .15s ease,box-shadow .15s ease,filter .15s ease}.icon-btn[data-v-2091d792]:hover:not(:disabled){filter:brightness(1.08);transform:translateY(-1px);box-shadow:0 6px 12px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,220,180,.12)}.icon-btn[data-v-2091d792]:disabled{opacity:.5;cursor:not-allowed}.icon-btn .icon[data-v-2091d792]{font-size:18px}.character-wheel-overlay[data-v-2091d792]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}.character-wheel[data-v-2091d792]{position:relative;width:280px;height:280px;animation:wheelSpinIn-2091d792 .4s cubic-bezier(0.68,-0.55,0.265,1.55)}.character-wheel .wheel-center[data-v-2091d792]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:120px;height:120px;background:linear-gradient(135deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:3px solid rgba(205,133,63,.6);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 0 20px rgba(205,133,63,.3),inset 0 2px 4px rgba(255,200,150,.1);z-index:10}.character-wheel .wheel-center .character-avatar[data-v-2091d792]{width:80px;height:80px;border-radius:50%;overflow:hidden;border:3px solid rgba(205,133,63,.6);box-shadow:0 4px 12px rgba(0,0,0,.3)}.character-wheel .wheel-center .character-avatar img[data-v-2091d792]{width:100%;height:100%;object-fit:cover}.character-wheel .wheel-center .character-avatar .default-avatar[data-v-2091d792]{width:100%;height:100%;background:linear-gradient(135deg,rgba(205,133,63,0.3),rgba(255,120,60,0.2));display:flex;align-items:center;justify-content:center}.character-wheel .wheel-center .character-avatar .default-avatar .avatar-icon[data-v-2091d792]{font-size:32px;opacity:.8}.character-wheel .wheel-center .close-wheel-btn[data-v-2091d792]{position:absolute;bottom:150px;left:110%;transform:translateX(-50%);width:24px;height:24px;background:rgba(220,38,38,.9);border:none;border-radius:50%;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.3)}.character-wheel .wheel-center .close-wheel-btn[data-v-2091d792]:hover{background:#dc2626;transform:translateX(-50%) scale(1.1)}.character-wheel .wheel-buttons[data-v-2091d792]{position:relative;width:100%;height:100%}.character-wheel .wheel-buttons .wheel-btn[data-v-2091d792]{position:absolute;width:60px;height:60px;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all .3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 4px 12px rgba(0,0,0,.3);z-index:5}.character-wheel .wheel-buttons .wheel-btn[data-v-2091d792]:hover:not(:disabled){transform:scale(1.15);box-shadow:0 6px 16px rgba(0,0,0,.4)}.character-wheel .wheel-buttons .wheel-btn[data-v-2091d792]:active:not(:disabled){transform:scale(1.05)}.character-wheel .wheel-buttons .wheel-btn[data-v-2091d792]:disabled{opacity:.4;cursor:not-allowed;transform:none}.character-wheel .wheel-buttons .wheel-btn .btn-icon[data-v-2091d792]{font-size:20px;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.5))}.character-wheel .wheel-buttons .wheel-btn.btn-0[data-v-2091d792]{top:calc(50% - 115px);left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#4a90e2,#357abd);border:2px solid rgba(74,144,226,.6)}.character-wheel .wheel-buttons .wheel-btn.btn-0[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#5ba0f2,#4a90e2);border-color:rgba(74,144,226,.8);transform:translateX(-50%) scale(1.15)}.character-wheel .wheel-buttons .wheel-btn.btn-0[data-v-2091d792]:active:not(:disabled){transform:translateX(-50%) scale(1.05)}.character-wheel .wheel-buttons .wheel-btn.btn-1[data-v-2091d792]{top:calc(50% - 70px);right:calc(50% - 105px);background:linear-gradient(135deg,#e91e63,#c2185b);border:2px solid rgba(233,30,99,.6)}.character-wheel .wheel-buttons .wheel-btn.btn-1[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#f06292,#e91e63);border-color:rgba(233,30,99,.8)}.character-wheel .wheel-buttons .wheel-btn.btn-2[data-v-2091d792]{bottom:calc(50% - 90px);right:calc(50% - 90px);background:linear-gradient(135deg,#6d2c2c,#4a1f1f);border:2px solid rgba(255,80,80,.6)}.character-wheel .wheel-buttons .wheel-btn.btn-2[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#7d3c3c,#6d2c2c);border-color:rgba(255,80,80,.8)}.character-wheel .wheel-buttons .wheel-btn.btn-3[data-v-2091d792]{bottom:calc(50% - 90px);left:calc(50% - 90px);background:linear-gradient(135deg,#e91e63,#c2185b);border:2px solid rgba(233,30,99,.6)}.character-wheel .wheel-buttons .wheel-btn.btn-3[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#f06292,#e91e63);border-color:rgba(233,30,99,.8)}.character-wheel .wheel-buttons .wheel-btn.btn-4[data-v-2091d792]{top:calc(50% - 70px);left:calc(50% - 105px);background:linear-gradient(135deg,#8a3c2c,#65261c);border:2px solid rgba(255,120,60,.6)}.character-wheel .wheel-buttons .wheel-btn.btn-4[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#9a4c3c,#8a3c2c);border-color:rgba(255,120,60,.8)}.character-wheel .wheel-buttons .wheel-btn.btn-5[data-v-2091d792]{bottom:calc(50% - 115px);left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ff6b35,#e55a2b);border:2px solid rgba(255,107,53,.6);animation:corruptionPulse-2091d792 2s ease-in-out infinite}.character-wheel .wheel-buttons .wheel-btn.btn-5[data-v-2091d792]:hover:not(:disabled){background:linear-gradient(135deg,#ff7b45,#ff6b35);border-color:rgba(255,107,53,.8);transform:translateX(-50%) scale(1.15);animation:none}.character-wheel .wheel-buttons .wheel-btn.btn-5[data-v-2091d792]:active:not(:disabled){transform:translateX(-50%) scale(1.05)}@keyframes wheelSpinIn-2091d792{0%{opacity:0;transform:scale(0.3) rotate(-180deg)}50%{opacity:.8;transform:scale(1.1) rotate(-90deg)}100%{opacity:1;transform:scale(1) rotate(0deg)}}@keyframes corruptionPulse-2091d792{0%{box-shadow:0 4px 12px rgba(0,0,0,.3),0 0 0 0 rgba(255,107,53,.7)}50%{box-shadow:0 4px 12px rgba(0,0,0,.3),0 0 0 10px rgba(255,107,53,.3)}100%{box-shadow:0 4px 12px rgba(0,0,0,.3),0 0 0 0 rgba(255,107,53,.7)}}.modal-overlay[data-v-2091d792]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-2091d792]{background:linear-gradient(180deg,rgba(40,26,20,0.95),rgba(25,17,14,0.98));border:1px solid rgba(205,133,63,.3);border-radius:12px;padding:20px;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,.5)}.modal-content .modal-header[data-v-2091d792]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid rgba(205,133,63,.2)}.modal-content .modal-header h4[data-v-2091d792]{margin:0;color:#ffd7a1;font-size:16px}.modal-content .modal-header .close-btn[data-v-2091d792]{background:none;border:none;color:#f0e6d2;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}.modal-content .modal-header .close-btn[data-v-2091d792]:hover{color:#ffd7a1}.modal-content .modal-body .avatar-options[data-v-2091d792]{display:flex;flex-direction:column;gap:16px}.modal-content .modal-body .avatar-options .option-group[data-v-2091d792]{display:flex;flex-direction:column;gap:8px}.modal-content .modal-body .avatar-options .option-group label[data-v-2091d792]{color:#f0e6d2;font-weight:600;font-size:14px}.modal-content .modal-body .avatar-options .option-group .url-input-group[data-v-2091d792]{display:flex;flex-direction:column;gap:8px}.modal-content .modal-body .avatar-options .option-group .url-input[data-v-2091d792]{background:rgba(40,26,20,.7);border:1px solid rgba(205,133,63,.25);border-radius:8px;padding:8px 12px;color:#ffe9d2;font-size:14px;width:100%}.modal-content .modal-body .avatar-options .option-group .url-input[data-v-2091d792]:focus{outline:none;border-color:rgba(255,120,60,.5)}.modal-content .modal-body .avatar-options .option-group .url-set-btn[data-v-2091d792]{width:100%;padding:10px 16px;font-size:14px;font-weight:600}.modal-content .modal-body .avatar-options .option-group .file-input[data-v-2091d792]{background:rgba(40,26,20,.7);border:1px solid rgba(205,133,63,.25);border-radius:8px;padding:8px 12px;color:#ffe9d2;font-size:14px}.modal-content .modal-body .avatar-options .option-group .preset-avatars[data-v-2091d792]{display:flex;gap:8px;justify-content:space-evenly;flex-wrap:nowrap}.modal-content .modal-body .avatar-options .option-group .preset-avatars .preset-avatar[data-v-2091d792]{width:40px;height:40px;border:1px solid rgba(205,133,63,.3);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;transition:all .2s ease;background:rgba(40,26,20,.3);flex-shrink:0}.modal-content .modal-body .avatar-options .option-group .preset-avatars .preset-avatar[data-v-2091d792]:hover{border-color:rgba(255,120,60,.6);background:rgba(255,120,60,.1);transform:scale(1.05)}@media (max-width:1024px){.characters-grid[data-v-2091d792]{grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px}.character-card[data-v-2091d792]{width:110px;height:220px}.character-portrait[data-v-2091d792]{height:100%}.character-name[data-v-2091d792]{font-size:12px}}@media (max-width:768px){.characters-grid[data-v-2091d792]{grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px}.character-card[data-v-2091d792]{width:100px;height:200px}.character-portrait[data-v-2091d792]{height:100%}.character-name[data-v-2091d792]{font-size:11px}.character-status-bar[data-v-2091d792]{padding:1px 3px}.character-status-bar .stat-item .stat-icon[data-v-2091d792]{font-size:5px}.character-status-bar .stat-item .stat-bar[data-v-2091d792]{height:1px}.character-detail-modal .character-detail-content[data-v-2091d792]{flex-direction:column;gap:16px}.summary-panel[data-v-2091d792]{grid-template-columns:repeat(2,1fr)}.info-actions-panel[data-v-2091d792]{flex-direction:column;gap:12px;align-items:stretch}.info-actions-panel .stats-info[data-v-2091d792]{justify-content:center;gap:16px}.info-actions-panel .batch-action[data-v-2091d792]{justify-content:center}}@media (max-width:480px){.characters-grid[data-v-2091d792]{grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:6px}.character-card[data-v-2091d792]{width:90px;height:180px}.character-portrait[data-v-2091d792]{height:100%}.character-name[data-v-2091d792]{font-size:10px}.character-status-bar[data-v-2091d792]{padding:1px 2px}.character-status-bar .stat-item .stat-icon[data-v-2091d792]{font-size:4px}.character-status-bar .stat-item .stat-bar[data-v-2091d792]{height:1px}}@media (max-width:360px){.characters-grid[data-v-2091d792]{grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:4px}.character-card[data-v-2091d792]{width:80px;height:160px}.character-portrait[data-v-2091d792]{height:100%}.character-name[data-v-2091d792]{font-size:9px}.character-status-bar[data-v-2091d792]{padding:1px}.character-status-bar .stat-item .stat-icon[data-v-2091d792]{font-size:3px}.character-status-bar .stat-item .stat-bar[data-v-2091d792]{height:1px}}
</style></head><body><div id="app" style="min-height:100vh"></div><style>body,html{margin:0;padding:0}</style></body>